
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../CLI/">
      
      
        <link rel="next" href="../modeling.html">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.9">
    
    
      
        <title>API - ADToolbox</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0d440cfe.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="ADToolbox" class="md-header__button md-logo" aria-label="ADToolbox" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ADToolbox
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="ADToolbox" class="md-nav__button md-logo" aria-label="ADToolbox" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    ADToolbox
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Welcome to ADToolbox
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../CLI/" class="md-nav__link">
        Commandline Interface
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        API
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#configs" class="md-nav__link">
    configs
  </a>
  
    <nav class="md-nav" aria-label="configs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-database" class="md-nav__link">
    1. Database
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.configs.Database" class="md-nav__link">
    adtoolbox.configs.Database
  </a>
  
    <nav class="md-nav" aria-label="adtoolbox.configs.Database">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2-metagenomics" class="md-nav__link">
    2. Metagenomics
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.configs.Metagenomics" class="md-nav__link">
    adtoolbox.configs.Metagenomics
  </a>
  
    <nav class="md-nav" aria-label="adtoolbox.configs.Metagenomics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3-utils" class="md-nav__link">
    3. Utils
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.configs.Utils" class="md-nav__link">
    adtoolbox.configs.Utils
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core" class="md-nav__link">
    core
  </a>
  
    <nav class="md-nav" aria-label="core">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-experiment" class="md-nav__link">
    1. Experiment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Experiment" class="md-nav__link">
    adtoolbox.core.Experiment
  </a>
  
    <nav class="md-nav" aria-label="adtoolbox.core.Experiment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2-feed" class="md-nav__link">
    2. Feed
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Feed" class="md-nav__link">
    adtoolbox.core.Feed
  </a>
  
    <nav class="md-nav" aria-label="adtoolbox.core.Feed">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3-metegenomicsstudy" class="md-nav__link">
    3. MetegenomicsStudy
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.MetagenomicsStudy" class="md-nav__link">
    adtoolbox.core.MetagenomicsStudy
  </a>
  
    <nav class="md-nav" aria-label="adtoolbox.core.MetagenomicsStudy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#4-reaction" class="md-nav__link">
    4. Reaction
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Reaction" class="md-nav__link">
    adtoolbox.core.Reaction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Reaction.stoichiometry" class="md-nav__link">
    stoichiometry
  </a>
  
    <nav class="md-nav" aria-label="stoichiometry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5-metabolite" class="md-nav__link">
    5. Metabolite
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metabolite" class="md-nav__link">
    adtoolbox.core.Metabolite
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metabolite.cod_calc" class="md-nav__link">
    cod_calc()
  </a>
  
    <nav class="md-nav" aria-label="cod_calc()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#6seeddb" class="md-nav__link">
    6.SeedDB
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.SeedDB" class="md-nav__link">
    adtoolbox.core.SeedDB
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.SeedDB.get_seed_rxn_from_ec" class="md-nav__link">
    get_seed_rxn_from_ec()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.SeedDB.instantiate_metabs" class="md-nav__link">
    instantiate_metabs()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.SeedDB.instantiate_rxns" class="md-nav__link">
    instantiate_rxns()
  </a>
  
    <nav class="md-nav" aria-label="instantiate_rxns()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#7-database" class="md-nav__link">
    7. Database
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database" class="md-nav__link">
    adtoolbox.core.Database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.add_experiment_to_experiments_db" class="md-nav__link">
    add_experiment_to_experiments_db()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.add_feed_to_feed_db" class="md-nav__link">
    add_feed_to_feed_db()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.add_metagenomics_study_to_metagenomics_studies_db" class="md-nav__link">
    add_metagenomics_study_to_metagenomics_studies_db()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.add_protein_to_protein_db" class="md-nav__link">
    add_protein_to_protein_db()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.add_proteins_from_ecnumbers_to_protein_db" class="md-nav__link">
    add_proteins_from_ecnumbers_to_protein_db()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.build_mmseqs_database" class="md-nav__link">
    build_mmseqs_database()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.build_protein_db_from_reactions_db" class="md-nav__link">
    build_protein_db_from_reactions_db()
  </a>
  
    <nav class="md-nav" aria-label="build_protein_db_from_reactions_db()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.build_protein_db_from_reactions_db---configreaction_db" class="md-nav__link">
    - config.reaction_db
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.build_protein_db_from_reactions_db---configprotein_db" class="md-nav__link">
    - config.protein_db
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.download_adm_parameters" class="md-nav__link">
    download_adm_parameters()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.download_all_databases" class="md-nav__link">
    download_all_databases()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.download_amplicon_to_genome_db" class="md-nav__link">
    download_amplicon_to_genome_db()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.download_feed_database" class="md-nav__link">
    download_feed_database()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.download_protein_database" class="md-nav__link">
    download_protein_database()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.download_reaction_database" class="md-nav__link">
    download_reaction_database()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.download_seed_databases" class="md-nav__link">
    download_seed_databases()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.download_studies_database" class="md-nav__link">
    download_studies_database()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.filter_seed_from_ec" class="md-nav__link">
    filter_seed_from_ec()
  </a>
  
    <nav class="md-nav" aria-label="filter_seed_from_ec()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.filter_seed_from_ec---configreaction_db" class="md-nav__link">
    - config.reaction_db
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.filter_seed_from_ec---configcompound_db" class="md-nav__link">
    - config.compound_db
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.filter_seed_from_ec---configlocal_reaction_db" class="md-nav__link">
    - config.local_reaction_db
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.filter_seed_from_ec---configlocal_compound_db" class="md-nav__link">
    - config.local_compound_db
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.get_experiment_from_experiments_db" class="md-nav__link">
    get_experiment_from_experiments_db()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.get_feed_from_feed_db" class="md-nav__link">
    get_feed_from_feed_db()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.get_metagenomics_study_from_metagenomics_studies_db" class="md-nav__link">
    get_metagenomics_study_from_metagenomics_studies_db()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.get_protein_seqs_from_uniprot" class="md-nav__link">
    get_protein_seqs_from_uniprot()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.initialize_experimental_data_db" class="md-nav__link">
    initialize_experimental_data_db()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.initialize_feed_db" class="md-nav__link">
    initialize_feed_db()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.initialize_metagenomics_studies_db" class="md-nav__link">
    initialize_metagenomics_studies_db()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.initialize_protein_db" class="md-nav__link">
    initialize_protein_db()
  </a>
  
    <nav class="md-nav" aria-label="initialize_protein_db()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.initialize_protein_db---configprotein_db" class="md-nav__link">
    - config.protein_db
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.initialize_reaction_db" class="md-nav__link">
    initialize_reaction_db()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.proteins_from_ec" class="md-nav__link">
    proteins_from_ec()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.remove_experiment_from_experiments_db" class="md-nav__link">
    remove_experiment_from_experiments_db()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.remove_feed_from_feed_db" class="md-nav__link">
    remove_feed_from_feed_db()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.remove_metagenomics_study_from_metagenomics_studies_db" class="md-nav__link">
    remove_metagenomics_study_from_metagenomics_studies_db()
  </a>
  
    <nav class="md-nav" aria-label="remove_metagenomics_study_from_metagenomics_studies_db()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#8-metagenomics" class="md-nav__link">
    8. Metagenomics
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics" class="md-nav__link">
    adtoolbox.core.Metagenomics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.align_genome_to_protein_db" class="md-nav__link">
    align_genome_to_protein_db()
  </a>
  
    <nav class="md-nav" aria-label="align_genome_to_protein_db()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.align_genome_to_protein_db--configprotein_db-the-address-of-the-protein-database-of-the-adtoolbox" class="md-nav__link">
    config.protein_db: The address of the protein database of the ADToolbox.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.align_genome_to_protein_db--configadtoolbox_docker-the-name-of-the-docker-image-to-be-used-by-adtoolbox-only-if-using-docker-as-container" class="md-nav__link">
    config.adtoolbox_docker: The name of the docker image to be used by ADToolbox (Only if using Docker as container).
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.align_genome_to_protein_db--configadtoolbox_singularity-the-name-of-the-singularity-image-to-be-used-by-adtoolbox-only-if-using-singularity-as-container" class="md-nav__link">
    config.adtoolbox_singularity: The name of the singularity image to be used by ADToolbox (Only if using Singularity as container).
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.align_short_reads_to_protein_db" class="md-nav__link">
    align_short_reads_to_protein_db()
  </a>
  
    <nav class="md-nav" aria-label="align_short_reads_to_protein_db()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.align_short_reads_to_protein_db--protein_db_mmseqs-str-the-address-of-the-existingto-be-created-protein-database-of-the-adtoolbox-for-mmseqs" class="md-nav__link">
    protein_db_mmseqs (str): The address of the existing/to be created protein database of the ADToolbox for mmseqs.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.align_to_gtdb" class="md-nav__link">
    align_to_gtdb()
  </a>
  
    <nav class="md-nav" aria-label="align_to_gtdb()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.align_to_gtdb--configgtdb_dir_fasta-the-path-to-the-gtdb-fasta-database" class="md-nav__link">
    config.gtdb_dir_fasta: The path to the gtdb fasta database.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.align_to_gtdb--configvsearch_similarity-the-similarity-threshold-for-the-alignment-to-be-used-by-vsearch" class="md-nav__link">
    config.vsearch_similarity: The similarity threshold for the alignment to be used by VSEARCH.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.align_to_gtdb--configvsearch_threads-the-number-of-threads-to-be-used-by-vsearch" class="md-nav__link">
    config.vsearch_threads: The number of threads to be used by VSEARCH.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.align_to_gtdb--configadtoolbox_docker-the-name-of-the-docker-image-to-be-used-by-adtoolbox-only-if-using-docker-as-container" class="md-nav__link">
    config.adtoolbox_docker: The name of the docker image to be used by ADToolbox (Only if using Docker as container).
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.align_to_gtdb--configadtoolbox_singularity-the-name-of-the-singularity-image-to-be-used-by-adtoolbox-only-if-using-singularity-as-container" class="md-nav__link">
    config.adtoolbox_singularity: The name of the singularity image to be used by ADToolbox (Only if using Singularity as container).
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.assign_ec_to_genome" class="md-nav__link">
    assign_ec_to_genome()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.calculate_group_abundances" class="md-nav__link">
    calculate_group_abundances()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.download_genome" class="md-nav__link">
    download_genome()
  </a>
  
    <nav class="md-nav" aria-label="download_genome()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.download_genome--configgenomes_base_dir-the-path-to-the-base-directory-where-the-genomes-will-be-saved" class="md-nav__link">
    config.genomes_base_dir: The path to the base directory where the genomes will be saved.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.download_genome--configadtoolbox_docker-the-name-of-the-docker-image-to-be-used-by-adtoolbox-only-if-using-docker-as-container" class="md-nav__link">
    config.adtoolbox_docker: The name of the docker image to be used by ADToolbox (Only if using Docker as container).
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.download_genome--configadtoolbox_singularity-the-name-of-the-singularity-image-to-be-used-by-adtoolbox-only-if-using-singularity-as-container" class="md-nav__link">
    config.adtoolbox_singularity: The name of the singularity image to be used by ADToolbox (Only if using Singularity as container).
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.extract_ec_from_alignment" class="md-nav__link">
    extract_ec_from_alignment()
  </a>
  
    <nav class="md-nav" aria-label="extract_ec_from_alignment()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.extract_ec_from_alignment--confige_value-the-e-value-threshold-for-the-filtering-the-alignment-table" class="md-nav__link">
    config.e_value: The e-value threshold for the filtering the alignment table.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.extract_ec_from_alignment--configbit_score-the-bit-score-threshold-for-the-filtering-the-alignment-table" class="md-nav__link">
    config.bit_score: The bit score threshold for the filtering the alignment table.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.extract_ec_from_alignment--configec_counts_from_alignment-the-address-of-the-json-file-that-the-results-will-be-saved-in" class="md-nav__link">
    config.ec_counts_from_alignment: The address of the json file that the results will be saved in.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.extract_genome_info" class="md-nav__link">
    extract_genome_info()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.extract_relative_abundances" class="md-nav__link">
    extract_relative_abundances()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.find_top_taxa" class="md-nav__link">
    find_top_taxa()
  </a>
  
    <nav class="md-nav" aria-label="find_top_taxa()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.find_top_taxa--configfeature_table_dir-the-path-to-the-feature-table-tsv-file" class="md-nav__link">
    config.feature_table_dir: The path to the feature table tsv file.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.find_top_taxa--configtaxonomy_table_dir-the-path-to-the-taxonomy-table-tsv-file" class="md-nav__link">
    config.taxonomy_table_dir: The path to the taxonomy table tsv file.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.find_top_taxa--configrep_seq_fasta-the-path-to-the-representative-sequence-fasta-file" class="md-nav__link">
    config.rep_seq_fasta: The path to the representative sequence fasta file.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.get_cod_from_ec_counts" class="md-nav__link">
    get_cod_from_ec_counts()
  </a>
  
    <nav class="md-nav" aria-label="get_cod_from_ec_counts()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.get_cod_from_ec_counts--configadm_mapping-a-dictionary-that-maps-adm-reactions-to-adm-microbial-agents" class="md-nav__link">
    config.adm_mapping : A dictionary that maps ADM reactions to ADM microbial agents.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.get_cod_from_ec_counts--configcsv_reaction_db-the-address-of-the-reaction-database-of-adtoolbox" class="md-nav__link">
    config.csv_reaction_db : The address of the reaction database of ADToolbox.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.get_cod_from_ec_counts--configadm_cod_from_ec-the-address-of-the-json-file-that-the-results-will-be-saved-in" class="md-nav__link">
    config.adm_cod_from_ec  : The address of the json file that the results will be saved in.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.get_genomes_from_gtdb_alignment" class="md-nav__link">
    get_genomes_from_gtdb_alignment()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.merge_paired_sequences" class="md-nav__link">
    merge_paired_sequences()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.run_qiime2_from_sra" class="md-nav__link">
    run_qiime2_from_sra()
  </a>
  
    <nav class="md-nav" aria-label="run_qiime2_from_sra()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.run_qiime2_from_sra--configqiime2_single_end_bash_str-the-path-to-the-qiime2-bash-script-for-single-end-reads" class="md-nav__link">
    config.qiime2_single_end_bash_str: The path to the qiime2 bash script for single end reads.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.run_qiime2_from_sra--configqiime2_paired_end_bash_str-the-path-to-the-qiime2-bash-script-for-paired-end-reads" class="md-nav__link">
    config.qiime2_paired_end_bash_str: The path to the qiime2 bash script for paired end reads.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.run_qiime2_from_sra--configqiime_classifier_db-the-path-to-the-qiime2-classifier-database" class="md-nav__link">
    config.qiime_classifier_db: The path to the qiime2 classifier database.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.run_qiime2_from_sra--configqiime2_docker_image-the-name-of-the-docker-image-to-be-used-by-adtoolbox-only-if-using-docker-as-container" class="md-nav__link">
    config.qiime2_docker_image: The name of the docker image to be used by ADToolbox (Only if using Docker as container).
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.run_qiime2_from_sra--configqiime2_singularity_image-the-name-of-the-singularity-image-to-be-used-by-adtoolbox-only-if-using-singularity-as-container" class="md-nav__link">
    config.qiime2_singularity_image: The name of the singularity image to be used by ADToolbox (Only if using Singularity as container).
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.seqs_from_sra" class="md-nav__link">
    seqs_from_sra()
  </a>
  
    <nav class="md-nav" aria-label="seqs_from_sra()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.seqs_from_sra--note-in-order-for-this-method-to-work-without-any-container-you-need-to-have-the-sra-toolkit-installed-on-your-system-or" class="md-nav__link">
    NOTE In order for this method to work without any container, you need to have the SRA toolkit installed on your system or
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adm" class="md-nav__link">
    adm
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.adm" class="md-nav__link">
    adtoolbox.adm
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.adm.Model" class="md-nav__link">
    Model
  </a>
  
    <nav class="md-nav" aria-label="Model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adtoolbox.adm.Model.s" class="md-nav__link">
    s
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.adm.Model.build_cobra_model" class="md-nav__link">
    build_cobra_model()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.adm.Model.copy" class="md-nav__link">
    copy()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.adm.Model.csv_report" class="md-nav__link">
    csv_report()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.adm.Model.dash_app" class="md-nav__link">
    dash_app()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.adm.Model.plot" class="md-nav__link">
    plot()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.adm.Model.solve_model" class="md-nav__link">
    solve_model()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.adm.Model.update_parameters" class="md-nav__link">
    update_parameters()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.adm.adm1_ode_sys" class="md-nav__link">
    adm1_ode_sys()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.adm.build_adm1_stoiciometric_matrix" class="md-nav__link">
    build_adm1_stoiciometric_matrix()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.adm.build_e_adm_2_stoichiometric_matrix" class="md-nav__link">
    build_e_adm_2_stoichiometric_matrix()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.adm.build_e_adm_stoiciometric_matrix" class="md-nav__link">
    build_e_adm_stoiciometric_matrix()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.adm.e_adm_2_ode_sys" class="md-nav__link">
    e_adm_2_ode_sys()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.adm.e_adm_ode_sys" class="md-nav__link">
    e_adm_ode_sys()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../modeling.html" class="md-nav__link">
        Modeling Pipeline
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../parameter_tuning.html" class="md-nav__link">
        Parameter Tuning Pipeline
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Metagenomics_Pipeline/" class="md-nav__link">
        Metagenomics Pipelines
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#configs" class="md-nav__link">
    configs
  </a>
  
    <nav class="md-nav" aria-label="configs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-database" class="md-nav__link">
    1. Database
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.configs.Database" class="md-nav__link">
    adtoolbox.configs.Database
  </a>
  
    <nav class="md-nav" aria-label="adtoolbox.configs.Database">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2-metagenomics" class="md-nav__link">
    2. Metagenomics
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.configs.Metagenomics" class="md-nav__link">
    adtoolbox.configs.Metagenomics
  </a>
  
    <nav class="md-nav" aria-label="adtoolbox.configs.Metagenomics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3-utils" class="md-nav__link">
    3. Utils
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.configs.Utils" class="md-nav__link">
    adtoolbox.configs.Utils
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core" class="md-nav__link">
    core
  </a>
  
    <nav class="md-nav" aria-label="core">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-experiment" class="md-nav__link">
    1. Experiment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Experiment" class="md-nav__link">
    adtoolbox.core.Experiment
  </a>
  
    <nav class="md-nav" aria-label="adtoolbox.core.Experiment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2-feed" class="md-nav__link">
    2. Feed
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Feed" class="md-nav__link">
    adtoolbox.core.Feed
  </a>
  
    <nav class="md-nav" aria-label="adtoolbox.core.Feed">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3-metegenomicsstudy" class="md-nav__link">
    3. MetegenomicsStudy
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.MetagenomicsStudy" class="md-nav__link">
    adtoolbox.core.MetagenomicsStudy
  </a>
  
    <nav class="md-nav" aria-label="adtoolbox.core.MetagenomicsStudy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#4-reaction" class="md-nav__link">
    4. Reaction
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Reaction" class="md-nav__link">
    adtoolbox.core.Reaction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Reaction.stoichiometry" class="md-nav__link">
    stoichiometry
  </a>
  
    <nav class="md-nav" aria-label="stoichiometry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5-metabolite" class="md-nav__link">
    5. Metabolite
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metabolite" class="md-nav__link">
    adtoolbox.core.Metabolite
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metabolite.cod_calc" class="md-nav__link">
    cod_calc()
  </a>
  
    <nav class="md-nav" aria-label="cod_calc()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#6seeddb" class="md-nav__link">
    6.SeedDB
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.SeedDB" class="md-nav__link">
    adtoolbox.core.SeedDB
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.SeedDB.get_seed_rxn_from_ec" class="md-nav__link">
    get_seed_rxn_from_ec()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.SeedDB.instantiate_metabs" class="md-nav__link">
    instantiate_metabs()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.SeedDB.instantiate_rxns" class="md-nav__link">
    instantiate_rxns()
  </a>
  
    <nav class="md-nav" aria-label="instantiate_rxns()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#7-database" class="md-nav__link">
    7. Database
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database" class="md-nav__link">
    adtoolbox.core.Database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.add_experiment_to_experiments_db" class="md-nav__link">
    add_experiment_to_experiments_db()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.add_feed_to_feed_db" class="md-nav__link">
    add_feed_to_feed_db()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.add_metagenomics_study_to_metagenomics_studies_db" class="md-nav__link">
    add_metagenomics_study_to_metagenomics_studies_db()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.add_protein_to_protein_db" class="md-nav__link">
    add_protein_to_protein_db()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.add_proteins_from_ecnumbers_to_protein_db" class="md-nav__link">
    add_proteins_from_ecnumbers_to_protein_db()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.build_mmseqs_database" class="md-nav__link">
    build_mmseqs_database()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.build_protein_db_from_reactions_db" class="md-nav__link">
    build_protein_db_from_reactions_db()
  </a>
  
    <nav class="md-nav" aria-label="build_protein_db_from_reactions_db()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.build_protein_db_from_reactions_db---configreaction_db" class="md-nav__link">
    - config.reaction_db
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.build_protein_db_from_reactions_db---configprotein_db" class="md-nav__link">
    - config.protein_db
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.download_adm_parameters" class="md-nav__link">
    download_adm_parameters()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.download_all_databases" class="md-nav__link">
    download_all_databases()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.download_amplicon_to_genome_db" class="md-nav__link">
    download_amplicon_to_genome_db()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.download_feed_database" class="md-nav__link">
    download_feed_database()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.download_protein_database" class="md-nav__link">
    download_protein_database()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.download_reaction_database" class="md-nav__link">
    download_reaction_database()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.download_seed_databases" class="md-nav__link">
    download_seed_databases()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.download_studies_database" class="md-nav__link">
    download_studies_database()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.filter_seed_from_ec" class="md-nav__link">
    filter_seed_from_ec()
  </a>
  
    <nav class="md-nav" aria-label="filter_seed_from_ec()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.filter_seed_from_ec---configreaction_db" class="md-nav__link">
    - config.reaction_db
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.filter_seed_from_ec---configcompound_db" class="md-nav__link">
    - config.compound_db
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.filter_seed_from_ec---configlocal_reaction_db" class="md-nav__link">
    - config.local_reaction_db
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.filter_seed_from_ec---configlocal_compound_db" class="md-nav__link">
    - config.local_compound_db
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.get_experiment_from_experiments_db" class="md-nav__link">
    get_experiment_from_experiments_db()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.get_feed_from_feed_db" class="md-nav__link">
    get_feed_from_feed_db()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.get_metagenomics_study_from_metagenomics_studies_db" class="md-nav__link">
    get_metagenomics_study_from_metagenomics_studies_db()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.get_protein_seqs_from_uniprot" class="md-nav__link">
    get_protein_seqs_from_uniprot()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.initialize_experimental_data_db" class="md-nav__link">
    initialize_experimental_data_db()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.initialize_feed_db" class="md-nav__link">
    initialize_feed_db()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.initialize_metagenomics_studies_db" class="md-nav__link">
    initialize_metagenomics_studies_db()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.initialize_protein_db" class="md-nav__link">
    initialize_protein_db()
  </a>
  
    <nav class="md-nav" aria-label="initialize_protein_db()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.initialize_protein_db---configprotein_db" class="md-nav__link">
    - config.protein_db
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.initialize_reaction_db" class="md-nav__link">
    initialize_reaction_db()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.proteins_from_ec" class="md-nav__link">
    proteins_from_ec()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.remove_experiment_from_experiments_db" class="md-nav__link">
    remove_experiment_from_experiments_db()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.remove_feed_from_feed_db" class="md-nav__link">
    remove_feed_from_feed_db()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.remove_metagenomics_study_from_metagenomics_studies_db" class="md-nav__link">
    remove_metagenomics_study_from_metagenomics_studies_db()
  </a>
  
    <nav class="md-nav" aria-label="remove_metagenomics_study_from_metagenomics_studies_db()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#8-metagenomics" class="md-nav__link">
    8. Metagenomics
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics" class="md-nav__link">
    adtoolbox.core.Metagenomics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.align_genome_to_protein_db" class="md-nav__link">
    align_genome_to_protein_db()
  </a>
  
    <nav class="md-nav" aria-label="align_genome_to_protein_db()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.align_genome_to_protein_db--configprotein_db-the-address-of-the-protein-database-of-the-adtoolbox" class="md-nav__link">
    config.protein_db: The address of the protein database of the ADToolbox.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.align_genome_to_protein_db--configadtoolbox_docker-the-name-of-the-docker-image-to-be-used-by-adtoolbox-only-if-using-docker-as-container" class="md-nav__link">
    config.adtoolbox_docker: The name of the docker image to be used by ADToolbox (Only if using Docker as container).
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.align_genome_to_protein_db--configadtoolbox_singularity-the-name-of-the-singularity-image-to-be-used-by-adtoolbox-only-if-using-singularity-as-container" class="md-nav__link">
    config.adtoolbox_singularity: The name of the singularity image to be used by ADToolbox (Only if using Singularity as container).
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.align_short_reads_to_protein_db" class="md-nav__link">
    align_short_reads_to_protein_db()
  </a>
  
    <nav class="md-nav" aria-label="align_short_reads_to_protein_db()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.align_short_reads_to_protein_db--protein_db_mmseqs-str-the-address-of-the-existingto-be-created-protein-database-of-the-adtoolbox-for-mmseqs" class="md-nav__link">
    protein_db_mmseqs (str): The address of the existing/to be created protein database of the ADToolbox for mmseqs.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.align_to_gtdb" class="md-nav__link">
    align_to_gtdb()
  </a>
  
    <nav class="md-nav" aria-label="align_to_gtdb()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.align_to_gtdb--configgtdb_dir_fasta-the-path-to-the-gtdb-fasta-database" class="md-nav__link">
    config.gtdb_dir_fasta: The path to the gtdb fasta database.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.align_to_gtdb--configvsearch_similarity-the-similarity-threshold-for-the-alignment-to-be-used-by-vsearch" class="md-nav__link">
    config.vsearch_similarity: The similarity threshold for the alignment to be used by VSEARCH.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.align_to_gtdb--configvsearch_threads-the-number-of-threads-to-be-used-by-vsearch" class="md-nav__link">
    config.vsearch_threads: The number of threads to be used by VSEARCH.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.align_to_gtdb--configadtoolbox_docker-the-name-of-the-docker-image-to-be-used-by-adtoolbox-only-if-using-docker-as-container" class="md-nav__link">
    config.adtoolbox_docker: The name of the docker image to be used by ADToolbox (Only if using Docker as container).
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.align_to_gtdb--configadtoolbox_singularity-the-name-of-the-singularity-image-to-be-used-by-adtoolbox-only-if-using-singularity-as-container" class="md-nav__link">
    config.adtoolbox_singularity: The name of the singularity image to be used by ADToolbox (Only if using Singularity as container).
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.assign_ec_to_genome" class="md-nav__link">
    assign_ec_to_genome()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.calculate_group_abundances" class="md-nav__link">
    calculate_group_abundances()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.download_genome" class="md-nav__link">
    download_genome()
  </a>
  
    <nav class="md-nav" aria-label="download_genome()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.download_genome--configgenomes_base_dir-the-path-to-the-base-directory-where-the-genomes-will-be-saved" class="md-nav__link">
    config.genomes_base_dir: The path to the base directory where the genomes will be saved.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.download_genome--configadtoolbox_docker-the-name-of-the-docker-image-to-be-used-by-adtoolbox-only-if-using-docker-as-container" class="md-nav__link">
    config.adtoolbox_docker: The name of the docker image to be used by ADToolbox (Only if using Docker as container).
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.download_genome--configadtoolbox_singularity-the-name-of-the-singularity-image-to-be-used-by-adtoolbox-only-if-using-singularity-as-container" class="md-nav__link">
    config.adtoolbox_singularity: The name of the singularity image to be used by ADToolbox (Only if using Singularity as container).
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.extract_ec_from_alignment" class="md-nav__link">
    extract_ec_from_alignment()
  </a>
  
    <nav class="md-nav" aria-label="extract_ec_from_alignment()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.extract_ec_from_alignment--confige_value-the-e-value-threshold-for-the-filtering-the-alignment-table" class="md-nav__link">
    config.e_value: The e-value threshold for the filtering the alignment table.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.extract_ec_from_alignment--configbit_score-the-bit-score-threshold-for-the-filtering-the-alignment-table" class="md-nav__link">
    config.bit_score: The bit score threshold for the filtering the alignment table.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.extract_ec_from_alignment--configec_counts_from_alignment-the-address-of-the-json-file-that-the-results-will-be-saved-in" class="md-nav__link">
    config.ec_counts_from_alignment: The address of the json file that the results will be saved in.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.extract_genome_info" class="md-nav__link">
    extract_genome_info()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.extract_relative_abundances" class="md-nav__link">
    extract_relative_abundances()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.find_top_taxa" class="md-nav__link">
    find_top_taxa()
  </a>
  
    <nav class="md-nav" aria-label="find_top_taxa()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.find_top_taxa--configfeature_table_dir-the-path-to-the-feature-table-tsv-file" class="md-nav__link">
    config.feature_table_dir: The path to the feature table tsv file.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.find_top_taxa--configtaxonomy_table_dir-the-path-to-the-taxonomy-table-tsv-file" class="md-nav__link">
    config.taxonomy_table_dir: The path to the taxonomy table tsv file.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.find_top_taxa--configrep_seq_fasta-the-path-to-the-representative-sequence-fasta-file" class="md-nav__link">
    config.rep_seq_fasta: The path to the representative sequence fasta file.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.get_cod_from_ec_counts" class="md-nav__link">
    get_cod_from_ec_counts()
  </a>
  
    <nav class="md-nav" aria-label="get_cod_from_ec_counts()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.get_cod_from_ec_counts--configadm_mapping-a-dictionary-that-maps-adm-reactions-to-adm-microbial-agents" class="md-nav__link">
    config.adm_mapping : A dictionary that maps ADM reactions to ADM microbial agents.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.get_cod_from_ec_counts--configcsv_reaction_db-the-address-of-the-reaction-database-of-adtoolbox" class="md-nav__link">
    config.csv_reaction_db : The address of the reaction database of ADToolbox.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.get_cod_from_ec_counts--configadm_cod_from_ec-the-address-of-the-json-file-that-the-results-will-be-saved-in" class="md-nav__link">
    config.adm_cod_from_ec  : The address of the json file that the results will be saved in.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.get_genomes_from_gtdb_alignment" class="md-nav__link">
    get_genomes_from_gtdb_alignment()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.merge_paired_sequences" class="md-nav__link">
    merge_paired_sequences()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.run_qiime2_from_sra" class="md-nav__link">
    run_qiime2_from_sra()
  </a>
  
    <nav class="md-nav" aria-label="run_qiime2_from_sra()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.run_qiime2_from_sra--configqiime2_single_end_bash_str-the-path-to-the-qiime2-bash-script-for-single-end-reads" class="md-nav__link">
    config.qiime2_single_end_bash_str: The path to the qiime2 bash script for single end reads.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.run_qiime2_from_sra--configqiime2_paired_end_bash_str-the-path-to-the-qiime2-bash-script-for-paired-end-reads" class="md-nav__link">
    config.qiime2_paired_end_bash_str: The path to the qiime2 bash script for paired end reads.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.run_qiime2_from_sra--configqiime_classifier_db-the-path-to-the-qiime2-classifier-database" class="md-nav__link">
    config.qiime_classifier_db: The path to the qiime2 classifier database.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.run_qiime2_from_sra--configqiime2_docker_image-the-name-of-the-docker-image-to-be-used-by-adtoolbox-only-if-using-docker-as-container" class="md-nav__link">
    config.qiime2_docker_image: The name of the docker image to be used by ADToolbox (Only if using Docker as container).
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.run_qiime2_from_sra--configqiime2_singularity_image-the-name-of-the-singularity-image-to-be-used-by-adtoolbox-only-if-using-singularity-as-container" class="md-nav__link">
    config.qiime2_singularity_image: The name of the singularity image to be used by ADToolbox (Only if using Singularity as container).
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.seqs_from_sra" class="md-nav__link">
    seqs_from_sra()
  </a>
  
    <nav class="md-nav" aria-label="seqs_from_sra()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.seqs_from_sra--note-in-order-for-this-method-to-work-without-any-container-you-need-to-have-the-sra-toolkit-installed-on-your-system-or" class="md-nav__link">
    NOTE In order for this method to work without any container, you need to have the SRA toolkit installed on your system or
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adm" class="md-nav__link">
    adm
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.adm" class="md-nav__link">
    adtoolbox.adm
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.adm.Model" class="md-nav__link">
    Model
  </a>
  
    <nav class="md-nav" aria-label="Model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adtoolbox.adm.Model.s" class="md-nav__link">
    s
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.adm.Model.build_cobra_model" class="md-nav__link">
    build_cobra_model()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.adm.Model.copy" class="md-nav__link">
    copy()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.adm.Model.csv_report" class="md-nav__link">
    csv_report()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.adm.Model.dash_app" class="md-nav__link">
    dash_app()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.adm.Model.plot" class="md-nav__link">
    plot()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.adm.Model.solve_model" class="md-nav__link">
    solve_model()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.adm.Model.update_parameters" class="md-nav__link">
    update_parameters()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.adm.adm1_ode_sys" class="md-nav__link">
    adm1_ode_sys()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.adm.build_adm1_stoiciometric_matrix" class="md-nav__link">
    build_adm1_stoiciometric_matrix()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.adm.build_e_adm_2_stoichiometric_matrix" class="md-nav__link">
    build_e_adm_2_stoichiometric_matrix()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.adm.build_e_adm_stoiciometric_matrix" class="md-nav__link">
    build_e_adm_stoiciometric_matrix()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.adm.e_adm_2_ode_sys" class="md-nav__link">
    e_adm_2_ode_sys()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.adm.e_adm_ode_sys" class="md-nav__link">
    e_adm_ode_sys()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="api">API</h1>
<p>ADToolbox has its own way of figuring out the path to the required files and configurations required for running different methods. The entire toolbox relies on the configs module. Objects of different classes in ADToolbox are instantiated by an instance of the corresponding class in the configs module. For instance, if you want to use the methods of the metagenomics class in core module, you should do the following:</p>
<pre><code>from adtoolbox import configs and core

metag_conf=configs.Metagenomics() 
metag_object=core.Metagenomics(metag_conf)

</code></pre>
<p>Doing this will result in that any core.Metagenomics method will refer to the defult configurations defined in the configs module. If you want to overwright the defult configuration, you can pass the desired argument to the configs.Metagenomics constructor. For example, if you want to change the docker repository for VSEARCH
you can:</p>
<pre><code>
metag_conf=configs.Metagenomics(vsearch_docker=&quot;mydocker&quot;) 
metag_object=core.Metagenomics(metag_conf)

</code></pre>
<p>Now when you execute the corresponding method in core.Metagenomics it will use mydocker instead of the defult. To learn more about defult configs, go to the configs api.</p>
<h2 id="configs">configs</h2>
<p>You can access this module by:</p>
<pre><code>from adtoolbox import configs 

</code></pre>
<p>This module contains configurations that are required by other classes in the package and also links to remote databases. The following classes are included in this module:</p>
<h3 id="1-database">1. Database</h3>


<div class="doc doc-object doc-class">


<a id="adtoolbox.configs.Database"></a>
  <div class="doc doc-contents first">

  
      <p>An instance of this class will hold all the configuration information for core.Database functionalities.</p>


        <details class="quote">
          <summary>Source code in <code>adtoolbox/configs.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Database</span><span class="p">:</span>
	<span class="s2">&quot;An instance of this class will hold all the configuration information for core.Database functionalities.&quot;</span>

	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
		<span class="n">compound_db</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="n">Seed_COMPOUNDS_DB</span><span class="p">,</span>
		<span class="n">reaction_db</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="n">Seed_RXN_DB</span><span class="p">,</span>
		<span class="n">local_compound_db</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span> <span class="s2">&quot;Database&quot;</span><span class="p">,</span> <span class="s1">&#39;Local_compounds.json&#39;</span><span class="p">),</span>
		<span class="n">local_reaction_db</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span> <span class="s2">&quot;Database&quot;</span><span class="p">,</span> <span class="s1">&#39;Local_reactions.json&#39;</span><span class="p">),</span>
		<span class="n">csv_reaction_db</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span> <span class="s2">&quot;Database&quot;</span><span class="p">,</span> <span class="s1">&#39;Reaction_Metadata.csv&#39;</span><span class="p">),</span>
		<span class="n">feed_db</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span> <span class="s2">&quot;Database&quot;</span><span class="p">,</span> <span class="s1">&#39;feed_db.tsv&#39;</span><span class="p">),</span>
		<span class="n">amplicon_to_genome_db</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s1">&#39;Database&#39;</span><span class="p">,</span><span class="s1">&#39;Amplicon2GenomeDBs&#39;</span><span class="p">),</span>
		<span class="n">cazy_links</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="n">EXTERNAL_LINKS</span><span class="p">[</span><span class="s2">&quot;cazy_links&quot;</span><span class="p">],</span>
		<span class="n">amplicon_to_genome_urls</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="n">EXTERNAL_LINKS</span><span class="p">[</span><span class="s2">&quot;amplicon2genome&quot;</span><span class="p">],</span>
		<span class="n">adm_parameters_urls</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="n">E_ADM_REMOTE</span><span class="p">,</span>
		<span class="n">adm_parameters</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="n">E_ADM_LOCAL</span><span class="p">,</span>
		<span class="n">seed_rxn_url</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span><span class="n">EXTERNAL_LINKS</span><span class="p">[</span><span class="s2">&quot;seed_rxn_url&quot;</span><span class="p">],</span>
		<span class="n">seed_compound_url</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span><span class="n">EXTERNAL_LINKS</span><span class="p">[</span><span class="s2">&quot;seed_compound_url&quot;</span><span class="p">],</span>
		<span class="n">protein_db_url</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span><span class="n">INTERNAL_LINKS</span><span class="p">[</span><span class="s2">&quot;protein_db_url&quot;</span><span class="p">],</span>
		<span class="n">adtoolbox_rxn_db_url</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span><span class="n">INTERNAL_LINKS</span><span class="p">[</span><span class="s2">&quot;adtoolbox_rxn_db_url&quot;</span><span class="p">],</span>
		<span class="n">feed_db_url</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span><span class="n">INTERNAL_LINKS</span><span class="p">[</span><span class="s2">&quot;feed_db_url&quot;</span><span class="p">],</span>
		<span class="n">qiime_classifier_db</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span> <span class="s2">&quot;Database&quot;</span><span class="p">,</span><span class="s2">&quot;qiime2_classifier_db&quot;</span> <span class="p">,</span><span class="s1">&#39;qiime2_classifier_db.qza&#39;</span><span class="p">),</span>
		<span class="n">qiime_classifier_db_url</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="n">INTERNAL_LINKS</span><span class="p">[</span><span class="s2">&quot;qiime_classifier_db_url&quot;</span><span class="p">],</span>
  		<span class="n">adtoolbox_singularity</span><span class="o">=</span><span class="n">ADTOOLBOX_CONTAINERS</span><span class="p">[</span><span class="s2">&quot;singularity_x86&quot;</span><span class="p">],</span>
		<span class="n">adtoolbox_docker</span><span class="o">=</span><span class="n">ADTOOLBOX_CONTAINERS</span><span class="p">[</span><span class="s2">&quot;docker_x86&quot;</span><span class="p">],</span>
    	<span class="n">protein_db</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span> <span class="s2">&quot;Database&quot;</span><span class="p">,</span> <span class="s1">&#39;Protein_DB.fasta&#39;</span><span class="p">),</span>
		<span class="n">adm_microbial_groups_mapping</span><span class="o">=</span><span class="n">E_ADM_MICROBIAL_GROUPS_MAPPING</span><span class="p">,</span>
        <span class="n">studies_remote</span><span class="o">=</span><span class="n">INTERNAL_LINKS</span><span class="p">,</span>
        <span class="n">studies_local</span><span class="o">=</span><span class="n">STUDIES_LOCAL</span><span class="p">,</span>
        <span class="n">check_sanity</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span>
		<span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">compound_db</span> <span class="o">=</span> <span class="n">compound_db</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">reaction_db</span> <span class="o">=</span> <span class="n">reaction_db</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">local_compound_db</span> <span class="o">=</span> <span class="n">local_compound_db</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">local_reaction_db</span> <span class="o">=</span> <span class="n">local_reaction_db</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">csv_reaction_db</span> <span class="o">=</span> <span class="n">csv_reaction_db</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">feed_db</span> <span class="o">=</span> <span class="n">feed_db</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">amplicon_to_genome_db</span> <span class="o">=</span> <span class="n">amplicon_to_genome_db</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">cazy_links</span> <span class="o">=</span> <span class="n">cazy_links</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">amplicon_to_genome_urls</span> <span class="o">=</span> <span class="n">amplicon_to_genome_urls</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">adm_parameters_urls</span> <span class="o">=</span> <span class="n">adm_parameters_urls</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">adm_parameters</span> <span class="o">=</span> <span class="n">adm_parameters</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">seed_rxn_url</span> <span class="o">=</span> <span class="n">seed_rxn_url</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">seed_compound_url</span> <span class="o">=</span> <span class="n">seed_compound_url</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">protein_db_url</span> <span class="o">=</span> <span class="n">protein_db_url</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">adtoolbox_rxn_db_url</span> <span class="o">=</span> <span class="n">adtoolbox_rxn_db_url</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">feed_db_url</span> <span class="o">=</span> <span class="n">feed_db_url</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">qiime_classifier_db</span> <span class="o">=</span> <span class="n">qiime_classifier_db</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">qiime_classifier_db_url</span> <span class="o">=</span> <span class="n">qiime_classifier_db_url</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">adtoolbox_singularity</span><span class="o">=</span><span class="n">adtoolbox_singularity</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">adtoolbox_docker</span><span class="o">=</span><span class="n">adtoolbox_docker</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">protein_db</span><span class="o">=</span><span class="n">protein_db</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">adm_microbial_groups_mapping</span><span class="o">=</span><span class="n">adm_microbial_groups_mapping</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">studies_remote</span><span class="o">=</span><span class="n">studies_remote</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">studies_local</span><span class="o">=</span><span class="n">studies_local</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">protein_db_mmseqs</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">protein_db</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;protein_db_mmseqs&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">check_sanity</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">check_adm_parameters</span><span class="p">()</span>

	<span class="k">def</span> <span class="nf">check_adm_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">branches</span><span class="o">=</span><span class="nb">all</span><span class="p">([</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">==</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adm_parameters</span><span class="p">[</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">parent</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">adm_parameters</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">branches</span><span class="p">:</span>
			<span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The ADM parameters are not in the same directory!&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div><h3 id="2-metagenomics">2. Metagenomics</h3>


<div class="doc doc-object doc-class">


<a id="adtoolbox.configs.Metagenomics"></a>
  <div class="doc doc-contents first">

  
      <p>An instance of this class will hold all the configuration information for core.Metagenomics functionalities.</p>


        <details class="quote">
          <summary>Source code in <code>adtoolbox/configs.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Metagenomics</span><span class="p">:</span>
	<span class="sd">&quot;&quot;&quot;	</span>
<span class="sd">	An instance of this class will hold all the configuration information for core.Metagenomics functionalities.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="c1">### Here we have some class variables that are used in the class</span>
	<span class="n">gtdb_dir</span><span class="o">=</span><span class="s2">&quot;ssu_all*.fna&quot;</span>
	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
            <span class="n">amplicon2genome_k</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">vsearch_similarity</span><span class="o">=</span><span class="mf">0.97</span><span class="p">,</span>
            <span class="n">genomes_base_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;Genomes&quot;</span><span class="p">),</span>
            <span class="n">align_to_gtdb_outputs_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;Genomes&quot;</span><span class="p">),</span>
            <span class="n">amplicon2genome_db</span><span class="o">=</span><span class="n">Database</span><span class="p">()</span><span class="o">.</span><span class="n">amplicon_to_genome_db</span><span class="p">,</span>
            <span class="n">qiime_outputs_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s1">&#39;Metagenomics_Data&#39;</span><span class="p">,</span><span class="s1">&#39;QIIME_Outputs&#39;</span><span class="p">),</span>
			<span class="n">genome_alignment_script</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;Metagenomics_Data&quot;</span><span class="p">,</span><span class="s2">&quot;QIIME_Outputs&quot;</span><span class="p">,</span><span class="s2">&quot;genome_alignment_script.sh&quot;</span><span class="p">),</span>
			<span class="n">vsearch_threads</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
			<span class="n">rsync_download_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;Genomes&quot;</span><span class="p">,</span><span class="s2">&quot;rsync_download.sh&quot;</span><span class="p">),</span>
			<span class="n">adtoolbox_singularity</span><span class="o">=</span><span class="n">ADTOOLBOX_CONTAINERS</span><span class="p">[</span><span class="s2">&quot;singularity_x86&quot;</span><span class="p">],</span>
			<span class="n">adtoolbox_docker</span><span class="o">=</span><span class="n">ADTOOLBOX_CONTAINERS</span><span class="p">[</span><span class="s2">&quot;docker_x86&quot;</span><span class="p">],</span>
            <span class="n">genome_alignment_output</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;Outputs&quot;</span><span class="p">),</span>
            <span class="n">csv_reaction_db</span><span class="o">=</span><span class="n">Database</span><span class="p">()</span><span class="o">.</span><span class="n">csv_reaction_db</span><span class="p">,</span>
            <span class="n">sra</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;Metagenomics_Analysis&quot;</span><span class="p">,</span><span class="s2">&quot;SRA&quot;</span><span class="p">),</span>
            <span class="n">bit_score</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
            <span class="n">e_value</span><span class="o">=</span><span class="mi">10</span><span class="o">**-</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">qiime2_docker_image</span><span class="o">=</span><span class="s2">&quot;quay.io/qiime2/core:2022.2&quot;</span><span class="p">,</span>
            <span class="n">qiime2_singularity_image</span><span class="o">=</span><span class="s2">&quot;docker://quay.io/qiime2/core:2022.2&quot;</span><span class="p">,</span>
            <span class="n">qiime2_paired_end_bash_str</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PKG_DATA</span><span class="p">,</span><span class="s2">&quot;qiime_template_paired.txt&quot;</span><span class="p">),</span>
            <span class="n">qiime2_single_end_bash_str</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PKG_DATA</span><span class="p">,</span><span class="s2">&quot;qiime_template_single.txt&quot;</span><span class="p">),</span>
			<span class="n">qiime_classifier_db</span><span class="o">=</span><span class="n">Database</span><span class="p">()</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">,</span>
			<span class="n">protein_db</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="n">Database</span><span class="p">()</span><span class="o">.</span><span class="n">protein_db</span><span class="p">,</span>
			<span class="n">protein_db_mmseqs</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="n">Database</span><span class="p">()</span><span class="o">.</span><span class="n">protein_db_mmseqs</span><span class="p">,</span>
			<span class="n">adm_mapping</span><span class="o">=</span><span class="n">E_ADM_MICROBIAL_GROUPS_MAPPING</span><span class="p">,</span>
			<span class="n">qiime2_p_trunc_len</span><span class="p">:</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;250&quot;</span><span class="p">,</span><span class="s2">&quot;250&quot;</span><span class="p">),</span>
             <span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">amplicon2genome_k</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">vsearch_similarity</span> <span class="o">=</span> <span class="n">vsearch_similarity</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">align_to_gtdb_outputs_dir</span> <span class="o">=</span> <span class="n">align_to_gtdb_outputs_dir</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">amplicon2genome_db</span> <span class="o">=</span> <span class="n">amplicon2genome_db</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">qiime_outputs_dir</span> <span class="o">=</span> <span class="n">qiime_outputs_dir</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">protein_db</span><span class="o">=</span><span class="n">protein_db</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">protein_db_mmseqs</span><span class="o">=</span><span class="n">protein_db_mmseqs</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">seed_rxn_db</span><span class="o">=</span><span class="n">Seed_RXN_DB</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">genome_alignment_output</span> <span class="o">=</span> <span class="n">genome_alignment_output</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">bit_score</span> <span class="o">=</span> <span class="n">bit_score</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">e_value</span> <span class="o">=</span> <span class="n">e_value</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">vsearch_threads</span><span class="o">=</span><span class="n">vsearch_threads</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">csv_reaction_db</span><span class="o">=</span><span class="n">csv_reaction_db</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sra</span><span class="o">=</span><span class="n">sra</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">qiime2_singularity_image</span><span class="o">=</span><span class="n">qiime2_singularity_image</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">qiime2_docker_image</span><span class="o">=</span><span class="n">qiime2_docker_image</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">qiime2_paired_end_bash_str</span><span class="o">=</span><span class="n">qiime2_paired_end_bash_str</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">qiime2_single_end_bash_str</span><span class="o">=</span><span class="n">qiime2_single_end_bash_str</span> 
		<span class="bp">self</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="o">=</span><span class="n">qiime_classifier_db</span>
		<span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amplicon2genome_db</span><span class="p">)</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="n">Metagenomics</span><span class="o">.</span><span class="n">gtdb_dir</span><span class="p">)):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">gtdb_dir_fasta</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amplicon2genome_db</span><span class="p">)</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="n">Metagenomics</span><span class="o">.</span><span class="n">gtdb_dir</span><span class="p">))[</span><span class="mi">0</span><span class="p">])</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">gtdb_dir_fasta</span><span class="o">=</span><span class="kc">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">genome_alignment_script</span><span class="o">=</span><span class="n">genome_alignment_script</span>	
		<span class="bp">self</span><span class="o">.</span><span class="n">adtoolbox_singularity</span><span class="o">=</span><span class="n">adtoolbox_singularity</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">adtoolbox_docker</span><span class="o">=</span><span class="n">adtoolbox_docker</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">rsync_download_dir</span><span class="o">=</span><span class="n">rsync_download_dir</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">genomes_base_dir</span><span class="o">=</span><span class="n">genomes_base_dir</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">adm_mapping</span><span class="o">=</span><span class="n">adm_mapping</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">qiime2_p_trunc_len</span><span class="o">=</span><span class="n">qiime2_p_trunc_len</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div><h3 id="3-utils">3. Utils</h3>


<div class="doc doc-object doc-class">


<a id="adtoolbox.configs.Utils"></a>
  <div class="doc doc-contents first">

  
      <p>An instance of this class will hold all the configuration information for utils module functionalities.</p>


        <details class="quote">
          <summary>Source code in <code>adtoolbox/configs.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Utils</span><span class="p">:</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	An instance of this class will hold all the configuration information for utils module functionalities.&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
	<span class="n">slurm_template</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PKG_DATA</span><span class="p">,</span><span class="s2">&quot;slurm_template.txt&quot;</span><span class="p">),</span>
	<span class="n">docker_template_qiime</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
	<span class="n">singularity_template_qiime</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
	<span class="n">slurm_executer</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
	<span class="n">slurm_wall_time</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;24:00:00&#39;</span><span class="p">,</span>
	<span class="n">slurm_job_name</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;ADToolbox&#39;</span><span class="p">,</span>
	<span class="n">slurm_outlog</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;ADToolbox.log&#39;</span><span class="p">,</span>
    <span class="n">slurm_cpus</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;12&quot;</span><span class="p">,</span>
	<span class="n">slurm_memory</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;100G&quot;</span><span class="p">,</span>
	<span class="n">slurm_save_dir</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span>
	<span class="n">adtoolbox_singularity</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="n">ADTOOLBOX_CONTAINERS</span><span class="p">[</span><span class="s2">&quot;singularity_x86&quot;</span><span class="p">],</span>
	<span class="n">adtoolbox_docker</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="n">ADTOOLBOX_CONTAINERS</span><span class="p">[</span><span class="s2">&quot;docker_x86&quot;</span><span class="p">]</span>
	<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">slurm_template</span> <span class="o">=</span> <span class="n">slurm_template</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">docker_template_qiime</span> <span class="o">=</span> <span class="n">docker_template_qiime</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">singularity_template_qiime</span> <span class="o">=</span> <span class="n">singularity_template_qiime</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">slurm_executer</span> <span class="o">=</span> <span class="n">slurm_executer</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">slurm_wall_time</span> <span class="o">=</span> <span class="n">slurm_wall_time</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">slurm_job_name</span> <span class="o">=</span> <span class="n">slurm_job_name</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">slurm_outlog</span><span class="o">=</span><span class="n">slurm_outlog</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">slurm_cpus</span> <span class="o">=</span> <span class="n">slurm_cpus</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">slurm_save_dir</span> <span class="o">=</span> <span class="n">slurm_save_dir</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">slurm_memory</span> <span class="o">=</span> <span class="n">slurm_memory</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">adtoolbox_singularity</span><span class="o">=</span><span class="n">adtoolbox_singularity</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">adtoolbox_docker</span><span class="o">=</span><span class="n">adtoolbox_docker</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div><h2 id="core">core</h2>
<p>You can access this module by:</p>
<pre><code>from adtoolbox import core 

</code></pre>
<p>This module includes the following classes:</p>
<h3 id="1-experiment">1. Experiment</h3>


<div class="doc doc-object doc-class">


<a id="adtoolbox.core.Experiment"></a>
  <div class="doc doc-contents first">

  
      <p>This class creates an interface for the experimental data to be used in different places in ADToolbox.
First you should give each experiment a name. Time must be a list of time points in days, and there must be a time 0 point assinged to each experiment.
variables must be a list of integers that represent the variables that are the index of the ADM species that we have concentration data for.
data must be a list of lists. Each list in the list must be a list of concentrations for each species at each time point.
IMPORTANT: The order of the species in the data list must match the order of the species in the variables list.
if there are specific initial concentrations for the ADM species, they can be passed as a dictionary to the initial_concentrations argument.
reference is an optional argument that can be used to provide a reference for the experimental data. If using the database module 
to query for Experiment objects you can query by name or reference or model_type. So, having a descriptive reference can be useful for querying as well.
default model name is "e_adm". This can be changed by passing a different model name to the model_name argument. This also helps with querying.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>A unique name for the experiment.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>time</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>A list of time points in days.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>variables</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>A list of strings that represent the species that are in the used model (most commonly ADM) that we have concentration data for.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>data</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>A list of lists. Each list in the list must be a list of concentrations for each species at each time point.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>feed</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="adtoolbox.core.Feed" href="#adtoolbox.core.Feed">Feed</a></code>
          </td>
          <td><p>An instance of feed class</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>initial_concentrations</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>A dictionary of initial concentrations for the ADM species. Defaults to {}.</p></td>
          <td>
                <code>dataclasses.field(default_factory=dict)</code>
          </td>
        </tr>
        <tr>
          <td><code>base_parameters</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>A dictionary of base parameters for the model. Defaults to {}.</p></td>
          <td>
                <code>dataclasses.field(default_factory=dict)</code>
          </td>
        </tr>
        <tr>
          <td><code>constants</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>A list of strings that represent the species that are in the used model (most commonly ADM) that are held constant during the simulations. Their value will come from the initial_concentrations. Defaults to [].</p></td>
          <td>
                <code>dataclasses.field(default_factory=tuple)</code>
          </td>
        </tr>
        <tr>
          <td><code>reference</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>A reference for the experimental data. Defaults to ''.</p></td>
          <td>
                <code>&#39;&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>model_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The name of the model that the experimental data is for. Defaults to "e_adm".</p></td>
          <td>
                <code>&#39;e_adm&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">json</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">()</span><span class="o">.</span><span class="n">adm_parameters</span><span class="p">[</span><span class="s2">&quot;species&quot;</span><span class="p">],</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">species</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">feed</span><span class="o">=</span><span class="n">Feed</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span><span class="n">carbohydrates</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span><span class="n">lipids</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span><span class="n">proteins</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span><span class="n">si</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span><span class="n">xi</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span><span class="n">tss</span><span class="o">=</span><span class="mi">70</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">exp</span><span class="o">=</span><span class="n">Experiment</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span><span class="n">time</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;S_su&quot;</span><span class="p">,</span><span class="s2">&quot;S_aa&quot;</span><span class="p">],</span><span class="n">data</span><span class="o">=</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]],</span><span class="n">feed</span><span class="o">=</span><span class="n">Feed</span><span class="p">,</span><span class="n">reference</span><span class="o">=</span><span class="s2">&quot;Test reference&quot;</span><span class="p">)</span>
</code></pre></div>


        <details class="quote">
          <summary>Source code in <code>adtoolbox/core.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Experiment</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class creates an interface for the experimental data to be used in different places in ADToolbox.</span>
<span class="sd">    First you should give each experiment a name. Time must be a list of time points in days, and there must be a time 0 point assinged to each experiment.</span>
<span class="sd">    variables must be a list of integers that represent the variables that are the index of the ADM species that we have concentration data for.</span>
<span class="sd">    data must be a list of lists. Each list in the list must be a list of concentrations for each species at each time point.</span>
<span class="sd">    IMPORTANT: The order of the species in the data list must match the order of the species in the variables list.</span>
<span class="sd">    if there are specific initial concentrations for the ADM species, they can be passed as a dictionary to the initial_concentrations argument.</span>
<span class="sd">    reference is an optional argument that can be used to provide a reference for the experimental data. If using the database module </span>
<span class="sd">    to query for Experiment objects you can query by name or reference or model_type. So, having a descriptive reference can be useful for querying as well.</span>
<span class="sd">    default model name is &quot;e_adm&quot;. This can be changed by passing a different model name to the model_name argument. This also helps with querying.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): A unique name for the experiment.</span>
<span class="sd">        time (list): A list of time points in days.</span>
<span class="sd">        variables (list): A list of strings that represent the species that are in the used model (most commonly ADM) that we have concentration data for.</span>
<span class="sd">        data (list): A list of lists. Each list in the list must be a list of concentrations for each species at each time point.</span>
<span class="sd">        feed (Feed): An instance of feed class</span>
<span class="sd">        initial_concentrations (dict, optional): A dictionary of initial concentrations for the ADM species. Defaults to {}.</span>
<span class="sd">        base_parameters (dict, optional): A dictionary of base parameters for the model. Defaults to {}.</span>
<span class="sd">        constants (list, optional): A list of strings that represent the species that are in the used model (most commonly ADM) that are held constant during the simulations. Their value will come from the initial_concentrations. Defaults to [].</span>
<span class="sd">        reference (str, optional): A reference for the experimental data. Defaults to &#39;&#39;.</span>
<span class="sd">        model_name (str, optional): The name of the model that the experimental data is for. Defaults to &quot;e_adm&quot;.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import json</span>
<span class="sd">        &gt;&gt;&gt; with open(configs.Database().adm_parameters[&quot;species&quot;],&quot;r&quot;) as f:</span>
<span class="sd">        ...     species=json.load(f)</span>
<span class="sd">        &gt;&gt;&gt; feed=Feed(name=&quot;Test&quot;,carbohydrates=25,lipids=25,proteins=25,si=25,xi=25,tss=70)</span>
<span class="sd">        &gt;&gt;&gt; exp=Experiment(name=&quot;Test&quot;,time=[0,1,2],variables=[&quot;S_su&quot;,&quot;S_aa&quot;],data=[[1,2,3],[4,5,6]],feed=Feed,reference=&quot;Test reference&quot;)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span><span class="nb">str</span>
    <span class="n">time</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
    <span class="n">variables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span>
    <span class="n">feed</span><span class="p">:</span> <span class="n">Feed</span>
    <span class="n">initial_concentrations</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">base_parameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">constants</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">tuple</span><span class="p">)</span>
    <span class="n">reference</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;e_adm&quot;</span>


    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Number of time points must match number of rows in data.&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">,</span> <span class="s2">&quot;Number of variables must match number of columns in data.&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Time must start at 0.&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;successful&quot;</span>

    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;time&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="s2">&quot;variables&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">,</span>
                <span class="s2">&quot;data&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="s2">&quot;feed&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
                <span class="s2">&quot;initial_concentrations&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_concentrations</span><span class="p">,</span>
                <span class="s2">&quot;base_parameters&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">,</span>
                <span class="s2">&quot;constants&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">constants</span><span class="p">,</span>
                <span class="s2">&quot;reference&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">reference</span><span class="p">,</span>
                <span class="s2">&quot;model_name&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div><h3 id="2-feed">2. Feed</h3>


<div class="doc doc-object doc-class">


<a id="adtoolbox.core.Feed"></a>
  <div class="doc doc-contents first">

  
      <p>The Feed class is used to store the feed information, and later use it in the e_adm model.
all the entered numbers must in percentages. Carbohudrates, lipids, and proteins and si must sum up to 100, 
and they form the total dissolved solids. Carbohydrates, lipids, proteins, and xi must sum up to 100, and they form the total suspended solids.</p>
<p>IMPORTANT: It is assumed that lipid, proteins and carbohydrates have the same fraction in soluble and insoluble fractions.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>A unique name for the feed.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>carbohydrates</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>percentage of carbohydrates in the feed.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>lipids</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>percentage of lipids in the feed.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>proteins</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>percentage of proteins in the feed.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>tss</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>percentage of total COD in the form of suspended solids.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>si</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>percentage of percentage of soluble inorganics in the TDS.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>xi</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>percentage of percentage of insoluble inorganics in the TSS.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>reference</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>A reference for the feed data. Defaults to ''.    </p></td>
          <td>
                <code>&#39;&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">feed</span><span class="o">=</span><span class="n">Feed</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span><span class="n">carbohydrates</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span><span class="n">lipids</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span><span class="n">proteins</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span><span class="n">si</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span><span class="n">xi</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span><span class="n">tss</span><span class="o">=</span><span class="mi">70</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">feed</span><span class="o">.</span><span class="n">ch_tss</span><span class="o">==</span><span class="n">feed</span><span class="o">.</span><span class="n">lip_tss</span><span class="o">==</span><span class="n">feed</span><span class="o">.</span><span class="n">prot_tss</span><span class="o">==</span><span class="n">feed</span><span class="o">.</span><span class="n">xi_tss</span><span class="o">==</span><span class="mf">0.25</span>
</code></pre></div>


        <details class="quote">
          <summary>Source code in <code>adtoolbox/core.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Feed</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Feed class is used to store the feed information, and later use it in the e_adm model.</span>
<span class="sd">    all the entered numbers must in percentages. Carbohudrates, lipids, and proteins and si must sum up to 100, </span>
<span class="sd">    and they form the total dissolved solids. Carbohydrates, lipids, proteins, and xi must sum up to 100, and they form the total suspended solids.</span>

<span class="sd">    IMPORTANT: It is assumed that lipid, proteins and carbohydrates have the same fraction in soluble and insoluble fractions.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): A unique name for the feed.</span>
<span class="sd">        carbohydrates (float): percentage of carbohydrates in the feed.</span>
<span class="sd">        lipids (float): percentage of lipids in the feed.</span>
<span class="sd">        proteins (float): percentage of proteins in the feed.</span>
<span class="sd">        tss (float): percentage of total COD in the form of suspended solids.</span>
<span class="sd">        si (float): percentage of percentage of soluble inorganics in the TDS.</span>
<span class="sd">        xi (float): percentage of percentage of insoluble inorganics in the TSS.</span>
<span class="sd">        reference (str, optional): A reference for the feed data. Defaults to &#39;&#39;.    </span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; feed=Feed(name=&quot;Test&quot;,carbohydrates=25,lipids=25,proteins=25,si=25,xi=25,tss=70)</span>
<span class="sd">        &gt;&gt;&gt; assert feed.ch_tss==feed.lip_tss==feed.prot_tss==feed.xi_tss==0.25</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># total_cod:float Transfer to base parameters</span>
    <span class="n">name</span><span class="p">:</span><span class="nb">str</span>            <span class="c1"># A unique name for the feed</span>
    <span class="n">carbohydrates</span><span class="p">:</span><span class="nb">float</span> <span class="c1"># percentage of carbohydrates in the feed</span>
    <span class="n">lipids</span><span class="p">:</span><span class="nb">float</span>        <span class="c1"># percentage of lipids in the feed</span>
    <span class="n">proteins</span><span class="p">:</span><span class="nb">float</span>      <span class="c1"># percentage of proteins in the feed</span>
    <span class="n">tss</span><span class="p">:</span><span class="nb">float</span>           <span class="c1"># percentage of total COD in the form of suspended solids</span>
    <span class="n">si</span><span class="p">:</span><span class="nb">float</span>            <span class="c1"># percentage of percentage of soluble inorganics in the TDS</span>
    <span class="n">xi</span><span class="p">:</span><span class="nb">float</span>            <span class="c1"># percentage of percentage of insoluble inorganics in the TSS</span>
    <span class="n">reference</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;&#39;</span>    <span class="c1"># A reference for the feed data</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">carbohydrates</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">lipids</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">proteins</span><span class="o">&gt;</span><span class="mi">100</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The sum of the percentages must less than 100&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">carbohydrates</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">lipids</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">proteins</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">si</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;The sum of lipids, carbohydrates, proteins are suspiciously low! Make sure youhave input the numbers in percentages!&quot;</span><span class="p">)</span>
        <span class="n">li_ch_pr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">carbohydrates</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">lipids</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">proteins</span>
        <span class="n">without_xi</span><span class="o">=</span><span class="mi">100</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">xi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ch_tss</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">carbohydrates</span><span class="o">/</span><span class="n">li_ch_pr</span><span class="o">*</span><span class="n">without_xi</span><span class="o">/</span><span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lip_tss</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lipids</span><span class="o">/</span><span class="n">li_ch_pr</span><span class="o">*</span><span class="n">without_xi</span><span class="o">/</span><span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prot_tss</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">proteins</span><span class="o">/</span><span class="n">li_ch_pr</span><span class="o">*</span><span class="n">without_xi</span><span class="o">/</span><span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xi_tss</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="o">/</span><span class="mi">100</span>
        <span class="n">without_si</span><span class="o">=</span><span class="mi">100</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">si</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ch_tds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">carbohydrates</span><span class="o">/</span><span class="n">li_ch_pr</span><span class="o">*</span><span class="n">without_si</span><span class="o">/</span><span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lip_tds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lipids</span><span class="o">/</span><span class="n">li_ch_pr</span><span class="o">*</span><span class="n">without_si</span><span class="o">/</span><span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prot_tds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">proteins</span><span class="o">/</span><span class="n">li_ch_pr</span><span class="o">*</span><span class="n">without_si</span><span class="o">/</span><span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">si_tds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">si</span><span class="o">/</span><span class="mi">100</span>

    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;carbohydrates&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">carbohydrates</span><span class="p">,</span>
                <span class="s2">&quot;lipids&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">lipids</span><span class="p">,</span>
                <span class="s2">&quot;proteins&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">proteins</span><span class="p">,</span>
                <span class="s2">&quot;tss&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">tss</span><span class="p">,</span>
                <span class="s2">&quot;si&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">si</span><span class="p">,</span>
                <span class="s2">&quot;xi&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">,</span>
                <span class="s2">&quot;reference&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">reference</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div><h3 id="3-metegenomicsstudy">3. MetegenomicsStudy</h3>


<div class="doc doc-object doc-class">


<a id="adtoolbox.core.MetagenomicsStudy"></a>
  <div class="doc doc-contents first">

  
      <p>This class is used to communicate between the metagenomics studies database and the ADM model.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The name of the metagenomics study. Its okay if it is not unique.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>study_type</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The type of the metagenomics study. It can be "amplicon" or "WGS".</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>microbiome</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The microbiome that the metagenomics study is about.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>sample_accession</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The SRA sample accession number of the metagenomics study. This must be unique.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>comments</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Any comments that you want to add to the metagenomics study.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>study_accession</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The SRA study accession number of the metagenomics study.   </p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">study</span><span class="o">=</span><span class="n">MetagenomicsStudy</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span><span class="n">study_type</span><span class="o">=</span><span class="s2">&quot;WGS&quot;</span><span class="p">,</span><span class="n">microbiome</span><span class="o">=</span><span class="s2">&quot;test_microbiome&quot;</span><span class="p">,</span><span class="n">sample_accession</span><span class="o">=</span><span class="s2">&quot;test_accession&quot;</span><span class="p">,</span><span class="n">comments</span><span class="o">=</span><span class="s2">&quot;test_comments&quot;</span><span class="p">,</span><span class="n">study_accession</span><span class="o">=</span><span class="s2">&quot;test_study_accession&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">study</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s2">&quot;Test&quot;</span>
</code></pre></div>


        <details class="quote">
          <summary>Source code in <code>adtoolbox/core.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">MetagenomicsStudy</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is used to communicate between the metagenomics studies database and the ADM model.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): The name of the metagenomics study. Its okay if it is not unique.</span>
<span class="sd">        study_type (str): The type of the metagenomics study. It can be &quot;amplicon&quot; or &quot;WGS&quot;.</span>
<span class="sd">        microbiome (str): The microbiome that the metagenomics study is about.</span>
<span class="sd">        sample_accession (str): The SRA sample accession number of the metagenomics study. This must be unique.</span>
<span class="sd">        comments (str): Any comments that you want to add to the metagenomics study.</span>
<span class="sd">        study_accession (str): The SRA study accession number of the metagenomics study.   </span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; study=MetagenomicsStudy(name=&quot;Test&quot;,study_type=&quot;WGS&quot;,microbiome=&quot;test_microbiome&quot;,sample_accession=&quot;test_accession&quot;,comments=&quot;test_comments&quot;,study_accession=&quot;test_study_accession&quot;)</span>
<span class="sd">        &gt;&gt;&gt; assert study.name==&quot;Test&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span><span class="nb">str</span>
    <span class="n">study_type</span><span class="p">:</span><span class="nb">str</span>
    <span class="n">microbiome</span><span class="p">:</span><span class="nb">str</span>
    <span class="n">sample_accession</span><span class="p">:</span><span class="nb">str</span>
    <span class="n">comments</span><span class="p">:</span><span class="nb">str</span>
    <span class="n">study_accession</span><span class="p">:</span><span class="nb">str</span>

    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;study_type&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">study_type</span><span class="p">,</span>
                <span class="s2">&quot;microbiome&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">microbiome</span><span class="p">,</span>
                <span class="s2">&quot;sample_accession&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_accession</span><span class="p">,</span>
                <span class="s2">&quot;comments&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">comments</span><span class="p">,</span>
                <span class="s2">&quot;study_accession&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">study_accession</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div><h3 id="4-reaction">4. Reaction</h3>


<div class="doc doc-object doc-class">


<a id="adtoolbox.core.Reaction"></a>
  <div class="doc doc-contents first">

  
      <p>This class provides a simple interface between information about biochemical reactions and multiple functionalities of ADToolbox.
In order to instantiate a reaction object, you need to pass a dictionary of the reaction information.
This dictionary must include 'name','stoichiometry' keys. This follows the format of the seed database.
stoichiometry must be formatted like seed database. The seed database format is as follows:
stoichiometry: '-1:cpd00079:0:0:"D-glucose-6-phosphate";1:cpd00072:0:0:"D-fructose-6-phosphate"'</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>data</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>A dictionary containing the reaction information. This follows the format of the seed database.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s1">&#39;D-glucose-6-phosphate aldose-ketose-isomerase&#39;</span><span class="p">,</span><span class="s2">&quot;stoichiometry&quot;</span><span class="p">:</span><span class="s1">&#39;-1:cpd00079:0:0:&quot;D-glucose-6-phosphate&quot;;1:cpd00072:0:0:&quot;D-fructose-6-phosphate&quot;&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">=</span><span class="n">Reaction</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">D-glucose-6-phosphate aldose-ketose-isomerase</span>
</code></pre></div>


        <details class="quote">
          <summary>Source code in <code>adtoolbox/core.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Reaction</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class provides a simple interface between information about biochemical reactions and multiple functionalities of ADToolbox.</span>
<span class="sd">    In order to instantiate a reaction object, you need to pass a dictionary of the reaction information.</span>
<span class="sd">    This dictionary must include &#39;name&#39;,&#39;stoichiometry&#39; keys. This follows the format of the seed database.</span>
<span class="sd">    stoichiometry must be formatted like seed database. The seed database format is as follows:</span>
<span class="sd">    stoichiometry: &#39;-1:cpd00079:0:0:\&quot;D-glucose-6-phosphate\&quot;;1:cpd00072:0:0:\&quot;D-fructose-6-phosphate\&quot;&#39;</span>

<span class="sd">    Args:</span>
<span class="sd">        data (dict): A dictionary containing the reaction information. This follows the format of the seed database.</span>


<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; A={&quot;name&quot;:&#39;D-glucose-6-phosphate aldose-ketose-isomerase&#39;,&quot;stoichiometry&quot;:&#39;-1:cpd00079:0:0:\&quot;D-glucose-6-phosphate\&quot;;1:cpd00072:0:0:\&quot;D-fructose-6-phosphate\&quot;&#39;}</span>
<span class="sd">        &gt;&gt;&gt; a=Reaction(A)</span>
<span class="sd">        &gt;&gt;&gt; print(a)</span>
<span class="sd">        D-glucose-6-phosphate aldose-ketose-isomerase</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span><span class="nb">dict</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">stoichiometry</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the stoichiometry of the reaction by the seed id of the compounds as key and the</span>
<span class="sd">        stoichiometric coefficient as value.</span>
<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; A={&quot;name&quot;:&#39;D-glucose-6-phosphate aldose-ketose-isomerase&#39;,&quot;stoichiometry&quot;:&#39;-1:cpd00079:0:0:\&quot;D-glucose-6-phosphate\&quot;;1:cpd00072:0:0:\&quot;D-fructose-6-phosphate\&quot;&#39;}</span>
<span class="sd">            &gt;&gt;&gt; a=Reaction(A)</span>
<span class="sd">            &gt;&gt;&gt; a.stoichiometry=={&#39;cpd00079&#39;: -1, &#39;cpd00072&#39;: 1}</span>
<span class="sd">            True</span>

<span class="sd">        Args:</span>
<span class="sd">            self (Reaction): An instance of the Reaction.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: The stoichiometry of the reaction </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">compound</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span><span class="nb">float</span><span class="p">(</span><span class="n">compound</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">compound</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;stoichiometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span> <span class="p">}</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h2 id="adtoolbox.core.Reaction.stoichiometry" class="doc doc-heading">
<code class="highlight language-python"><span class="n">stoichiometry</span><span class="p">:</span> <span class="nb">dict</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Returns the stoichiometry of the reaction by the seed id of the compounds as key and the
stoichiometric coefficient as value.</p>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s1">&#39;D-glucose-6-phosphate aldose-ketose-isomerase&#39;</span><span class="p">,</span><span class="s2">&quot;stoichiometry&quot;</span><span class="p">:</span><span class="s1">&#39;-1:cpd00079:0:0:&quot;D-glucose-6-phosphate&quot;;1:cpd00072:0:0:&quot;D-fructose-6-phosphate&quot;&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">=</span><span class="n">Reaction</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">stoichiometry</span><span class="o">==</span><span class="p">{</span><span class="s1">&#39;cpd00079&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;cpd00072&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="go">True</span>
</code></pre></div>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>self</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="adtoolbox.core.Reaction" href="#adtoolbox.core.Reaction">Reaction</a></code>
          </td>
          <td><p>An instance of the Reaction.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>dict</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>The stoichiometry of the reaction</p></td>
        </tr>
    </tbody>
  </table>
  </div>

</div>





  </div>

  </div>

</div><h3 id="5-metabolite">5. Metabolite</h3>


<div class="doc doc-object doc-class">


<a id="adtoolbox.core.Metabolite"></a>
  <div class="doc doc-contents first">

  
      <p>This class provides a simple interface between information about metabolites and multiple functionalities of ADToolbox.
In order to instantiate a metabolite object, you need to pass a dictionary of the metabolite information.
This dictionary must include 'name','mass','formula' keys. This follows the format of the seed database.
formula must be formatted like seed database. The seed database format is as follows:
formula: 'C6H12O6'
Possibly the main advantage of instantiating a metabolite object is that it provides a COD attribute that can be used to convert
the concentration of the metabolite from g/l to gCOD/l. This is useful for comparing the experimental data with the model outputs.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>data</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>A dictionary containing the metabolite information. This follows the format of the seed database.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;methane&quot;</span><span class="p">,</span><span class="s2">&quot;mass&quot;</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span><span class="s2">&quot;formula&quot;</span><span class="p">:</span><span class="s2">&quot;CH4&quot;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">=</span><span class="n">Metabolite</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">methane</span>
</code></pre></div>


        <details class="quote">
          <summary>Source code in <code>adtoolbox/core.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Metabolite</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class provides a simple interface between information about metabolites and multiple functionalities of ADToolbox.</span>
<span class="sd">    In order to instantiate a metabolite object, you need to pass a dictionary of the metabolite information.</span>
<span class="sd">    This dictionary must include &#39;name&#39;,&#39;mass&#39;,&#39;formula&#39; keys. This follows the format of the seed database.</span>
<span class="sd">    formula must be formatted like seed database. The seed database format is as follows:</span>
<span class="sd">    formula: &#39;C6H12O6&#39;</span>
<span class="sd">    Possibly the main advantage of instantiating a metabolite object is that it provides a COD attribute that can be used to convert</span>
<span class="sd">    the concentration of the metabolite from g/l to gCOD/l. This is useful for comparing the experimental data with the model outputs.</span>

<span class="sd">    Args:</span>
<span class="sd">        data (dict): A dictionary containing the metabolite information. This follows the format of the seed database.</span>


<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; A={&quot;name&quot;:&quot;methane&quot;,&quot;mass&quot;:16,&quot;formula&quot;:&quot;CH4&quot;}</span>
<span class="sd">        &gt;&gt;&gt; a=Metabolite(A)</span>
<span class="sd">        &gt;&gt;&gt; print(a)</span>
<span class="sd">        methane</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cod_calc</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mw</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mass&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">cod_calc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">add_h</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">add_c</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">add_o</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the conversion rates for g/l -&gt; gCOD/l</span>
<span class="sd">        In some cases we would like to add extra atoms for COD calculations</span>
<span class="sd">        For example, model seed biochemistry database only uses acetate instead of acetic acid.</span>
<span class="sd">        The 1 hydrogen difference changes the COD conversion rate. For this reason we can add extra atoms to the formula</span>
<span class="sd">        to calculate the COD conversion rate without changing anything else.</span>

<span class="sd">        Args:</span>
<span class="sd">            add_h (float): The number of extra hydrogen atoms to add to the formula for COD calculation.</span>
<span class="sd">            add_c (float): The number of extra carbon atoms to add to the formula for COD calculation.</span>
<span class="sd">            add_o (float): The number of extra oxygen atoms to add to the formula for COD calculation.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; A={&quot;name&quot;:&quot;methane&quot;,&quot;mass&quot;:16,&quot;formula&quot;:&quot;CH4&quot;}</span>
<span class="sd">            &gt;&gt;&gt; a=Metabolite(A)</span>
<span class="sd">            &gt;&gt;&gt; a.cod</span>
<span class="sd">            4.0</span>

<span class="sd">        Args:</span>
<span class="sd">            self (Metabolite): An instance of the Metabolite class: Note</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: COD conversion from g/l to gCOD/l</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;formula&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;mass&#39;</span><span class="p">]:</span>
            <span class="n">contents</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">atoms</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;O&quot;</span><span class="p">]</span>
            <span class="n">mw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;mass&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">add_h</span><span class="o">*</span><span class="mi">1</span><span class="o">+</span><span class="n">add_c</span><span class="o">*</span><span class="mi">12</span><span class="o">+</span><span class="n">add_o</span><span class="o">*</span><span class="mi">16</span>
            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">atom</span><span class="o">+</span><span class="s1">&#39;\d*&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;formula&#39;</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">atom</span><span class="o">+</span><span class="s1">&#39;\d*&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;formula&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">group</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">contents</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">contents</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                            <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">atom</span><span class="o">+</span><span class="s1">&#39;\d*&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;formula&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">group</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">contents</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">contents</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">]</span><span class="o">+=</span><span class="n">add_h</span>
            <span class="n">contents</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span><span class="o">+=</span><span class="n">add_c</span>
            <span class="n">contents</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span><span class="o">+=</span><span class="n">add_o</span>
            <span class="n">cod_conv</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">mw</span><span class="o">*</span><span class="p">(</span><span class="n">contents</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">contents</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">contents</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">])</span><span class="o">/</span><span class="mi">4</span><span class="o">*</span><span class="mi">32</span>
            <span class="k">return</span> <span class="n">cod_conv</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;None&#39;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Metabolite.cod_calc" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cod_calc</span><span class="p">(</span><span class="n">add_h</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">add_c</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">add_o</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Calculates the conversion rates for g/l -&gt; gCOD/l
In some cases we would like to add extra atoms for COD calculations
For example, model seed biochemistry database only uses acetate instead of acetic acid.
The 1 hydrogen difference changes the COD conversion rate. For this reason we can add extra atoms to the formula
to calculate the COD conversion rate without changing anything else.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>add_h</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>The number of extra hydrogen atoms to add to the formula for COD calculation.</p></td>
          <td>
                <code>0</code>
          </td>
        </tr>
        <tr>
          <td><code>add_c</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>The number of extra carbon atoms to add to the formula for COD calculation.</p></td>
          <td>
                <code>0</code>
          </td>
        </tr>
        <tr>
          <td><code>add_o</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>The number of extra oxygen atoms to add to the formula for COD calculation.</p></td>
          <td>
                <code>0</code>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;methane&quot;</span><span class="p">,</span><span class="s2">&quot;mass&quot;</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span><span class="s2">&quot;formula&quot;</span><span class="p">:</span><span class="s2">&quot;CH4&quot;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">=</span><span class="n">Metabolite</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">cod</span>
<span class="go">4.0</span>
</code></pre></div>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>self</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="adtoolbox.core.Metabolite" href="#adtoolbox.core.Metabolite">Metabolite</a></code>
          </td>
          <td><p>An instance of the Metabolite class: Note</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>float</code></td>          <td>
                <code>float</code>
          </td>
          <td><p>COD conversion from g/l to gCOD/l</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cod_calc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">add_h</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">add_c</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">add_o</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">float</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the conversion rates for g/l -&gt; gCOD/l</span>
<span class="sd">    In some cases we would like to add extra atoms for COD calculations</span>
<span class="sd">    For example, model seed biochemistry database only uses acetate instead of acetic acid.</span>
<span class="sd">    The 1 hydrogen difference changes the COD conversion rate. For this reason we can add extra atoms to the formula</span>
<span class="sd">    to calculate the COD conversion rate without changing anything else.</span>

<span class="sd">    Args:</span>
<span class="sd">        add_h (float): The number of extra hydrogen atoms to add to the formula for COD calculation.</span>
<span class="sd">        add_c (float): The number of extra carbon atoms to add to the formula for COD calculation.</span>
<span class="sd">        add_o (float): The number of extra oxygen atoms to add to the formula for COD calculation.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; A={&quot;name&quot;:&quot;methane&quot;,&quot;mass&quot;:16,&quot;formula&quot;:&quot;CH4&quot;}</span>
<span class="sd">        &gt;&gt;&gt; a=Metabolite(A)</span>
<span class="sd">        &gt;&gt;&gt; a.cod</span>
<span class="sd">        4.0</span>

<span class="sd">    Args:</span>
<span class="sd">        self (Metabolite): An instance of the Metabolite class: Note</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: COD conversion from g/l to gCOD/l</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;formula&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;mass&#39;</span><span class="p">]:</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;O&quot;</span><span class="p">]</span>
        <span class="n">mw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;mass&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">add_h</span><span class="o">*</span><span class="mi">1</span><span class="o">+</span><span class="n">add_c</span><span class="o">*</span><span class="mi">12</span><span class="o">+</span><span class="n">add_o</span><span class="o">*</span><span class="mi">16</span>
        <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">atom</span><span class="o">+</span><span class="s1">&#39;\d*&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;formula&#39;</span><span class="p">]):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">atom</span><span class="o">+</span><span class="s1">&#39;\d*&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;formula&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">group</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">contents</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">contents</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                        <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">atom</span><span class="o">+</span><span class="s1">&#39;\d*&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;formula&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">group</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">contents</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">contents</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">]</span><span class="o">+=</span><span class="n">add_h</span>
        <span class="n">contents</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span><span class="o">+=</span><span class="n">add_c</span>
        <span class="n">contents</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span><span class="o">+=</span><span class="n">add_o</span>
        <span class="n">cod_conv</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">mw</span><span class="o">*</span><span class="p">(</span><span class="n">contents</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">contents</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">contents</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">])</span><span class="o">/</span><span class="mi">4</span><span class="o">*</span><span class="mi">32</span>
        <span class="k">return</span> <span class="n">cod_conv</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;None&#39;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h3 id="6seeddb">6.SeedDB</h3>


<div class="doc doc-object doc-class">


<a id="adtoolbox.core.SeedDB"></a>
  <div class="doc doc-contents first">

  
      <p>This class is designed to interact with seed database. The main advantage of using this class is that it can be used to instantiate
a reaction and metabolite object, and it provides extra functionalities that rely on information in the seed database. For example, 
If there is a chemical formula assigned to a metabolite in the seed database, then the informattion about the COD of that metabolite
can be computed using the chemical formula. </p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>config</code></td>
          <td>
                <code>configs.<span title="configs.SeedDB">SeedDB</span></code>
          </td>
          <td><p>An instance of the SeedDB class in the configs module. This class contains the information about the seed database.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">seed_db</span><span class="o">=</span><span class="n">SeedDB</span><span class="p">(</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">seed_db</span><span class="o">.</span><span class="n">compound_db</span><span class="o">==</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">()</span><span class="o">.</span><span class="n">compound_db</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">seed_db</span><span class="o">.</span><span class="n">reaction_db</span><span class="o">==</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">()</span><span class="o">.</span><span class="n">reaction_db</span>
</code></pre></div>


        <details class="quote">
          <summary>Source code in <code>adtoolbox/core.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SeedDB</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is designed to interact with seed database. The main advantage of using this class is that it can be used to instantiate</span>
<span class="sd">    a reaction and metabolite object, and it provides extra functionalities that rely on information in the seed database. For example, </span>
<span class="sd">    If there is a chemical formula assigned to a metabolite in the seed database, then the informattion about the COD of that metabolite</span>
<span class="sd">    can be computed using the chemical formula. </span>

<span class="sd">    Args:</span>
<span class="sd">        config (configs.SeedDB): An instance of the SeedDB class in the configs module. This class contains the information about the seed database.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; seed_db=SeedDB(configs.Database())</span>
<span class="sd">        &gt;&gt;&gt; assert seed_db.compound_db==configs.Database().compound_db</span>
<span class="sd">        &gt;&gt;&gt; assert seed_db.reaction_db==configs.Database().reaction_db</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reaction_db</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">reaction_db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compound_db</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">compound_db</span>

    <span class="k">def</span> <span class="nf">instantiate_rxns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed_id</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Reaction</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is used to instantiate reaction objects from the seed database.</span>
<span class="sd">        in order to instantiate a reaction object, you need to pass the seed identifier for that reaction.</span>

<span class="sd">        Args:</span>
<span class="sd">            seed_id (str): The seed identifier for the reaction.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Reaction: An instance of the Reaction class.</span>

<span class="sd">        Required Configs:</span>
<span class="sd">            - config.reaction_db</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; db_conf=configs.Database()</span>
<span class="sd">            &gt;&gt;&gt; seed_db=SeedDB(db_conf)</span>
<span class="sd">            &gt;&gt;&gt; rxn=seed_db.instantiate_rxns(&quot;rxn00558&quot;)</span>
<span class="sd">            &gt;&gt;&gt; assert rxn.data[&quot;name&quot;]==&quot;D-glucose-6-phosphate aldose-ketose-isomerase&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">db</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reaction_db</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Reaction</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">db</span><span class="p">[</span><span class="n">db</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">seed_id</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">instantiate_metabs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed_id</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Metabolite</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is used to instantiate metabolite objects from the seed database.</span>
<span class="sd">        In order to instantiate a metabolite object, you need to pass the seed identifier for that metabolite.</span>

<span class="sd">        Args:</span>
<span class="sd">            seed_id (str): The seed identifier for the metabolite.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Metabolite: An instance of the Metabolite class. </span>

<span class="sd">        Required Configs:</span>
<span class="sd">            - config.compound_db</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; seed_db=SeedDB(configs.Database())</span>
<span class="sd">            &gt;&gt;&gt; metab=seed_db.instantiate_metabs(&quot;cpd01024&quot;)</span>
<span class="sd">            &gt;&gt;&gt; assert metab.cod==4.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">db</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">compound_db</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Metabolite</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">db</span><span class="p">[</span><span class="n">db</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">seed_id</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">get_seed_rxn_from_ec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ec_number</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is used to get the seed reaction identifiers for a given EC number.</span>

<span class="sd">        Args:</span>
<span class="sd">            ec_number (str): The EC number.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list of seed reaction identifiers.</span>

<span class="sd">        Required Configs:</span>
<span class="sd">            - config.reaction_db</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; seed_db=SeedDB(config=configs.Database())</span>
<span class="sd">            &gt;&gt;&gt; seed_rxn_list=seed_db.get_seed_rxn_from_ec(&quot;1.1.1.1&quot;)</span>
<span class="sd">            &gt;&gt;&gt; assert len(seed_rxn_list)&gt;0</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">db</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reaction_db</span><span class="p">)</span>
        <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">[</span><span class="n">db</span><span class="p">[</span><span class="s2">&quot;ec_numbers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ec_number</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">if</span> <span class="n">x</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)]</span>
        <span class="n">db</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">db</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.SeedDB.get_seed_rxn_from_ec" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_seed_rxn_from_ec</span><span class="p">(</span><span class="n">ec_number</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method is used to get the seed reaction identifiers for a given EC number.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>ec_number</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The EC number.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>list</code></td>          <td>
                <code>list</code>
          </td>
          <td><p>A list of seed reaction identifiers.</p></td>
        </tr>
    </tbody>
  </table>

<details class="required-configs">
  <summary>Required Configs</summary>
  <ul>
<li>config.reaction_db</li>
</ul>
</details>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">seed_db</span><span class="o">=</span><span class="n">SeedDB</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">seed_rxn_list</span><span class="o">=</span><span class="n">seed_db</span><span class="o">.</span><span class="n">get_seed_rxn_from_ec</span><span class="p">(</span><span class="s2">&quot;1.1.1.1&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">seed_rxn_list</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_seed_rxn_from_ec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ec_number</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">list</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method is used to get the seed reaction identifiers for a given EC number.</span>

<span class="sd">    Args:</span>
<span class="sd">        ec_number (str): The EC number.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of seed reaction identifiers.</span>

<span class="sd">    Required Configs:</span>
<span class="sd">        - config.reaction_db</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; seed_db=SeedDB(config=configs.Database())</span>
<span class="sd">        &gt;&gt;&gt; seed_rxn_list=seed_db.get_seed_rxn_from_ec(&quot;1.1.1.1&quot;)</span>
<span class="sd">        &gt;&gt;&gt; assert len(seed_rxn_list)&gt;0</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">db</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reaction_db</span><span class="p">)</span>
    <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">[</span><span class="n">db</span><span class="p">[</span><span class="s2">&quot;ec_numbers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ec_number</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">if</span> <span class="n">x</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)]</span>
    <span class="n">db</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">db</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.SeedDB.instantiate_metabs" class="doc doc-heading">
<code class="highlight language-python"><span class="n">instantiate_metabs</span><span class="p">(</span><span class="n">seed_id</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method is used to instantiate metabolite objects from the seed database.
In order to instantiate a metabolite object, you need to pass the seed identifier for that metabolite.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>seed_id</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The seed identifier for the metabolite.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>Metabolite</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="adtoolbox.core.Metabolite" href="#adtoolbox.core.Metabolite">Metabolite</a></code>
          </td>
          <td><p>An instance of the Metabolite class. </p></td>
        </tr>
    </tbody>
  </table>

<details class="required-configs">
  <summary>Required Configs</summary>
  <ul>
<li>config.compound_db</li>
</ul>
</details>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">seed_db</span><span class="o">=</span><span class="n">SeedDB</span><span class="p">(</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metab</span><span class="o">=</span><span class="n">seed_db</span><span class="o">.</span><span class="n">instantiate_metabs</span><span class="p">(</span><span class="s2">&quot;cpd01024&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">metab</span><span class="o">.</span><span class="n">cod</span><span class="o">==</span><span class="mf">4.0</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">instantiate_metabs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed_id</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Metabolite</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method is used to instantiate metabolite objects from the seed database.</span>
<span class="sd">    In order to instantiate a metabolite object, you need to pass the seed identifier for that metabolite.</span>

<span class="sd">    Args:</span>
<span class="sd">        seed_id (str): The seed identifier for the metabolite.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Metabolite: An instance of the Metabolite class. </span>

<span class="sd">    Required Configs:</span>
<span class="sd">        - config.compound_db</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; seed_db=SeedDB(configs.Database())</span>
<span class="sd">        &gt;&gt;&gt; metab=seed_db.instantiate_metabs(&quot;cpd01024&quot;)</span>
<span class="sd">        &gt;&gt;&gt; assert metab.cod==4.0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">db</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">compound_db</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Metabolite</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">db</span><span class="p">[</span><span class="n">db</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">seed_id</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.SeedDB.instantiate_rxns" class="doc doc-heading">
<code class="highlight language-python"><span class="n">instantiate_rxns</span><span class="p">(</span><span class="n">seed_id</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method is used to instantiate reaction objects from the seed database.
in order to instantiate a reaction object, you need to pass the seed identifier for that reaction.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>seed_id</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The seed identifier for the reaction.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>Reaction</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="adtoolbox.core.Reaction" href="#adtoolbox.core.Reaction">Reaction</a></code>
          </td>
          <td><p>An instance of the Reaction class.</p></td>
        </tr>
        <tr>
<td></td>          <td>
                <code><a class="autorefs autorefs-internal" title="adtoolbox.core.Reaction" href="#adtoolbox.core.Reaction">Reaction</a></code>
          </td>
          <td></td>
        </tr>
    </tbody>
  </table>

<details class="required-configs">
  <summary>Required Configs</summary>
  <ul>
<li>config.reaction_db</li>
</ul>
</details>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">db_conf</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">seed_db</span><span class="o">=</span><span class="n">SeedDB</span><span class="p">(</span><span class="n">db_conf</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rxn</span><span class="o">=</span><span class="n">seed_db</span><span class="o">.</span><span class="n">instantiate_rxns</span><span class="p">(</span><span class="s2">&quot;rxn00558&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">rxn</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;D-glucose-6-phosphate aldose-ketose-isomerase&quot;</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">instantiate_rxns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed_id</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Reaction</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method is used to instantiate reaction objects from the seed database.</span>
<span class="sd">    in order to instantiate a reaction object, you need to pass the seed identifier for that reaction.</span>

<span class="sd">    Args:</span>
<span class="sd">        seed_id (str): The seed identifier for the reaction.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Reaction: An instance of the Reaction class.</span>

<span class="sd">    Required Configs:</span>
<span class="sd">        - config.reaction_db</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; db_conf=configs.Database()</span>
<span class="sd">        &gt;&gt;&gt; seed_db=SeedDB(db_conf)</span>
<span class="sd">        &gt;&gt;&gt; rxn=seed_db.instantiate_rxns(&quot;rxn00558&quot;)</span>
<span class="sd">        &gt;&gt;&gt; assert rxn.data[&quot;name&quot;]==&quot;D-glucose-6-phosphate aldose-ketose-isomerase&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">db</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reaction_db</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Reaction</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">db</span><span class="p">[</span><span class="n">db</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">seed_id</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h3 id="7-database">7. Database</h3>
<p>Here is a schematic of the Database Module</p>
<p><img alt="database" src="../Database.svg" /></p>


<div class="doc doc-object doc-class">


<a id="adtoolbox.core.Database"></a>
  <div class="doc doc-contents first">

  
      <p>This class is designed to supply any data requirement for ADToolbox. All functionalisties for saving, loading, and querying data are implemented here.
ADToolbox in general contains the following databases:</p>
<ul>
<li>
<p>The seed reaction database</p>
</li>
<li>
<p>The seed compound database</p>
</li>
<li>
<p>ADToolbox's Feed database</p>
</li>
<li>
<p>ADToolbox's Metagenomics studies database</p>
</li>
<li>
<p>ADToolbox's Experimental data database</p>
</li>
<li>
<p>ADToolbox's Protein database</p>
</li>
<li>
<p>ADToolbox's Reaction database</p>
</li>
<li>
<p>GTDB-tk database for bacterial and archaeal 16s rRNA sequences</p>
</li>
<li>
<p>ADM and e_adm model parameters</p>
</li>
</ul>
<p>This class is instantiated with a configs.Database object. This object contains the paths to all the databases that ADToolbox uses.
Please refer to the documentation of each method for more information on the required configurations.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>config</code></td>
          <td>
                <code>configs.<span title="configs.Database">Database</span></code>
          </td>
          <td><p>A configs.Database object. Defaults to configs.Database().</p></td>
          <td>
                <code>configs.Database()</code>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">=</span><span class="n">Database</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">db</span><span class="p">)</span><span class="o">==</span><span class="n">Database</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">config</span><span class="p">)</span><span class="o">==</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span>
</code></pre></div>


        <details class="quote">
          <summary>Source code in <code>adtoolbox/core.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Database</span><span class="p">:</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This class is designed to supply any data requirement for ADToolbox. All functionalisties for saving, loading, and querying data are implemented here.</span>
<span class="sd">    ADToolbox in general contains the following databases:</span>

<span class="sd">    - The seed reaction database</span>

<span class="sd">    - The seed compound database</span>

<span class="sd">    - ADToolbox&#39;s Feed database</span>

<span class="sd">    - ADToolbox&#39;s Metagenomics studies database</span>

<span class="sd">    - ADToolbox&#39;s Experimental data database</span>

<span class="sd">    - ADToolbox&#39;s Protein database</span>

<span class="sd">    - ADToolbox&#39;s Reaction database</span>

<span class="sd">    - GTDB-tk database for bacterial and archaeal 16s rRNA sequences</span>

<span class="sd">    - ADM and e_adm model parameters</span>

<span class="sd">    This class is instantiated with a configs.Database object. This object contains the paths to all the databases that ADToolbox uses.</span>
<span class="sd">    Please refer to the documentation of each method for more information on the required configurations.</span>

<span class="sd">    Args:</span>
<span class="sd">        config (configs.Database, optional): A configs.Database object. Defaults to configs.Database().</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; db=Database(config=configs.Database())</span>
<span class="sd">        &gt;&gt;&gt; assert type(db)==Database and type(db.config)==configs.Database</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">())</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>


    <span class="k">def</span> <span class="nf">initialize_protein_db</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;This function intializes ADToolbox&#39;s protein database by creating an empty fasta file.</span>
<span class="sd">        Be careful, this will overwrite any existing file with the same name.</span>
<span class="sd">        Logically, this needs method needs config.protein_db to be defined.</span>

<span class="sd">        Required Configs:</span>
<span class="sd">            - config.protein_db</span>
<span class="sd">            --------</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import os</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))==False # This is just to make sure that the following lines create the file</span>
<span class="sd">            &gt;&gt;&gt; db=Database(config=configs.Database(protein_db=os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))) # point to a test non-existing file</span>
<span class="sd">            &gt;&gt;&gt; db.initialize_protein_db() # initialize the protein database</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))==True # check if the file is created</span>
<span class="sd">            &gt;&gt;&gt; os.remove(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;)) # remove the file to clean up</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">initialize_reaction_db</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;This function intializes ADToolbox&#39;s reaction database by creating an empty tsv file.</span>
<span class="sd">        Be careful, this will overwrite any existing file with the same name.</span>

<span class="sd">        Required Configs:</span>
<span class="sd">            - config.reaction_db</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import os</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;reaction_test_db.tsv&quot;))==False</span>
<span class="sd">            &gt;&gt;&gt; db=Database(config=configs.Database(reaction_db=os.path.join(Main_Dir,&quot;reaction_test_db.tsv&quot;)))</span>
<span class="sd">            &gt;&gt;&gt; db.initialize_reaction_db()</span>
<span class="sd">            &gt;&gt;&gt; assert pd.read_table(os.path.join(Main_Dir,&quot;reaction_test_db.tsv&quot;),delimiter=&quot;\t&quot;).shape[0]==0</span>
<span class="sd">            &gt;&gt;&gt; assert set(pd.read_csv(os.path.join(Main_Dir,&quot;reaction_test_db.tsv&quot;),delimiter=&quot;\t&quot;).columns)==set([&quot;ec_numbers&quot;,&quot;seed_ids&quot;,&quot;reaction_names&quot;,&quot;adm1_reaction&quot;,&quot;e_adm_reactions&quot;,&quot;pathways&quot;])</span>
<span class="sd">            &gt;&gt;&gt; os.remove(os.path.join(Main_Dir,&quot;reaction_test_db.tsv&quot;))</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ec_numbers&quot;</span><span class="p">,</span><span class="s2">&quot;seed_ids&quot;</span><span class="p">,</span><span class="s2">&quot;reaction_names&quot;</span><span class="p">,</span><span class="s2">&quot;adm1_reaction&quot;</span><span class="p">,</span><span class="s2">&quot;e_adm_reactions&quot;</span><span class="p">,</span><span class="s2">&quot;pathways&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reaction_db</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initialize_feed_db</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;This function intializes ADToolbox&#39;s Feed database by creating an empty tsv file.</span>
<span class="sd">        Be careful, this will overwrite any existing file with the same name.</span>

<span class="sd">        Required Configs:</span>
<span class="sd">            - config.feed_db</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import os</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;))==False</span>
<span class="sd">            &gt;&gt;&gt; db=Database(config=configs.Database(feed_db=os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;)))</span>
<span class="sd">            &gt;&gt;&gt; db.initialize_feed_db()</span>
<span class="sd">            &gt;&gt;&gt; assert pd.read_table(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;),delimiter=&#39;\t&#39;).shape[0]==0</span>
<span class="sd">            &gt;&gt;&gt; assert set(pd.read_table(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;),delimiter=&#39;\t&#39;).columns)==set([&quot;name&quot;,&quot;carbohydrates&quot;,&quot;lipids&quot;,&quot;proteins&quot;,&quot;tss&quot;,&quot;si&quot;,&quot;xi&quot;,&quot;reference&quot;])</span>
<span class="sd">            &gt;&gt;&gt; os.remove(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;))</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;carbohydrates&quot;</span><span class="p">,</span><span class="s2">&quot;lipids&quot;</span><span class="p">,</span><span class="s2">&quot;proteins&quot;</span><span class="p">,</span><span class="s2">&quot;tss&quot;</span><span class="p">,</span><span class="s2">&quot;si&quot;</span><span class="p">,</span><span class="s2">&quot;xi&quot;</span><span class="p">,</span><span class="s2">&quot;reference&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initialize_metagenomics_studies_db</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;This function intializes ADToolbox&#39;s Metagenomics studies database by creating an empty tsv file.</span>
<span class="sd">        Be careful, this will overwrite any existing file with the same name.</span>

<span class="sd">        Required Configs:</span>
<span class="sd">            - config.metagenomics_studies_db</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import os</span>
<span class="sd">            &gt;&gt;&gt; local_dir={&#39;metagenomics_studies&#39;:os.path.join(Main_Dir,&quot;test&quot;,&quot;metagenomics_test_db.tsv&quot;)}</span>
<span class="sd">            &gt;&gt;&gt; db=Database(config=configs.Database(studies_local=local_dir))</span>
<span class="sd">            &gt;&gt;&gt; db.initialize_metagenomics_studies_db()</span>
<span class="sd">            &gt;&gt;&gt; assert pd.read_table(local_dir[&#39;metagenomics_studies&#39;],delimiter=&quot;\t&quot;).shape[0]==0</span>
<span class="sd">            &gt;&gt;&gt; assert set(pd.read_table(local_dir[&#39;metagenomics_studies&#39;],delimiter=&quot;\t&quot;).columns)==set([&quot;name&quot;,&quot;study_type&quot;,&quot;microbiome&quot;,&quot;sample_accession&quot;,&quot;comments&quot;,&quot;study_accession&quot;])</span>
<span class="sd">            &gt;&gt;&gt; os.remove(local_dir[&#39;metagenomics_studies&#39;])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;study_type&quot;</span><span class="p">,</span><span class="s2">&quot;microbiome&quot;</span><span class="p">,</span><span class="s2">&quot;sample_accession&quot;</span><span class="p">,</span><span class="s2">&quot;comments&quot;</span><span class="p">,</span><span class="s2">&quot;study_accession&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;metagenomics_studies&quot;</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initialize_experimental_data_db</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;This function intializes ADToolbox&#39;s experimental data database by creating an empty json file.</span>
<span class="sd">        Be careful, this will overwrite any existing file with the same name.</span>

<span class="sd">        Required Configs:</span>
<span class="sd">            - config.experimental_data_db</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import os,json</span>
<span class="sd">            &gt;&gt;&gt; local_dir={&#39;experimental_data_db&#39;:os.path.join(Main_Dir,&quot;test&quot;,&quot;experiments_test_db.json&quot;)}</span>
<span class="sd">            &gt;&gt;&gt; db=Database(config=configs.Database(studies_local=local_dir))</span>
<span class="sd">            &gt;&gt;&gt; db.initialize_experimental_data_db()</span>
<span class="sd">            &gt;&gt;&gt; assert pd.read_json(local_dir[&#39;experimental_data_db&#39;]).shape[0]==0</span>
<span class="sd">            &gt;&gt;&gt; with open(local_dir[&#39;experimental_data_db&#39;],&quot;r&quot;) as f:</span>
<span class="sd">            ...     assert json.load(f)==[]</span>
<span class="sd">            &gt;&gt;&gt; os.remove(local_dir[&#39;experimental_data_db&#39;])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;experimental_data_db&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;experimental_data_db&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;initial_concentrations&quot;</span><span class="p">,</span><span class="s2">&quot;time&quot;</span><span class="p">,</span><span class="s2">&quot;variables&quot;</span><span class="p">,</span><span class="s2">&quot;data&quot;</span><span class="p">,</span><span class="s2">&quot;reference&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;experimental_data_db&quot;</span><span class="p">],</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">filter_seed_from_ec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                            <span class="n">ec_list</span><span class="p">:</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                            <span class="n">save</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function takes a list of EC numbers and filters the seed database to find the seed reactions that have the EC numbers in their EC number list.</span>
<span class="sd">        This will help to trim the large seed database to a smaller one that only contains the reactions that are relevant to the AD process.</span>

<span class="sd">        Args:</span>
<span class="sd">            ec_list (list[str]): A list of EC numbers.</span>
<span class="sd">            save (bool, optional): Whether to save the filtered seed database or not. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: A tuple containing the filtered seed reaction database and the seed compound database, respectively.</span>

<span class="sd">        Required Configs:</span>

<span class="sd">            - config.reaction_db</span>
<span class="sd">            --------</span>
<span class="sd">            - config.compound_db</span>
<span class="sd">            --------</span>
<span class="sd">            - config.local_reaction_db</span>
<span class="sd">            --------</span>
<span class="sd">            - config.local_compound_db</span>
<span class="sd">            --------</span>


<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; db=Database()</span>
<span class="sd">            &gt;&gt;&gt; seed_rxn_db,seed_compound_db=db.filter_seed_from_ec([&quot;1.1.1.1&quot;,&quot;1.1.1.2&quot;])</span>
<span class="sd">            &gt;&gt;&gt; assert len(seed_rxn_db)&gt;0 and len(seed_compound_db)&gt;0</span>
<span class="sd">            &gt;&gt;&gt; assert pd.read_json(configs.Database().reaction_db).shape[0]&gt;pd.DataFrame(seed_rxn_db).shape[0]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">seed_rxn_db</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reaction_db</span><span class="p">)</span>
        <span class="n">seed_compound_db</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">compound_db</span><span class="p">)</span>
        <span class="n">seed_rxn_db</span><span class="o">=</span><span class="n">seed_rxn_db</span><span class="p">[</span><span class="n">seed_rxn_db</span><span class="p">[</span><span class="s2">&quot;ec_numbers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">any</span><span class="p">(</span><span class="n">ec</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">for</span> <span class="n">ec</span> <span class="ow">in</span> <span class="n">ec_list</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)]</span>
        <span class="n">seed_compound_db</span><span class="o">=</span><span class="n">seed_compound_db</span><span class="p">[</span><span class="n">seed_compound_db</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">seed_rxn_db</span><span class="p">[</span><span class="s2">&quot;stoichiometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">seed_rxn_db</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">local_reaction_db</span><span class="p">)</span>
            <span class="n">seed_compound_db</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">local_compound_db</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">seed_rxn_db</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;record&quot;</span><span class="p">),</span><span class="n">seed_compound_db</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;record&quot;</span><span class="p">)</span>



    <span class="k">def</span> <span class="nf">get_protein_seqs_from_uniprot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniprot_id</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function takes a uniprot id and fetches the protein sequence from Uniprot.</span>

<span class="sd">        Args:</span>
<span class="sd">            uniprot_id (str): The uniprot id of the protein.</span>


<span class="sd">        Returns:</span>
<span class="sd">            str: The protein sequence.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; db=Database()</span>
<span class="sd">            &gt;&gt;&gt; seq=db.get_protein_seqs_from_uniprot(&quot;P0A9P0&quot;)</span>
<span class="sd">            &gt;&gt;&gt; assert type(seq)==str and len(seq)&gt;0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Base_URL</span> <span class="o">=</span> <span class="s2">&quot;https://rest.uniprot.org/uniprotkb/&quot;</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
        <span class="n">retry</span> <span class="o">=</span> <span class="n">Retry</span><span class="p">(</span><span class="n">connect</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">backoff_factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">adapter</span> <span class="o">=</span> <span class="n">HTTPAdapter</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="n">retry</span><span class="p">)</span>
        <span class="n">session</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s1">&#39;http://&#39;</span><span class="p">,</span> <span class="n">adapter</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;https://rest.uniprot.org/uniprotkb/</span><span class="si">{</span><span class="n">uniprot_id</span><span class="si">}</span><span class="s2">.fasta&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not fetch the sequence! Trying again ...&quot;</span><span class="p">)</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                <span class="n">file</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Base_URL</span><span class="o">+</span><span class="n">uniprot_id</span><span class="o">+</span><span class="s2">&quot;.fasta&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
                    <span class="k">break</span>

        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">proteins_from_ec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ec_number</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function returns a dictionary of protein sequences for a given EC number.</span>
<span class="sd">        The keys are the uniprot ids and ec number compatible with ADToolbox protein database</span>
<span class="sd">        and the values are the protein sequences. Since ADToolbox deals with microbial process,</span>
<span class="sd">        only bacterial and archaeal proteins are considered.</span>

<span class="sd">        Args:</span>
<span class="sd">            ec_number (str): The EC number.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary of protein sequences.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; db=Database()</span>
<span class="sd">            &gt;&gt;&gt; protein_seqs=db.proteins_from_ec(&quot;1.1.1.1&quot;)</span>
<span class="sd">            &gt;&gt;&gt; assert len(protein_seqs)&gt;0</span>
<span class="sd">            &gt;&gt;&gt; assert list(protein_seqs.keys())[0].split(&quot;|&quot;)[1]==&quot;1.1.1.1&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
        <span class="n">retry</span> <span class="o">=</span> <span class="n">Retry</span><span class="p">(</span><span class="n">connect</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">backoff_factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">adapter</span> <span class="o">=</span> <span class="n">HTTPAdapter</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="n">retry</span><span class="p">)</span>
        <span class="n">session</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s1">&#39;http://&#39;</span><span class="p">,</span> <span class="n">adapter</span><span class="p">)</span>
        <span class="n">protein_seqs</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;https://rest.uniprot.org/uniprotkb/stream?format=fasta&amp;query=%28%28ec%3A</span><span class="si">{</span><span class="n">ec_number</span><span class="si">}</span><span class="s2">%29%20AND%20%28reviewed%3Atrue%29%20NOT%20%28taxonomy_id%3A2759%29%29&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="ow">or</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Request Error! Trying again ...&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;https://rest.uniprot.org/uniprotkb/stream?format=fasta&amp;query=%28%28ec%3A</span><span class="si">{</span><span class="n">ec_number</span><span class="si">}</span><span class="s2">%29%20AND%20%28reviewed%3Atrue%29%20NOT%20%28taxonomy_id%3A2759%29%29&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="c1"># This alsp does a sanity chec</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Something went wrong!&#39;</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">text</span>
        <span class="k">if</span> <span class="n">text</span><span class="p">:</span>
            <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)</span>
            <span class="n">text</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
                <span class="n">protein_seqs</span><span class="o">.</span><span class="n">update</span><span class="p">([(</span><span class="n">seq</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;|&quot;</span><span class="o">+</span><span class="n">ec_number</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">seq</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]))])</span>


        <span class="k">return</span> <span class="n">protein_seqs</span>


    <span class="k">def</span> <span class="nf">build_protein_db_from_reactions_db</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function builds the protein database from the reaction database.</span>
<span class="sd">        It takes the reaction database and finds the protein sequences for each EC number in the reaction database.</span>
<span class="sd">        Then it saves the protein sequences in a fasta file.</span>

<span class="sd">        Required Configs:</span>
<span class="sd">            - config.reaction_db</span>
<span class="sd">            --------</span>
<span class="sd">            - config.protein_db</span>
<span class="sd">            --------</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import os</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))==False</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;reaction_test_db.tsv&quot;))==False</span>
<span class="sd">            &gt;&gt;&gt; db=Database(config=configs.Database(protein_db=os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;),reaction_db=os.path.join(Main_Dir,&quot;reaction_test_db.tsv&quot;)))</span>
<span class="sd">            &gt;&gt;&gt; reaction_db=pd.DataFrame(columns=[&quot;EC_Numbers&quot;,&quot;Seed Ids&quot;,&quot;Reaction Names&quot;,&quot;ADM1_Reaction&quot;,&quot;e_adm_Reactions&quot;,&quot;Pathways&quot;])</span>
<span class="sd">            &gt;&gt;&gt; reaction_db.loc[0,&quot;EC_Numbers&quot;]=&quot;1.1.1.1&quot;</span>
<span class="sd">            &gt;&gt;&gt; reaction_db.to_csv(os.path.join(Main_Dir,&quot;reaction_test_db.tsv&quot;),index=False,sep=&quot;\t&quot;)</span>
<span class="sd">            &gt;&gt;&gt; db.build_protein_db_from_reactions_db()</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))==True</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;reaction_test_db.tsv&quot;))==True</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.getsize(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))&gt;0</span>
<span class="sd">            &gt;&gt;&gt; os.remove(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))</span>
<span class="sd">            &gt;&gt;&gt; os.remove(os.path.join(Main_Dir,&quot;reaction_test_db.tsv&quot;))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rxn_db</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reaction_db</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ec_numbers</span><span class="o">=</span><span class="n">rxn_db</span><span class="p">[</span><span class="s2">&quot;EC_Numbers&quot;</span><span class="p">]</span>
        <span class="n">ec_numbers</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ec_numbers</span><span class="p">))</span>
        <span class="n">protein_seqs</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">ec</span> <span class="ow">in</span> <span class="n">ec_numbers</span><span class="p">:</span>
            <span class="n">protein_seqs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proteins_from_ec</span><span class="p">(</span><span class="n">ec</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">protein_seqs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">value</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cazy_ec</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">list</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">add_protein_to_protein_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">protein_id</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">header_tail</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This funciton adds a protein sequence to the protein database. It takes a uniprot id and an EC number it is assigned to </span>
<span class="sd">        and adds the corresponding protein sequence to the protein database.</span>

<span class="sd">        Required Configs:</span>
<span class="sd">            - config.protein_db</span>

<span class="sd">        Args:</span>
<span class="sd">            protein_id (str): The uniprot id of the protein.</span>
<span class="sd">            header_tail (str): A text to append to the header of the entry in the database;</span>
<span class="sd">            In ADToolbox it is better to use ec number for compatibility with downstream functions.</span>


<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import os</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))==False</span>
<span class="sd">            &gt;&gt;&gt; db=Database(config=configs.Database(protein_db=os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;)))</span>
<span class="sd">            &gt;&gt;&gt; db.add_protein_to_protein_db(&quot;P0A9P0&quot;,&quot;1.2.3.4&quot;)</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))==True</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.getsize(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))&gt;0</span>
<span class="sd">            &gt;&gt;&gt; import utils</span>
<span class="sd">            &gt;&gt;&gt; assert len(utils.fasta_to_dict(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;)))&gt;0</span>
<span class="sd">            &gt;&gt;&gt; os.remove(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initialize_protein_db</span><span class="p">()</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="p">,</span><span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="o">+</span><span class="n">protein_id</span><span class="o">+</span><span class="s2">&quot;|&quot;</span><span class="o">+</span><span class="n">header_tail</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_protein_seqs_from_uniprot</span><span class="p">(</span><span class="n">protein_id</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_proteins_from_ecnumbers_to_protein_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ec_numbers</span><span class="p">:</span><span class="nb">list</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function adds protein sequences to the protein database from a list of EC numbers.</span>
<span class="sd">        It takes a list of EC numbers and finds the protein sequences for each EC number in the list.</span>
<span class="sd">        Then it saves the protein sequences in a fasta file.</span>

<span class="sd">        Required Configs:</span>
<span class="sd">            - config.protein_db</span>

<span class="sd">        Args:</span>
<span class="sd">            ec_numbers (list): A list of EC numbers.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import os</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))==False</span>
<span class="sd">            &gt;&gt;&gt; db=Database(config=configs.Database(protein_db=os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;)))</span>
<span class="sd">            &gt;&gt;&gt; db.add_proteins_from_ecnumbers_to_protein_db([&quot;1.1.1.1&quot;,&quot;1.1.1.2&quot;])</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))==True</span>
<span class="sd">            &gt;&gt;&gt; import utils</span>
<span class="sd">            &gt;&gt;&gt; assert len(utils.fasta_to_dict(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;)))&gt;0</span>
<span class="sd">            &gt;&gt;&gt; os.remove(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initialize_protein_db</span><span class="p">()</span>

        <span class="n">protein_seqs</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">ec</span> <span class="ow">in</span> <span class="n">ec_numbers</span><span class="p">:</span>
            <span class="n">protein_seqs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proteins_from_ec</span><span class="p">(</span><span class="n">ec</span><span class="p">))</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="p">,</span><span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">protein_seqs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">value</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_feed_to_feed_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">feed</span><span class="p">:</span><span class="n">Feed</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function adds a feed to the feed database. It takes the feed name and the feed composition and adds them to the feed database.</span>

<span class="sd">        Required Configs:</span>
<span class="sd">            - config.feed_db</span>

<span class="sd">        Args:</span>
<span class="sd">            feed (Feed): An instance of the Feed class.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import os</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;))==False</span>
<span class="sd">            &gt;&gt;&gt; db=Database(config=configs.Database(feed_db=os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;)))</span>
<span class="sd">            &gt;&gt;&gt; feed=Feed(name=&quot;test_feed&quot;,carbohydrates=10,lipids=20,proteins=30,tss=80,si=10,xi=30,reference=&quot;test&quot;)</span>
<span class="sd">            &gt;&gt;&gt; db.add_feed_to_feed_db(feed)</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;))==True</span>
<span class="sd">            &gt;&gt;&gt; assert pd.read_table(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;),delimiter=&quot;\t&quot;).shape[0]&gt;0</span>
<span class="sd">            &gt;&gt;&gt; os.remove(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;))</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initialize_feed_db</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">feed</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Feed already exists in the database.&quot;</span><span class="p">)</span>
        <span class="n">feed_db</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">feed_db</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">feed_db</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">feed</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()])],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">feed_db</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">remove_feed_from_feed_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">field_name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">query</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function removes studyes that contain the query in the given column, field name, from the feed database.</span>

<span class="sd">        Required Configs:</span>
<span class="sd">            - config.feed_db</span>

<span class="sd">        Args:</span>
<span class="sd">            field_name (str): The name of the column to query.</span>
<span class="sd">            query (str): The query string.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import os</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;))==False</span>
<span class="sd">            &gt;&gt;&gt; db=Database(config=configs.Database(feed_db=os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;)))</span>
<span class="sd">            &gt;&gt;&gt; feed=Feed(name=&quot;test_feed&quot;,carbohydrates=10,lipids=20,proteins=30,tss=80,si=10,xi=30,reference=&quot;test&quot;)</span>
<span class="sd">            &gt;&gt;&gt; db.add_feed_to_feed_db(feed)</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;))==True</span>
<span class="sd">            &gt;&gt;&gt; assert pd.read_table(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;),delimiter=&quot;\t&quot;).shape[0]&gt;0</span>
<span class="sd">            &gt;&gt;&gt; db.remove_feed_from_feed_db(&quot;name&quot;,&quot;test_feed&quot;)</span>
<span class="sd">            &gt;&gt;&gt; assert pd.read_table(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;),delimiter=&quot;\t&quot;).shape[0]==0</span>
<span class="sd">            &gt;&gt;&gt; os.remove(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;))</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Feed database does not exist!&quot;</span><span class="p">)</span>


        <span class="n">feed_db</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">feed_db</span><span class="o">=</span><span class="n">feed_db</span><span class="p">[</span><span class="n">feed_db</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">==</span><span class="kc">False</span><span class="p">]</span>
        <span class="n">feed_db</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_feed_from_feed_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">field_name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">query</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">list</span><span class="p">[</span><span class="n">Feed</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function returns a feed from the feed database. It takes the query string and the column name to query and returns the feed that contains the query string in the given column.</span>

<span class="sd">        Required Configs:</span>
<span class="sd">            - config.feed_db</span>

<span class="sd">        Args:</span>
<span class="sd">            field_name (str): The name of the column to query.</span>
<span class="sd">            query (str): The query string.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Feed: An instance of the Feed class.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import os</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;))==False</span>
<span class="sd">            &gt;&gt;&gt; db=Database(config=configs.Database(feed_db=os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;)))</span>
<span class="sd">            &gt;&gt;&gt; feed=Feed(name=&quot;test_feed&quot;,carbohydrates=10,lipids=20,proteins=30,tss=80,si=10,xi=30,reference=&quot;test&quot;)</span>
<span class="sd">            &gt;&gt;&gt; db.add_feed_to_feed_db(feed)</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;))==True</span>
<span class="sd">            &gt;&gt;&gt; assert pd.read_table(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;),delimiter=&quot;\t&quot;).shape[0]&gt;0</span>
<span class="sd">            &gt;&gt;&gt; feed=db.get_feed_from_feed_db(&quot;name&quot;,&quot;test_feed&quot;)</span>
<span class="sd">            &gt;&gt;&gt; assert feed[0].name==&quot;test_feed&quot;</span>
<span class="sd">            &gt;&gt;&gt; os.remove(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;))</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Feed database does not exist!&quot;</span><span class="p">)</span>

        <span class="n">feed_db</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">feed_db</span><span class="o">=</span><span class="n">feed_db</span><span class="p">[</span><span class="n">feed_db</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">query</span><span class="p">)]</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Feed</span><span class="p">(</span><span class="o">**</span><span class="n">feed</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">feed</span> <span class="ow">in</span> <span class="n">feed_db</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()]</span>

    <span class="k">def</span> <span class="nf">add_metagenomics_study_to_metagenomics_studies_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">metagenomics_study</span><span class="p">:</span><span class="n">MetagenomicsStudy</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function adds a metagenomics study to the metagenomics studies database. It takes a metagenomics study and adds it to the metagenomics studies database.</span>

<span class="sd">        Required Configs:</span>
<span class="sd">            - config.metagenomics_studies_db</span>

<span class="sd">        Args:</span>
<span class="sd">            metagenomics_study (MetagenomicsStudy): An instance of the MetagenomicsStudy class.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import os</span>
<span class="sd">            &gt;&gt;&gt; local_dir={&#39;metagenomics_studies&#39;:os.path.join(Main_Dir,&quot;test&quot;,&quot;metagenomics_test_db.tsv&quot;)}</span>
<span class="sd">            &gt;&gt;&gt; db=Database(config=configs.Database(studies_local=local_dir))</span>
<span class="sd">            &gt;&gt;&gt; metagenomics_study=MetagenomicsStudy(name=&quot;test_study&quot;,study_type=&quot;metagenomics&quot;,microbiome=&quot;anaerobic digester&quot;,sample_accession=&quot;test&quot;,comments=&quot;test&quot;,study_accession=&quot;test&quot;)</span>
<span class="sd">            &gt;&gt;&gt; db.add_metagenomics_study_to_metagenomics_studies_db(metagenomics_study)</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(local_dir[&#39;metagenomics_studies&#39;])==True</span>
<span class="sd">            &gt;&gt;&gt; assert pd.read_table(local_dir[&#39;metagenomics_studies&#39;],delimiter=&quot;\t&quot;).shape[0]&gt;0</span>
<span class="sd">            &gt;&gt;&gt; os.remove(local_dir[&#39;metagenomics_studies&#39;])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;metagenomics_studies&quot;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initialize_metagenomics_studies_db</span><span class="p">()</span>
        <span class="n">metagenomics_studies_db</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;metagenomics_studies&quot;</span><span class="p">],</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">metagenomics_studies_db</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">metagenomics_studies_db</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">metagenomics_study</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()])],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">metagenomics_studies_db</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;metagenomics_studies&quot;</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">remove_metagenomics_study_from_metagenomics_studies_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">field_name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">query</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function removes studies that contain the query in the given column, field name, from the metagenomics studies database.</span>

<span class="sd">        Required Configs:</span>
<span class="sd">            - config.metagenomics_studies_db</span>

<span class="sd">        Args:</span>
<span class="sd">            field_name (str): The name of the column to query.</span>
<span class="sd">            query (str): The query string.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import os,json</span>
<span class="sd">            &gt;&gt;&gt; local_dir={&#39;metagenomics_studies&#39;:os.path.join(Main_Dir,&quot;test&quot;,&quot;metagenomics_test_db.json&quot;)}</span>
<span class="sd">            &gt;&gt;&gt; db=Database(config=configs.Database(studies_local=local_dir))</span>
<span class="sd">            &gt;&gt;&gt; metagenomics_study=MetagenomicsStudy(name=&quot;test_study&quot;,study_type=&quot;metagenomics&quot;,microbiome=&quot;anaerobic digester&quot;,sample_accession=&quot;test&quot;,comments=&quot;test&quot;,study_accession=&quot;test&quot;)</span>
<span class="sd">            &gt;&gt;&gt; db.add_metagenomics_study_to_metagenomics_studies_db(metagenomics_study)</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(local_dir[&#39;metagenomics_studies&#39;])==True</span>
<span class="sd">            &gt;&gt;&gt; assert pd.read_table(local_dir[&#39;metagenomics_studies&#39;],delimiter=&quot;\t&quot;).shape[0]&gt;0</span>
<span class="sd">            &gt;&gt;&gt; db.remove_metagenomics_study_from_metagenomics_studies_db(&quot;name&quot;,&quot;test_study&quot;)</span>
<span class="sd">            &gt;&gt;&gt; assert pd.read_table(local_dir[&#39;metagenomics_studies&#39;],delimiter=&quot;\t&quot;).shape[0]==0</span>
<span class="sd">            &gt;&gt;&gt; os.remove(local_dir[&#39;metagenomics_studies&#39;])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;metagenomics_studies&quot;</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Metagenomics studies database does not exist!&quot;</span><span class="p">)</span>

        <span class="n">metagenomics_studies_db</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;metagenomics_studies&quot;</span><span class="p">],</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">metagenomics_studies_db</span><span class="o">=</span><span class="n">metagenomics_studies_db</span><span class="p">[</span><span class="n">metagenomics_studies_db</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">==</span><span class="kc">False</span><span class="p">]</span>
        <span class="n">metagenomics_studies_db</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;metagenomics_studies&quot;</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_metagenomics_study_from_metagenomics_studies_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">field_name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">query</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">list</span><span class="p">[</span><span class="n">MetagenomicsStudy</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function returns a metagenomics study from the metagenomics studies database. It takes the query string and the column name to query and returns the metagenomics study that contains the query string in the given column.</span>

<span class="sd">        Required Configs:</span>
<span class="sd">            - config.metagenomics_studies_db</span>

<span class="sd">        Args:</span>
<span class="sd">            field_name (str): The name of the column to query.</span>
<span class="sd">            query (str): The query string.</span>

<span class="sd">        Returns:</span>
<span class="sd">            MetagenomicsStudy: An instance of the MetagenomicsStudy class.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import os</span>
<span class="sd">            &gt;&gt;&gt; local_dir={&#39;metagenomics_studies&#39;:os.path.join(Main_Dir,&quot;test&quot;,&quot;metagenomics_test_db.tsv&quot;)}</span>
<span class="sd">            &gt;&gt;&gt; db=Database(config=configs.Database(studies_local=local_dir))</span>
<span class="sd">            &gt;&gt;&gt; metagenomics_study=MetagenomicsStudy(name=&quot;test_study&quot;,study_type=&quot;metagenomics&quot;,microbiome=&quot;anaerobic digester&quot;,sample_accession=&quot;test&quot;,comments=&quot;test&quot;,study_accession=&quot;test&quot;)</span>
<span class="sd">            &gt;&gt;&gt; db.add_metagenomics_study_to_metagenomics_studies_db(metagenomics_study)</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(local_dir[&#39;metagenomics_studies&#39;])==True</span>
<span class="sd">            &gt;&gt;&gt; assert pd.read_table(local_dir[&#39;metagenomics_studies&#39;],delimiter=&quot;\t&quot;).shape[0]&gt;0</span>
<span class="sd">            &gt;&gt;&gt; metagenomics_study=db.get_metagenomics_study_from_metagenomics_studies_db(&quot;name&quot;,&quot;test_study&quot;)</span>
<span class="sd">            &gt;&gt;&gt; assert metagenomics_study[0].name==&quot;test_study&quot;</span>
<span class="sd">            &gt;&gt;&gt; os.remove(local_dir[&#39;metagenomics_studies&#39;])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;metagenomics_studies&quot;</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Metagenomics studies database does not exist!&quot;</span><span class="p">)</span>

        <span class="n">metagenomics_studies_db</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;metagenomics_studies&quot;</span><span class="p">],</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">metagenomics_studies_db</span><span class="o">=</span><span class="n">metagenomics_studies_db</span><span class="p">[</span><span class="n">metagenomics_studies_db</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">query</span><span class="p">)]</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">MetagenomicsStudy</span><span class="p">(</span><span class="o">**</span><span class="n">metagenomics_study</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">metagenomics_study</span> <span class="ow">in</span> <span class="n">metagenomics_studies_db</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()]</span>

    <span class="k">def</span> <span class="nf">add_experiment_to_experiments_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">experiment</span><span class="p">:</span><span class="n">Experiment</span><span class="p">,</span><span class="n">force</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function adds an experiment to the experiments database. It takes an experiment and adds it to the experiments database.</span>

<span class="sd">        Required Configs:</span>
<span class="sd">            - config.experimental_data_db</span>

<span class="sd">        Args:</span>
<span class="sd">            experiment (Experiment): An instance of the Experiment class.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import os,json</span>
<span class="sd">            &gt;&gt;&gt; local_dir={&#39;experimental_data_db&#39;:os.path.join(Main_Dir,&quot;test&quot;,&quot;experiments_test_db.json&quot;)}</span>
<span class="sd">            &gt;&gt;&gt; if os.path.exists(local_dir[&#39;experimental_data_db&#39;]):</span>
<span class="sd">            ...     os.remove(local_dir[&#39;experimental_data_db&#39;])</span>
<span class="sd">            &gt;&gt;&gt; db=Database(config=configs.Database(studies_local=local_dir))</span>
<span class="sd">            &gt;&gt;&gt; feed=Feed(name=&quot;test_feed&quot;,carbohydrates=10,lipids=20,proteins=30,tss=80,si=10,xi=30,reference=&quot;test&quot;)</span>
<span class="sd">            &gt;&gt;&gt; experiment = Experiment(name=&quot;test2_study&quot;,initial_concentrations={}, time=[0, 1, 2], variables=[&quot;S_bu&quot;,&quot;S_ac&quot;], data=[[1, 2, 3], [4, 5, 6]],feed=feed,reference=&quot;test&quot;)</span>
<span class="sd">            &gt;&gt;&gt; db.add_experiment_to_experiments_db(experiment,force=True)</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(local_dir[&#39;experimental_data_db&#39;])==True</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.getsize(local_dir[&#39;experimental_data_db&#39;])&gt;0</span>
<span class="sd">            &gt;&gt;&gt; os.remove(local_dir[&#39;experimental_data_db&#39;])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;experimental_data_db&quot;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initialize_experimental_data_db</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_experiment_from_experiments_db</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="n">experiment</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">remove_experiment_from_experiments_db</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="n">exp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Experiment already exists in the database!&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;experimental_data_db&quot;</span><span class="p">],</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">experiments_db</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">experiments_db</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;experimental_data_db&quot;</span><span class="p">],</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">experiments_db</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">remove_experiment_from_experiments_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">field_name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">query</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function removes experiments that contain the query in the given column, field name, from the experiments database.</span>

<span class="sd">        Required Configs:</span>
<span class="sd">            - config.experimental_data_db</span>

<span class="sd">        Args:</span>
<span class="sd">            field_name (str): The name of the column to query.</span>
<span class="sd">            query (str): The query string.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import os,json</span>
<span class="sd">            &gt;&gt;&gt; local_dir={&#39;experimental_data_db&#39;:os.path.join(Main_Dir,&quot;test&quot;,&quot;experiments_test_db.json&quot;)}</span>
<span class="sd">            &gt;&gt;&gt; db=Database(config=configs.Database(studies_local=local_dir))</span>
<span class="sd">            &gt;&gt;&gt; feed=Feed(name=&quot;test_feed&quot;,carbohydrates=10,lipids=20,proteins=30,tss=80,si=10,xi=30,reference=&quot;test&quot;)</span>
<span class="sd">            &gt;&gt;&gt; experiment = Experiment(name=&quot;test2_study&quot;,initial_concentrations={}, time=[0, 1, 2], variables=[&quot;S_bu&quot;,&quot;S_ac&quot;], data=[[1, 2, 3], [4, 5, 6]],feed=feed,reference=&quot;test&quot;)</span>
<span class="sd">            &gt;&gt;&gt; db.add_experiment_to_experiments_db(experiment,force=True)</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(local_dir[&#39;experimental_data_db&#39;])==True</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.getsize(local_dir[&#39;experimental_data_db&#39;])&gt;0</span>
<span class="sd">            &gt;&gt;&gt; db.remove_experiment_from_experiments_db(&quot;name&quot;,&quot;test2_study&quot;)</span>
<span class="sd">            &gt;&gt;&gt; assert pd.read_json(local_dir[&#39;experimental_data_db&#39;]).shape[0]==0</span>
<span class="sd">            &gt;&gt;&gt; os.remove(local_dir[&#39;experimental_data_db&#39;])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;experimental_data_db&quot;</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Experimental data database does not exist!&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;experimental_data_db&quot;</span><span class="p">],</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">experiments_db</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">experiments_db</span><span class="o">=</span><span class="p">[</span><span class="n">experiment</span> <span class="k">for</span> <span class="n">experiment</span> <span class="ow">in</span> <span class="n">experiments_db</span> <span class="k">if</span> <span class="n">query</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">experiment</span><span class="p">[</span><span class="n">field_name</span><span class="p">]]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;experimental_data_db&quot;</span><span class="p">],</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">experiments_db</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_experiment_from_experiments_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">field_name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">query</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">list</span><span class="p">[</span><span class="n">Experiment</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function returns an experiment from the experiments database. It takes the query string and the column name to query and returns the experiment that contains the query string in the given column.</span>

<span class="sd">        Required Configs:</span>
<span class="sd">            - config.experimental_data_db</span>

<span class="sd">        Args:</span>
<span class="sd">            field_name (str): The name of the column to query.</span>
<span class="sd">            query (str): The query string.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Experiment: An instance of the Experiment class.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import os,json</span>
<span class="sd">            &gt;&gt;&gt; local_dir={&#39;experimental_data_db&#39;:os.path.join(Main_Dir,&quot;test&quot;,&quot;experiments_test_db.json&quot;)}</span>
<span class="sd">            &gt;&gt;&gt; db=Database(config=configs.Database(studies_local=local_dir))</span>
<span class="sd">            &gt;&gt;&gt; feed=Feed(name=&quot;test_feed&quot;,carbohydrates=10,lipids=20,proteins=30,tss=80,si=10,xi=30,reference=&quot;test&quot;)</span>
<span class="sd">            &gt;&gt;&gt; experiment = Experiment(name=&quot;test2_study&quot;,initial_concentrations={}, time=[0, 1, 2], variables=[&quot;S_bu&quot;,&quot;S_ac&quot;], data=[[1, 2, 3], [4, 5, 6]],feed=feed,reference=&quot;test&quot;)</span>
<span class="sd">            &gt;&gt;&gt; db.add_experiment_to_experiments_db(experiment,force=True)</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(local_dir[&#39;experimental_data_db&#39;])==True</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.getsize(local_dir[&#39;experimental_data_db&#39;])&gt;0</span>
<span class="sd">            &gt;&gt;&gt; experiment=db.get_experiment_from_experiments_db(&quot;name&quot;,&quot;test2_study&quot;)</span>
<span class="sd">            &gt;&gt;&gt; assert experiment[0].name==&quot;test2_study&quot;</span>
<span class="sd">            &gt;&gt;&gt; os.remove(local_dir[&#39;experimental_data_db&#39;])</span>
<span class="sd">        &quot;&quot;&quot;</span>



        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;experimental_data_db&quot;</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Experimental data database does not exist!&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;experimental_data_db&quot;</span><span class="p">],</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">experiments_db</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">experiments_db</span><span class="o">=</span><span class="p">[</span><span class="n">experiment</span> <span class="k">for</span> <span class="n">experiment</span> <span class="ow">in</span> <span class="n">experiments_db</span> <span class="k">if</span> <span class="n">query</span> <span class="ow">in</span> <span class="n">experiment</span><span class="p">[</span><span class="n">field_name</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">experiment</span> <span class="ow">in</span> <span class="n">experiments_db</span><span class="p">:</span>
            <span class="n">experiment</span><span class="p">[</span><span class="s2">&quot;feed&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">Feed</span><span class="p">(</span><span class="o">**</span><span class="n">experiment</span><span class="p">[</span><span class="s2">&quot;feed&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Experiment</span><span class="p">(</span><span class="o">**</span><span class="n">experiment</span><span class="p">)</span> <span class="k">for</span> <span class="n">experiment</span> <span class="ow">in</span> <span class="n">experiments_db</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">build_mmseqs_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">container</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Builds an indexed mmseqs database from the ADToolbox&#39;s fasta protein database.</span>

<span class="sd">        Required Configs:</span>
<span class="sd">            - config.protein_db</span>
<span class="sd">            - config.adtoolbox_singularity</span>
<span class="sd">            - config.adtoolbox_docker</span>

<span class="sd">        Args:</span>
<span class="sd">            container (str, optional): The container to run the script with. Defaults to &quot;None&quot;.</span>
<span class="sd">        Returns:</span>
<span class="sd">            str: The script to build the mmseqs database.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import os</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))==False</span>
<span class="sd">            &gt;&gt;&gt; db=Database(config=configs.Database(protein_db=os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;)))</span>
<span class="sd">            &gt;&gt;&gt; db.add_protein_to_protein_db(&quot;P0A9P0&quot;,&quot;x,x,x,x&quot;)</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))==True</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.getsize(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))&gt;0</span>
<span class="sd">            &gt;&gt;&gt; script=db.build_mmseqs_database()</span>
<span class="sd">            &gt;&gt;&gt; assert script==&quot;mmseqs createdb &quot;+str(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))+&quot; &quot;+str(db.config.protein_db_mmseqs)</span>
<span class="sd">            &gt;&gt;&gt; os.remove(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">script</span><span class="o">=</span><span class="n">create_mmseqs_database</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db_mmseqs</span><span class="p">,</span>
                                      <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
                                      <span class="n">run</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                      <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>


        <span class="k">return</span> <span class="n">script</span>


    <span class="k">def</span> <span class="nf">download_adm_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbose</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Downloads the parameters needed for running ADM models in ADToolbox.</span>

<span class="sd">        Required Configs:</span>
<span class="sd">            - config.adm_parameters_base_dir</span>
<span class="sd">            - config.adm_parameters_urls</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import os</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;adm_parameters_test&quot;))==False</span>
<span class="sd">            &gt;&gt;&gt; E_ADM_LOCAL={&quot;model_parameters&quot;:os.path.join(Main_Dir, &quot;test&quot;,&quot;ADM_Parameters&quot;,&quot;e_adm_model_parameters.json&quot;),\</span>
<span class="sd">	        &quot;base_parameters&quot;:os.path.join(Main_Dir, &quot;test&quot;,&quot;ADM_Parameters&quot;,&quot;e_adm_base_parameters.json&quot;),\</span>
<span class="sd">	        &quot;initial_conditions&quot;:os.path.join(Main_Dir, &quot;test&quot;,&quot;ADM_Parameters&quot;,&quot;e_adm_initial_conditions.json&quot;),\</span>
<span class="sd">	        &quot;inlet_conditions&quot;:os.path.join(Main_Dir, &quot;test&quot;,&quot;ADM_Parameters&quot;,&quot;e_adm_inlet_conditions.json&quot;),\</span>
<span class="sd">	        &quot;reactions&quot;:os.path.join(Main_Dir, &quot;test&quot;,&quot;ADM_Parameters&quot;,&quot;e_adm_reactions.json&quot;),\</span>
<span class="sd">	        &quot;species&quot;:os.path.join(Main_Dir, &quot;test&quot;,&quot;ADM_Parameters&quot;,&quot;e_adm_species.json&quot;)}</span>
<span class="sd">            &gt;&gt;&gt; db=Database(config=configs.Database(adm_parameters=E_ADM_LOCAL))</span>
<span class="sd">            &gt;&gt;&gt; db.download_adm_parameters(verbose=False) </span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;test&quot;))==True</span>
<span class="sd">            &gt;&gt;&gt; assert len(os.listdir(os.path.join(Main_Dir,&quot;test&quot;)))&gt;0</span>
<span class="sd">            &gt;&gt;&gt; os.system(&quot;rm -r &quot;+os.path.join(Main_Dir,&quot;test&quot;))</span>
<span class="sd">            0</span>

<span class="sd">        Args:</span>

<span class="sd">            verbose (bool, optional): Whether to print the progress or not. Defaults to True.</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adm_parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adm_parameters</span><span class="p">[</span><span class="n">param</span><span class="p">])</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adm_parameters</span><span class="p">[</span><span class="n">param</span><span class="p">])</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adm_parameters_urls</span><span class="p">[</span><span class="n">param</span><span class="p">],</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adm_parameters</span><span class="p">[</span><span class="n">param</span><span class="p">],</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[green]</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> downloaded to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adm_parameters</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">download_seed_databases</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbose</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;This function will download the seed databases, both compound and reaction databases.</span>

<span class="sd">        Required Configs:</span>
<span class="sd">            - config.seed_rxn_url</span>
<span class="sd">            - config.seed_compound_url</span>
<span class="sd">            - config.reaction_db</span>
<span class="sd">            - config.compound_db</span>

<span class="sd">        Args:</span>
<span class="sd">            verbose (bool, optional): Whether to print the progress or not. Defaults to True.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import os</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;seed_compound.json&quot;))==False</span>
<span class="sd">            &gt;&gt;&gt; db=Database(config=configs.Database(reaction_db=os.path.join(Main_Dir,&quot;seed_rxn.json&quot;),compound_db=os.path.join(Main_Dir,&quot;seed_compound.json&quot;)))</span>
<span class="sd">            &gt;&gt;&gt; db.download_seed_databases(verbose=False)</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;seed_rxn.json&quot;))==True</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;seed_compound.json&quot;))==True</span>
<span class="sd">            &gt;&gt;&gt; os.remove(os.path.join(Main_Dir,&quot;seed_rxn.json&quot;))</span>
<span class="sd">            &gt;&gt;&gt; os.remove(os.path.join(Main_Dir,&quot;seed_compound.json&quot;))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">seed_rxn_url</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reaction_db</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reaction_db</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reaction_db</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[green]Reaction database downloaded to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reaction_db</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">r</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">seed_compound_url</span><span class="p">,</span><span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">compound_db</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[green]Compound database downloaded to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">compound_db</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">download_protein_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Downloads the prebuilt protein database from the remote repository.</span>

<span class="sd">        Required Configs:</span>
<span class="sd">            - config.protein_db_url</span>
<span class="sd">            - config.protein_db</span>

<span class="sd">        Args:</span>
<span class="sd">            verbose (bool, optional): Whether to print the progress or not. Defaults to True.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import os</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))==False</span>
<span class="sd">            &gt;&gt;&gt; db=Database(config=configs.Database(protein_db=os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;)))</span>
<span class="sd">            &gt;&gt;&gt; db.download_protein_database(verbose=False)</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))==True</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.getsize(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))&gt;0</span>
<span class="sd">            &gt;&gt;&gt; os.remove(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db_url</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[green]Protein database downloaded to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">download_reaction_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbose</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function will download the reaction database from the remote repository.</span>

<span class="sd">        Required Configs:</span>
<span class="sd">            - config.adtoolbox_rxn_db_url</span>
<span class="sd">            - config.csv_reaction_db</span>

<span class="sd">        Args:</span>
<span class="sd">            verbose (bool, optional): Whether to print the progress or not. Defaults to True.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import os</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;reaction_test_db.csv&quot;))==False</span>
<span class="sd">            &gt;&gt;&gt; db=Database(config=configs.Database(csv_reaction_db=os.path.join(Main_Dir,&quot;reaction_test_db.csv&quot;)))</span>
<span class="sd">            &gt;&gt;&gt; db.download_reaction_database(verbose=False)</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;reaction_test_db.csv&quot;))==True</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.getsize(os.path.join(Main_Dir,&quot;reaction_test_db.csv&quot;))&gt;0</span>
<span class="sd">            &gt;&gt;&gt; os.remove(os.path.join(Main_Dir,&quot;reaction_test_db.csv&quot;))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adtoolbox_rxn_db_url</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">csv_reaction_db</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">csv_reaction_db</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">csv_reaction_db</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[green]Reaction database downloaded to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">csv_reaction_db</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">download_feed_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbose</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function will download the feed database from the remote repository.</span>

<span class="sd">        Required Configs:</span>
<span class="sd">            - config.feed_db_url</span>
<span class="sd">            - config.feed_db</span>

<span class="sd">        Args:</span>
<span class="sd">            verbose (bool, optional): Whether to print the progress or not. Defaults to True.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import os</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;))==False</span>
<span class="sd">            &gt;&gt;&gt; db=Database(config=configs.Database(feed_db=os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;)))</span>
<span class="sd">            &gt;&gt;&gt; db.download_feed_database(verbose=False)</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;))==True</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.getsize(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;))&gt;0</span>
<span class="sd">            &gt;&gt;&gt; os.remove(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db_url</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[green]Feed database downloaded to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">download_qiime_classifier_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbose</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db_url</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">block_size</span> <span class="o">=</span> <span class="mi">1024</span>
        <span class="n">total_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content-length&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">Progress</span><span class="p">()</span> <span class="k">as</span> <span class="n">progress</span><span class="p">:</span>
                <span class="n">task</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="s2">&quot;Downloading the qiime&#39;s classifier database:&quot;</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="n">total_size</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">block_size</span><span class="p">):</span>
                    <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[green]Qiime&#39;s classifier database downloaded to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">download_studies_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbose</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function will download the required files for studies functionality.</span>

<span class="sd">        Args:</span>
<span class="sd">            verbode (bool, optional): Whether to print the progress or not. Defaults to True.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import os</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;studies_test_db.tsv&quot;))==False</span>
<span class="sd">            &gt;&gt;&gt; STUDIES_LOCAL={&quot;metagenomics_studies&quot;:os.path.join(Main_Dir,&quot;Database&quot;,&quot;test&quot;,&quot;Studies&quot;,&quot;metagenomics_studies.tsv&quot;),\</span>
<span class="sd">	                            &quot;experimental_data_db&quot;:os.path.join(Main_Dir,&quot;Database&quot;,&quot;test&quot;,&quot;Studies&quot;,&quot;experimental_data_references.json&quot;)}</span>
<span class="sd">            &gt;&gt;&gt; db=Database(config=configs.Database(studies_local=STUDIES_LOCAL))</span>
<span class="sd">            &gt;&gt;&gt; db.download_studies_database(verbose=False)</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(STUDIES_LOCAL[&#39;metagenomics_studies&#39;])==True</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.getsize(STUDIES_LOCAL[&#39;metagenomics_studies&#39;])&gt;0</span>
<span class="sd">            &gt;&gt;&gt; os.remove(STUDIES_LOCAL[&#39;metagenomics_studies&#39;])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;metagenomics_studies&quot;</span><span class="p">,</span><span class="s2">&quot;experimental_data_db&quot;</span><span class="p">]:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_remote</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">parent</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[bold green]Downloaded </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_remote</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">[/bold green]&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">download_amplicon_to_genome_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbose</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function will automatically download the GTDB-tk database for genome assignment.</span>

<span class="sd">        Required Configs:</span>
<span class="sd">            - config.amplicon_to_genome_db</span>
<span class="sd">            - config.amplicon_to_genome_urls</span>

<span class="sd">        Args:</span>
<span class="sd">            verbose (bool, optional): Whether to print the progress or not. Defaults to True.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import os</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;amplicon_to_genome_test_db&quot;))==False</span>
<span class="sd">            &gt;&gt;&gt; db=Database(config=configs.Database(amplicon_to_genome_db=os.path.join(Main_Dir,&quot;amplicon_to_genome_test_db&quot;)))</span>
<span class="sd">            &gt;&gt;&gt; db.download_amplicon_to_genome_db(verbose=False)</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;amplicon_to_genome_test_db&quot;))==True</span>
<span class="sd">            &gt;&gt;&gt; assert len(os.listdir(os.path.join(Main_Dir,&quot;amplicon_to_genome_test_db&quot;)))&gt;0</span>
<span class="sd">            &gt;&gt;&gt; os.system(&quot;rm -r &quot;+os.path.join(Main_Dir,&quot;amplicon_to_genome_test_db&quot;))</span>
<span class="sd">            0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon_to_genome_db</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon_to_genome_db</span><span class="p">)</span>

        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon_to_genome_urls</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Version&#39;</span><span class="p">,</span> <span class="s1">&#39;MD5SUM&#39;</span><span class="p">,</span> <span class="s1">&#39;FILE_DESCRIPTIONS&#39;</span><span class="p">]:</span>
                <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="n">keys</span><span class="p">],</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
                    <span class="n">total_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content-length&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                    <span class="n">block_size</span> <span class="o">=</span> <span class="mi">1024</span>
                    <span class="k">with</span> <span class="n">Progress</span><span class="p">()</span> <span class="k">as</span> <span class="n">progress</span><span class="p">:</span>
                        <span class="n">task1</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="s2">&quot;Downloading &quot;</span> <span class="o">+</span> <span class="n">keys</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="n">total_size</span><span class="p">)</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon_to_genome_db</span><span class="p">,</span> <span class="n">keys</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">block_size</span><span class="p">):</span>
                                <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">task1</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
                                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="s1">&#39;metadata_field_desc&#39;</span><span class="p">],</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
                <span class="n">total_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content-length&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                <span class="n">block_size</span> <span class="o">=</span> <span class="mi">1024</span>
                <span class="k">with</span> <span class="n">Progress</span><span class="p">()</span> <span class="k">as</span> <span class="n">progress</span><span class="p">:</span>
                    <span class="n">task1</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="s2">&quot;Downloading metadata_field_desc.tsv&quot;</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="n">total_size</span><span class="p">)</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon_to_genome_db</span><span class="p">,</span> <span class="s1">&#39;metadata_field_desc.tsv&#39;</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">block_size</span><span class="p">):</span>
                            <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">task1</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;bac120_ssu&#39;</span><span class="p">]:</span>
                <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="n">keys</span><span class="p">],</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
                    <span class="n">total_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content-length&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                    <span class="n">block_size</span> <span class="o">=</span> <span class="mi">1024</span>
                    <span class="k">with</span> <span class="n">Progress</span><span class="p">()</span> <span class="k">as</span> <span class="n">progress</span><span class="p">:</span>
                        <span class="n">task1</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="s2">&quot;Downloading &quot;</span> <span class="o">+</span> <span class="n">keys</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="n">total_size</span><span class="p">)</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon_to_genome_db</span><span class="p">,</span> <span class="n">url</span><span class="p">[</span><span class="n">keys</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">block_size</span><span class="p">):</span>
                                <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">task1</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
                                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon_to_genome_db</span><span class="p">,</span> <span class="n">url</span><span class="p">[</span><span class="n">keys</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_in</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon_to_genome_db</span><span class="p">,</span> <span class="n">url</span><span class="p">[</span><span class="n">keys</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.gz&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)),</span><span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_out</span><span class="p">:</span>
                        <span class="n">f_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f_in</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>


                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon_to_genome_db</span><span class="p">,</span> <span class="n">url</span><span class="p">[</span><span class="n">keys</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Version&#39;</span><span class="p">,</span> <span class="s1">&#39;MD5SUM&#39;</span><span class="p">,</span> <span class="s1">&#39;FILE_DESCRIPTIONS&#39;</span><span class="p">]:</span>
                <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="n">keys</span><span class="p">],</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon_to_genome_db</span><span class="p">,</span> <span class="n">keys</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="s1">&#39;metadata_field_desc&#39;</span><span class="p">],</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon_to_genome_db</span><span class="p">,</span> <span class="s1">&#39;metadata_field_desc.tsv&#39;</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="p">[</span> <span class="s1">&#39;bac120_ssu&#39;</span><span class="p">]:</span>
                <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="n">keys</span><span class="p">],</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon_to_genome_db</span><span class="p">,</span> <span class="n">url</span><span class="p">[</span><span class="n">keys</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
                <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon_to_genome_db</span><span class="p">,</span> <span class="n">url</span><span class="p">[</span><span class="n">keys</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_in</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon_to_genome_db</span><span class="p">,</span> <span class="n">url</span><span class="p">[</span><span class="n">keys</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.gz&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)),</span><span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_out</span><span class="p">:</span>
                        <span class="n">f_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f_in</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;[bold green]Downloaded all the required files for Amplicon to Genome functionality.[/bold green]&quot;</span><span class="p">)</span>




    <span class="k">def</span> <span class="nf">download_all_databases</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbose</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function will download all the required databases for all the functionalities of ADToolbox.</span>
<span class="sd">        NOTE: each method that this function calls is individually tested so it is skipped from testing!</span>

<span class="sd">        Args:</span>
<span class="sd">            verbose (bool, optional): Whether to print the progress or not. Defaults to True.</span>

<span class="sd">        Required Configs:</span>
<span class="sd">            - config.adm_parameters_base_dir</span>
<span class="sd">            - config.adm_parameters_urls</span>
<span class="sd">            - config.seed_rxn_url</span>
<span class="sd">            - config.seed_compound_url</span>
<span class="sd">            - config.reaction_db</span>
<span class="sd">            - config.compound_db</span>
<span class="sd">            - config.protein_db_url</span>
<span class="sd">            - config.protein_db</span>
<span class="sd">            - config.adtoolbox_rxn_db_url</span>
<span class="sd">            - config.csv_reaction_db</span>
<span class="sd">            - config.feed_db_url</span>
<span class="sd">            - config.feed_db</span>
<span class="sd">            - config.amplicon_to_genome_db</span>
<span class="sd">            - config.amplicon_to_genome_urls</span>
<span class="sd">            - config.qiime_classifier_db_url</span>
<span class="sd">            - config.qiime_classifier_db</span>
<span class="sd">            - config.studies_db</span>
<span class="sd">            - config.studies_urls</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import os # doctest: +SKIP</span>
<span class="sd">            &gt;&gt;&gt; db=Database(config=configs.Database()) # doctest: +SKIP</span>
<span class="sd">            &gt;&gt;&gt; db.download_all_databases(verbose=False) # doctest: +SKIP</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">download_seed_databases</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_adm_parameters</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_protein_database</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_reaction_database</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_feed_database</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_studies_database</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_amplicon_to_genome_db</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_qiime_classifier_db</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.add_experiment_to_experiments_db" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_experiment_to_experiments_db</span><span class="p">(</span><span class="n">experiment</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function adds an experiment to the experiments database. It takes an experiment and adds it to the experiments database.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <ul>
<li>config.experimental_data_db</li>
</ul>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>experiment</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="adtoolbox.core.Experiment" href="#adtoolbox.core.Experiment">Experiment</a></code>
          </td>
          <td><p>An instance of the Experiment class.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span><span class="nn">json</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">local_dir</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;experimental_data_db&#39;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="s2">&quot;experiments_test_db.json&quot;</span><span class="p">)}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">local_dir</span><span class="p">[</span><span class="s1">&#39;experimental_data_db&#39;</span><span class="p">]):</span>
<span class="gp">... </span>    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">local_dir</span><span class="p">[</span><span class="s1">&#39;experimental_data_db&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">=</span><span class="n">Database</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">studies_local</span><span class="o">=</span><span class="n">local_dir</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">feed</span><span class="o">=</span><span class="n">Feed</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;test_feed&quot;</span><span class="p">,</span><span class="n">carbohydrates</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">lipids</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">proteins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">tss</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span><span class="n">si</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">xi</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">reference</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;test2_study&quot;</span><span class="p">,</span><span class="n">initial_concentrations</span><span class="o">=</span><span class="p">{},</span> <span class="n">time</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;S_bu&quot;</span><span class="p">,</span><span class="s2">&quot;S_ac&quot;</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]],</span><span class="n">feed</span><span class="o">=</span><span class="n">feed</span><span class="p">,</span><span class="n">reference</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">add_experiment_to_experiments_db</span><span class="p">(</span><span class="n">experiment</span><span class="p">,</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">local_dir</span><span class="p">[</span><span class="s1">&#39;experimental_data_db&#39;</span><span class="p">])</span><span class="o">==</span><span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">local_dir</span><span class="p">[</span><span class="s1">&#39;experimental_data_db&#39;</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">local_dir</span><span class="p">[</span><span class="s1">&#39;experimental_data_db&#39;</span><span class="p">])</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_experiment_to_experiments_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">experiment</span><span class="p">:</span><span class="n">Experiment</span><span class="p">,</span><span class="n">force</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function adds an experiment to the experiments database. It takes an experiment and adds it to the experiments database.</span>

<span class="sd">    Required Configs:</span>
<span class="sd">        - config.experimental_data_db</span>

<span class="sd">    Args:</span>
<span class="sd">        experiment (Experiment): An instance of the Experiment class.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import os,json</span>
<span class="sd">        &gt;&gt;&gt; local_dir={&#39;experimental_data_db&#39;:os.path.join(Main_Dir,&quot;test&quot;,&quot;experiments_test_db.json&quot;)}</span>
<span class="sd">        &gt;&gt;&gt; if os.path.exists(local_dir[&#39;experimental_data_db&#39;]):</span>
<span class="sd">        ...     os.remove(local_dir[&#39;experimental_data_db&#39;])</span>
<span class="sd">        &gt;&gt;&gt; db=Database(config=configs.Database(studies_local=local_dir))</span>
<span class="sd">        &gt;&gt;&gt; feed=Feed(name=&quot;test_feed&quot;,carbohydrates=10,lipids=20,proteins=30,tss=80,si=10,xi=30,reference=&quot;test&quot;)</span>
<span class="sd">        &gt;&gt;&gt; experiment = Experiment(name=&quot;test2_study&quot;,initial_concentrations={}, time=[0, 1, 2], variables=[&quot;S_bu&quot;,&quot;S_ac&quot;], data=[[1, 2, 3], [4, 5, 6]],feed=feed,reference=&quot;test&quot;)</span>
<span class="sd">        &gt;&gt;&gt; db.add_experiment_to_experiments_db(experiment,force=True)</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(local_dir[&#39;experimental_data_db&#39;])==True</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.getsize(local_dir[&#39;experimental_data_db&#39;])&gt;0</span>
<span class="sd">        &gt;&gt;&gt; os.remove(local_dir[&#39;experimental_data_db&#39;])</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;experimental_data_db&quot;</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_experimental_data_db</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_experiment_from_experiments_db</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="n">experiment</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_experiment_from_experiments_db</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="n">exp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Experiment already exists in the database!&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;experimental_data_db&quot;</span><span class="p">],</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">experiments_db</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">experiments_db</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;experimental_data_db&quot;</span><span class="p">],</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">experiments_db</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.add_feed_to_feed_db" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_feed_to_feed_db</span><span class="p">(</span><span class="n">feed</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function adds a feed to the feed database. It takes the feed name and the feed composition and adds them to the feed database.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <ul>
<li>config.feed_db</li>
</ul>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>feed</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="adtoolbox.core.Feed" href="#adtoolbox.core.Feed">Feed</a></code>
          </td>
          <td><p>An instance of the Feed class.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;feed_test_db.tsv&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">=</span><span class="n">Database</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">feed_db</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;feed_test_db.tsv&quot;</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">feed</span><span class="o">=</span><span class="n">Feed</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;test_feed&quot;</span><span class="p">,</span><span class="n">carbohydrates</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">lipids</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">proteins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">tss</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span><span class="n">si</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">xi</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">reference</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">add_feed_to_feed_db</span><span class="p">(</span><span class="n">feed</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;feed_test_db.tsv&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;feed_test_db.tsv&quot;</span><span class="p">),</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;feed_test_db.tsv&quot;</span><span class="p">))</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_feed_to_feed_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">feed</span><span class="p">:</span><span class="n">Feed</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function adds a feed to the feed database. It takes the feed name and the feed composition and adds them to the feed database.</span>

<span class="sd">    Required Configs:</span>
<span class="sd">        - config.feed_db</span>

<span class="sd">    Args:</span>
<span class="sd">        feed (Feed): An instance of the Feed class.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;))==False</span>
<span class="sd">        &gt;&gt;&gt; db=Database(config=configs.Database(feed_db=os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;)))</span>
<span class="sd">        &gt;&gt;&gt; feed=Feed(name=&quot;test_feed&quot;,carbohydrates=10,lipids=20,proteins=30,tss=80,si=10,xi=30,reference=&quot;test&quot;)</span>
<span class="sd">        &gt;&gt;&gt; db.add_feed_to_feed_db(feed)</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;))==True</span>
<span class="sd">        &gt;&gt;&gt; assert pd.read_table(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;),delimiter=&quot;\t&quot;).shape[0]&gt;0</span>
<span class="sd">        &gt;&gt;&gt; os.remove(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;))</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_feed_db</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">feed</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Feed already exists in the database.&quot;</span><span class="p">)</span>
    <span class="n">feed_db</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">feed_db</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">feed_db</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">feed</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()])],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">feed_db</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.add_metagenomics_study_to_metagenomics_studies_db" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_metagenomics_study_to_metagenomics_studies_db</span><span class="p">(</span><span class="n">metagenomics_study</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function adds a metagenomics study to the metagenomics studies database. It takes a metagenomics study and adds it to the metagenomics studies database.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <ul>
<li>config.metagenomics_studies_db</li>
</ul>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>metagenomics_study</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="adtoolbox.core.MetagenomicsStudy" href="#adtoolbox.core.MetagenomicsStudy">MetagenomicsStudy</a></code>
          </td>
          <td><p>An instance of the MetagenomicsStudy class.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">local_dir</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;metagenomics_studies&#39;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="s2">&quot;metagenomics_test_db.tsv&quot;</span><span class="p">)}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">=</span><span class="n">Database</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">studies_local</span><span class="o">=</span><span class="n">local_dir</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metagenomics_study</span><span class="o">=</span><span class="n">MetagenomicsStudy</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;test_study&quot;</span><span class="p">,</span><span class="n">study_type</span><span class="o">=</span><span class="s2">&quot;metagenomics&quot;</span><span class="p">,</span><span class="n">microbiome</span><span class="o">=</span><span class="s2">&quot;anaerobic digester&quot;</span><span class="p">,</span><span class="n">sample_accession</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="n">comments</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="n">study_accession</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">add_metagenomics_study_to_metagenomics_studies_db</span><span class="p">(</span><span class="n">metagenomics_study</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">local_dir</span><span class="p">[</span><span class="s1">&#39;metagenomics_studies&#39;</span><span class="p">])</span><span class="o">==</span><span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">local_dir</span><span class="p">[</span><span class="s1">&#39;metagenomics_studies&#39;</span><span class="p">],</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">local_dir</span><span class="p">[</span><span class="s1">&#39;metagenomics_studies&#39;</span><span class="p">])</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_metagenomics_study_to_metagenomics_studies_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">metagenomics_study</span><span class="p">:</span><span class="n">MetagenomicsStudy</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function adds a metagenomics study to the metagenomics studies database. It takes a metagenomics study and adds it to the metagenomics studies database.</span>

<span class="sd">    Required Configs:</span>
<span class="sd">        - config.metagenomics_studies_db</span>

<span class="sd">    Args:</span>
<span class="sd">        metagenomics_study (MetagenomicsStudy): An instance of the MetagenomicsStudy class.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; local_dir={&#39;metagenomics_studies&#39;:os.path.join(Main_Dir,&quot;test&quot;,&quot;metagenomics_test_db.tsv&quot;)}</span>
<span class="sd">        &gt;&gt;&gt; db=Database(config=configs.Database(studies_local=local_dir))</span>
<span class="sd">        &gt;&gt;&gt; metagenomics_study=MetagenomicsStudy(name=&quot;test_study&quot;,study_type=&quot;metagenomics&quot;,microbiome=&quot;anaerobic digester&quot;,sample_accession=&quot;test&quot;,comments=&quot;test&quot;,study_accession=&quot;test&quot;)</span>
<span class="sd">        &gt;&gt;&gt; db.add_metagenomics_study_to_metagenomics_studies_db(metagenomics_study)</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(local_dir[&#39;metagenomics_studies&#39;])==True</span>
<span class="sd">        &gt;&gt;&gt; assert pd.read_table(local_dir[&#39;metagenomics_studies&#39;],delimiter=&quot;\t&quot;).shape[0]&gt;0</span>
<span class="sd">        &gt;&gt;&gt; os.remove(local_dir[&#39;metagenomics_studies&#39;])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;metagenomics_studies&quot;</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_metagenomics_studies_db</span><span class="p">()</span>
    <span class="n">metagenomics_studies_db</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;metagenomics_studies&quot;</span><span class="p">],</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">metagenomics_studies_db</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">metagenomics_studies_db</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">metagenomics_study</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()])],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">metagenomics_studies_db</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;metagenomics_studies&quot;</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.add_protein_to_protein_db" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_protein_to_protein_db</span><span class="p">(</span><span class="n">protein_id</span><span class="p">,</span> <span class="n">header_tail</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This funciton adds a protein sequence to the protein database. It takes a uniprot id and an EC number it is assigned to 
and adds the corresponding protein sequence to the protein database.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <ul>
<li>config.protein_db</li>
</ul>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>protein_id</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The uniprot id of the protein.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>header_tail</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>A text to append to the header of the entry in the database;</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;protein_test_db.fasta&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">=</span><span class="n">Database</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">protein_db</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;protein_test_db.fasta&quot;</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">add_protein_to_protein_db</span><span class="p">(</span><span class="s2">&quot;P0A9P0&quot;</span><span class="p">,</span><span class="s2">&quot;1.2.3.4&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;protein_test_db.fasta&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;protein_test_db.fasta&quot;</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">utils</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">fasta_to_dict</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;protein_test_db.fasta&quot;</span><span class="p">)))</span><span class="o">&gt;</span><span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;protein_test_db.fasta&quot;</span><span class="p">))</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_protein_to_protein_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">protein_id</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">header_tail</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This funciton adds a protein sequence to the protein database. It takes a uniprot id and an EC number it is assigned to </span>
<span class="sd">    and adds the corresponding protein sequence to the protein database.</span>

<span class="sd">    Required Configs:</span>
<span class="sd">        - config.protein_db</span>

<span class="sd">    Args:</span>
<span class="sd">        protein_id (str): The uniprot id of the protein.</span>
<span class="sd">        header_tail (str): A text to append to the header of the entry in the database;</span>
<span class="sd">        In ADToolbox it is better to use ec number for compatibility with downstream functions.</span>


<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))==False</span>
<span class="sd">        &gt;&gt;&gt; db=Database(config=configs.Database(protein_db=os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;)))</span>
<span class="sd">        &gt;&gt;&gt; db.add_protein_to_protein_db(&quot;P0A9P0&quot;,&quot;1.2.3.4&quot;)</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))==True</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.getsize(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))&gt;0</span>
<span class="sd">        &gt;&gt;&gt; import utils</span>
<span class="sd">        &gt;&gt;&gt; assert len(utils.fasta_to_dict(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;)))&gt;0</span>
<span class="sd">        &gt;&gt;&gt; os.remove(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_protein_db</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="p">,</span><span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="o">+</span><span class="n">protein_id</span><span class="o">+</span><span class="s2">&quot;|&quot;</span><span class="o">+</span><span class="n">header_tail</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_protein_seqs_from_uniprot</span><span class="p">(</span><span class="n">protein_id</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.add_proteins_from_ecnumbers_to_protein_db" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_proteins_from_ecnumbers_to_protein_db</span><span class="p">(</span><span class="n">ec_numbers</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function adds protein sequences to the protein database from a list of EC numbers.
It takes a list of EC numbers and finds the protein sequences for each EC number in the list.
Then it saves the protein sequences in a fasta file.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <ul>
<li>config.protein_db</li>
</ul>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>ec_numbers</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>A list of EC numbers.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;protein_test_db.fasta&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">=</span><span class="n">Database</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">protein_db</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;protein_test_db.fasta&quot;</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">add_proteins_from_ecnumbers_to_protein_db</span><span class="p">([</span><span class="s2">&quot;1.1.1.1&quot;</span><span class="p">,</span><span class="s2">&quot;1.1.1.2&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;protein_test_db.fasta&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">utils</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">fasta_to_dict</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;protein_test_db.fasta&quot;</span><span class="p">)))</span><span class="o">&gt;</span><span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;protein_test_db.fasta&quot;</span><span class="p">))</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_proteins_from_ecnumbers_to_protein_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ec_numbers</span><span class="p">:</span><span class="nb">list</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function adds protein sequences to the protein database from a list of EC numbers.</span>
<span class="sd">    It takes a list of EC numbers and finds the protein sequences for each EC number in the list.</span>
<span class="sd">    Then it saves the protein sequences in a fasta file.</span>

<span class="sd">    Required Configs:</span>
<span class="sd">        - config.protein_db</span>

<span class="sd">    Args:</span>
<span class="sd">        ec_numbers (list): A list of EC numbers.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))==False</span>
<span class="sd">        &gt;&gt;&gt; db=Database(config=configs.Database(protein_db=os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;)))</span>
<span class="sd">        &gt;&gt;&gt; db.add_proteins_from_ecnumbers_to_protein_db([&quot;1.1.1.1&quot;,&quot;1.1.1.2&quot;])</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))==True</span>
<span class="sd">        &gt;&gt;&gt; import utils</span>
<span class="sd">        &gt;&gt;&gt; assert len(utils.fasta_to_dict(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;)))&gt;0</span>
<span class="sd">        &gt;&gt;&gt; os.remove(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_protein_db</span><span class="p">()</span>

    <span class="n">protein_seqs</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">ec</span> <span class="ow">in</span> <span class="n">ec_numbers</span><span class="p">:</span>
        <span class="n">protein_seqs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proteins_from_ec</span><span class="p">(</span><span class="n">ec</span><span class="p">))</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="p">,</span><span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">protein_seqs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">value</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.build_mmseqs_database" class="doc doc-heading">
<code class="highlight language-python"><span class="n">build_mmseqs_database</span><span class="p">(</span><span class="n">container</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Builds an indexed mmseqs database from the ADToolbox's fasta protein database.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <ul>
<li>config.protein_db</li>
<li>config.adtoolbox_singularity</li>
<li>config.adtoolbox_docker</li>
</ul>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>container</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The container to run the script with. Defaults to "None".</p></td>
          <td>
                <code>&#39;None&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>The script to build the mmseqs database.</p></td>
        </tr>
        <tr>
<td></td>          <td>
                <code>str</code>
          </td>
          <td></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;protein_test_db.fasta&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">=</span><span class="n">Database</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">protein_db</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;protein_test_db.fasta&quot;</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">add_protein_to_protein_db</span><span class="p">(</span><span class="s2">&quot;P0A9P0&quot;</span><span class="p">,</span><span class="s2">&quot;x,x,x,x&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;protein_test_db.fasta&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;protein_test_db.fasta&quot;</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">script</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">build_mmseqs_database</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">script</span><span class="o">==</span><span class="s2">&quot;mmseqs createdb &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;protein_test_db.fasta&quot;</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db_mmseqs</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;protein_test_db.fasta&quot;</span><span class="p">))</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">build_mmseqs_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">container</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Builds an indexed mmseqs database from the ADToolbox&#39;s fasta protein database.</span>

<span class="sd">    Required Configs:</span>
<span class="sd">        - config.protein_db</span>
<span class="sd">        - config.adtoolbox_singularity</span>
<span class="sd">        - config.adtoolbox_docker</span>

<span class="sd">    Args:</span>
<span class="sd">        container (str, optional): The container to run the script with. Defaults to &quot;None&quot;.</span>
<span class="sd">    Returns:</span>
<span class="sd">        str: The script to build the mmseqs database.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))==False</span>
<span class="sd">        &gt;&gt;&gt; db=Database(config=configs.Database(protein_db=os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;)))</span>
<span class="sd">        &gt;&gt;&gt; db.add_protein_to_protein_db(&quot;P0A9P0&quot;,&quot;x,x,x,x&quot;)</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))==True</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.getsize(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))&gt;0</span>
<span class="sd">        &gt;&gt;&gt; script=db.build_mmseqs_database()</span>
<span class="sd">        &gt;&gt;&gt; assert script==&quot;mmseqs createdb &quot;+str(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))+&quot; &quot;+str(db.config.protein_db_mmseqs)</span>
<span class="sd">        &gt;&gt;&gt; os.remove(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">script</span><span class="o">=</span><span class="n">create_mmseqs_database</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db_mmseqs</span><span class="p">,</span>
                                  <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
                                  <span class="n">run</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                  <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">script</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.build_protein_db_from_reactions_db" class="doc doc-heading">
<code class="highlight language-python"><span class="n">build_protein_db_from_reactions_db</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function builds the protein database from the reaction database.
It takes the reaction database and finds the protein sequences for each EC number in the reaction database.
Then it saves the protein sequences in a fasta file.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <h4 id="adtoolbox.core.Database.build_protein_db_from_reactions_db---configreaction_db">- config.reaction_db</h4>
<h4 id="adtoolbox.core.Database.build_protein_db_from_reactions_db---configprotein_db">- config.protein_db</h4>
</details>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;protein_test_db.fasta&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;reaction_test_db.tsv&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">=</span><span class="n">Database</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">protein_db</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;protein_test_db.fasta&quot;</span><span class="p">),</span><span class="n">reaction_db</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;reaction_test_db.tsv&quot;</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reaction_db</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;EC_Numbers&quot;</span><span class="p">,</span><span class="s2">&quot;Seed Ids&quot;</span><span class="p">,</span><span class="s2">&quot;Reaction Names&quot;</span><span class="p">,</span><span class="s2">&quot;ADM1_Reaction&quot;</span><span class="p">,</span><span class="s2">&quot;e_adm_Reactions&quot;</span><span class="p">,</span><span class="s2">&quot;Pathways&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reaction_db</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;EC_Numbers&quot;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;1.1.1.1&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reaction_db</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;reaction_test_db.tsv&quot;</span><span class="p">),</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">build_protein_db_from_reactions_db</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;protein_test_db.fasta&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;reaction_test_db.tsv&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;protein_test_db.fasta&quot;</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;protein_test_db.fasta&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;reaction_test_db.tsv&quot;</span><span class="p">))</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">build_protein_db_from_reactions_db</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function builds the protein database from the reaction database.</span>
<span class="sd">    It takes the reaction database and finds the protein sequences for each EC number in the reaction database.</span>
<span class="sd">    Then it saves the protein sequences in a fasta file.</span>

<span class="sd">    Required Configs:</span>
<span class="sd">        - config.reaction_db</span>
<span class="sd">        --------</span>
<span class="sd">        - config.protein_db</span>
<span class="sd">        --------</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))==False</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;reaction_test_db.tsv&quot;))==False</span>
<span class="sd">        &gt;&gt;&gt; db=Database(config=configs.Database(protein_db=os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;),reaction_db=os.path.join(Main_Dir,&quot;reaction_test_db.tsv&quot;)))</span>
<span class="sd">        &gt;&gt;&gt; reaction_db=pd.DataFrame(columns=[&quot;EC_Numbers&quot;,&quot;Seed Ids&quot;,&quot;Reaction Names&quot;,&quot;ADM1_Reaction&quot;,&quot;e_adm_Reactions&quot;,&quot;Pathways&quot;])</span>
<span class="sd">        &gt;&gt;&gt; reaction_db.loc[0,&quot;EC_Numbers&quot;]=&quot;1.1.1.1&quot;</span>
<span class="sd">        &gt;&gt;&gt; reaction_db.to_csv(os.path.join(Main_Dir,&quot;reaction_test_db.tsv&quot;),index=False,sep=&quot;\t&quot;)</span>
<span class="sd">        &gt;&gt;&gt; db.build_protein_db_from_reactions_db()</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))==True</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;reaction_test_db.tsv&quot;))==True</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.getsize(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))&gt;0</span>
<span class="sd">        &gt;&gt;&gt; os.remove(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))</span>
<span class="sd">        &gt;&gt;&gt; os.remove(os.path.join(Main_Dir,&quot;reaction_test_db.tsv&quot;))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rxn_db</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reaction_db</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">ec_numbers</span><span class="o">=</span><span class="n">rxn_db</span><span class="p">[</span><span class="s2">&quot;EC_Numbers&quot;</span><span class="p">]</span>
    <span class="n">ec_numbers</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ec_numbers</span><span class="p">))</span>
    <span class="n">protein_seqs</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">ec</span> <span class="ow">in</span> <span class="n">ec_numbers</span><span class="p">:</span>
        <span class="n">protein_seqs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proteins_from_ec</span><span class="p">(</span><span class="n">ec</span><span class="p">))</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">protein_seqs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">value</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.download_adm_parameters" class="doc doc-heading">
<code class="highlight language-python"><span class="n">download_adm_parameters</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Downloads the parameters needed for running ADM models in ADToolbox.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <ul>
<li>config.adm_parameters_base_dir</li>
<li>config.adm_parameters_urls</li>
</ul>
</details>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;adm_parameters_test&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">E_ADM_LOCAL</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="s2">&quot;ADM_Parameters&quot;</span><span class="p">,</span><span class="s2">&quot;e_adm_model_parameters.json&quot;</span><span class="p">),</span>          <span class="s2">&quot;base_parameters&quot;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="s2">&quot;ADM_Parameters&quot;</span><span class="p">,</span><span class="s2">&quot;e_adm_base_parameters.json&quot;</span><span class="p">),</span>         <span class="s2">&quot;initial_conditions&quot;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="s2">&quot;ADM_Parameters&quot;</span><span class="p">,</span><span class="s2">&quot;e_adm_initial_conditions.json&quot;</span><span class="p">),</span>           <span class="s2">&quot;inlet_conditions&quot;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="s2">&quot;ADM_Parameters&quot;</span><span class="p">,</span><span class="s2">&quot;e_adm_inlet_conditions.json&quot;</span><span class="p">),</span>               <span class="s2">&quot;reactions&quot;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="s2">&quot;ADM_Parameters&quot;</span><span class="p">,</span><span class="s2">&quot;e_adm_reactions.json&quot;</span><span class="p">),</span>             <span class="s2">&quot;species&quot;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="s2">&quot;ADM_Parameters&quot;</span><span class="p">,</span><span class="s2">&quot;e_adm_species.json&quot;</span><span class="p">)}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">=</span><span class="n">Database</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">adm_parameters</span><span class="o">=</span><span class="n">E_ADM_LOCAL</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">download_adm_parameters</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;test&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;test&quot;</span><span class="p">)))</span><span class="o">&gt;</span><span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;rm -r &quot;</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;test&quot;</span><span class="p">))</span>
<span class="go">0</span>
</code></pre></div>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>verbose</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to print the progress or not. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span></pre></div></td><td class="code"><div><pre><span></span><code>    <span class="k">def</span> <span class="nf">download_adm_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbose</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Downloads the parameters needed for running ADM models in ADToolbox.</span>

<span class="sd">        Required Configs:</span>
<span class="sd">            - config.adm_parameters_base_dir</span>
<span class="sd">            - config.adm_parameters_urls</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import os</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;adm_parameters_test&quot;))==False</span>
<span class="sd">            &gt;&gt;&gt; E_ADM_LOCAL={&quot;model_parameters&quot;:os.path.join(Main_Dir, &quot;test&quot;,&quot;ADM_Parameters&quot;,&quot;e_adm_model_parameters.json&quot;),\</span>
<span class="sd">	        &quot;base_parameters&quot;:os.path.join(Main_Dir, &quot;test&quot;,&quot;ADM_Parameters&quot;,&quot;e_adm_base_parameters.json&quot;),\</span>
<span class="sd">	        &quot;initial_conditions&quot;:os.path.join(Main_Dir, &quot;test&quot;,&quot;ADM_Parameters&quot;,&quot;e_adm_initial_conditions.json&quot;),\</span>
<span class="sd">	        &quot;inlet_conditions&quot;:os.path.join(Main_Dir, &quot;test&quot;,&quot;ADM_Parameters&quot;,&quot;e_adm_inlet_conditions.json&quot;),\</span>
<span class="sd">	        &quot;reactions&quot;:os.path.join(Main_Dir, &quot;test&quot;,&quot;ADM_Parameters&quot;,&quot;e_adm_reactions.json&quot;),\</span>
<span class="sd">	        &quot;species&quot;:os.path.join(Main_Dir, &quot;test&quot;,&quot;ADM_Parameters&quot;,&quot;e_adm_species.json&quot;)}</span>
<span class="sd">            &gt;&gt;&gt; db=Database(config=configs.Database(adm_parameters=E_ADM_LOCAL))</span>
<span class="sd">            &gt;&gt;&gt; db.download_adm_parameters(verbose=False) </span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;test&quot;))==True</span>
<span class="sd">            &gt;&gt;&gt; assert len(os.listdir(os.path.join(Main_Dir,&quot;test&quot;)))&gt;0</span>
<span class="sd">            &gt;&gt;&gt; os.system(&quot;rm -r &quot;+os.path.join(Main_Dir,&quot;test&quot;))</span>
<span class="sd">            0</span>

<span class="sd">        Args:</span>

<span class="sd">            verbose (bool, optional): Whether to print the progress or not. Defaults to True.</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adm_parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adm_parameters</span><span class="p">[</span><span class="n">param</span><span class="p">])</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adm_parameters</span><span class="p">[</span><span class="n">param</span><span class="p">])</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adm_parameters_urls</span><span class="p">[</span><span class="n">param</span><span class="p">],</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adm_parameters</span><span class="p">[</span><span class="n">param</span><span class="p">],</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[green]</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> downloaded to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adm_parameters</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.download_all_databases" class="doc doc-heading">
<code class="highlight language-python"><span class="n">download_all_databases</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function will download all the required databases for all the functionalities of ADToolbox.
NOTE: each method that this function calls is individually tested so it is skipped from testing!</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>verbose</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to print the progress or not. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

<details class="required-configs">
  <summary>Required Configs</summary>
  <ul>
<li>config.adm_parameters_base_dir</li>
<li>config.adm_parameters_urls</li>
<li>config.seed_rxn_url</li>
<li>config.seed_compound_url</li>
<li>config.reaction_db</li>
<li>config.compound_db</li>
<li>config.protein_db_url</li>
<li>config.protein_db</li>
<li>config.adtoolbox_rxn_db_url</li>
<li>config.csv_reaction_db</li>
<li>config.feed_db_url</li>
<li>config.feed_db</li>
<li>config.amplicon_to_genome_db</li>
<li>config.amplicon_to_genome_urls</li>
<li>config.qiime_classifier_db_url</li>
<li>config.qiime_classifier_db</li>
<li>config.studies_db</li>
<li>config.studies_urls</li>
</ul>
</details>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">=</span><span class="n">Database</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">download_all_databases</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_all_databases</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbose</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function will download all the required databases for all the functionalities of ADToolbox.</span>
<span class="sd">    NOTE: each method that this function calls is individually tested so it is skipped from testing!</span>

<span class="sd">    Args:</span>
<span class="sd">        verbose (bool, optional): Whether to print the progress or not. Defaults to True.</span>

<span class="sd">    Required Configs:</span>
<span class="sd">        - config.adm_parameters_base_dir</span>
<span class="sd">        - config.adm_parameters_urls</span>
<span class="sd">        - config.seed_rxn_url</span>
<span class="sd">        - config.seed_compound_url</span>
<span class="sd">        - config.reaction_db</span>
<span class="sd">        - config.compound_db</span>
<span class="sd">        - config.protein_db_url</span>
<span class="sd">        - config.protein_db</span>
<span class="sd">        - config.adtoolbox_rxn_db_url</span>
<span class="sd">        - config.csv_reaction_db</span>
<span class="sd">        - config.feed_db_url</span>
<span class="sd">        - config.feed_db</span>
<span class="sd">        - config.amplicon_to_genome_db</span>
<span class="sd">        - config.amplicon_to_genome_urls</span>
<span class="sd">        - config.qiime_classifier_db_url</span>
<span class="sd">        - config.qiime_classifier_db</span>
<span class="sd">        - config.studies_db</span>
<span class="sd">        - config.studies_urls</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import os # doctest: +SKIP</span>
<span class="sd">        &gt;&gt;&gt; db=Database(config=configs.Database()) # doctest: +SKIP</span>
<span class="sd">        &gt;&gt;&gt; db.download_all_databases(verbose=False) # doctest: +SKIP</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">download_seed_databases</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">download_adm_parameters</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">download_protein_database</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">download_reaction_database</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">download_feed_database</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">download_studies_database</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">download_amplicon_to_genome_db</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">download_qiime_classifier_db</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.download_amplicon_to_genome_db" class="doc doc-heading">
<code class="highlight language-python"><span class="n">download_amplicon_to_genome_db</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function will automatically download the GTDB-tk database for genome assignment.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <ul>
<li>config.amplicon_to_genome_db</li>
<li>config.amplicon_to_genome_urls</li>
</ul>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>verbose</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to print the progress or not. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;amplicon_to_genome_test_db&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">=</span><span class="n">Database</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">amplicon_to_genome_db</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;amplicon_to_genome_test_db&quot;</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">download_amplicon_to_genome_db</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;amplicon_to_genome_test_db&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;amplicon_to_genome_test_db&quot;</span><span class="p">)))</span><span class="o">&gt;</span><span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;rm -r &quot;</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;amplicon_to_genome_test_db&quot;</span><span class="p">))</span>
<span class="go">0</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_amplicon_to_genome_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbose</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function will automatically download the GTDB-tk database for genome assignment.</span>

<span class="sd">    Required Configs:</span>
<span class="sd">        - config.amplicon_to_genome_db</span>
<span class="sd">        - config.amplicon_to_genome_urls</span>

<span class="sd">    Args:</span>
<span class="sd">        verbose (bool, optional): Whether to print the progress or not. Defaults to True.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;amplicon_to_genome_test_db&quot;))==False</span>
<span class="sd">        &gt;&gt;&gt; db=Database(config=configs.Database(amplicon_to_genome_db=os.path.join(Main_Dir,&quot;amplicon_to_genome_test_db&quot;)))</span>
<span class="sd">        &gt;&gt;&gt; db.download_amplicon_to_genome_db(verbose=False)</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;amplicon_to_genome_test_db&quot;))==True</span>
<span class="sd">        &gt;&gt;&gt; assert len(os.listdir(os.path.join(Main_Dir,&quot;amplicon_to_genome_test_db&quot;)))&gt;0</span>
<span class="sd">        &gt;&gt;&gt; os.system(&quot;rm -r &quot;+os.path.join(Main_Dir,&quot;amplicon_to_genome_test_db&quot;))</span>
<span class="sd">        0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon_to_genome_db</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon_to_genome_db</span><span class="p">)</span>

    <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon_to_genome_urls</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Version&#39;</span><span class="p">,</span> <span class="s1">&#39;MD5SUM&#39;</span><span class="p">,</span> <span class="s1">&#39;FILE_DESCRIPTIONS&#39;</span><span class="p">]:</span>
            <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="n">keys</span><span class="p">],</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
                <span class="n">total_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content-length&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                <span class="n">block_size</span> <span class="o">=</span> <span class="mi">1024</span>
                <span class="k">with</span> <span class="n">Progress</span><span class="p">()</span> <span class="k">as</span> <span class="n">progress</span><span class="p">:</span>
                    <span class="n">task1</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="s2">&quot;Downloading &quot;</span> <span class="o">+</span> <span class="n">keys</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="n">total_size</span><span class="p">)</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon_to_genome_db</span><span class="p">,</span> <span class="n">keys</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">block_size</span><span class="p">):</span>
                            <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">task1</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="s1">&#39;metadata_field_desc&#39;</span><span class="p">],</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
            <span class="n">total_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content-length&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">block_size</span> <span class="o">=</span> <span class="mi">1024</span>
            <span class="k">with</span> <span class="n">Progress</span><span class="p">()</span> <span class="k">as</span> <span class="n">progress</span><span class="p">:</span>
                <span class="n">task1</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="s2">&quot;Downloading metadata_field_desc.tsv&quot;</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="n">total_size</span><span class="p">)</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon_to_genome_db</span><span class="p">,</span> <span class="s1">&#39;metadata_field_desc.tsv&#39;</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">block_size</span><span class="p">):</span>
                        <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">task1</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;bac120_ssu&#39;</span><span class="p">]:</span>
            <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="n">keys</span><span class="p">],</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
                <span class="n">total_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content-length&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                <span class="n">block_size</span> <span class="o">=</span> <span class="mi">1024</span>
                <span class="k">with</span> <span class="n">Progress</span><span class="p">()</span> <span class="k">as</span> <span class="n">progress</span><span class="p">:</span>
                    <span class="n">task1</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="s2">&quot;Downloading &quot;</span> <span class="o">+</span> <span class="n">keys</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="n">total_size</span><span class="p">)</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon_to_genome_db</span><span class="p">,</span> <span class="n">url</span><span class="p">[</span><span class="n">keys</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">block_size</span><span class="p">):</span>
                            <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">task1</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon_to_genome_db</span><span class="p">,</span> <span class="n">url</span><span class="p">[</span><span class="n">keys</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_in</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon_to_genome_db</span><span class="p">,</span> <span class="n">url</span><span class="p">[</span><span class="n">keys</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.gz&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)),</span><span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_out</span><span class="p">:</span>
                    <span class="n">f_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f_in</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>


            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon_to_genome_db</span><span class="p">,</span> <span class="n">url</span><span class="p">[</span><span class="n">keys</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Version&#39;</span><span class="p">,</span> <span class="s1">&#39;MD5SUM&#39;</span><span class="p">,</span> <span class="s1">&#39;FILE_DESCRIPTIONS&#39;</span><span class="p">]:</span>
            <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="n">keys</span><span class="p">],</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon_to_genome_db</span><span class="p">,</span> <span class="n">keys</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="s1">&#39;metadata_field_desc&#39;</span><span class="p">],</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon_to_genome_db</span><span class="p">,</span> <span class="s1">&#39;metadata_field_desc.tsv&#39;</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="p">[</span> <span class="s1">&#39;bac120_ssu&#39;</span><span class="p">]:</span>
            <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="n">keys</span><span class="p">],</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon_to_genome_db</span><span class="p">,</span> <span class="n">url</span><span class="p">[</span><span class="n">keys</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon_to_genome_db</span><span class="p">,</span> <span class="n">url</span><span class="p">[</span><span class="n">keys</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_in</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon_to_genome_db</span><span class="p">,</span> <span class="n">url</span><span class="p">[</span><span class="n">keys</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.gz&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)),</span><span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_out</span><span class="p">:</span>
                    <span class="n">f_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f_in</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;[bold green]Downloaded all the required files for Amplicon to Genome functionality.[/bold green]&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.download_feed_database" class="doc doc-heading">
<code class="highlight language-python"><span class="n">download_feed_database</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function will download the feed database from the remote repository.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <ul>
<li>config.feed_db_url</li>
<li>config.feed_db</li>
</ul>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>verbose</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to print the progress or not. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;feed_test_db.tsv&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">=</span><span class="n">Database</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">feed_db</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;feed_test_db.tsv&quot;</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">download_feed_database</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;feed_test_db.tsv&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;feed_test_db.tsv&quot;</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;feed_test_db.tsv&quot;</span><span class="p">))</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_feed_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbose</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function will download the feed database from the remote repository.</span>

<span class="sd">    Required Configs:</span>
<span class="sd">        - config.feed_db_url</span>
<span class="sd">        - config.feed_db</span>

<span class="sd">    Args:</span>
<span class="sd">        verbose (bool, optional): Whether to print the progress or not. Defaults to True.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;))==False</span>
<span class="sd">        &gt;&gt;&gt; db=Database(config=configs.Database(feed_db=os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;)))</span>
<span class="sd">        &gt;&gt;&gt; db.download_feed_database(verbose=False)</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;))==True</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.getsize(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;))&gt;0</span>
<span class="sd">        &gt;&gt;&gt; os.remove(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db_url</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[green]Feed database downloaded to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.download_protein_database" class="doc doc-heading">
<code class="highlight language-python"><span class="n">download_protein_database</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Downloads the prebuilt protein database from the remote repository.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <ul>
<li>config.protein_db_url</li>
<li>config.protein_db</li>
</ul>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>verbose</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to print the progress or not. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;protein_test_db.fasta&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">=</span><span class="n">Database</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">protein_db</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;protein_test_db.fasta&quot;</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">download_protein_database</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;protein_test_db.fasta&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;protein_test_db.fasta&quot;</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;protein_test_db.fasta&quot;</span><span class="p">))</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_protein_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Downloads the prebuilt protein database from the remote repository.</span>

<span class="sd">    Required Configs:</span>
<span class="sd">        - config.protein_db_url</span>
<span class="sd">        - config.protein_db</span>

<span class="sd">    Args:</span>
<span class="sd">        verbose (bool, optional): Whether to print the progress or not. Defaults to True.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))==False</span>
<span class="sd">        &gt;&gt;&gt; db=Database(config=configs.Database(protein_db=os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;)))</span>
<span class="sd">        &gt;&gt;&gt; db.download_protein_database(verbose=False)</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))==True</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.getsize(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))&gt;0</span>
<span class="sd">        &gt;&gt;&gt; os.remove(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db_url</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[green]Protein database downloaded to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.download_reaction_database" class="doc doc-heading">
<code class="highlight language-python"><span class="n">download_reaction_database</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function will download the reaction database from the remote repository.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <ul>
<li>config.adtoolbox_rxn_db_url</li>
<li>config.csv_reaction_db</li>
</ul>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>verbose</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to print the progress or not. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;reaction_test_db.csv&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">=</span><span class="n">Database</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">csv_reaction_db</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;reaction_test_db.csv&quot;</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">download_reaction_database</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;reaction_test_db.csv&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;reaction_test_db.csv&quot;</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;reaction_test_db.csv&quot;</span><span class="p">))</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_reaction_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbose</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function will download the reaction database from the remote repository.</span>

<span class="sd">    Required Configs:</span>
<span class="sd">        - config.adtoolbox_rxn_db_url</span>
<span class="sd">        - config.csv_reaction_db</span>

<span class="sd">    Args:</span>
<span class="sd">        verbose (bool, optional): Whether to print the progress or not. Defaults to True.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;reaction_test_db.csv&quot;))==False</span>
<span class="sd">        &gt;&gt;&gt; db=Database(config=configs.Database(csv_reaction_db=os.path.join(Main_Dir,&quot;reaction_test_db.csv&quot;)))</span>
<span class="sd">        &gt;&gt;&gt; db.download_reaction_database(verbose=False)</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;reaction_test_db.csv&quot;))==True</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.getsize(os.path.join(Main_Dir,&quot;reaction_test_db.csv&quot;))&gt;0</span>
<span class="sd">        &gt;&gt;&gt; os.remove(os.path.join(Main_Dir,&quot;reaction_test_db.csv&quot;))</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adtoolbox_rxn_db_url</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">csv_reaction_db</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">csv_reaction_db</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">csv_reaction_db</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[green]Reaction database downloaded to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">csv_reaction_db</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.download_seed_databases" class="doc doc-heading">
<code class="highlight language-python"><span class="n">download_seed_databases</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function will download the seed databases, both compound and reaction databases.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <ul>
<li>config.seed_rxn_url</li>
<li>config.seed_compound_url</li>
<li>config.reaction_db</li>
<li>config.compound_db</li>
</ul>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>verbose</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to print the progress or not. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;seed_compound.json&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">=</span><span class="n">Database</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">reaction_db</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;seed_rxn.json&quot;</span><span class="p">),</span><span class="n">compound_db</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;seed_compound.json&quot;</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">download_seed_databases</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;seed_rxn.json&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;seed_compound.json&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;seed_rxn.json&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;seed_compound.json&quot;</span><span class="p">))</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_seed_databases</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbose</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;This function will download the seed databases, both compound and reaction databases.</span>

<span class="sd">    Required Configs:</span>
<span class="sd">        - config.seed_rxn_url</span>
<span class="sd">        - config.seed_compound_url</span>
<span class="sd">        - config.reaction_db</span>
<span class="sd">        - config.compound_db</span>

<span class="sd">    Args:</span>
<span class="sd">        verbose (bool, optional): Whether to print the progress or not. Defaults to True.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;seed_compound.json&quot;))==False</span>
<span class="sd">        &gt;&gt;&gt; db=Database(config=configs.Database(reaction_db=os.path.join(Main_Dir,&quot;seed_rxn.json&quot;),compound_db=os.path.join(Main_Dir,&quot;seed_compound.json&quot;)))</span>
<span class="sd">        &gt;&gt;&gt; db.download_seed_databases(verbose=False)</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;seed_rxn.json&quot;))==True</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;seed_compound.json&quot;))==True</span>
<span class="sd">        &gt;&gt;&gt; os.remove(os.path.join(Main_Dir,&quot;seed_rxn.json&quot;))</span>
<span class="sd">        &gt;&gt;&gt; os.remove(os.path.join(Main_Dir,&quot;seed_compound.json&quot;))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">seed_rxn_url</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reaction_db</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reaction_db</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reaction_db</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[green]Reaction database downloaded to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reaction_db</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">r</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">seed_compound_url</span><span class="p">,</span><span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">compound_db</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[green]Compound database downloaded to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">compound_db</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.download_studies_database" class="doc doc-heading">
<code class="highlight language-python"><span class="n">download_studies_database</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function will download the required files for studies functionality.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>verbode</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to print the progress or not. Defaults to True.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;studies_test_db.tsv&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">STUDIES_LOCAL</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;metagenomics_studies&quot;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;Database&quot;</span><span class="p">,</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="s2">&quot;Studies&quot;</span><span class="p">,</span><span class="s2">&quot;metagenomics_studies.tsv&quot;</span><span class="p">),</span>                                <span class="s2">&quot;experimental_data_db&quot;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;Database&quot;</span><span class="p">,</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="s2">&quot;Studies&quot;</span><span class="p">,</span><span class="s2">&quot;experimental_data_references.json&quot;</span><span class="p">)}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">=</span><span class="n">Database</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">studies_local</span><span class="o">=</span><span class="n">STUDIES_LOCAL</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">download_studies_database</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">STUDIES_LOCAL</span><span class="p">[</span><span class="s1">&#39;metagenomics_studies&#39;</span><span class="p">])</span><span class="o">==</span><span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">STUDIES_LOCAL</span><span class="p">[</span><span class="s1">&#39;metagenomics_studies&#39;</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">STUDIES_LOCAL</span><span class="p">[</span><span class="s1">&#39;metagenomics_studies&#39;</span><span class="p">])</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span></pre></div></td><td class="code"><div><pre><span></span><code>    <span class="k">def</span> <span class="nf">download_studies_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbose</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function will download the required files for studies functionality.</span>

<span class="sd">        Args:</span>
<span class="sd">            verbode (bool, optional): Whether to print the progress or not. Defaults to True.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import os</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;studies_test_db.tsv&quot;))==False</span>
<span class="sd">            &gt;&gt;&gt; STUDIES_LOCAL={&quot;metagenomics_studies&quot;:os.path.join(Main_Dir,&quot;Database&quot;,&quot;test&quot;,&quot;Studies&quot;,&quot;metagenomics_studies.tsv&quot;),\</span>
<span class="sd">	                            &quot;experimental_data_db&quot;:os.path.join(Main_Dir,&quot;Database&quot;,&quot;test&quot;,&quot;Studies&quot;,&quot;experimental_data_references.json&quot;)}</span>
<span class="sd">            &gt;&gt;&gt; db=Database(config=configs.Database(studies_local=STUDIES_LOCAL))</span>
<span class="sd">            &gt;&gt;&gt; db.download_studies_database(verbose=False)</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.exists(STUDIES_LOCAL[&#39;metagenomics_studies&#39;])==True</span>
<span class="sd">            &gt;&gt;&gt; assert os.path.getsize(STUDIES_LOCAL[&#39;metagenomics_studies&#39;])&gt;0</span>
<span class="sd">            &gt;&gt;&gt; os.remove(STUDIES_LOCAL[&#39;metagenomics_studies&#39;])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;metagenomics_studies&quot;</span><span class="p">,</span><span class="s2">&quot;experimental_data_db&quot;</span><span class="p">]:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_remote</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">parent</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[bold green]Downloaded </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_remote</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">[/bold green]&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.filter_seed_from_ec" class="doc doc-heading">
<code class="highlight language-python"><span class="n">filter_seed_from_ec</span><span class="p">(</span><span class="n">ec_list</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function takes a list of EC numbers and filters the seed database to find the seed reactions that have the EC numbers in their EC number list.
This will help to trim the large seed database to a smaller one that only contains the reactions that are relevant to the AD process.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>ec_list</code></td>
          <td>
                <code>list[str]</code>
          </td>
          <td><p>A list of EC numbers.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>save</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to save the filtered seed database or not. Defaults to False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>tuple</code></td>          <td>
                <code>tuple</code>
          </td>
          <td><p>A tuple containing the filtered seed reaction database and the seed compound database, respectively.</p></td>
        </tr>
    </tbody>
  </table>

<details class="required-configs">
  <summary>Required Configs</summary>
  <h4 id="adtoolbox.core.Database.filter_seed_from_ec---configreaction_db">- config.reaction_db</h4>
<h4 id="adtoolbox.core.Database.filter_seed_from_ec---configcompound_db">- config.compound_db</h4>
<h4 id="adtoolbox.core.Database.filter_seed_from_ec---configlocal_reaction_db">- config.local_reaction_db</h4>
<h4 id="adtoolbox.core.Database.filter_seed_from_ec---configlocal_compound_db">- config.local_compound_db</h4>
</details>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">=</span><span class="n">Database</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">seed_rxn_db</span><span class="p">,</span><span class="n">seed_compound_db</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">filter_seed_from_ec</span><span class="p">([</span><span class="s2">&quot;1.1.1.1&quot;</span><span class="p">,</span><span class="s2">&quot;1.1.1.2&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">seed_rxn_db</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">seed_compound_db</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">()</span><span class="o">.</span><span class="n">reaction_db</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">seed_rxn_db</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filter_seed_from_ec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                        <span class="n">ec_list</span><span class="p">:</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                        <span class="n">save</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function takes a list of EC numbers and filters the seed database to find the seed reactions that have the EC numbers in their EC number list.</span>
<span class="sd">    This will help to trim the large seed database to a smaller one that only contains the reactions that are relevant to the AD process.</span>

<span class="sd">    Args:</span>
<span class="sd">        ec_list (list[str]): A list of EC numbers.</span>
<span class="sd">        save (bool, optional): Whether to save the filtered seed database or not. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing the filtered seed reaction database and the seed compound database, respectively.</span>

<span class="sd">    Required Configs:</span>

<span class="sd">        - config.reaction_db</span>
<span class="sd">        --------</span>
<span class="sd">        - config.compound_db</span>
<span class="sd">        --------</span>
<span class="sd">        - config.local_reaction_db</span>
<span class="sd">        --------</span>
<span class="sd">        - config.local_compound_db</span>
<span class="sd">        --------</span>


<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; db=Database()</span>
<span class="sd">        &gt;&gt;&gt; seed_rxn_db,seed_compound_db=db.filter_seed_from_ec([&quot;1.1.1.1&quot;,&quot;1.1.1.2&quot;])</span>
<span class="sd">        &gt;&gt;&gt; assert len(seed_rxn_db)&gt;0 and len(seed_compound_db)&gt;0</span>
<span class="sd">        &gt;&gt;&gt; assert pd.read_json(configs.Database().reaction_db).shape[0]&gt;pd.DataFrame(seed_rxn_db).shape[0]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">seed_rxn_db</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reaction_db</span><span class="p">)</span>
    <span class="n">seed_compound_db</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">compound_db</span><span class="p">)</span>
    <span class="n">seed_rxn_db</span><span class="o">=</span><span class="n">seed_rxn_db</span><span class="p">[</span><span class="n">seed_rxn_db</span><span class="p">[</span><span class="s2">&quot;ec_numbers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">any</span><span class="p">(</span><span class="n">ec</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">for</span> <span class="n">ec</span> <span class="ow">in</span> <span class="n">ec_list</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)]</span>
    <span class="n">seed_compound_db</span><span class="o">=</span><span class="n">seed_compound_db</span><span class="p">[</span><span class="n">seed_compound_db</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">seed_rxn_db</span><span class="p">[</span><span class="s2">&quot;stoichiometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="n">seed_rxn_db</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">local_reaction_db</span><span class="p">)</span>
        <span class="n">seed_compound_db</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">local_compound_db</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">seed_rxn_db</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;record&quot;</span><span class="p">),</span><span class="n">seed_compound_db</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;record&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.get_experiment_from_experiments_db" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_experiment_from_experiments_db</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function returns an experiment from the experiments database. It takes the query string and the column name to query and returns the experiment that contains the query string in the given column.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <ul>
<li>config.experimental_data_db</li>
</ul>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>field_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The name of the column to query.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>query</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The query string.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>Experiment</code></td>          <td>
                <code>list[<a class="autorefs autorefs-internal" title="adtoolbox.core.Experiment" href="#adtoolbox.core.Experiment">Experiment</a>]</code>
          </td>
          <td><p>An instance of the Experiment class.</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span><span class="nn">json</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">local_dir</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;experimental_data_db&#39;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="s2">&quot;experiments_test_db.json&quot;</span><span class="p">)}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">=</span><span class="n">Database</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">studies_local</span><span class="o">=</span><span class="n">local_dir</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">feed</span><span class="o">=</span><span class="n">Feed</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;test_feed&quot;</span><span class="p">,</span><span class="n">carbohydrates</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">lipids</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">proteins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">tss</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span><span class="n">si</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">xi</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">reference</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;test2_study&quot;</span><span class="p">,</span><span class="n">initial_concentrations</span><span class="o">=</span><span class="p">{},</span> <span class="n">time</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;S_bu&quot;</span><span class="p">,</span><span class="s2">&quot;S_ac&quot;</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]],</span><span class="n">feed</span><span class="o">=</span><span class="n">feed</span><span class="p">,</span><span class="n">reference</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">add_experiment_to_experiments_db</span><span class="p">(</span><span class="n">experiment</span><span class="p">,</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">local_dir</span><span class="p">[</span><span class="s1">&#39;experimental_data_db&#39;</span><span class="p">])</span><span class="o">==</span><span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">local_dir</span><span class="p">[</span><span class="s1">&#39;experimental_data_db&#39;</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">experiment</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">get_experiment_from_experiments_db</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;test2_study&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">experiment</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s2">&quot;test2_study&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">local_dir</span><span class="p">[</span><span class="s1">&#39;experimental_data_db&#39;</span><span class="p">])</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_experiment_from_experiments_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">field_name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">query</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">list</span><span class="p">[</span><span class="n">Experiment</span><span class="p">]:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function returns an experiment from the experiments database. It takes the query string and the column name to query and returns the experiment that contains the query string in the given column.</span>

<span class="sd">    Required Configs:</span>
<span class="sd">        - config.experimental_data_db</span>

<span class="sd">    Args:</span>
<span class="sd">        field_name (str): The name of the column to query.</span>
<span class="sd">        query (str): The query string.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Experiment: An instance of the Experiment class.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import os,json</span>
<span class="sd">        &gt;&gt;&gt; local_dir={&#39;experimental_data_db&#39;:os.path.join(Main_Dir,&quot;test&quot;,&quot;experiments_test_db.json&quot;)}</span>
<span class="sd">        &gt;&gt;&gt; db=Database(config=configs.Database(studies_local=local_dir))</span>
<span class="sd">        &gt;&gt;&gt; feed=Feed(name=&quot;test_feed&quot;,carbohydrates=10,lipids=20,proteins=30,tss=80,si=10,xi=30,reference=&quot;test&quot;)</span>
<span class="sd">        &gt;&gt;&gt; experiment = Experiment(name=&quot;test2_study&quot;,initial_concentrations={}, time=[0, 1, 2], variables=[&quot;S_bu&quot;,&quot;S_ac&quot;], data=[[1, 2, 3], [4, 5, 6]],feed=feed,reference=&quot;test&quot;)</span>
<span class="sd">        &gt;&gt;&gt; db.add_experiment_to_experiments_db(experiment,force=True)</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(local_dir[&#39;experimental_data_db&#39;])==True</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.getsize(local_dir[&#39;experimental_data_db&#39;])&gt;0</span>
<span class="sd">        &gt;&gt;&gt; experiment=db.get_experiment_from_experiments_db(&quot;name&quot;,&quot;test2_study&quot;)</span>
<span class="sd">        &gt;&gt;&gt; assert experiment[0].name==&quot;test2_study&quot;</span>
<span class="sd">        &gt;&gt;&gt; os.remove(local_dir[&#39;experimental_data_db&#39;])</span>
<span class="sd">    &quot;&quot;&quot;</span>



    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;experimental_data_db&quot;</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Experimental data database does not exist!&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;experimental_data_db&quot;</span><span class="p">],</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">experiments_db</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">experiments_db</span><span class="o">=</span><span class="p">[</span><span class="n">experiment</span> <span class="k">for</span> <span class="n">experiment</span> <span class="ow">in</span> <span class="n">experiments_db</span> <span class="k">if</span> <span class="n">query</span> <span class="ow">in</span> <span class="n">experiment</span><span class="p">[</span><span class="n">field_name</span><span class="p">]]</span>
    <span class="k">for</span> <span class="n">experiment</span> <span class="ow">in</span> <span class="n">experiments_db</span><span class="p">:</span>
        <span class="n">experiment</span><span class="p">[</span><span class="s2">&quot;feed&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">Feed</span><span class="p">(</span><span class="o">**</span><span class="n">experiment</span><span class="p">[</span><span class="s2">&quot;feed&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">Experiment</span><span class="p">(</span><span class="o">**</span><span class="n">experiment</span><span class="p">)</span> <span class="k">for</span> <span class="n">experiment</span> <span class="ow">in</span> <span class="n">experiments_db</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.get_feed_from_feed_db" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_feed_from_feed_db</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function returns a feed from the feed database. It takes the query string and the column name to query and returns the feed that contains the query string in the given column.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <ul>
<li>config.feed_db</li>
</ul>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>field_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The name of the column to query.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>query</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The query string.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>Feed</code></td>          <td>
                <code>list[<a class="autorefs autorefs-internal" title="adtoolbox.core.Feed" href="#adtoolbox.core.Feed">Feed</a>]</code>
          </td>
          <td><p>An instance of the Feed class.</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;feed_test_db.tsv&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">=</span><span class="n">Database</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">feed_db</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;feed_test_db.tsv&quot;</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">feed</span><span class="o">=</span><span class="n">Feed</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;test_feed&quot;</span><span class="p">,</span><span class="n">carbohydrates</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">lipids</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">proteins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">tss</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span><span class="n">si</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">xi</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">reference</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">add_feed_to_feed_db</span><span class="p">(</span><span class="n">feed</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;feed_test_db.tsv&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;feed_test_db.tsv&quot;</span><span class="p">),</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">feed</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">get_feed_from_feed_db</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;test_feed&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">feed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s2">&quot;test_feed&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;feed_test_db.tsv&quot;</span><span class="p">))</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_feed_from_feed_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">field_name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">query</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">list</span><span class="p">[</span><span class="n">Feed</span><span class="p">]:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function returns a feed from the feed database. It takes the query string and the column name to query and returns the feed that contains the query string in the given column.</span>

<span class="sd">    Required Configs:</span>
<span class="sd">        - config.feed_db</span>

<span class="sd">    Args:</span>
<span class="sd">        field_name (str): The name of the column to query.</span>
<span class="sd">        query (str): The query string.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Feed: An instance of the Feed class.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;))==False</span>
<span class="sd">        &gt;&gt;&gt; db=Database(config=configs.Database(feed_db=os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;)))</span>
<span class="sd">        &gt;&gt;&gt; feed=Feed(name=&quot;test_feed&quot;,carbohydrates=10,lipids=20,proteins=30,tss=80,si=10,xi=30,reference=&quot;test&quot;)</span>
<span class="sd">        &gt;&gt;&gt; db.add_feed_to_feed_db(feed)</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;))==True</span>
<span class="sd">        &gt;&gt;&gt; assert pd.read_table(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;),delimiter=&quot;\t&quot;).shape[0]&gt;0</span>
<span class="sd">        &gt;&gt;&gt; feed=db.get_feed_from_feed_db(&quot;name&quot;,&quot;test_feed&quot;)</span>
<span class="sd">        &gt;&gt;&gt; assert feed[0].name==&quot;test_feed&quot;</span>
<span class="sd">        &gt;&gt;&gt; os.remove(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;))</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Feed database does not exist!&quot;</span><span class="p">)</span>

    <span class="n">feed_db</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">feed_db</span><span class="o">=</span><span class="n">feed_db</span><span class="p">[</span><span class="n">feed_db</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">query</span><span class="p">)]</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">Feed</span><span class="p">(</span><span class="o">**</span><span class="n">feed</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">feed</span> <span class="ow">in</span> <span class="n">feed_db</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.get_metagenomics_study_from_metagenomics_studies_db" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_metagenomics_study_from_metagenomics_studies_db</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function returns a metagenomics study from the metagenomics studies database. It takes the query string and the column name to query and returns the metagenomics study that contains the query string in the given column.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <ul>
<li>config.metagenomics_studies_db</li>
</ul>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>field_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The name of the column to query.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>query</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The query string.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>MetagenomicsStudy</code></td>          <td>
                <code>list[<a class="autorefs autorefs-internal" title="adtoolbox.core.MetagenomicsStudy" href="#adtoolbox.core.MetagenomicsStudy">MetagenomicsStudy</a>]</code>
          </td>
          <td><p>An instance of the MetagenomicsStudy class.</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">local_dir</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;metagenomics_studies&#39;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="s2">&quot;metagenomics_test_db.tsv&quot;</span><span class="p">)}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">=</span><span class="n">Database</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">studies_local</span><span class="o">=</span><span class="n">local_dir</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metagenomics_study</span><span class="o">=</span><span class="n">MetagenomicsStudy</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;test_study&quot;</span><span class="p">,</span><span class="n">study_type</span><span class="o">=</span><span class="s2">&quot;metagenomics&quot;</span><span class="p">,</span><span class="n">microbiome</span><span class="o">=</span><span class="s2">&quot;anaerobic digester&quot;</span><span class="p">,</span><span class="n">sample_accession</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="n">comments</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="n">study_accession</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">add_metagenomics_study_to_metagenomics_studies_db</span><span class="p">(</span><span class="n">metagenomics_study</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">local_dir</span><span class="p">[</span><span class="s1">&#39;metagenomics_studies&#39;</span><span class="p">])</span><span class="o">==</span><span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">local_dir</span><span class="p">[</span><span class="s1">&#39;metagenomics_studies&#39;</span><span class="p">],</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metagenomics_study</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">get_metagenomics_study_from_metagenomics_studies_db</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;test_study&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">metagenomics_study</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s2">&quot;test_study&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">local_dir</span><span class="p">[</span><span class="s1">&#39;metagenomics_studies&#39;</span><span class="p">])</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_metagenomics_study_from_metagenomics_studies_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">field_name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">query</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">list</span><span class="p">[</span><span class="n">MetagenomicsStudy</span><span class="p">]:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function returns a metagenomics study from the metagenomics studies database. It takes the query string and the column name to query and returns the metagenomics study that contains the query string in the given column.</span>

<span class="sd">    Required Configs:</span>
<span class="sd">        - config.metagenomics_studies_db</span>

<span class="sd">    Args:</span>
<span class="sd">        field_name (str): The name of the column to query.</span>
<span class="sd">        query (str): The query string.</span>

<span class="sd">    Returns:</span>
<span class="sd">        MetagenomicsStudy: An instance of the MetagenomicsStudy class.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; local_dir={&#39;metagenomics_studies&#39;:os.path.join(Main_Dir,&quot;test&quot;,&quot;metagenomics_test_db.tsv&quot;)}</span>
<span class="sd">        &gt;&gt;&gt; db=Database(config=configs.Database(studies_local=local_dir))</span>
<span class="sd">        &gt;&gt;&gt; metagenomics_study=MetagenomicsStudy(name=&quot;test_study&quot;,study_type=&quot;metagenomics&quot;,microbiome=&quot;anaerobic digester&quot;,sample_accession=&quot;test&quot;,comments=&quot;test&quot;,study_accession=&quot;test&quot;)</span>
<span class="sd">        &gt;&gt;&gt; db.add_metagenomics_study_to_metagenomics_studies_db(metagenomics_study)</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(local_dir[&#39;metagenomics_studies&#39;])==True</span>
<span class="sd">        &gt;&gt;&gt; assert pd.read_table(local_dir[&#39;metagenomics_studies&#39;],delimiter=&quot;\t&quot;).shape[0]&gt;0</span>
<span class="sd">        &gt;&gt;&gt; metagenomics_study=db.get_metagenomics_study_from_metagenomics_studies_db(&quot;name&quot;,&quot;test_study&quot;)</span>
<span class="sd">        &gt;&gt;&gt; assert metagenomics_study[0].name==&quot;test_study&quot;</span>
<span class="sd">        &gt;&gt;&gt; os.remove(local_dir[&#39;metagenomics_studies&#39;])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;metagenomics_studies&quot;</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Metagenomics studies database does not exist!&quot;</span><span class="p">)</span>

    <span class="n">metagenomics_studies_db</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;metagenomics_studies&quot;</span><span class="p">],</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">metagenomics_studies_db</span><span class="o">=</span><span class="n">metagenomics_studies_db</span><span class="p">[</span><span class="n">metagenomics_studies_db</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">query</span><span class="p">)]</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">MetagenomicsStudy</span><span class="p">(</span><span class="o">**</span><span class="n">metagenomics_study</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">metagenomics_study</span> <span class="ow">in</span> <span class="n">metagenomics_studies_db</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.get_protein_seqs_from_uniprot" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_protein_seqs_from_uniprot</span><span class="p">(</span><span class="n">uniprot_id</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function takes a uniprot id and fetches the protein sequence from Uniprot.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>uniprot_id</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The uniprot id of the protein.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>The protein sequence.</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">=</span><span class="n">Database</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">seq</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">get_protein_seqs_from_uniprot</span><span class="p">(</span><span class="s2">&quot;P0A9P0&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span><span class="o">==</span><span class="nb">str</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_protein_seqs_from_uniprot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniprot_id</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function takes a uniprot id and fetches the protein sequence from Uniprot.</span>

<span class="sd">    Args:</span>
<span class="sd">        uniprot_id (str): The uniprot id of the protein.</span>


<span class="sd">    Returns:</span>
<span class="sd">        str: The protein sequence.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; db=Database()</span>
<span class="sd">        &gt;&gt;&gt; seq=db.get_protein_seqs_from_uniprot(&quot;P0A9P0&quot;)</span>
<span class="sd">        &gt;&gt;&gt; assert type(seq)==str and len(seq)&gt;0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Base_URL</span> <span class="o">=</span> <span class="s2">&quot;https://rest.uniprot.org/uniprotkb/&quot;</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
    <span class="n">retry</span> <span class="o">=</span> <span class="n">Retry</span><span class="p">(</span><span class="n">connect</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">backoff_factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">adapter</span> <span class="o">=</span> <span class="n">HTTPAdapter</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="n">retry</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s1">&#39;http://&#39;</span><span class="p">,</span> <span class="n">adapter</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">file</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;https://rest.uniprot.org/uniprotkb/</span><span class="si">{</span><span class="n">uniprot_id</span><span class="si">}</span><span class="s2">.fasta&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not fetch the sequence! Trying again ...&quot;</span><span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Base_URL</span><span class="o">+</span><span class="n">uniprot_id</span><span class="o">+</span><span class="s2">&quot;.fasta&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
                <span class="k">break</span>

    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.initialize_experimental_data_db" class="doc doc-heading">
<code class="highlight language-python"><span class="n">initialize_experimental_data_db</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function intializes ADToolbox's experimental data database by creating an empty json file.
Be careful, this will overwrite any existing file with the same name.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <ul>
<li>config.experimental_data_db</li>
</ul>
</details>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span><span class="nn">json</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">local_dir</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;experimental_data_db&#39;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="s2">&quot;experiments_test_db.json&quot;</span><span class="p">)}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">=</span><span class="n">Database</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">studies_local</span><span class="o">=</span><span class="n">local_dir</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">initialize_experimental_data_db</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">local_dir</span><span class="p">[</span><span class="s1">&#39;experimental_data_db&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_dir</span><span class="p">[</span><span class="s1">&#39;experimental_data_db&#39;</span><span class="p">],</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">assert</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">==</span><span class="p">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">local_dir</span><span class="p">[</span><span class="s1">&#39;experimental_data_db&#39;</span><span class="p">])</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">initialize_experimental_data_db</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;This function intializes ADToolbox&#39;s experimental data database by creating an empty json file.</span>
<span class="sd">    Be careful, this will overwrite any existing file with the same name.</span>

<span class="sd">    Required Configs:</span>
<span class="sd">        - config.experimental_data_db</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import os,json</span>
<span class="sd">        &gt;&gt;&gt; local_dir={&#39;experimental_data_db&#39;:os.path.join(Main_Dir,&quot;test&quot;,&quot;experiments_test_db.json&quot;)}</span>
<span class="sd">        &gt;&gt;&gt; db=Database(config=configs.Database(studies_local=local_dir))</span>
<span class="sd">        &gt;&gt;&gt; db.initialize_experimental_data_db()</span>
<span class="sd">        &gt;&gt;&gt; assert pd.read_json(local_dir[&#39;experimental_data_db&#39;]).shape[0]==0</span>
<span class="sd">        &gt;&gt;&gt; with open(local_dir[&#39;experimental_data_db&#39;],&quot;r&quot;) as f:</span>
<span class="sd">        ...     assert json.load(f)==[]</span>
<span class="sd">        &gt;&gt;&gt; os.remove(local_dir[&#39;experimental_data_db&#39;])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;experimental_data_db&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;experimental_data_db&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;initial_concentrations&quot;</span><span class="p">,</span><span class="s2">&quot;time&quot;</span><span class="p">,</span><span class="s2">&quot;variables&quot;</span><span class="p">,</span><span class="s2">&quot;data&quot;</span><span class="p">,</span><span class="s2">&quot;reference&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;experimental_data_db&quot;</span><span class="p">],</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.initialize_feed_db" class="doc doc-heading">
<code class="highlight language-python"><span class="n">initialize_feed_db</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function intializes ADToolbox's Feed database by creating an empty tsv file.
Be careful, this will overwrite any existing file with the same name.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <ul>
<li>config.feed_db</li>
</ul>
</details>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;feed_test_db.tsv&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">=</span><span class="n">Database</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">feed_db</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;feed_test_db.tsv&quot;</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">initialize_feed_db</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;feed_test_db.tsv&quot;</span><span class="p">),</span><span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;feed_test_db.tsv&quot;</span><span class="p">),</span><span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">==</span><span class="nb">set</span><span class="p">([</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;carbohydrates&quot;</span><span class="p">,</span><span class="s2">&quot;lipids&quot;</span><span class="p">,</span><span class="s2">&quot;proteins&quot;</span><span class="p">,</span><span class="s2">&quot;tss&quot;</span><span class="p">,</span><span class="s2">&quot;si&quot;</span><span class="p">,</span><span class="s2">&quot;xi&quot;</span><span class="p">,</span><span class="s2">&quot;reference&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;feed_test_db.tsv&quot;</span><span class="p">))</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">initialize_feed_db</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;This function intializes ADToolbox&#39;s Feed database by creating an empty tsv file.</span>
<span class="sd">    Be careful, this will overwrite any existing file with the same name.</span>

<span class="sd">    Required Configs:</span>
<span class="sd">        - config.feed_db</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;))==False</span>
<span class="sd">        &gt;&gt;&gt; db=Database(config=configs.Database(feed_db=os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;)))</span>
<span class="sd">        &gt;&gt;&gt; db.initialize_feed_db()</span>
<span class="sd">        &gt;&gt;&gt; assert pd.read_table(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;),delimiter=&#39;\t&#39;).shape[0]==0</span>
<span class="sd">        &gt;&gt;&gt; assert set(pd.read_table(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;),delimiter=&#39;\t&#39;).columns)==set([&quot;name&quot;,&quot;carbohydrates&quot;,&quot;lipids&quot;,&quot;proteins&quot;,&quot;tss&quot;,&quot;si&quot;,&quot;xi&quot;,&quot;reference&quot;])</span>
<span class="sd">        &gt;&gt;&gt; os.remove(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;))</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;carbohydrates&quot;</span><span class="p">,</span><span class="s2">&quot;lipids&quot;</span><span class="p">,</span><span class="s2">&quot;proteins&quot;</span><span class="p">,</span><span class="s2">&quot;tss&quot;</span><span class="p">,</span><span class="s2">&quot;si&quot;</span><span class="p">,</span><span class="s2">&quot;xi&quot;</span><span class="p">,</span><span class="s2">&quot;reference&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.initialize_metagenomics_studies_db" class="doc doc-heading">
<code class="highlight language-python"><span class="n">initialize_metagenomics_studies_db</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function intializes ADToolbox's Metagenomics studies database by creating an empty tsv file.
Be careful, this will overwrite any existing file with the same name.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <ul>
<li>config.metagenomics_studies_db</li>
</ul>
</details>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">local_dir</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;metagenomics_studies&#39;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="s2">&quot;metagenomics_test_db.tsv&quot;</span><span class="p">)}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">=</span><span class="n">Database</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">studies_local</span><span class="o">=</span><span class="n">local_dir</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">initialize_metagenomics_studies_db</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">local_dir</span><span class="p">[</span><span class="s1">&#39;metagenomics_studies&#39;</span><span class="p">],</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">local_dir</span><span class="p">[</span><span class="s1">&#39;metagenomics_studies&#39;</span><span class="p">],</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">==</span><span class="nb">set</span><span class="p">([</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;study_type&quot;</span><span class="p">,</span><span class="s2">&quot;microbiome&quot;</span><span class="p">,</span><span class="s2">&quot;sample_accession&quot;</span><span class="p">,</span><span class="s2">&quot;comments&quot;</span><span class="p">,</span><span class="s2">&quot;study_accession&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">local_dir</span><span class="p">[</span><span class="s1">&#39;metagenomics_studies&#39;</span><span class="p">])</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">initialize_metagenomics_studies_db</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;This function intializes ADToolbox&#39;s Metagenomics studies database by creating an empty tsv file.</span>
<span class="sd">    Be careful, this will overwrite any existing file with the same name.</span>

<span class="sd">    Required Configs:</span>
<span class="sd">        - config.metagenomics_studies_db</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; local_dir={&#39;metagenomics_studies&#39;:os.path.join(Main_Dir,&quot;test&quot;,&quot;metagenomics_test_db.tsv&quot;)}</span>
<span class="sd">        &gt;&gt;&gt; db=Database(config=configs.Database(studies_local=local_dir))</span>
<span class="sd">        &gt;&gt;&gt; db.initialize_metagenomics_studies_db()</span>
<span class="sd">        &gt;&gt;&gt; assert pd.read_table(local_dir[&#39;metagenomics_studies&#39;],delimiter=&quot;\t&quot;).shape[0]==0</span>
<span class="sd">        &gt;&gt;&gt; assert set(pd.read_table(local_dir[&#39;metagenomics_studies&#39;],delimiter=&quot;\t&quot;).columns)==set([&quot;name&quot;,&quot;study_type&quot;,&quot;microbiome&quot;,&quot;sample_accession&quot;,&quot;comments&quot;,&quot;study_accession&quot;])</span>
<span class="sd">        &gt;&gt;&gt; os.remove(local_dir[&#39;metagenomics_studies&#39;])</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;study_type&quot;</span><span class="p">,</span><span class="s2">&quot;microbiome&quot;</span><span class="p">,</span><span class="s2">&quot;sample_accession&quot;</span><span class="p">,</span><span class="s2">&quot;comments&quot;</span><span class="p">,</span><span class="s2">&quot;study_accession&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;metagenomics_studies&quot;</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.initialize_protein_db" class="doc doc-heading">
<code class="highlight language-python"><span class="n">initialize_protein_db</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function intializes ADToolbox's protein database by creating an empty fasta file.
Be careful, this will overwrite any existing file with the same name.
Logically, this needs method needs config.protein_db to be defined.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <h4 id="adtoolbox.core.Database.initialize_protein_db---configprotein_db">- config.protein_db</h4>
</details>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;protein_test_db.fasta&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">False</span> <span class="c1"># This is just to make sure that the following lines create the file</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">=</span><span class="n">Database</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">protein_db</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;protein_test_db.fasta&quot;</span><span class="p">)))</span> <span class="c1"># point to a test non-existing file</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">initialize_protein_db</span><span class="p">()</span> <span class="c1"># initialize the protein database</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;protein_test_db.fasta&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">True</span> <span class="c1"># check if the file is created</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;protein_test_db.fasta&quot;</span><span class="p">))</span> <span class="c1"># remove the file to clean up</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">initialize_protein_db</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;This function intializes ADToolbox&#39;s protein database by creating an empty fasta file.</span>
<span class="sd">    Be careful, this will overwrite any existing file with the same name.</span>
<span class="sd">    Logically, this needs method needs config.protein_db to be defined.</span>

<span class="sd">    Required Configs:</span>
<span class="sd">        - config.protein_db</span>
<span class="sd">        --------</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))==False # This is just to make sure that the following lines create the file</span>
<span class="sd">        &gt;&gt;&gt; db=Database(config=configs.Database(protein_db=os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))) # point to a test non-existing file</span>
<span class="sd">        &gt;&gt;&gt; db.initialize_protein_db() # initialize the protein database</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;))==True # check if the file is created</span>
<span class="sd">        &gt;&gt;&gt; os.remove(os.path.join(Main_Dir,&quot;protein_test_db.fasta&quot;)) # remove the file to clean up</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.initialize_reaction_db" class="doc doc-heading">
<code class="highlight language-python"><span class="n">initialize_reaction_db</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function intializes ADToolbox's reaction database by creating an empty tsv file.
Be careful, this will overwrite any existing file with the same name.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <ul>
<li>config.reaction_db</li>
</ul>
</details>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;reaction_test_db.tsv&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">=</span><span class="n">Database</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">reaction_db</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;reaction_test_db.tsv&quot;</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">initialize_reaction_db</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;reaction_test_db.tsv&quot;</span><span class="p">),</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;reaction_test_db.tsv&quot;</span><span class="p">),</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">==</span><span class="nb">set</span><span class="p">([</span><span class="s2">&quot;ec_numbers&quot;</span><span class="p">,</span><span class="s2">&quot;seed_ids&quot;</span><span class="p">,</span><span class="s2">&quot;reaction_names&quot;</span><span class="p">,</span><span class="s2">&quot;adm1_reaction&quot;</span><span class="p">,</span><span class="s2">&quot;e_adm_reactions&quot;</span><span class="p">,</span><span class="s2">&quot;pathways&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;reaction_test_db.tsv&quot;</span><span class="p">))</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">initialize_reaction_db</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;This function intializes ADToolbox&#39;s reaction database by creating an empty tsv file.</span>
<span class="sd">    Be careful, this will overwrite any existing file with the same name.</span>

<span class="sd">    Required Configs:</span>
<span class="sd">        - config.reaction_db</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;reaction_test_db.tsv&quot;))==False</span>
<span class="sd">        &gt;&gt;&gt; db=Database(config=configs.Database(reaction_db=os.path.join(Main_Dir,&quot;reaction_test_db.tsv&quot;)))</span>
<span class="sd">        &gt;&gt;&gt; db.initialize_reaction_db()</span>
<span class="sd">        &gt;&gt;&gt; assert pd.read_table(os.path.join(Main_Dir,&quot;reaction_test_db.tsv&quot;),delimiter=&quot;\t&quot;).shape[0]==0</span>
<span class="sd">        &gt;&gt;&gt; assert set(pd.read_csv(os.path.join(Main_Dir,&quot;reaction_test_db.tsv&quot;),delimiter=&quot;\t&quot;).columns)==set([&quot;ec_numbers&quot;,&quot;seed_ids&quot;,&quot;reaction_names&quot;,&quot;adm1_reaction&quot;,&quot;e_adm_reactions&quot;,&quot;pathways&quot;])</span>
<span class="sd">        &gt;&gt;&gt; os.remove(os.path.join(Main_Dir,&quot;reaction_test_db.tsv&quot;))</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ec_numbers&quot;</span><span class="p">,</span><span class="s2">&quot;seed_ids&quot;</span><span class="p">,</span><span class="s2">&quot;reaction_names&quot;</span><span class="p">,</span><span class="s2">&quot;adm1_reaction&quot;</span><span class="p">,</span><span class="s2">&quot;e_adm_reactions&quot;</span><span class="p">,</span><span class="s2">&quot;pathways&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reaction_db</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.proteins_from_ec" class="doc doc-heading">
<code class="highlight language-python"><span class="n">proteins_from_ec</span><span class="p">(</span><span class="n">ec_number</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function returns a dictionary of protein sequences for a given EC number.
The keys are the uniprot ids and ec number compatible with ADToolbox protein database
and the values are the protein sequences. Since ADToolbox deals with microbial process,
only bacterial and archaeal proteins are considered.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>ec_number</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The EC number.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>dict</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>A dictionary of protein sequences.</p></td>
        </tr>
        <tr>
<td></td>          <td>
                <code>dict</code>
          </td>
          <td></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">=</span><span class="n">Database</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">protein_seqs</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">proteins_from_ec</span><span class="p">(</span><span class="s2">&quot;1.1.1.1&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">protein_seqs</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">protein_seqs</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;1.1.1.1&quot;</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">proteins_from_ec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ec_number</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function returns a dictionary of protein sequences for a given EC number.</span>
<span class="sd">    The keys are the uniprot ids and ec number compatible with ADToolbox protein database</span>
<span class="sd">    and the values are the protein sequences. Since ADToolbox deals with microbial process,</span>
<span class="sd">    only bacterial and archaeal proteins are considered.</span>

<span class="sd">    Args:</span>
<span class="sd">        ec_number (str): The EC number.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary of protein sequences.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; db=Database()</span>
<span class="sd">        &gt;&gt;&gt; protein_seqs=db.proteins_from_ec(&quot;1.1.1.1&quot;)</span>
<span class="sd">        &gt;&gt;&gt; assert len(protein_seqs)&gt;0</span>
<span class="sd">        &gt;&gt;&gt; assert list(protein_seqs.keys())[0].split(&quot;|&quot;)[1]==&quot;1.1.1.1&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
    <span class="n">retry</span> <span class="o">=</span> <span class="n">Retry</span><span class="p">(</span><span class="n">connect</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">backoff_factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">adapter</span> <span class="o">=</span> <span class="n">HTTPAdapter</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="n">retry</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s1">&#39;http://&#39;</span><span class="p">,</span> <span class="n">adapter</span><span class="p">)</span>
    <span class="n">protein_seqs</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">file</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;https://rest.uniprot.org/uniprotkb/stream?format=fasta&amp;query=%28%28ec%3A</span><span class="si">{</span><span class="n">ec_number</span><span class="si">}</span><span class="s2">%29%20AND%20%28reviewed%3Atrue%29%20NOT%20%28taxonomy_id%3A2759%29%29&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="ow">or</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Request Error! Trying again ...&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">file</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;https://rest.uniprot.org/uniprotkb/stream?format=fasta&amp;query=%28%28ec%3A</span><span class="si">{</span><span class="n">ec_number</span><span class="si">}</span><span class="s2">%29%20AND%20%28reviewed%3Atrue%29%20NOT%20%28taxonomy_id%3A2759%29%29&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="c1"># This alsp does a sanity chec</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Something went wrong!&#39;</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">text</span>
    <span class="k">if</span> <span class="n">text</span><span class="p">:</span>
        <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)</span>
        <span class="n">text</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
            <span class="n">protein_seqs</span><span class="o">.</span><span class="n">update</span><span class="p">([(</span><span class="n">seq</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;|&quot;</span><span class="o">+</span><span class="n">ec_number</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">seq</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]))])</span>


    <span class="k">return</span> <span class="n">protein_seqs</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.remove_experiment_from_experiments_db" class="doc doc-heading">
<code class="highlight language-python"><span class="n">remove_experiment_from_experiments_db</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function removes experiments that contain the query in the given column, field name, from the experiments database.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <ul>
<li>config.experimental_data_db</li>
</ul>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>field_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The name of the column to query.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>query</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The query string.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span><span class="nn">json</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">local_dir</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;experimental_data_db&#39;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="s2">&quot;experiments_test_db.json&quot;</span><span class="p">)}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">=</span><span class="n">Database</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">studies_local</span><span class="o">=</span><span class="n">local_dir</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">feed</span><span class="o">=</span><span class="n">Feed</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;test_feed&quot;</span><span class="p">,</span><span class="n">carbohydrates</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">lipids</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">proteins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">tss</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span><span class="n">si</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">xi</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">reference</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;test2_study&quot;</span><span class="p">,</span><span class="n">initial_concentrations</span><span class="o">=</span><span class="p">{},</span> <span class="n">time</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;S_bu&quot;</span><span class="p">,</span><span class="s2">&quot;S_ac&quot;</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]],</span><span class="n">feed</span><span class="o">=</span><span class="n">feed</span><span class="p">,</span><span class="n">reference</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">add_experiment_to_experiments_db</span><span class="p">(</span><span class="n">experiment</span><span class="p">,</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">local_dir</span><span class="p">[</span><span class="s1">&#39;experimental_data_db&#39;</span><span class="p">])</span><span class="o">==</span><span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">local_dir</span><span class="p">[</span><span class="s1">&#39;experimental_data_db&#39;</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">remove_experiment_from_experiments_db</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;test2_study&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">local_dir</span><span class="p">[</span><span class="s1">&#39;experimental_data_db&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">local_dir</span><span class="p">[</span><span class="s1">&#39;experimental_data_db&#39;</span><span class="p">])</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remove_experiment_from_experiments_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">field_name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">query</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function removes experiments that contain the query in the given column, field name, from the experiments database.</span>

<span class="sd">    Required Configs:</span>
<span class="sd">        - config.experimental_data_db</span>

<span class="sd">    Args:</span>
<span class="sd">        field_name (str): The name of the column to query.</span>
<span class="sd">        query (str): The query string.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import os,json</span>
<span class="sd">        &gt;&gt;&gt; local_dir={&#39;experimental_data_db&#39;:os.path.join(Main_Dir,&quot;test&quot;,&quot;experiments_test_db.json&quot;)}</span>
<span class="sd">        &gt;&gt;&gt; db=Database(config=configs.Database(studies_local=local_dir))</span>
<span class="sd">        &gt;&gt;&gt; feed=Feed(name=&quot;test_feed&quot;,carbohydrates=10,lipids=20,proteins=30,tss=80,si=10,xi=30,reference=&quot;test&quot;)</span>
<span class="sd">        &gt;&gt;&gt; experiment = Experiment(name=&quot;test2_study&quot;,initial_concentrations={}, time=[0, 1, 2], variables=[&quot;S_bu&quot;,&quot;S_ac&quot;], data=[[1, 2, 3], [4, 5, 6]],feed=feed,reference=&quot;test&quot;)</span>
<span class="sd">        &gt;&gt;&gt; db.add_experiment_to_experiments_db(experiment,force=True)</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(local_dir[&#39;experimental_data_db&#39;])==True</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.getsize(local_dir[&#39;experimental_data_db&#39;])&gt;0</span>
<span class="sd">        &gt;&gt;&gt; db.remove_experiment_from_experiments_db(&quot;name&quot;,&quot;test2_study&quot;)</span>
<span class="sd">        &gt;&gt;&gt; assert pd.read_json(local_dir[&#39;experimental_data_db&#39;]).shape[0]==0</span>
<span class="sd">        &gt;&gt;&gt; os.remove(local_dir[&#39;experimental_data_db&#39;])</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;experimental_data_db&quot;</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Experimental data database does not exist!&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;experimental_data_db&quot;</span><span class="p">],</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">experiments_db</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">experiments_db</span><span class="o">=</span><span class="p">[</span><span class="n">experiment</span> <span class="k">for</span> <span class="n">experiment</span> <span class="ow">in</span> <span class="n">experiments_db</span> <span class="k">if</span> <span class="n">query</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">experiment</span><span class="p">[</span><span class="n">field_name</span><span class="p">]]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;experimental_data_db&quot;</span><span class="p">],</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">experiments_db</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.remove_feed_from_feed_db" class="doc doc-heading">
<code class="highlight language-python"><span class="n">remove_feed_from_feed_db</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function removes studyes that contain the query in the given column, field name, from the feed database.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <ul>
<li>config.feed_db</li>
</ul>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>field_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The name of the column to query.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>query</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The query string.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;feed_test_db.tsv&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">=</span><span class="n">Database</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">feed_db</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;feed_test_db.tsv&quot;</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">feed</span><span class="o">=</span><span class="n">Feed</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;test_feed&quot;</span><span class="p">,</span><span class="n">carbohydrates</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">lipids</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">proteins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">tss</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span><span class="n">si</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">xi</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">reference</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">add_feed_to_feed_db</span><span class="p">(</span><span class="n">feed</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;feed_test_db.tsv&quot;</span><span class="p">))</span><span class="o">==</span><span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;feed_test_db.tsv&quot;</span><span class="p">),</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">remove_feed_from_feed_db</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;test_feed&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;feed_test_db.tsv&quot;</span><span class="p">),</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;feed_test_db.tsv&quot;</span><span class="p">))</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remove_feed_from_feed_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">field_name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">query</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function removes studyes that contain the query in the given column, field name, from the feed database.</span>

<span class="sd">    Required Configs:</span>
<span class="sd">        - config.feed_db</span>

<span class="sd">    Args:</span>
<span class="sd">        field_name (str): The name of the column to query.</span>
<span class="sd">        query (str): The query string.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;))==False</span>
<span class="sd">        &gt;&gt;&gt; db=Database(config=configs.Database(feed_db=os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;)))</span>
<span class="sd">        &gt;&gt;&gt; feed=Feed(name=&quot;test_feed&quot;,carbohydrates=10,lipids=20,proteins=30,tss=80,si=10,xi=30,reference=&quot;test&quot;)</span>
<span class="sd">        &gt;&gt;&gt; db.add_feed_to_feed_db(feed)</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;))==True</span>
<span class="sd">        &gt;&gt;&gt; assert pd.read_table(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;),delimiter=&quot;\t&quot;).shape[0]&gt;0</span>
<span class="sd">        &gt;&gt;&gt; db.remove_feed_from_feed_db(&quot;name&quot;,&quot;test_feed&quot;)</span>
<span class="sd">        &gt;&gt;&gt; assert pd.read_table(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;),delimiter=&quot;\t&quot;).shape[0]==0</span>
<span class="sd">        &gt;&gt;&gt; os.remove(os.path.join(Main_Dir,&quot;feed_test_db.tsv&quot;))</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Feed database does not exist!&quot;</span><span class="p">)</span>


    <span class="n">feed_db</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">feed_db</span><span class="o">=</span><span class="n">feed_db</span><span class="p">[</span><span class="n">feed_db</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">==</span><span class="kc">False</span><span class="p">]</span>
    <span class="n">feed_db</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.remove_metagenomics_study_from_metagenomics_studies_db" class="doc doc-heading">
<code class="highlight language-python"><span class="n">remove_metagenomics_study_from_metagenomics_studies_db</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function removes studies that contain the query in the given column, field name, from the metagenomics studies database.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <ul>
<li>config.metagenomics_studies_db</li>
</ul>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>field_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The name of the column to query.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>query</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The query string.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span><span class="nn">json</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">local_dir</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;metagenomics_studies&#39;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="s2">&quot;metagenomics_test_db.json&quot;</span><span class="p">)}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">=</span><span class="n">Database</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">studies_local</span><span class="o">=</span><span class="n">local_dir</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metagenomics_study</span><span class="o">=</span><span class="n">MetagenomicsStudy</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;test_study&quot;</span><span class="p">,</span><span class="n">study_type</span><span class="o">=</span><span class="s2">&quot;metagenomics&quot;</span><span class="p">,</span><span class="n">microbiome</span><span class="o">=</span><span class="s2">&quot;anaerobic digester&quot;</span><span class="p">,</span><span class="n">sample_accession</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="n">comments</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="n">study_accession</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">add_metagenomics_study_to_metagenomics_studies_db</span><span class="p">(</span><span class="n">metagenomics_study</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">local_dir</span><span class="p">[</span><span class="s1">&#39;metagenomics_studies&#39;</span><span class="p">])</span><span class="o">==</span><span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">local_dir</span><span class="p">[</span><span class="s1">&#39;metagenomics_studies&#39;</span><span class="p">],</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">remove_metagenomics_study_from_metagenomics_studies_db</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;test_study&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">local_dir</span><span class="p">[</span><span class="s1">&#39;metagenomics_studies&#39;</span><span class="p">],</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">local_dir</span><span class="p">[</span><span class="s1">&#39;metagenomics_studies&#39;</span><span class="p">])</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remove_metagenomics_study_from_metagenomics_studies_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">field_name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">query</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function removes studies that contain the query in the given column, field name, from the metagenomics studies database.</span>

<span class="sd">    Required Configs:</span>
<span class="sd">        - config.metagenomics_studies_db</span>

<span class="sd">    Args:</span>
<span class="sd">        field_name (str): The name of the column to query.</span>
<span class="sd">        query (str): The query string.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import os,json</span>
<span class="sd">        &gt;&gt;&gt; local_dir={&#39;metagenomics_studies&#39;:os.path.join(Main_Dir,&quot;test&quot;,&quot;metagenomics_test_db.json&quot;)}</span>
<span class="sd">        &gt;&gt;&gt; db=Database(config=configs.Database(studies_local=local_dir))</span>
<span class="sd">        &gt;&gt;&gt; metagenomics_study=MetagenomicsStudy(name=&quot;test_study&quot;,study_type=&quot;metagenomics&quot;,microbiome=&quot;anaerobic digester&quot;,sample_accession=&quot;test&quot;,comments=&quot;test&quot;,study_accession=&quot;test&quot;)</span>
<span class="sd">        &gt;&gt;&gt; db.add_metagenomics_study_to_metagenomics_studies_db(metagenomics_study)</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.exists(local_dir[&#39;metagenomics_studies&#39;])==True</span>
<span class="sd">        &gt;&gt;&gt; assert pd.read_table(local_dir[&#39;metagenomics_studies&#39;],delimiter=&quot;\t&quot;).shape[0]&gt;0</span>
<span class="sd">        &gt;&gt;&gt; db.remove_metagenomics_study_from_metagenomics_studies_db(&quot;name&quot;,&quot;test_study&quot;)</span>
<span class="sd">        &gt;&gt;&gt; assert pd.read_table(local_dir[&#39;metagenomics_studies&#39;],delimiter=&quot;\t&quot;).shape[0]==0</span>
<span class="sd">        &gt;&gt;&gt; os.remove(local_dir[&#39;metagenomics_studies&#39;])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;metagenomics_studies&quot;</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Metagenomics studies database does not exist!&quot;</span><span class="p">)</span>

    <span class="n">metagenomics_studies_db</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;metagenomics_studies&quot;</span><span class="p">],</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">metagenomics_studies_db</span><span class="o">=</span><span class="n">metagenomics_studies_db</span><span class="p">[</span><span class="n">metagenomics_studies_db</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">==</span><span class="kc">False</span><span class="p">]</span>
    <span class="n">metagenomics_studies_db</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">studies_local</span><span class="p">[</span><span class="s2">&quot;metagenomics_studies&quot;</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h3 id="8-metagenomics">8. Metagenomics</h3>
<p>Here is a schematic view of core.Metagenomics API:</p>
<p><img alt="schema" src="../Metagenomics.svg" /></p>


<div class="doc doc-object doc-class">


<a id="adtoolbox.core.Metagenomics"></a>
  <div class="doc doc-contents first">

  
      <p>This is the main class for Metagenomics functionality of ADToolbox. This class contains all the methods required for metagenomics analysis 
that ADToolbox offers.</p>


        <details class="quote">
          <summary>Source code in <code>adtoolbox/core.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span>
<span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span>
<span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span>
<span class="normal">2188</span>
<span class="normal">2189</span>
<span class="normal">2190</span>
<span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span>
<span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span>
<span class="normal">2230</span>
<span class="normal">2231</span>
<span class="normal">2232</span>
<span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span>
<span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span>
<span class="normal">2248</span>
<span class="normal">2249</span>
<span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span>
<span class="normal">2255</span>
<span class="normal">2256</span>
<span class="normal">2257</span>
<span class="normal">2258</span>
<span class="normal">2259</span>
<span class="normal">2260</span>
<span class="normal">2261</span>
<span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span>
<span class="normal">2265</span>
<span class="normal">2266</span>
<span class="normal">2267</span>
<span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span>
<span class="normal">2273</span>
<span class="normal">2274</span>
<span class="normal">2275</span>
<span class="normal">2276</span>
<span class="normal">2277</span>
<span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span>
<span class="normal">2283</span>
<span class="normal">2284</span>
<span class="normal">2285</span>
<span class="normal">2286</span>
<span class="normal">2287</span>
<span class="normal">2288</span>
<span class="normal">2289</span>
<span class="normal">2290</span>
<span class="normal">2291</span>
<span class="normal">2292</span>
<span class="normal">2293</span>
<span class="normal">2294</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Metagenomics</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the main class for Metagenomics functionality of ADToolbox. This class contains all the methods required for metagenomics analysis </span>
<span class="sd">    that ADToolbox offers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">config</span><span class="p">:</span><span class="n">configs</span><span class="o">.</span><span class="n">Metagenomics</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;In order to instntiate an object from this class, you need to provide a metagenomics configs object from the configs module : configs.Metagenomics.</span>
<span class="sd">        Information for inputs and of each method is then obtained from the corresponding configs object. The following example shows how to instantiate an object from this class</span>
<span class="sd">        using the default configs object:</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; from adtoolbox import core, configs</span>
<span class="sd">            &gt;&gt;&gt; config=configs.Metagenomics() ### This uses default arguments. Refer to configs module for more information.</span>
<span class="sd">            &gt;&gt;&gt; metagenomics=core.Metagenomics(config)</span>
<span class="sd">            &gt;&gt;&gt; assert type(metagenomics)==core.Metagenomics</span>

<span class="sd">        Args:</span>
<span class="sd">            config (configs.Metagenomics): A metagenomics configs object from configs module.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">=</span><span class="n">config</span>

    <span class="c1">#### NEEDS to BE FIXED        </span>
    <span class="k">def</span> <span class="nf">find_top_taxa</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">sample_name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">treshold</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">],</span>
        <span class="n">mode</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;top_k&#39;</span><span class="p">,</span>
        <span class="p">)</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function needs three inputs from qiime:</span>
<span class="sd">        1. feature table: This is the abundance of each feature in each sample (TSV).</span>
<span class="sd">        2. taxonomy table: This is the taxonomy of each feature (TSV). </span>
<span class="sd">        3. rep seqs: This is the representative sequence of each feature (fasta).</span>
<span class="sd">        It then finds the top k features or features that form specific percentile of the community of the sample.</span>

<span class="sd">        Required Configs:</span>

<span class="sd">            config.feature_table_dir: The path to the feature table tsv file.</span>
<span class="sd">            ---------</span>
<span class="sd">            config.taxonomy_table_dir: The path to the taxonomy table tsv file.</span>
<span class="sd">            ---------</span>
<span class="sd">            config.rep_seq_fasta: The path to the representative sequence fasta file.</span>
<span class="sd">            ---------</span>

<span class="sd">        Args:</span>
<span class="sd">            sample_name (str): The name of the sample.</span>
<span class="sd">            threshold (int, float): The threshold for the top k or the percentile.</span>
<span class="sd">            mode (str, optional): Whether to find the top k features or features that form specific percentile of the community of the sample. Defaults to &#39;top_k&#39;. Options: &#39;top_k&#39;, &#39;percentile&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary of the top k features and their taxonomy.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">### Load all the required files</span>
        <span class="n">feature_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feature_table_dir</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">taxonomy_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">taxonomy_table_dir</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">repseqs</span><span class="o">=</span><span class="n">fasta_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">rep_seq_fasta</span><span class="p">)</span>
        <span class="c1">### End Loading</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;top_k&#39;</span><span class="p">:</span>
            <span class="n">sorted_df</span><span class="o">=</span><span class="n">feature_table</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">top_featureids</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">sorted_df</span><span class="p">[</span><span class="s1">&#39;#OTU ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">treshold</span><span class="p">))</span>
            <span class="n">top_taxa</span><span class="o">=</span><span class="p">[</span><span class="n">taxonomy_table</span><span class="p">[</span><span class="n">taxonomy_table</span><span class="p">[</span><span class="s1">&#39;Feature ID&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">featureid</span><span class="p">][</span><span class="s1">&#39;Taxon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">featureid</span> <span class="ow">in</span> <span class="n">top_featureids</span><span class="p">]</span>
            <span class="n">top_repseqs</span><span class="o">=</span><span class="p">[</span><span class="n">repseqs</span><span class="p">[</span><span class="n">featureid</span><span class="p">]</span> <span class="k">for</span> <span class="n">featureid</span> <span class="ow">in</span> <span class="n">top_featureids</span><span class="p">]</span>
            <span class="n">top_abundances</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">sorted_df</span><span class="p">[</span><span class="n">sample_name</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">treshold</span><span class="p">)</span><span class="o">/</span><span class="n">sorted_df</span><span class="p">[</span><span class="n">sample_name</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;percentile&#39;</span><span class="p">:</span>
            <span class="n">feature_table</span><span class="p">[</span><span class="n">sample_name</span><span class="p">]</span><span class="o">=</span><span class="n">feature_table</span><span class="p">[</span><span class="n">sample_name</span><span class="p">]</span><span class="o">/</span><span class="n">feature_table</span><span class="p">[</span><span class="n">sample_name</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">sorted_df</span><span class="o">=</span><span class="n">feature_table</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">sorted_df</span><span class="p">[</span><span class="s1">&#39;cumsum&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sorted_df</span><span class="p">[</span><span class="n">sample_name</span><span class="p">]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span>
            <span class="n">sorted_df_filtered</span><span class="o">=</span><span class="n">sorted_df</span><span class="p">[</span><span class="n">sorted_df</span><span class="p">[</span><span class="s1">&#39;cumsum&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">treshold</span><span class="p">]</span>
            <span class="n">top_featureids</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">sorted_df_filtered</span><span class="p">[</span><span class="s1">&#39;#OTU ID&#39;</span><span class="p">])</span>
            <span class="n">top_taxa</span><span class="o">=</span><span class="p">[</span><span class="n">taxonomy_table</span><span class="p">[</span><span class="n">taxonomy_table</span><span class="p">[</span><span class="s1">&#39;Feature ID&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">featureid</span><span class="p">][</span><span class="s1">&#39;Taxon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">featureid</span> <span class="ow">in</span> <span class="n">top_featureids</span><span class="p">]</span>
            <span class="n">top_repseqs</span><span class="o">=</span><span class="p">[</span><span class="n">repseqs</span><span class="p">[</span><span class="n">featureid</span><span class="p">]</span> <span class="k">for</span> <span class="n">featureid</span> <span class="ow">in</span> <span class="n">top_featureids</span><span class="p">]</span>
            <span class="n">top_abundances</span><span class="o">=</span><span class="n">sorted_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sorted_df_filtered</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="n">sample_name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;mode must be either &#39;top_k&#39; or &#39;percentile&#39;&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;top_featureids&#39;</span><span class="p">:</span><span class="n">top_featureids</span><span class="p">,</span><span class="s1">&#39;top_taxa&#39;</span><span class="p">:</span><span class="n">top_taxa</span><span class="p">,</span><span class="s1">&#39;top_repseqs&#39;</span><span class="p">:</span><span class="n">top_repseqs</span><span class="p">,</span><span class="s1">&#39;top_abundances&#39;</span><span class="p">:</span><span class="n">top_abundances</span><span class="p">}</span>    


    <span class="k">def</span> <span class="nf">align_to_gtdb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">query_dir</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
                      <span class="n">output_dir</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
                      <span class="n">container</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;This function takes the representative sequences of the top k features and generates the script to</span>
<span class="sd">        align these feature sequences to gtdb using VSEARCH. If you intend to run this you either</span>
<span class="sd">        need to have VSEARCH installed or run it with a container option. You can use either the docker or singularity</span>
<span class="sd">        as container options. Otherwise you can use None and run it with the assumption that VSEARCH is installed.</span>
<span class="sd">        If you only want the script and not to run it, set run to False.</span>

<span class="sd">        Required Configs:</span>

<span class="sd">            ---------</span>
<span class="sd">            config.gtdb_dir_fasta: The path to the gtdb fasta database.</span>
<span class="sd">            ---------</span>
<span class="sd">            config.vsearch_similarity: The similarity threshold for the alignment to be used by VSEARCH.</span>
<span class="sd">            ---------</span>
<span class="sd">            config.vsearch_threads: The number of threads to be used by VSEARCH.</span>
<span class="sd">            ---------</span>
<span class="sd">            config.adtoolbox_docker: The name of the docker image to be used by ADToolbox (Only if using Docker as container).</span>
<span class="sd">            ---------</span>
<span class="sd">            config.adtoolbox_singularity: The name of the singularity image to be used by ADToolbox (Only if using Singularity as container).</span>
<span class="sd">            ---------</span>
<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import os</span>
<span class="sd">            &gt;&gt;&gt; query_dir=os.path.join(Main_Dir,&quot;test&quot;,&quot;query.fa&quot;)</span>
<span class="sd">            &gt;&gt;&gt; output_dir=os.path.join(Main_Dir,&quot;test&quot;)</span>
<span class="sd">            &gt;&gt;&gt; conf=configs.Metagenomics(vsearch_similarity=0.8)</span>
<span class="sd">            &gt;&gt;&gt; conf.gtdb_dir_fasta=(os.path.join(Main_Dir,&quot;db.fa&quot;))</span>
<span class="sd">            &gt;&gt;&gt; obj = Metagenomics(conf) </span>
<span class="sd">            &gt;&gt;&gt; assert obj.align_to_gtdb(query_dir, output_dir, container=&quot;docker&quot;)[0] == f&#39;docker run -v {output_dir}:{output_dir} -v {conf.gtdb_dir_fasta}:{conf.gtdb_dir_fasta} -v {query_dir}:{query_dir} parsaghadermazi/adtoolbox:x86 vsearch --top_hits_only --blast6out {output_dir}/matches.blast --usearch_global {query_dir} --db {conf.gtdb_dir_fasta} --id {conf.vsearch_similarity} --threads 4 --alnout {output_dir}/Alignments --top_hits_only\n&#39;</span>

<span class="sd">        Args:</span>
<span class="sd">            container (str, optional): The container to use. Defaults to &quot;None&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The script that is supposed to be running later.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">### Load all the required files</span>
        <span class="n">alignment_dir</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span><span class="s1">&#39;Alignments&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">absolute</span><span class="p">())</span>
        <span class="n">match_table</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span><span class="s1">&#39;matches.blast&#39;</span><span class="p">)))</span>
        <span class="n">gtdb_dir_fasta</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">gtdb_dir_fasta</span><span class="p">))</span>
        <span class="c1">### End Loading</span>
        <span class="n">query</span><span class="o">=</span><span class="n">query_dir</span>
        <span class="n">dirs</span><span class="o">=</span><span class="p">[</span><span class="n">output_dir</span><span class="p">,</span>
            <span class="n">gtdb_dir_fasta</span><span class="p">,</span>
            <span class="n">query</span>
            <span class="p">]</span>
        <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;None&quot;</span><span class="p">:</span>
            <span class="n">bash_script</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;vsearch --top_hits_only --blast6out &#39;</span><span class="o">+</span>
                        <span class="n">match_table</span><span class="o">+</span>
                        <span class="s1">&#39; --usearch_global &#39;</span><span class="o">+</span> <span class="n">query</span> <span class="o">+</span>
                        <span class="s1">&#39; --db &#39;</span><span class="o">+</span> <span class="n">gtdb_dir_fasta</span> <span class="o">+</span>
                        <span class="s1">&#39; --id &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">vsearch_similarity</span><span class="p">)</span> <span class="o">+</span>
                        <span class="s1">&#39; --threads &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">vsearch_threads</span><span class="p">)</span><span class="o">+</span>
                        <span class="s1">&#39; --alnout &#39;</span><span class="o">+</span> <span class="n">alignment_dir</span> <span class="o">+</span>
                        <span class="s1">&#39; --top_hits_only&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;docker&quot;</span><span class="p">:</span>
            <span class="n">bash_script</span><span class="o">=</span><span class="s1">&#39;docker run &#39;</span>
            <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
                <span class="n">bash_script</span><span class="o">+=</span><span class="p">(</span><span class="s1">&#39;-v &#39;</span><span class="o">+</span><span class="nb">dir</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="nb">dir</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

            <span class="n">bash_script</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adtoolbox_docker</span><span class="o">+</span><span class="s1">&#39; vsearch --top_hits_only --blast6out &#39;</span><span class="o">+</span>
                        <span class="n">match_table</span><span class="o">+</span>
                        <span class="s1">&#39; --usearch_global &#39;</span><span class="o">+</span> <span class="n">query</span> <span class="o">+</span>
                        <span class="s1">&#39; --db &#39;</span><span class="o">+</span> <span class="n">gtdb_dir_fasta</span> <span class="o">+</span>
                        <span class="s1">&#39; --id &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">vsearch_similarity</span><span class="p">)</span> <span class="o">+</span>
                        <span class="s1">&#39; --threads &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">vsearch_threads</span><span class="p">)</span><span class="o">+</span>
                        <span class="s1">&#39; --alnout &#39;</span><span class="o">+</span> <span class="n">alignment_dir</span> <span class="o">+</span>
                        <span class="s1">&#39; --top_hits_only&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;singularity&quot;</span><span class="p">:</span>
            <span class="n">bash_script</span><span class="o">=</span><span class="s1">&#39;singularity exec &#39;</span>
            <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
                <span class="n">bash_script</span><span class="o">+=</span><span class="p">(</span><span class="s1">&#39;-B &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

            <span class="n">bash_script</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adtoolbox_singularity</span><span class="o">+</span><span class="s1">&#39; vsearch --top_hits_only --blast6out &#39;</span><span class="o">+</span>
                        <span class="n">match_table</span><span class="o">+</span>
                        <span class="s1">&#39; --usearch_global &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="p">)</span> <span class="o">+</span>
                        <span class="s1">&#39; --db &#39;</span><span class="o">+</span> <span class="n">gtdb_dir_fasta</span> <span class="o">+</span>
                        <span class="s1">&#39; --id &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">vsearch_similarity</span><span class="p">)</span> <span class="o">+</span>
                        <span class="s1">&#39; --threads &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">vsearch_threads</span><span class="p">)</span><span class="o">+</span>
                        <span class="s1">&#39; --alnout &#39;</span><span class="o">+</span> <span class="n">alignment_dir</span> <span class="o">+</span>
                        <span class="s1">&#39; --top_hits_only&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bash_script</span><span class="p">,</span>



    <span class="k">def</span> <span class="nf">get_genomes_from_gtdb_alignment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">alignment_dir</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;This function takes the alignment file generated from the align_to_gtdb function and generates the the genome information</span>
<span class="sd">        using the GTDB-Tk. In the outputted dictionary, the keys are feature ids and the values are the representative genomes.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import os</span>
<span class="sd">            &gt;&gt;&gt; alignments=[&quot;0034e3d0368ec41aeb7f346b434f8d46&quot;,&quot;GB_GCA_937889405.1~CALAPC010000121.1&quot;,&quot;100.0&quot;,&quot;253&quot;,&quot;0&quot;,&quot;0&quot;	,&quot;1&quot;,&quot;253&quot;,	&quot;1&quot;,&quot;1009&quot;,	&quot;-1&quot;,&quot;0&quot;]</span>
<span class="sd">            &gt;&gt;&gt; hit=&quot;\t&quot;.join(alignments)</span>
<span class="sd">            &gt;&gt;&gt; output= os.path.join(Main_Dir,&quot;test&quot;,&quot;matches.blast&quot;)</span>
<span class="sd">            &gt;&gt;&gt; with open(output,&quot;w&quot;) as f:</span>
<span class="sd">            ...    f.write(hit)</span>
<span class="sd">            101</span>
<span class="sd">            &gt;&gt;&gt; obj=Metagenomics(configs.Metagenomics())</span>
<span class="sd">            &gt;&gt;&gt; obj.get_genomes_from_gtdb_alignment(output)</span>
<span class="sd">            {&#39;0034e3d0368ec41aeb7f346b434f8d46&#39;: &#39;GCA_937889405.1&#39;}</span>


<span class="sd">        Args:</span>
<span class="sd">            save (bool, optional): Whether to save the json file or not. Defaults to True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">alignment_dir</span><span class="p">)</span>
        <span class="n">aligned</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">matches</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">aligned</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">aligned</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">aligned</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">alignment_dict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">aligned</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">aligned</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">alignment_dict</span>


    <span class="k">def</span> <span class="nf">download_genome</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">identifier</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">output_dir</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">container</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;This function downloads the genomes from NCBI using the refseq/genbank identifiers.</span>
<span class="sd">        Note that this function uses rsync to download the genomes. </span>

<span class="sd">        Required Configs:</span>
<span class="sd">            config.genomes_base_dir: The path to the base directory where the genomes will be saved.</span>
<span class="sd">            ---------</span>
<span class="sd">            config.adtoolbox_docker: The name of the docker image to be used by ADToolbox (Only if using Docker as container).</span>
<span class="sd">            ---------</span>
<span class="sd">            config.adtoolbox_singularity: The name of the singularity image to be used by ADToolbox (Only if using Singularity as container).</span>
<span class="sd">            ---------</span>
<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import os </span>
<span class="sd">            &gt;&gt;&gt; genome_identifier=&quot;GCA_937889405.1&quot;</span>
<span class="sd">            &gt;&gt;&gt; output=os.path.join(Main_Dir,&quot;test&quot;)</span>
<span class="sd">            &gt;&gt;&gt; obj = Metagenomics(configs.Metagenomics()) </span>
<span class="sd">            &gt;&gt;&gt; assert obj.download_genome(identifier=genome_identifier,output_dir= output)[0] == &#39;rsync -avz --progress rsync://ftp.ncbi.nlm.nih.gov/genomes/all/GCA/937/889/405 &#39;+output</span>

<span class="sd">        Args:</span>
<span class="sd">            identifier list[str]: The list of identifiers for the genomes. It can be either refseq or genbank.</span>
<span class="sd">            container (str, optional): The container to use. Defaults to &quot;None&quot;. You may select from &quot;None&quot;, &quot;docker&quot;, &quot;singularity&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The bash script that is used to download the genomes or to be used to download the genomes.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">base_ncbi_dir</span> <span class="o">=</span> <span class="s1">&#39;rsync://ftp.ncbi.nlm.nih.gov/genomes/all/&#39;</span>
        <span class="n">bash_script</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
        <span class="n">identifier</span><span class="o">=</span><span class="n">identifier</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">specific_ncbi_dir</span> <span class="o">=</span> <span class="n">identifier</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span>\
                            <span class="n">identifier</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span>\
                            <span class="n">identifier</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span>\
                            <span class="n">identifier</span><span class="p">[</span><span class="mi">9</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">genome_dir</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;None&quot;</span><span class="p">:</span>
            <span class="n">bash_script</span><span class="o">+=</span><span class="p">(</span><span class="s1">&#39;rsync -avz --progress &#39;</span><span class="o">+</span><span class="n">base_ncbi_dir</span><span class="o">+</span><span class="n">specific_ncbi_dir</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">genome_dir</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;docker&quot;</span><span class="p">:</span>
            <span class="n">bash_script</span><span class="o">+=</span><span class="p">(</span><span class="s1">&#39;docker run -v &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">genome_dir</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">genome_dir</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">+</span> <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adtoolbox_docker</span><span class="si">}</span><span class="s1"> rsync -avz --progress &#39;</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">base_ncbi_dir</span><span class="o">+</span><span class="n">specific_ncbi_dir</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">genome_dir</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;singularity&quot;</span><span class="p">:</span>
            <span class="n">bash_script</span><span class="o">+=</span><span class="p">(</span><span class="s1">&#39;singularity exec -B &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">genome_dir</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">genome_dir</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">+</span> <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adtoolbox_singularity</span><span class="si">}</span><span class="s1"> rsync -avz --progress &#39;</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">base_ncbi_dir</span><span class="o">+</span><span class="n">specific_ncbi_dir</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">genome_dir</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">bash_script</span><span class="p">,</span>

    <span class="k">def</span> <span class="nf">async_genome_downloader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">identifiers</span><span class="p">:</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span><span class="n">batch_size</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">container</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">):</span>
        <span class="n">sem</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_collect_coros</span><span class="p">(</span><span class="n">identifiers</span><span class="o">=</span><span class="n">identifiers</span><span class="p">,</span><span class="n">semaphore</span><span class="o">=</span><span class="n">sem</span><span class="p">,</span><span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">))</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_collect_coros</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">identifiers</span><span class="p">:</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span><span class="n">semaphore</span><span class="p">:</span><span class="n">asyncio</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">,</span><span class="n">container</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">):</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_genome_dl_coro</span><span class="p">(</span><span class="n">identifier</span><span class="o">=</span><span class="n">i</span><span class="p">,</span><span class="n">semaphore</span><span class="o">=</span><span class="n">semaphore</span><span class="p">,</span><span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">identifiers</span><span class="p">])</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_genome_dl_coro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">identifier</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">semaphore</span><span class="p">:</span><span class="n">asyncio</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">,</span><span class="n">container</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">semaphore</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_subprocess_exec</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">download_genome</span><span class="p">(</span><span class="n">identifier</span><span class="o">=</span><span class="n">identifier</span><span class="p">,</span><span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">extract_genome_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">base_dir</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
                            <span class="n">endpattern</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;genomic.fna.gz&quot;</span><span class="p">,</span>
                            <span class="n">filters</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="p">{</span>
                                          <span class="s2">&quot;INCLUDE&quot;</span><span class="p">:[],</span>
                                          <span class="s2">&quot;EXCLUDE&quot;</span><span class="p">:[</span><span class="s2">&quot;cds&quot;</span><span class="p">,</span><span class="s2">&quot;rna&quot;</span><span class="p">],</span>
                                            <span class="p">})</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;This function extracts the genome information from the genomes base directory. The output</span>
<span class="sd">        is a dictionary where the keys are the genome IDs and the values are the paths to the genome files.</span>

<span class="sd">        Required Configs:</span>
<span class="sd">            None</span>
<span class="sd">        ---------</span>
<span class="sd">        Args:</span>
<span class="sd">            base_dir (str): The path to the base directory where the genomes are saved.</span>
<span class="sd">            endpattern (str, optional): The end pattern of the genome files. Defaults to &quot;genomic.fna.gz&quot;.</span>
<span class="sd">            filters (dict, optional): The filters to be applied to the genome files. This filter must be a </span>
<span class="sd">            dictionary with two keys: INCLUDE and EXCLUDE. The values of these keys must be lists of strings.</span>
<span class="sd">            Defaults to {&quot;INCLUDE&quot;:[],&quot;EXCLUDE&quot;:[&quot;cds&quot;,&quot;rna&quot;]}. This defult is compatible with the genomes downloaded</span>
<span class="sd">            from NCBI i.e. only change this if you are providing your own genomes with different file name conventions.</span>
<span class="sd">        Returns:</span>
<span class="sd">            dict[str,str]: A dictionary containing the address of the genomes that are downloaded or to be downloaded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">base_dir</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">base_dir</span><span class="p">)</span>
        <span class="n">genome_info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">genome_dir</span> <span class="ow">in</span> <span class="n">base_dir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">genome_dir</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
                <span class="n">candids</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">genome_dir</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;*</span><span class="si">{</span><span class="n">endpattern</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">candid</span> <span class="ow">in</span> <span class="n">candids</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">i</span> <span class="ow">in</span> <span class="n">candid</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;INCLUDE&quot;</span><span class="p">]])</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">([</span><span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">candid</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;EXCLUDE&quot;</span><span class="p">]]):</span>
                        <span class="n">genome_info</span><span class="p">[</span><span class="n">candid</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_genomic.fna.gz&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">candid</span><span class="o">.</span><span class="n">absolute</span><span class="p">())</span>           
        <span class="k">return</span> <span class="n">genome_info</span>

    <span class="k">def</span> <span class="nf">align_genome_to_protein_db</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">address</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">outdir</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">container</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
            <span class="p">)</span><span class="o">-&gt;</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is a function that will align a genome to the Protein Database of the ADToolbox using mmseqs2.</span>
<span class="sd">        If you want to save the scripts, set save to True. Note that the alignment tables will be saved in any case.</span>
<span class="sd">        Note that this function uses mmseqs2 to align the genomes to the protein database. So, to run this function without</span>
<span class="sd">        any container you need to have mmseqs2 installed on your system. However, if you want to run this function with a container,</span>
<span class="sd">        you need to have the container installed on your system. You may select from &quot;None&quot;, &quot;docker&quot;, &quot;singularity&quot;.</span>

<span class="sd">        Requires:</span>
<span class="sd">            config.protein_db: The address of the protein database of the ADToolbox.</span>
<span class="sd">            ---------</span>
<span class="sd">            config.adtoolbox_docker: The name of the docker image to be used by ADToolbox (Only if using Docker as container).</span>
<span class="sd">            ---------</span>
<span class="sd">            config.adtoolbox_singularity: The name of the singularity image to be used by ADToolbox (Only if using Singularity as container).</span>
<span class="sd">            ---------</span>
<span class="sd">        Example: </span>
<span class="sd">            &gt;&gt;&gt; import os</span>
<span class="sd">            &gt;&gt;&gt; output=os.path.join(Main_Dir,&quot;test&quot;)</span>
<span class="sd">            &gt;&gt;&gt; address=os.path.join(Main_Dir,&quot;test&quot;,&quot;genome_sequence.fa&quot;)</span>
<span class="sd">            &gt;&gt;&gt; obj = Metagenomics(configs.Metagenomics()) </span>
<span class="sd">            &gt;&gt;&gt; name=&quot;test_align&quot;</span>
<span class="sd">            &gt;&gt;&gt; assert obj.align_genome_to_protein_db(address=address,outdir=output,name=name,container=&quot;docker&quot;)[0].split(&quot; &quot;)==[&#39;docker&#39;, &#39;run&#39;, &#39;&#39;, &#39;-v&#39;, address+&#39;:&#39;+address, &#39;-v&#39;, configs.Database().protein_db+&#39;:&#39;+configs.Database().protein_db, &#39;-v&#39;, output+&#39;:&#39;+output, &#39;parsaghadermazi/adtoolbox:x86&#39;, &#39;&#39;, &#39;mmseqs&#39;, &#39;easy-search&#39;, address, configs.Database().protein_db, output+&#39;/Alignment_Results_mmseq_test_align.tsv&#39;, &#39;tmpfiles&#39;, &#39;--format-mode&#39;, &#39;4&#39;, &#39;\n\n&#39;]</span>

<span class="sd">        Args:</span>
<span class="sd">            address (str): The address of the genome to be aligned.</span>
<span class="sd">            outdir (str): The output directory where the alignment files will be saved.</span>
<span class="sd">            name (str): The name of the genome.</span>
<span class="sd">            container (str, optional): The container to use. Defaults to &quot;None&quot;. You may select from &quot;None&quot;, &quot;docker&quot;, &quot;singularity&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: A dictionary containing the alignment files.</span>
<span class="sd">            str: The bash script that is used to align the genomes or to be used to align the genomes.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;None&quot;</span><span class="p">:</span>
            <span class="n">bash_script</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">alignment_file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span><span class="s2">&quot;Alignment_Results_mmseq_&quot;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;.tsv&quot;</span><span class="p">)</span>
            <span class="n">bash_script</span> <span class="o">+=</span> <span class="s2">&quot;mmseqs easy-search &quot;</span> <span class="o">+</span> \
                <span class="n">address</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> \
                <span class="n">alignment_file</span><span class="o">+</span> <span class="s1">&#39; tmp --format-mode 4 &#39;</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;docker&quot;</span><span class="p">:</span>
            <span class="n">bash_script</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">alignment_file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span><span class="s2">&quot;Alignment_Results_mmseq_&quot;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;.tsv&quot;</span><span class="p">)</span>
            <span class="n">bash_script</span> <span class="o">+=</span><span class="s2">&quot;docker run &quot;</span><span class="o">+</span> \
            <span class="s2">&quot; -v &quot;</span><span class="o">+</span><span class="n">address</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="n">address</span><span class="o">+</span> \
            <span class="s2">&quot; -v &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="o">+</span> \
            <span class="s2">&quot; -v &quot;</span><span class="o">+</span><span class="n">outdir</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="n">outdir</span><span class="o">+</span> \
            <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adtoolbox_docker</span><span class="si">}</span><span class="s2">  mmseqs easy-search &quot;</span> <span class="o">+</span> \
                <span class="n">address</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> \
                <span class="n">alignment_file</span><span class="o">+</span><span class="s1">&#39; tmpfiles --format-mode 4 &#39;</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;singularity&quot;</span><span class="p">:</span>
            <span class="n">bash_script</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">alignment_file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span><span class="s2">&quot;Alignment_Results_mmseq_&quot;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;.tsv&quot;</span><span class="p">)</span>
            <span class="n">bash_script</span> <span class="o">+=</span><span class="s2">&quot;singularity exec &quot;</span><span class="o">+</span> \
            <span class="s2">&quot; -B &quot;</span><span class="o">+</span><span class="n">address</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="n">address</span><span class="o">+</span> \
            <span class="s2">&quot; -B &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="o">+</span> \
            <span class="s2">&quot; -B &quot;</span><span class="o">+</span><span class="n">outdir</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="n">outdir</span><span class="o">+</span> \
            <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adtoolbox_singularity</span><span class="si">}</span><span class="s2">  mmseqs easy-search &quot;</span> <span class="o">+</span> \
                <span class="n">address</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> \
                <span class="n">alignment_file</span><span class="o">+</span><span class="s1">&#39; tmpfiles --format-mode 4 &#39;</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span>

        <span class="k">return</span>  <span class="n">bash_script</span><span class="p">,</span><span class="n">alignment_file</span>

    <span class="k">def</span> <span class="nf">align_short_reads_to_protein_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">query_seq</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
                                        <span class="n">alignment_file_name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
                                        <span class="n">container</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
                                        <span class="p">)</span><span class="o">-&gt;</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;This function aligns shotgun short reads to the protein database of the ADToolbox using mmseqs2.</span>
<span class="sd">        mmseqs wrappers in utils are used to perform this task. The result of this task is an alignment table.</span>

<span class="sd">        Required Configs:</span>

<span class="sd">            protein_db_mmseqs (str): The address of the existing/to be created protein database of the ADToolbox for mmseqs.</span>
<span class="sd">            --------</span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; import os</span>
<span class="sd">            &gt;&gt;&gt; query_seq= os.path.join(Main_Dir,&quot;test&quot;,&quot;query.seq&quot;)</span>
<span class="sd">            &gt;&gt;&gt; alignment_file= &quot;output_alignment.txt&quot;</span>
<span class="sd">            &gt;&gt;&gt; protein_db_mmseqs=os.path.join(Main_Dir,&quot;test&quot;,&quot;protein_db_mmseqs&quot;)</span>
<span class="sd">            &gt;&gt;&gt; with open(protein_db_mmseqs,&#39;w&#39;) as f:</span>
<span class="sd">            ...     f.write(&quot;&quot;)</span>
<span class="sd">            0</span>
<span class="sd">            &gt;&gt;&gt; obj = Metagenomics(configs.Metagenomics(protein_db_mmseqs=protein_db_mmseqs)) </span>
<span class="sd">            &gt;&gt;&gt; assert obj.align_short_reads_to_protein_db(query_seq=query_seq, alignment_file_name= protein_db_mmseqs, container=&quot;docker&quot;)[0] == &#39;docker run -v /home/parsa/ADresearch/test/query.seq:/home/parsa/ADresearch/test/query.seq -v /home/parsa/ADresearch/test:/home/parsa/ADresearch/test parsaghadermazi/adtoolbox:x86 mmseqs createdb /home/parsa/ADresearch/test/query.seq /home/parsa/ADresearch/test/query\ndocker run -v /home/parsa/ADresearch/test/query:/home/parsa/ADresearch/test/query -v /home/parsa/ADresearch/test:/home/parsa/ADresearch/test -v /home/parsa/ADresearch/test/protein_db_mmseqs:/home/parsa/ADresearch/test/protein_db_mmseqs parsaghadermazi/adtoolbox:x86 mmseqs search /home/parsa/ADresearch/test/query /home/parsa/ADresearch/test/protein_db_mmseqs /home/parsa/ADresearch/test/protein_db_mmseqs /home/parsa/ADresearch/test/tmp\ndocker run -v /home/parsa/ADresearch/test/query:/home/parsa/ADresearch/test/query -v /home/parsa/ADresearch/test:/home/parsa/ADresearch/test -v /home/parsa/ADresearch/test/protein_db_mmseqs:/home/parsa/ADresearch/test/protein_db_mmseqs parsaghadermazi/adtoolbox:x86 mmseqs convertalis /home/parsa/ADresearch/test/query /home/parsa/ADresearch/test/protein_db_mmseqs /home/parsa/ADresearch/test/protein_db_mmseqs /home/parsa/ADresearch/test/protein_db_mmseqs.tsv --format-mode 4\n&#39;</span>
<span class="sd">            &gt;&gt;&gt; os.remove(protein_db_mmseqs)</span>

<span class="sd">        Args:</span>
<span class="sd">            query_seq (str): The address of the query sequence.</span>
<span class="sd">            alignment_file_name (str): The name of the alignment file.</span>
<span class="sd">            container (str, optional): The container to use. Defaults to &quot;None&quot;. You may select from &quot;None&quot;, &quot;docker&quot;, &quot;singularity&quot;.</span>


<span class="sd">        Returns:</span>
<span class="sd">            str: The bash script that is used to align the genomes or to be used to align the genomes.</span>
<span class="sd">            str: The address of the alignment file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db_mmseqs</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;The protein database of the ADToolbox for mmseqs is not found. Please build it first</span>
<span class="s2">                                    using Database.build_mmseqs_database method.&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">path_query</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">query_seq</span><span class="p">)</span>
        <span class="n">script</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">script</span> <span class="o">+=</span> <span class="n">create_mmseqs_database</span><span class="p">(</span><span class="n">query_seq</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">path_query</span><span class="o">.</span><span class="n">parent</span><span class="o">/</span><span class="n">path_query</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span><span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">run</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">script</span> <span class="o">+=</span> <span class="n">mmseqs_search</span><span class="p">(</span>
            <span class="n">query_db</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">path_query</span><span class="o">.</span><span class="n">parent</span><span class="o">/</span><span class="n">path_query</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="n">target_db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db_mmseqs</span><span class="p">,</span>
            <span class="n">results_db</span><span class="o">=</span><span class="n">path_query</span><span class="o">.</span><span class="n">parent</span><span class="o">/</span><span class="n">alignment_file_name</span><span class="p">,</span>
            <span class="n">run</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">save</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
        <span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">script</span> <span class="o">+=</span> <span class="n">mmseqs_result_db_to_tsv</span><span class="p">(</span>
            <span class="n">query_db</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">path_query</span><span class="o">.</span><span class="n">parent</span><span class="o">/</span><span class="n">path_query</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="n">target_db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db_mmseqs</span><span class="p">,</span>
            <span class="n">results_db</span><span class="o">=</span><span class="n">path_query</span><span class="o">.</span><span class="n">parent</span><span class="o">/</span><span class="n">alignment_file_name</span><span class="p">,</span>
            <span class="n">tsv_file</span><span class="o">=</span><span class="n">path_query</span><span class="o">.</span><span class="n">parent</span><span class="o">/</span><span class="p">(</span><span class="n">alignment_file_name</span><span class="o">+</span><span class="s2">&quot;.tsv&quot;</span><span class="p">),</span>
            <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
            <span class="n">save</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">run</span><span class="o">=</span><span class="kc">False</span><span class="p">,)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">script</span><span class="p">,</span><span class="n">path_query</span><span class="o">.</span><span class="n">parent</span><span class="o">/</span><span class="p">(</span><span class="n">alignment_file_name</span><span class="o">+</span><span class="s2">&quot;.tsv&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">extract_ec_from_alignment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">alignment_file</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">int</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function extracts the number of times an EC number is found in the alignment file when aligned to ADToolbox protein database.</span>

<span class="sd">        Required Configs:</span>
<span class="sd">            config.e_value: The e-value threshold for the filtering the alignment table.</span>
<span class="sd">            ---------</span>
<span class="sd">            config.bit_score: The bit score threshold for the filtering the alignment table.</span>
<span class="sd">            ---------</span>
<span class="sd">            config.ec_counts_from_alignment: The address of the json file that the results will be saved in.</span>
<span class="sd">            ---------</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; import os</span>
<span class="sd">            &gt;&gt;&gt; output = os.path.join(Main_Dir, &quot;test&quot;, &quot;mmseqs_alignments.tsv&quot;)</span>
<span class="sd">            &gt;&gt;&gt; alignments = [&quot;CP001673.1&quot;, &quot;Q8YNF9|1.4.4.2&quot;, &quot;0.566&quot;, &quot;2859&quot;, &quot;414&quot;, &quot;0&quot;, &quot;1021521&quot;, &quot;1024379&quot;, &quot;27&quot;, &quot;982&quot;, &quot;0.000E+00&quot;, &quot;1109&quot;]</span>
<span class="sd">            &gt;&gt;&gt; headers = [&quot;query&quot;, &quot;target&quot;, &quot;fident&quot;, &quot;alnlen&quot;, &quot;mismatch&quot;, &quot;gapopen&quot;, &quot;qstart&quot;, &quot;qend &quot;, &quot;tstart&quot;, &quot;tend&quot;, &quot;evalue&quot;, &quot;bits&quot;]</span>
<span class="sd">            &gt;&gt;&gt; hit = &quot;\t&quot;.join(alignments)</span>
<span class="sd">            &gt;&gt;&gt; headers_tab = &quot;\t&quot;.join(headers)</span>
<span class="sd">            &gt;&gt;&gt; combine = headers_tab + &quot;\n&quot; + hit</span>
<span class="sd">            &gt;&gt;&gt; with open(output, &quot;w&quot;) as f:</span>
<span class="sd">            ...     f.write(combine)</span>
<span class="sd">            161</span>
<span class="sd">            &gt;&gt;&gt; obj = Metagenomics(configs.Metagenomics())</span>
<span class="sd">            &gt;&gt;&gt; obj.extract_ec_from_alignment(output) </span>
<span class="sd">            {&#39;1.4.4.2&#39;: 1}</span>

<span class="sd">        Args:</span>
<span class="sd">            alignment_file (str): The address of the alignment file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary of EC numbers and their counts.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span><span class="o">=</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">scan_csv</span><span class="p">(</span><span class="n">alignment_file</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,)</span> 
        <span class="o">.</span><span class="n">filter</span><span class="p">((</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;evalue&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">e_value</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;bits&quot;</span><span class="p">)</span> <span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">bit_score</span><span class="p">))</span>
        <span class="o">.</span><span class="n">with_columns</span><span class="p">((</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;target&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split_exact</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">struct</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;EC&quot;</span><span class="p">)))</span>
        <span class="o">.</span><span class="n">unique</span><span class="p">([</span><span class="s2">&quot;query&quot;</span><span class="p">,</span><span class="s2">&quot;EC&quot;</span><span class="p">],</span><span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;EC&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">streaming</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">to_dicts</span><span class="p">())</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;EC&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_cod_from_ec_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ec_counts</span><span class="p">:</span><span class="nb">dict</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;This function takes a json file that comtains ec counts and converts it to ADM microbial agents counts.</span>
<span class="sd">        Required Configs:</span>
<span class="sd">            config.adm_mapping : A dictionary that maps ADM reactions to ADM microbial agents.</span>
<span class="sd">            ---------</span>
<span class="sd">            config.csv_reaction_db : The address of the reaction database of ADToolbox.</span>
<span class="sd">            ---------</span>
<span class="sd">            config.adm_cod_from_ec  : The address of the json file that the results will be saved in.</span>
<span class="sd">            ---------</span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; import os</span>
<span class="sd">            &gt;&gt;&gt; output = os.path.join(Main_Dir, &quot;test&quot;, &quot;cod_from_ec_counts&quot;)</span>
<span class="sd">            &gt;&gt;&gt; alignments = [&quot;CP001673.1&quot;, &quot;Q8YNF9|1.4.4.2&quot;, &quot;0.566&quot;, &quot;2859&quot;, &quot;414&quot;, &quot;0&quot;, &quot;1021521&quot;, &quot;1024379&quot;, &quot;27&quot;, &quot;982&quot;, &quot;0.000E+00&quot;, &quot;1109&quot;]</span>
<span class="sd">            &gt;&gt;&gt; headers = [&quot;query&quot;, &quot;target&quot;, &quot;fident&quot;, &quot;alnlen&quot;, &quot;mismatch&quot;, &quot;gapopen&quot;, &quot;qstart&quot;, &quot;qend &quot;, &quot;tstart&quot;, &quot;tend&quot;, &quot;evalue&quot;, &quot;bits&quot;]</span>
<span class="sd">            &gt;&gt;&gt; hit = &quot;\t&quot;.join(alignments)</span>
<span class="sd">            &gt;&gt;&gt; headers_tab = &quot;\t&quot;.join(headers)</span>
<span class="sd">            &gt;&gt;&gt; combine = headers_tab + &quot;\n&quot; + hit</span>
<span class="sd">            &gt;&gt;&gt; with open(output, &quot;w&quot;) as f:</span>
<span class="sd">            ...     f.write(combine)</span>
<span class="sd">            161</span>
<span class="sd">            &gt;&gt;&gt; obj = Metagenomics(configs.Metagenomics())</span>
<span class="sd">            &gt;&gt;&gt; obj.get_cod_from_ec_counts(output) </span>
<span class="sd">            [(&#39;ADM_microbe_1&#39;, 161), (&#39;ADM_microbe_2&#39;, 0), (&#39;ADM_microbe_3&#39;, 0)]</span>

<span class="sd">        Args:</span>
<span class="sd">            ec_counts (dict): A dictionary containing the counts for each ec number.  </span>
<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary containing the ADM microbial agents counts.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reaction_db</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">csv_reaction_db</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="s2">&quot;EC_Numbers&quot;</span><span class="p">)</span>
        <span class="n">reaction_db</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;EC_Numbers&quot;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">adm_reactions_agents</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="mi">0</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adm_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
        <span class="k">for</span> <span class="n">ec</span> <span class="ow">in</span> <span class="n">ec_counts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">l</span><span class="o">=</span><span class="n">reaction_db</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ec</span><span class="p">,</span><span class="s2">&quot;e_adm_Reactions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">adm_rxn</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span> 
                <span class="n">adm_reactions_agents</span><span class="p">[</span><span class="n">adm_rxn</span><span class="p">]</span><span class="o">+=</span><span class="n">ec_counts</span><span class="p">[</span><span class="n">ec</span><span class="p">]</span>
        <span class="n">adm_microbial_agents</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adm_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">adm_microbial_agents</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">=</span><span class="n">adm_reactions_agents</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">adm_microbial_agents</span>

    <span class="k">def</span> <span class="nf">calculate_group_abundances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">elements_feature_abundances</span><span class="p">:</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">dict</span><span class="p">],</span><span class="n">rel_abund</span><span class="p">:</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">dict</span><span class="p">])</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">float</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is defined to calculate the features for each sample given:</span>
<span class="sd">        1) The relative abundances of the genomes in each sample:</span>
<span class="sd">            - In this dictionary the keys are the sample names and the values are dictionaries where the keys are the genome names and the values are the relative abundances of the genomes in the sample.</span>
<span class="sd">        2) The relative abundances of the elements in each genome.</span>
<span class="sd">            - In this dictionary the keys are the genome names and the values are dictionaries where the keys are the element names and the values are the relative abundances of the elements in the genome.</span>

<span class="sd">        Required Configs:</span>
<span class="sd">            None</span>

<span class="sd">        Args:</span>
<span class="sd">            elements_feature_abundances (dict[str,dict]): A dictionary containing the relative abundances of the elements in each genome.</span>
<span class="sd">            rel_abund (dict[str,dict]): A dictionary containing the relative abundances of the genomes in each sample.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str,dict[str,float]]: A dictionary containing the relative abundances of the elements in each sample.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">elements_feature_abundances</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sample</span><span class="p">,</span><span class="n">abunds</span> <span class="ow">in</span> <span class="n">rel_abund</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">out</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span><span class="o">=</span><span class="n">scaler</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">abunds</span><span class="o">.</span><span class="n">keys</span><span class="p">(),:]</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">abunds</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">extract_relative_abundances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">feature_table_dir</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">sample_names</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span><span class="kc">None</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">top_k</span><span class="p">:</span><span class="nb">int</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">:</span>

        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method extracts the relative abundances of the features in each sample from the feature table. The feature table must follow the qiime2 feature-table format.</span>
<span class="sd">        NOTE: The final feature abundances sum to 1 for each sample.</span>
<span class="sd">        Required Configs:</span>
<span class="sd">            None</span>
<span class="sd">        Args:</span>
<span class="sd">            feature_table_dir (str): The path to the feature table.</span>
<span class="sd">            sample_names (Union[list[str],None], optional): The list of sample names. to be considered. If None, all the samples will be considered. Defaults to None.</span>
<span class="sd">            top_k (int, optional): The number of top features to be used. If -1, all the features will be used. Defaults to -1.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary containing the relative abundances of the features in each sample.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">feature_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">feature_table_dir</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sample_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sample_names</span> <span class="o">=</span> <span class="n">feature_table</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">relative_abundances</span><span class="o">=</span><span class="p">{</span><span class="n">sample</span><span class="p">:[]</span> <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">sample_names</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">top_k</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">top_k</span> <span class="o">=</span> <span class="n">feature_table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">sample_names</span><span class="p">:</span>
            <span class="n">relative_abundances</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">feature_table</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">top_k</span><span class="p">)[</span><span class="n">sample</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">feature_table</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">top_k</span><span class="p">)[</span><span class="n">sample</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">relative_abundances</span>

    <span class="k">def</span> <span class="nf">assign_ec_to_genome</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">alignment_file</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function takes an alignment file and assigns the EC numbers to the genomes based on the alignment file,</span>
<span class="sd">        and the e-adm groupings of the EC numbers. The output is a dictionary where the keys e-adm reactions and the values are the EC numbers,</span>
<span class="sd">        that are found in the genome and are grouped under the e-adm reaction.</span>

<span class="sd">        Example: </span>
<span class="sd">            &gt;&gt;&gt; import os</span>
<span class="sd">            &gt;&gt;&gt; output = os.path.join(Main_Dir, &quot;test&quot;, &quot;ec_to_genome&quot;)</span>
<span class="sd">            &gt;&gt;&gt; alignments = [&quot;CP001673.1&quot;, &quot;Q8YNF9|1.4.4.2&quot;, &quot;0.566&quot;, &quot;2859&quot;, &quot;414&quot;, &quot;0&quot;, &quot;1021521&quot;, &quot;1024379&quot;, &quot;27&quot;, &quot;982&quot;, &quot;0.000E+00&quot;, &quot;1109&quot;]</span>
<span class="sd">            &gt;&gt;&gt; headers = [&quot;query&quot;, &quot;target&quot;, &quot;fident&quot;, &quot;alnlen&quot;, &quot;mismatch&quot;, &quot;gapopen&quot;, &quot;qstart&quot;, &quot;qend &quot;, &quot;tstart&quot;, &quot;tend&quot;, &quot;evalue&quot;, &quot;bits&quot;]</span>
<span class="sd">            &gt;&gt;&gt; hit = &quot;\t&quot;.join(alignments)</span>
<span class="sd">            &gt;&gt;&gt; headers_tab = &quot;\t&quot;.join(headers)</span>
<span class="sd">            &gt;&gt;&gt; combine = headers_tab + &quot;\n&quot; + hit</span>
<span class="sd">            &gt;&gt;&gt; with open(output, &quot;w&quot;) as f:</span>
<span class="sd">            ...     f.write(combine)</span>
<span class="sd">            161</span>
<span class="sd">            &gt;&gt;&gt; obj = Metagenomics(configs.Metagenomics())</span>
<span class="sd">            &gt;&gt;&gt; obj.assign_ec_to_genome(output) </span>

<span class="sd">        Args:</span>
<span class="sd">            alignment_file (str): The address of the alignment file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary containing the e-adm reactions and the EC numbers that are found in the genome and are grouped under the e-adm reaction.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">aligntable</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">alignment_file</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">aligntable</span> <span class="o">=</span> <span class="n">aligntable</span><span class="p">[(</span><span class="n">aligntable</span><span class="p">[</span><span class="s2">&quot;bits&quot;</span><span class="p">]</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">bit_score</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">aligntable</span><span class="p">[</span><span class="s2">&quot;evalue&quot;</span><span class="p">]</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">e_value</span><span class="p">)]</span>

        <span class="n">ec_align_list</span> <span class="o">=</span> <span class="n">aligntable</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ec_align_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ec_align_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> 

        <span class="n">metadatatable</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">csv_reaction_db</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="s2">&quot;EC_Numbers&quot;</span><span class="p">)[([</span><span class="s1">&#39;EC_Numbers&#39;</span><span class="p">,</span><span class="s1">&#39;Modified_ADM_Reactions&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">metadatatable</span><span class="o">=</span><span class="n">metadatatable</span><span class="p">[</span><span class="n">metadatatable</span><span class="p">[</span><span class="s2">&quot;EC_Numbers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">ec_align_list</span><span class="p">)]</span>
        <span class="n">adm_reactions</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">metadatatable</span><span class="p">[</span><span class="s2">&quot;Modified_ADM_Reactions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>
        <span class="n">adm_to_ecs</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="n">adm_reactions</span><span class="p">:</span>
            <span class="n">adm_to_ecs</span><span class="p">[</span><span class="n">reaction</span><span class="p">]</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">metadatatable</span><span class="p">[</span><span class="n">metadatatable</span><span class="p">[</span><span class="s2">&quot;Modified_ADM_Reactions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">reaction</span><span class="p">)][</span><span class="s2">&quot;EC_Numbers&quot;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">adm_to_ecs</span>




    <span class="k">def</span> <span class="nf">seqs_from_sra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">accession</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">target_dir</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">container</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">dict</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        This method downloads the fastq files from the SRA database using the accession number (ONLY SAMPLE ACCESSION AND NOT PROJECT ACCESSION) of the project or run.</span>
<span class="sd">        The method uses the fasterq-dump tool to download the fastq files. This method also extracts the sample metadata from the SRA database for future use.</span>
<span class="sd">        #NOTE In order for this method to work without any container, you need to have the SRA toolkit installed on your system or</span>
<span class="sd">        at least have prefetch and fasterq-dump installed on your system. For more information on how to install the SRA toolkit, please refer to the following link:</span>
<span class="sd">        https://github.com/ncbi/sra-tools.</span>

<span class="sd">        Any additional keyword</span>

<span class="sd">        Required Configs:</span>
<span class="sd">            None</span>


<span class="sd">        Args:</span>
<span class="sd">            accession (str): The accession number of the SRA project or run</span>
<span class="sd">            target_dir (str): The directory where the fastq files will be downloaded</span>
<span class="sd">            container (str, optional): The containerization tool that will be used to run the bash scripts. Defaults to &quot;None&quot;. Options are &quot;None&quot;,&quot;docker&quot;,&quot;singularity&quot;</span>

<span class="sd">        Returns:</span>
<span class="sd">            prefetch_script (str): The bash script that will be used to download the SRA files in python string format</span>
<span class="sd">            sample_metadata (dict): A dictionary that contains the sample metadata</span>

<span class="sd">        &quot;&quot;&quot;</span>   
        <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;None&quot;</span><span class="p">:</span>
            <span class="n">prefetch_script</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;#!/bin/bash</span><span class="se">\n</span><span class="s2">prefetch </span><span class="si">{</span><span class="n">accession</span><span class="si">}</span><span class="s2"> -O </span><span class="si">{</span><span class="n">target_dir</span><span class="si">}</span><span class="s2"> --max-size 100000000</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>
            <span class="n">acc_folder</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">target_dir</span><span class="p">)</span><span class="o">/</span><span class="n">accession</span>
            <span class="n">fasterq_dump_script</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
            <span class="n">sra_file</span><span class="o">=</span><span class="n">acc_folder</span><span class="o">/</span><span class="p">(</span><span class="n">accession</span><span class="o">+</span><span class="s2">&quot;.sra&quot;</span><span class="p">)</span>
            <span class="n">fasterq_dump_script</span><span class="o">+=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">fasterq-dump </span><span class="si">{</span><span class="n">sra_file</span><span class="si">}</span><span class="s2"> -O </span><span class="si">{</span><span class="n">acc_folder</span><span class="si">}</span><span class="s2"> --split-files --temp </span><span class="si">{</span><span class="n">acc_folder</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">fasterq_dump_script</span><span class="o">+=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">rm </span><span class="si">{</span><span class="n">sra_file</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="n">prefetch_script</span><span class="o">+=</span><span class="n">fasterq_dump_script</span>


        <span class="k">elif</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;docker&quot;</span><span class="p">:</span>
            <span class="n">prefetch_script</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;&quot;&quot;&quot;</span>
            <span class="n">prefetch_script</span><span class="o">+=</span><span class="sa">f</span><span class="s2">&quot;docker run -v </span><span class="si">{</span><span class="n">target_dir</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">target_dir</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adtoolbox_docker</span><span class="si">}</span><span class="s2"> prefetch </span><span class="si">{</span><span class="n">accession</span><span class="si">}</span><span class="s2"> -O </span><span class="si">{</span><span class="n">target_dir</span><span class="si">}</span><span class="s2"> --max-size 100000000</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">acc_folder</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">target_dir</span><span class="p">)</span><span class="o">/</span><span class="n">accession</span>
            <span class="n">fasterq_dump_script</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
            <span class="n">sra_file</span><span class="o">=</span><span class="n">acc_folder</span><span class="o">/</span><span class="p">(</span><span class="n">accession</span><span class="o">+</span><span class="s2">&quot;.sra&quot;</span><span class="p">)</span>
            <span class="n">fasterq_dump_script</span><span class="o">+=</span><span class="sa">f</span><span class="s2">&quot;docker run -v </span><span class="si">{</span><span class="n">target_dir</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">target_dir</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adtoolbox_docker</span><span class="si">}</span><span class="s2"> fasterq-dump </span><span class="si">{</span><span class="n">sra_file</span><span class="si">}</span><span class="s2"> -O </span><span class="si">{</span><span class="n">acc_folder</span><span class="si">}</span><span class="s2"> --split-files --temp </span><span class="si">{</span><span class="n">acc_folder</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">fasterq_dump_script</span><span class="o">+=</span><span class="sa">f</span><span class="s2">&quot;docker run -v </span><span class="si">{</span><span class="n">target_dir</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">target_dir</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adtoolbox_docker</span><span class="si">}</span><span class="s2"> rm </span><span class="si">{</span><span class="n">sra_file</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">prefetch_script</span><span class="o">+=</span><span class="n">fasterq_dump_script</span>

        <span class="k">elif</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;singularity&quot;</span><span class="p">:</span>
            <span class="n">prefetch_script</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;&quot;&quot;&quot;</span>
            <span class="n">prefetch_script</span><span class="o">+=</span><span class="sa">f</span><span class="s2">&quot;singularity exec </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adtoolbox_singularity</span><span class="si">}</span><span class="s2"> prefetch </span><span class="si">{</span><span class="n">accession</span><span class="si">}</span><span class="s2"> -O </span><span class="si">{</span><span class="n">target_dir</span><span class="si">}</span><span class="s2"> --max-size 100000000</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">acc_folder</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">target_dir</span><span class="p">)</span><span class="o">/</span><span class="n">accession</span>
            <span class="n">fasterq_dump_script</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
            <span class="n">sra_file</span><span class="o">=</span><span class="n">acc_folder</span><span class="o">/</span><span class="p">(</span><span class="n">accession</span><span class="o">+</span><span class="s2">&quot;.sra&quot;</span><span class="p">)</span>
            <span class="n">fasterq_dump_script</span><span class="o">+=</span><span class="sa">f</span><span class="s2">&quot;singularity exec </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adtoolbox_singularity</span><span class="si">}</span><span class="s2"> fasterq-dump </span><span class="si">{</span><span class="n">sra_file</span><span class="si">}</span><span class="s2"> -O </span><span class="si">{</span><span class="n">acc_folder</span><span class="si">}</span><span class="s2"> --split-files --temp </span><span class="si">{</span><span class="n">acc_folder</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">fasterq_dump_script</span><span class="o">+=</span><span class="sa">f</span><span class="s2">&quot;singularity exec </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adtoolbox_singularity</span><span class="si">}</span><span class="s2"> rm </span><span class="si">{</span><span class="n">sra_file</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">prefetch_script</span><span class="o">+=</span><span class="n">fasterq_dump_script</span>

        <span class="n">sample_metadata</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">get_sample_metadata_from_accession</span><span class="p">(</span><span class="n">accession</span><span class="p">)</span>      


        <span class="k">return</span> <span class="n">prefetch_script</span><span class="p">,</span><span class="n">sample_metadata</span>     

    <span class="k">def</span> <span class="nf">merge_paired_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">read_1</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">read_2</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">outputfile</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">container</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot; This method merges the paired end reads using the fastp tool. Note that any additional keyword arguments will be passed to the fastp tool.   </span>
<span class="sd">        Required Configs:</span>
<span class="sd">            None</span>
<span class="sd">        Args:</span>
<span class="sd">            read_1 (str): The directory of the forward reads file.</span>
<span class="sd">            read_2 (str): The directory of the reverse reads file.</span>
<span class="sd">            outputfile (str): The directory of the output file.</span>
<span class="sd">            container (str, optional): The containerization tool that will be used to run the bash scripts. Defaults to &quot;None&quot;. Options are &quot;None&quot;,&quot;docker&quot;,&quot;singularity&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The bash script that will be used to merge the paired end reads in python string format</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;None&quot;</span><span class="p">:</span>
            <span class="n">bash_script</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;fastp -i </span><span class="si">{</span><span class="n">read_1</span><span class="si">}</span><span class="s2"> -I </span><span class="si">{</span><span class="n">read_2</span><span class="si">}</span><span class="s2">  -m --merged_out </span><span class="si">{</span><span class="n">outputfile</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">key_</span><span class="o">=</span><span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
                <span class="n">bash_script</span><span class="o">+=</span><span class="sa">f</span><span class="s2">&quot; --</span><span class="si">{</span><span class="n">key_</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2"> &quot;</span>

        <span class="k">elif</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;docker&quot;</span><span class="p">:</span>
            <span class="n">bash_script</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;docker run -v </span><span class="si">{</span><span class="n">read_1</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">read_1</span><span class="si">}</span><span class="s2"> -v </span><span class="si">{</span><span class="n">read_2</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">read_2</span><span class="si">}</span><span class="s2"> -v </span><span class="si">{</span><span class="n">outputfile</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">outputfile</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adtoolbox_docker</span><span class="si">}</span><span class="s2"> fastp -i </span><span class="si">{</span><span class="n">read_1</span><span class="si">}</span><span class="s2"> -I </span><span class="si">{</span><span class="n">read_2</span><span class="si">}</span><span class="s2">  -m --merged_out </span><span class="si">{</span><span class="n">outputfile</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">key_</span><span class="o">=</span><span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
                <span class="n">bash_script</span><span class="o">+=</span><span class="sa">f</span><span class="s2">&quot; --</span><span class="si">{</span><span class="n">key_</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2"> &quot;</span>

        <span class="k">elif</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;singularity&quot;</span><span class="p">:</span>
            <span class="n">bash_script</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;singularity exec </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adtoolbox_singularity</span><span class="si">}</span><span class="s2"> fastp -i </span><span class="si">{</span><span class="n">read_1</span><span class="si">}</span><span class="s2"> -I </span><span class="si">{</span><span class="n">read_2</span><span class="si">}</span><span class="s2">  -m --merged_out </span><span class="si">{</span><span class="n">outputfile</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">key_</span><span class="o">=</span><span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
                <span class="n">bash_script</span><span class="o">+=</span><span class="sa">f</span><span class="s2">&quot; --</span><span class="si">{</span><span class="n">key_</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2"> &quot;</span>

        <span class="k">return</span> <span class="n">bash_script</span><span class="p">,</span>

    <span class="k">def</span> <span class="nf">run_qiime2_from_sra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">read_1</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
                            <span class="n">read_2</span><span class="p">:</span><span class="nb">str</span><span class="o">|</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">sample_name</span><span class="p">:</span><span class="nb">str</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">manifest_dir</span><span class="p">:</span><span class="nb">str</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">workings_dir</span><span class="p">:</span><span class="nb">str</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">save_manifest</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">container</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span>
                            <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method uses the input fastq files to run qiime2. The method uses the qiime2 template scripts that are provided in pkg_data module.</span>
<span class="sd">        The method also creates a manifest file for qiime2. The manifest file is created based on the input fastq files.</span>
<span class="sd">        Required Configs:</span>
<span class="sd">            config.qiime2_single_end_bash_str: The path to the qiime2 bash script for single end reads.</span>
<span class="sd">            ---------</span>
<span class="sd">            config.qiime2_paired_end_bash_str: The path to the qiime2 bash script for paired end reads.</span>
<span class="sd">            ---------</span>
<span class="sd">            config.qiime_classifier_db: The path to the qiime2 classifier database.</span>
<span class="sd">            ---------</span>
<span class="sd">            config.qiime2_docker_image: The name of the docker image to be used by ADToolbox (Only if using Docker as container).</span>
<span class="sd">            ---------</span>
<span class="sd">            config.qiime2_singularity_image: The name of the singularity image to be used by ADToolbox (Only if using Singularity as container).</span>
<span class="sd">            ---------</span>
<span class="sd">        Args:</span>
<span class="sd">            read_1 (str): directory of the forward reads file</span>
<span class="sd">            read_2 (str): directory of the reverse reads file. This is provided only if the reads are paired end. If this is not the case,</span>
<span class="sd">            sample_name (str, optional): The name of the sample. If None, the name of the sample will be the name of the directory where the fastq files are located. Defaults to None.</span>
<span class="sd">            manifest_dir (str, optional): The directory where the manifest file will be saved. If None, the manifest file will be saved in the same directory as the fastq files. Defaults to None.</span>
<span class="sd">            workings_dir (str, optional): The directory where the qiime2 outputs will be saved. If None, the outputs will be saved in the same directory as the fastq files. Defaults to None.</span>
<span class="sd">            container (str, optional): If you want to run the qiime2 commands in a container, specify the container name here. Defaults to &#39;None&#39;.</span>
<span class="sd">        Returns:</span>
<span class="sd">            qiime2_bash_str (str): The bash script that will be used to run qiime2 in python string format</span>
<span class="sd">            manifest (dict): The manifest file that will be used to run qiime2 in python dictionary format</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">sample_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sample_name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">read_1</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">manifest_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">manifest_dir</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">read_1</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">manifest_dir</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">manifest_dir</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">workings_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">workings_dir</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">read_1</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">workings_dir</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">workings_dir</span><span class="p">)</span>


        <span class="n">manifest_single</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sample-id&#39;</span><span class="p">:[],</span><span class="s1">&#39;absolute-filepath&#39;</span><span class="p">:[]}</span>
        <span class="n">manifest_paired</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sample-id&#39;</span><span class="p">:[],</span><span class="s1">&#39;forward-absolute-filepath&#39;</span><span class="p">:[],</span><span class="s1">&#39;reverse-absolute-filepath&#39;</span><span class="p">:[]}</span>  
        <span class="k">if</span> <span class="n">read_2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">manifest_paired</span><span class="p">[</span><span class="s1">&#39;sample-id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample_name</span><span class="p">)</span>
            <span class="n">manifest_paired</span><span class="p">[</span><span class="s1">&#39;forward-absolute-filepath&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">read_1</span><span class="p">)</span>
            <span class="n">manifest_paired</span><span class="p">[</span><span class="s1">&#39;reverse-absolute-filepath&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">read_2</span><span class="p">)</span>
            <span class="n">paired_end</span><span class="o">=</span><span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">manifest_single</span><span class="p">[</span><span class="s1">&#39;sample-id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample_name</span><span class="p">)</span>
            <span class="n">manifest_single</span><span class="p">[</span><span class="s1">&#39;absolute-filepath&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">read_1</span><span class="p">)</span>
            <span class="n">paired_end</span><span class="o">=</span><span class="kc">False</span>

        <span class="n">manifest</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">manifest_single</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">paired_end</span> <span class="k">else</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">manifest_paired</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">paired_end</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime2_paired_end_bash_str</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime2_single_end_bash_str</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;p_trunc_len&quot;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">paired_end</span><span class="p">:</span>
                <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;p-trunc-len&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;p_trunc_len&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;p-trunc-len-f&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;p_trunc_len&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;p-trunc-len-r&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;p_trunc_len&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">paired_end</span><span class="p">:</span>
                <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;p-trunc-len&gt;&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime2_p_trunc_len</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;p-trunc-len-f&gt;&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime2_p_trunc_len</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;p-trunc-len-r&gt;&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime2_p_trunc_len</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;None&quot;</span><span class="p">:</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;manifest&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">manifest_dir</span><span class="p">))</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;qiime2_work_dir&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">workings_dir</span><span class="p">))</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;classifier&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">))</span>


        <span class="k">elif</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;docker&quot;</span><span class="p">:</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">qiime2_bash_str</span><span class="p">):</span>
                <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;qiime&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;biom&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">paired_end</span><span class="p">:</span>
                        <span class="n">pec</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">pec</span><span class="o">=</span><span class="s2">&quot;-v &quot;</span><span class="o">+</span><span class="n">read_2</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="n">read_2</span><span class="o">+</span><span class="s2">&quot; &quot;</span>
                    <span class="n">qiime2_bash_str</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;docker run --env TMPDIR=/data/tmp -v </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">manifest_dir</span><span class="p">)</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">manifest_dir</span><span class="p">)</span><span class="si">}</span><span class="s2"> -v </span><span class="si">{</span><span class="n">read_1</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">read_1</span><span class="si">}</span><span class="s2"> -v </span><span class="si">{</span><span class="n">read_2</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">read_2</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">pec</span><span class="si">}</span><span class="s2"> -v </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="si">}</span><span class="s2"> -w /data  </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime2_docker_image</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="n">line</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">qiime2_bash_str</span><span class="p">)</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;manifest&gt;&quot;</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">manifest_dir</span><span class="p">),</span><span class="s2">&quot;manifest.tsv&quot;</span><span class="p">))</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;qiime2_work_dir&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">workings_dir</span><span class="p">))</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;classifier&gt;&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">paired_end</span><span class="p">:</span>
                <span class="n">manifest</span><span class="p">[</span><span class="s1">&#39;absolute-filepath&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">manifest</span><span class="p">[</span><span class="s1">&#39;absolute-filepath&#39;</span><span class="p">]]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">manifest</span><span class="p">[</span><span class="s1">&#39;forward-absolute-filepath&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">manifest</span><span class="p">[</span><span class="s1">&#39;forward-absolute-filepath&#39;</span><span class="p">]]</span>
                <span class="n">manifest</span><span class="p">[</span><span class="s1">&#39;reverse-absolute-filepath&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">manifest</span><span class="p">[</span><span class="s1">&#39;reverse-absolute-filepath&#39;</span><span class="p">]]</span>

        <span class="k">elif</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;singularity&quot;</span><span class="p">:</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">qiime2_bash_str</span><span class="p">):</span>
                <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;qiime&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;biom&quot;</span><span class="p">):</span>
                    <span class="n">qiime2_bash_str</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;singularity exec --bind  </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">seqs</span><span class="p">)</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">seqs</span><span class="p">)</span><span class="si">}</span><span class="s2">,$PWD:$PWD,</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">))</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">))</span><span class="si">}</span><span class="s2">,$SINGULARITY_TMPDIR:/tmp  </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime2_singularity_image</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="o">+</span><span class="n">line</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">qiime2_bash_str</span><span class="p">)</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;manifest&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">manifest_dir</span><span class="p">))</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;qiime2_work_dir&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">seqs</span><span class="p">))</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;classifier&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">)))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Container must be None, singularity or docker&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">save_manifest</span><span class="p">:</span>
            <span class="n">manifest</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">manifest_dir</span><span class="p">,</span><span class="s2">&quot;manifest.tsv&quot;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">qiime2_bash_str</span><span class="p">,</span><span class="n">manifest</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Metagenomics.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>In order to instntiate an object from this class, you need to provide a metagenomics configs object from the configs module : configs.Metagenomics.
Information for inputs and of each method is then obtained from the corresponding configs object. The following example shows how to instantiate an object from this class
using the default configs object:</p>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">adtoolbox</span> <span class="kn">import</span> <span class="n">core</span><span class="p">,</span> <span class="n">configs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Metagenomics</span><span class="p">()</span> <span class="c1">### This uses default arguments. Refer to configs module for more information.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metagenomics</span><span class="o">=</span><span class="n">core</span><span class="o">.</span><span class="n">Metagenomics</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">metagenomics</span><span class="p">)</span><span class="o">==</span><span class="n">core</span><span class="o">.</span><span class="n">Metagenomics</span>
</code></pre></div>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>config</code></td>
          <td>
                <code>configs.<span title="configs.Metagenomics">Metagenomics</span></code>
          </td>
          <td><p>A metagenomics configs object from configs module.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>None</code>
          </td>
          <td><p>None</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">config</span><span class="p">:</span><span class="n">configs</span><span class="o">.</span><span class="n">Metagenomics</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;In order to instntiate an object from this class, you need to provide a metagenomics configs object from the configs module : configs.Metagenomics.</span>
<span class="sd">    Information for inputs and of each method is then obtained from the corresponding configs object. The following example shows how to instantiate an object from this class</span>
<span class="sd">    using the default configs object:</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; from adtoolbox import core, configs</span>
<span class="sd">        &gt;&gt;&gt; config=configs.Metagenomics() ### This uses default arguments. Refer to configs module for more information.</span>
<span class="sd">        &gt;&gt;&gt; metagenomics=core.Metagenomics(config)</span>
<span class="sd">        &gt;&gt;&gt; assert type(metagenomics)==core.Metagenomics</span>

<span class="sd">    Args:</span>
<span class="sd">        config (configs.Metagenomics): A metagenomics configs object from configs module.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">=</span><span class="n">config</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Metagenomics.align_genome_to_protein_db" class="doc doc-heading">
<code class="highlight language-python"><span class="n">align_genome_to_protein_db</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">outdir</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This is a function that will align a genome to the Protein Database of the ADToolbox using mmseqs2.
If you want to save the scripts, set save to True. Note that the alignment tables will be saved in any case.
Note that this function uses mmseqs2 to align the genomes to the protein database. So, to run this function without
any container you need to have mmseqs2 installed on your system. However, if you want to run this function with a container,
you need to have the container installed on your system. You may select from "None", "docker", "singularity".</p>

<details class="requires">
  <summary>Requires</summary>
  <h4 id="adtoolbox.core.Metagenomics.align_genome_to_protein_db--configprotein_db-the-address-of-the-protein-database-of-the-adtoolbox">config.protein_db: The address of the protein database of the ADToolbox.</h4>
<h4 id="adtoolbox.core.Metagenomics.align_genome_to_protein_db--configadtoolbox_docker-the-name-of-the-docker-image-to-be-used-by-adtoolbox-only-if-using-docker-as-container">config.adtoolbox_docker: The name of the docker image to be used by ADToolbox (Only if using Docker as container).</h4>
<h4 id="adtoolbox.core.Metagenomics.align_genome_to_protein_db--configadtoolbox_singularity-the-name-of-the-singularity-image-to-be-used-by-adtoolbox-only-if-using-singularity-as-container">config.adtoolbox_singularity: The name of the singularity image to be used by ADToolbox (Only if using Singularity as container).</h4>
</details>      <p>Example: 
    &gt;&gt;&gt; import os
    &gt;&gt;&gt; output=os.path.join(Main_Dir,"test")
    &gt;&gt;&gt; address=os.path.join(Main_Dir,"test","genome_sequence.fa")
    &gt;&gt;&gt; obj = Metagenomics(configs.Metagenomics()) 
    &gt;&gt;&gt; name="test_align"
    &gt;&gt;&gt; assert obj.align_genome_to_protein_db(address=address,outdir=output,name=name,container="docker")[0].split(" ")==['docker', 'run', '', '-v', address+':'+address, '-v', configs.Database().protein_db+':'+configs.Database().protein_db, '-v', output+':'+output, 'parsaghadermazi/adtoolbox:x86', '', 'mmseqs', 'easy-search', address, configs.Database().protein_db, output+'/Alignment_Results_mmseq_test_align.tsv', 'tmpfiles', '--format-mode', '4', '\n\n']</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>address</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The address of the genome to be aligned.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>outdir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The output directory where the alignment files will be saved.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The name of the genome.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>container</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The container to use. Defaults to "None". You may select from "None", "docker", "singularity".</p></td>
          <td>
                <code>&#39;None&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>A dictionary containing the alignment files.</p></td>
        </tr>
        <tr>
<td><code>str</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>The bash script that is used to align the genomes or to be used to align the genomes.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">align_genome_to_protein_db</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">address</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">outdir</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">container</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
        <span class="p">)</span><span class="o">-&gt;</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a function that will align a genome to the Protein Database of the ADToolbox using mmseqs2.</span>
<span class="sd">    If you want to save the scripts, set save to True. Note that the alignment tables will be saved in any case.</span>
<span class="sd">    Note that this function uses mmseqs2 to align the genomes to the protein database. So, to run this function without</span>
<span class="sd">    any container you need to have mmseqs2 installed on your system. However, if you want to run this function with a container,</span>
<span class="sd">    you need to have the container installed on your system. You may select from &quot;None&quot;, &quot;docker&quot;, &quot;singularity&quot;.</span>

<span class="sd">    Requires:</span>
<span class="sd">        config.protein_db: The address of the protein database of the ADToolbox.</span>
<span class="sd">        ---------</span>
<span class="sd">        config.adtoolbox_docker: The name of the docker image to be used by ADToolbox (Only if using Docker as container).</span>
<span class="sd">        ---------</span>
<span class="sd">        config.adtoolbox_singularity: The name of the singularity image to be used by ADToolbox (Only if using Singularity as container).</span>
<span class="sd">        ---------</span>
<span class="sd">    Example: </span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; output=os.path.join(Main_Dir,&quot;test&quot;)</span>
<span class="sd">        &gt;&gt;&gt; address=os.path.join(Main_Dir,&quot;test&quot;,&quot;genome_sequence.fa&quot;)</span>
<span class="sd">        &gt;&gt;&gt; obj = Metagenomics(configs.Metagenomics()) </span>
<span class="sd">        &gt;&gt;&gt; name=&quot;test_align&quot;</span>
<span class="sd">        &gt;&gt;&gt; assert obj.align_genome_to_protein_db(address=address,outdir=output,name=name,container=&quot;docker&quot;)[0].split(&quot; &quot;)==[&#39;docker&#39;, &#39;run&#39;, &#39;&#39;, &#39;-v&#39;, address+&#39;:&#39;+address, &#39;-v&#39;, configs.Database().protein_db+&#39;:&#39;+configs.Database().protein_db, &#39;-v&#39;, output+&#39;:&#39;+output, &#39;parsaghadermazi/adtoolbox:x86&#39;, &#39;&#39;, &#39;mmseqs&#39;, &#39;easy-search&#39;, address, configs.Database().protein_db, output+&#39;/Alignment_Results_mmseq_test_align.tsv&#39;, &#39;tmpfiles&#39;, &#39;--format-mode&#39;, &#39;4&#39;, &#39;\n\n&#39;]</span>

<span class="sd">    Args:</span>
<span class="sd">        address (str): The address of the genome to be aligned.</span>
<span class="sd">        outdir (str): The output directory where the alignment files will be saved.</span>
<span class="sd">        name (str): The name of the genome.</span>
<span class="sd">        container (str, optional): The container to use. Defaults to &quot;None&quot;. You may select from &quot;None&quot;, &quot;docker&quot;, &quot;singularity&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A dictionary containing the alignment files.</span>
<span class="sd">        str: The bash script that is used to align the genomes or to be used to align the genomes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;None&quot;</span><span class="p">:</span>
        <span class="n">bash_script</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">alignment_file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span><span class="s2">&quot;Alignment_Results_mmseq_&quot;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;.tsv&quot;</span><span class="p">)</span>
        <span class="n">bash_script</span> <span class="o">+=</span> <span class="s2">&quot;mmseqs easy-search &quot;</span> <span class="o">+</span> \
            <span class="n">address</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> \
            <span class="n">alignment_file</span><span class="o">+</span> <span class="s1">&#39; tmp --format-mode 4 &#39;</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span>

    <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;docker&quot;</span><span class="p">:</span>
        <span class="n">bash_script</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">alignment_file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span><span class="s2">&quot;Alignment_Results_mmseq_&quot;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;.tsv&quot;</span><span class="p">)</span>
        <span class="n">bash_script</span> <span class="o">+=</span><span class="s2">&quot;docker run &quot;</span><span class="o">+</span> \
        <span class="s2">&quot; -v &quot;</span><span class="o">+</span><span class="n">address</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="n">address</span><span class="o">+</span> \
        <span class="s2">&quot; -v &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="o">+</span> \
        <span class="s2">&quot; -v &quot;</span><span class="o">+</span><span class="n">outdir</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="n">outdir</span><span class="o">+</span> \
        <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adtoolbox_docker</span><span class="si">}</span><span class="s2">  mmseqs easy-search &quot;</span> <span class="o">+</span> \
            <span class="n">address</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> \
            <span class="n">alignment_file</span><span class="o">+</span><span class="s1">&#39; tmpfiles --format-mode 4 &#39;</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span>

    <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;singularity&quot;</span><span class="p">:</span>
        <span class="n">bash_script</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">alignment_file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span><span class="s2">&quot;Alignment_Results_mmseq_&quot;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;.tsv&quot;</span><span class="p">)</span>
        <span class="n">bash_script</span> <span class="o">+=</span><span class="s2">&quot;singularity exec &quot;</span><span class="o">+</span> \
        <span class="s2">&quot; -B &quot;</span><span class="o">+</span><span class="n">address</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="n">address</span><span class="o">+</span> \
        <span class="s2">&quot; -B &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="o">+</span> \
        <span class="s2">&quot; -B &quot;</span><span class="o">+</span><span class="n">outdir</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="n">outdir</span><span class="o">+</span> \
        <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adtoolbox_singularity</span><span class="si">}</span><span class="s2">  mmseqs easy-search &quot;</span> <span class="o">+</span> \
            <span class="n">address</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> \
            <span class="n">alignment_file</span><span class="o">+</span><span class="s1">&#39; tmpfiles --format-mode 4 &#39;</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span>

    <span class="k">return</span>  <span class="n">bash_script</span><span class="p">,</span><span class="n">alignment_file</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Metagenomics.align_short_reads_to_protein_db" class="doc doc-heading">
<code class="highlight language-python"><span class="n">align_short_reads_to_protein_db</span><span class="p">(</span><span class="n">query_seq</span><span class="p">,</span> <span class="n">alignment_file_name</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function aligns shotgun short reads to the protein database of the ADToolbox using mmseqs2.
mmseqs wrappers in utils are used to perform this task. The result of this task is an alignment table.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <h4 id="adtoolbox.core.Metagenomics.align_short_reads_to_protein_db--protein_db_mmseqs-str-the-address-of-the-existingto-be-created-protein-database-of-the-adtoolbox-for-mmseqs">protein_db_mmseqs (str): The address of the existing/to be created protein database of the ADToolbox for mmseqs.</h4>
</details>
<details class="example">
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>import os
query_seq= os.path.join(Main_Dir,"test","query.seq")
alignment_file= "output_alignment.txt"
protein_db_mmseqs=os.path.join(Main_Dir,"test","protein_db_mmseqs")
with open(protein_db_mmseqs,'w') as f:
...     f.write("")
0
obj = Metagenomics(configs.Metagenomics(protein_db_mmseqs=protein_db_mmseqs)) 
assert obj.align_short_reads_to_protein_db(query_seq=query_seq, alignment_file_name= protein_db_mmseqs, container="docker")[0] == 'docker run -v /home/parsa/ADresearch/test/query.seq:/home/parsa/ADresearch/test/query.seq -v /home/parsa/ADresearch/test:/home/parsa/ADresearch/test parsaghadermazi/adtoolbox:x86 mmseqs createdb /home/parsa/ADresearch/test/query.seq /home/parsa/ADresearch/test/query\ndocker run -v /home/parsa/ADresearch/test/query:/home/parsa/ADresearch/test/query -v /home/parsa/ADresearch/test:/home/parsa/ADresearch/test -v /home/parsa/ADresearch/test/protein_db_mmseqs:/home/parsa/ADresearch/test/protein_db_mmseqs parsaghadermazi/adtoolbox:x86 mmseqs search /home/parsa/ADresearch/test/query /home/parsa/ADresearch/test/protein_db_mmseqs /home/parsa/ADresearch/test/protein_db_mmseqs /home/parsa/ADresearch/test/tmp\ndocker run -v /home/parsa/ADresearch/test/query:/home/parsa/ADresearch/test/query -v /home/parsa/ADresearch/test:/home/parsa/ADresearch/test -v /home/parsa/ADresearch/test/protein_db_mmseqs:/home/parsa/ADresearch/test/protein_db_mmseqs parsaghadermazi/adtoolbox:x86 mmseqs convertalis /home/parsa/ADresearch/test/query /home/parsa/ADresearch/test/protein_db_mmseqs /home/parsa/ADresearch/test/protein_db_mmseqs /home/parsa/ADresearch/test/protein_db_mmseqs.tsv --format-mode 4\n'
os.remove(protein_db_mmseqs)</p>
</blockquote>
</blockquote>
</blockquote>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>query_seq</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The address of the query sequence.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>alignment_file_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The name of the alignment file.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>container</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The container to use. Defaults to "None". You may select from "None", "docker", "singularity".</p></td>
          <td>
                <code>&#39;None&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>The bash script that is used to align the genomes or to be used to align the genomes.</p></td>
        </tr>
        <tr>
<td><code>str</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>The address of the alignment file.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">align_short_reads_to_protein_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">query_seq</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
                                    <span class="n">alignment_file_name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
                                    <span class="n">container</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
                                    <span class="p">)</span><span class="o">-&gt;</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;This function aligns shotgun short reads to the protein database of the ADToolbox using mmseqs2.</span>
<span class="sd">    mmseqs wrappers in utils are used to perform this task. The result of this task is an alignment table.</span>

<span class="sd">    Required Configs:</span>

<span class="sd">        protein_db_mmseqs (str): The address of the existing/to be created protein database of the ADToolbox for mmseqs.</span>
<span class="sd">        --------</span>
<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; query_seq= os.path.join(Main_Dir,&quot;test&quot;,&quot;query.seq&quot;)</span>
<span class="sd">        &gt;&gt;&gt; alignment_file= &quot;output_alignment.txt&quot;</span>
<span class="sd">        &gt;&gt;&gt; protein_db_mmseqs=os.path.join(Main_Dir,&quot;test&quot;,&quot;protein_db_mmseqs&quot;)</span>
<span class="sd">        &gt;&gt;&gt; with open(protein_db_mmseqs,&#39;w&#39;) as f:</span>
<span class="sd">        ...     f.write(&quot;&quot;)</span>
<span class="sd">        0</span>
<span class="sd">        &gt;&gt;&gt; obj = Metagenomics(configs.Metagenomics(protein_db_mmseqs=protein_db_mmseqs)) </span>
<span class="sd">        &gt;&gt;&gt; assert obj.align_short_reads_to_protein_db(query_seq=query_seq, alignment_file_name= protein_db_mmseqs, container=&quot;docker&quot;)[0] == &#39;docker run -v /home/parsa/ADresearch/test/query.seq:/home/parsa/ADresearch/test/query.seq -v /home/parsa/ADresearch/test:/home/parsa/ADresearch/test parsaghadermazi/adtoolbox:x86 mmseqs createdb /home/parsa/ADresearch/test/query.seq /home/parsa/ADresearch/test/query\ndocker run -v /home/parsa/ADresearch/test/query:/home/parsa/ADresearch/test/query -v /home/parsa/ADresearch/test:/home/parsa/ADresearch/test -v /home/parsa/ADresearch/test/protein_db_mmseqs:/home/parsa/ADresearch/test/protein_db_mmseqs parsaghadermazi/adtoolbox:x86 mmseqs search /home/parsa/ADresearch/test/query /home/parsa/ADresearch/test/protein_db_mmseqs /home/parsa/ADresearch/test/protein_db_mmseqs /home/parsa/ADresearch/test/tmp\ndocker run -v /home/parsa/ADresearch/test/query:/home/parsa/ADresearch/test/query -v /home/parsa/ADresearch/test:/home/parsa/ADresearch/test -v /home/parsa/ADresearch/test/protein_db_mmseqs:/home/parsa/ADresearch/test/protein_db_mmseqs parsaghadermazi/adtoolbox:x86 mmseqs convertalis /home/parsa/ADresearch/test/query /home/parsa/ADresearch/test/protein_db_mmseqs /home/parsa/ADresearch/test/protein_db_mmseqs /home/parsa/ADresearch/test/protein_db_mmseqs.tsv --format-mode 4\n&#39;</span>
<span class="sd">        &gt;&gt;&gt; os.remove(protein_db_mmseqs)</span>

<span class="sd">    Args:</span>
<span class="sd">        query_seq (str): The address of the query sequence.</span>
<span class="sd">        alignment_file_name (str): The name of the alignment file.</span>
<span class="sd">        container (str, optional): The container to use. Defaults to &quot;None&quot;. You may select from &quot;None&quot;, &quot;docker&quot;, &quot;singularity&quot;.</span>


<span class="sd">    Returns:</span>
<span class="sd">        str: The bash script that is used to align the genomes or to be used to align the genomes.</span>
<span class="sd">        str: The address of the alignment file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db_mmseqs</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;The protein database of the ADToolbox for mmseqs is not found. Please build it first</span>
<span class="s2">                                using Database.build_mmseqs_database method.&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="n">path_query</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">query_seq</span><span class="p">)</span>
    <span class="n">script</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">script</span> <span class="o">+=</span> <span class="n">create_mmseqs_database</span><span class="p">(</span><span class="n">query_seq</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">path_query</span><span class="o">.</span><span class="n">parent</span><span class="o">/</span><span class="n">path_query</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span><span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">run</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">script</span> <span class="o">+=</span> <span class="n">mmseqs_search</span><span class="p">(</span>
        <span class="n">query_db</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">path_query</span><span class="o">.</span><span class="n">parent</span><span class="o">/</span><span class="n">path_query</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="n">target_db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db_mmseqs</span><span class="p">,</span>
        <span class="n">results_db</span><span class="o">=</span><span class="n">path_query</span><span class="o">.</span><span class="n">parent</span><span class="o">/</span><span class="n">alignment_file_name</span><span class="p">,</span>
        <span class="n">run</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">save</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
    <span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">script</span> <span class="o">+=</span> <span class="n">mmseqs_result_db_to_tsv</span><span class="p">(</span>
        <span class="n">query_db</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">path_query</span><span class="o">.</span><span class="n">parent</span><span class="o">/</span><span class="n">path_query</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="n">target_db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db_mmseqs</span><span class="p">,</span>
        <span class="n">results_db</span><span class="o">=</span><span class="n">path_query</span><span class="o">.</span><span class="n">parent</span><span class="o">/</span><span class="n">alignment_file_name</span><span class="p">,</span>
        <span class="n">tsv_file</span><span class="o">=</span><span class="n">path_query</span><span class="o">.</span><span class="n">parent</span><span class="o">/</span><span class="p">(</span><span class="n">alignment_file_name</span><span class="o">+</span><span class="s2">&quot;.tsv&quot;</span><span class="p">),</span>
        <span class="n">container</span><span class="o">=</span><span class="n">container</span><span class="p">,</span>
        <span class="n">save</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">run</span><span class="o">=</span><span class="kc">False</span><span class="p">,)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">script</span><span class="p">,</span><span class="n">path_query</span><span class="o">.</span><span class="n">parent</span><span class="o">/</span><span class="p">(</span><span class="n">alignment_file_name</span><span class="o">+</span><span class="s2">&quot;.tsv&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Metagenomics.align_to_gtdb" class="doc doc-heading">
<code class="highlight language-python"><span class="n">align_to_gtdb</span><span class="p">(</span><span class="n">query_dir</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function takes the representative sequences of the top k features and generates the script to
align these feature sequences to gtdb using VSEARCH. If you intend to run this you either
need to have VSEARCH installed or run it with a container option. You can use either the docker or singularity
as container options. Otherwise you can use None and run it with the assumption that VSEARCH is installed.
If you only want the script and not to run it, set run to False.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <hr />
<h4 id="adtoolbox.core.Metagenomics.align_to_gtdb--configgtdb_dir_fasta-the-path-to-the-gtdb-fasta-database">config.gtdb_dir_fasta: The path to the gtdb fasta database.</h4>
<h4 id="adtoolbox.core.Metagenomics.align_to_gtdb--configvsearch_similarity-the-similarity-threshold-for-the-alignment-to-be-used-by-vsearch">config.vsearch_similarity: The similarity threshold for the alignment to be used by VSEARCH.</h4>
<h4 id="adtoolbox.core.Metagenomics.align_to_gtdb--configvsearch_threads-the-number-of-threads-to-be-used-by-vsearch">config.vsearch_threads: The number of threads to be used by VSEARCH.</h4>
<h4 id="adtoolbox.core.Metagenomics.align_to_gtdb--configadtoolbox_docker-the-name-of-the-docker-image-to-be-used-by-adtoolbox-only-if-using-docker-as-container">config.adtoolbox_docker: The name of the docker image to be used by ADToolbox (Only if using Docker as container).</h4>
<h4 id="adtoolbox.core.Metagenomics.align_to_gtdb--configadtoolbox_singularity-the-name-of-the-singularity-image-to-be-used-by-adtoolbox-only-if-using-singularity-as-container">config.adtoolbox_singularity: The name of the singularity image to be used by ADToolbox (Only if using Singularity as container).</h4>
</details>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">query_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="s2">&quot;query.fa&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">output_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conf</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Metagenomics</span><span class="p">(</span><span class="n">vsearch_similarity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conf</span><span class="o">.</span><span class="n">gtdb_dir_fasta</span><span class="o">=</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;db.fa&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">obj</span> <span class="o">=</span> <span class="n">Metagenomics</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">obj</span><span class="o">.</span><span class="n">align_to_gtdb</span><span class="p">(</span><span class="n">query_dir</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;docker&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sa">f</span><span class="s1">&#39;docker run -v </span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s1"> -v </span><span class="si">{</span><span class="n">conf</span><span class="o">.</span><span class="n">gtdb_dir_fasta</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">conf</span><span class="o">.</span><span class="n">gtdb_dir_fasta</span><span class="si">}</span><span class="s1"> -v </span><span class="si">{</span><span class="n">query_dir</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">query_dir</span><span class="si">}</span><span class="s1"> parsaghadermazi/adtoolbox:x86 vsearch --top_hits_only --blast6out </span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s1">/matches.blast --usearch_global </span><span class="si">{</span><span class="n">query_dir</span><span class="si">}</span><span class="s1"> --db </span><span class="si">{</span><span class="n">conf</span><span class="o">.</span><span class="n">gtdb_dir_fasta</span><span class="si">}</span><span class="s1"> --id </span><span class="si">{</span><span class="n">conf</span><span class="o">.</span><span class="n">vsearch_similarity</span><span class="si">}</span><span class="s1"> --threads 4 --alnout </span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s1">/Alignments --top_hits_only</span><span class="se">\n</span><span class="s1">&#39;</span>
</code></pre></div>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>container</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The container to use. Defaults to "None".</p></td>
          <td>
                <code>&#39;None&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
                <code>tuple[str]</code>
          </td>
          <td><p>The script that is supposed to be running later.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">align_to_gtdb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                  <span class="n">query_dir</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
                  <span class="n">output_dir</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
                  <span class="n">container</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;This function takes the representative sequences of the top k features and generates the script to</span>
<span class="sd">    align these feature sequences to gtdb using VSEARCH. If you intend to run this you either</span>
<span class="sd">    need to have VSEARCH installed or run it with a container option. You can use either the docker or singularity</span>
<span class="sd">    as container options. Otherwise you can use None and run it with the assumption that VSEARCH is installed.</span>
<span class="sd">    If you only want the script and not to run it, set run to False.</span>

<span class="sd">    Required Configs:</span>

<span class="sd">        ---------</span>
<span class="sd">        config.gtdb_dir_fasta: The path to the gtdb fasta database.</span>
<span class="sd">        ---------</span>
<span class="sd">        config.vsearch_similarity: The similarity threshold for the alignment to be used by VSEARCH.</span>
<span class="sd">        ---------</span>
<span class="sd">        config.vsearch_threads: The number of threads to be used by VSEARCH.</span>
<span class="sd">        ---------</span>
<span class="sd">        config.adtoolbox_docker: The name of the docker image to be used by ADToolbox (Only if using Docker as container).</span>
<span class="sd">        ---------</span>
<span class="sd">        config.adtoolbox_singularity: The name of the singularity image to be used by ADToolbox (Only if using Singularity as container).</span>
<span class="sd">        ---------</span>
<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; query_dir=os.path.join(Main_Dir,&quot;test&quot;,&quot;query.fa&quot;)</span>
<span class="sd">        &gt;&gt;&gt; output_dir=os.path.join(Main_Dir,&quot;test&quot;)</span>
<span class="sd">        &gt;&gt;&gt; conf=configs.Metagenomics(vsearch_similarity=0.8)</span>
<span class="sd">        &gt;&gt;&gt; conf.gtdb_dir_fasta=(os.path.join(Main_Dir,&quot;db.fa&quot;))</span>
<span class="sd">        &gt;&gt;&gt; obj = Metagenomics(conf) </span>
<span class="sd">        &gt;&gt;&gt; assert obj.align_to_gtdb(query_dir, output_dir, container=&quot;docker&quot;)[0] == f&#39;docker run -v {output_dir}:{output_dir} -v {conf.gtdb_dir_fasta}:{conf.gtdb_dir_fasta} -v {query_dir}:{query_dir} parsaghadermazi/adtoolbox:x86 vsearch --top_hits_only --blast6out {output_dir}/matches.blast --usearch_global {query_dir} --db {conf.gtdb_dir_fasta} --id {conf.vsearch_similarity} --threads 4 --alnout {output_dir}/Alignments --top_hits_only\n&#39;</span>

<span class="sd">    Args:</span>
<span class="sd">        container (str, optional): The container to use. Defaults to &quot;None&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The script that is supposed to be running later.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">### Load all the required files</span>
    <span class="n">alignment_dir</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span><span class="s1">&#39;Alignments&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">absolute</span><span class="p">())</span>
    <span class="n">match_table</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span><span class="s1">&#39;matches.blast&#39;</span><span class="p">)))</span>
    <span class="n">gtdb_dir_fasta</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">gtdb_dir_fasta</span><span class="p">))</span>
    <span class="c1">### End Loading</span>
    <span class="n">query</span><span class="o">=</span><span class="n">query_dir</span>
    <span class="n">dirs</span><span class="o">=</span><span class="p">[</span><span class="n">output_dir</span><span class="p">,</span>
        <span class="n">gtdb_dir_fasta</span><span class="p">,</span>
        <span class="n">query</span>
        <span class="p">]</span>
    <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;None&quot;</span><span class="p">:</span>
        <span class="n">bash_script</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;vsearch --top_hits_only --blast6out &#39;</span><span class="o">+</span>
                    <span class="n">match_table</span><span class="o">+</span>
                    <span class="s1">&#39; --usearch_global &#39;</span><span class="o">+</span> <span class="n">query</span> <span class="o">+</span>
                    <span class="s1">&#39; --db &#39;</span><span class="o">+</span> <span class="n">gtdb_dir_fasta</span> <span class="o">+</span>
                    <span class="s1">&#39; --id &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">vsearch_similarity</span><span class="p">)</span> <span class="o">+</span>
                    <span class="s1">&#39; --threads &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">vsearch_threads</span><span class="p">)</span><span class="o">+</span>
                    <span class="s1">&#39; --alnout &#39;</span><span class="o">+</span> <span class="n">alignment_dir</span> <span class="o">+</span>
                    <span class="s1">&#39; --top_hits_only&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;docker&quot;</span><span class="p">:</span>
        <span class="n">bash_script</span><span class="o">=</span><span class="s1">&#39;docker run &#39;</span>
        <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
            <span class="n">bash_script</span><span class="o">+=</span><span class="p">(</span><span class="s1">&#39;-v &#39;</span><span class="o">+</span><span class="nb">dir</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="nb">dir</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

        <span class="n">bash_script</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adtoolbox_docker</span><span class="o">+</span><span class="s1">&#39; vsearch --top_hits_only --blast6out &#39;</span><span class="o">+</span>
                    <span class="n">match_table</span><span class="o">+</span>
                    <span class="s1">&#39; --usearch_global &#39;</span><span class="o">+</span> <span class="n">query</span> <span class="o">+</span>
                    <span class="s1">&#39; --db &#39;</span><span class="o">+</span> <span class="n">gtdb_dir_fasta</span> <span class="o">+</span>
                    <span class="s1">&#39; --id &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">vsearch_similarity</span><span class="p">)</span> <span class="o">+</span>
                    <span class="s1">&#39; --threads &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">vsearch_threads</span><span class="p">)</span><span class="o">+</span>
                    <span class="s1">&#39; --alnout &#39;</span><span class="o">+</span> <span class="n">alignment_dir</span> <span class="o">+</span>
                    <span class="s1">&#39; --top_hits_only&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;singularity&quot;</span><span class="p">:</span>
        <span class="n">bash_script</span><span class="o">=</span><span class="s1">&#39;singularity exec &#39;</span>
        <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
            <span class="n">bash_script</span><span class="o">+=</span><span class="p">(</span><span class="s1">&#39;-B &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

        <span class="n">bash_script</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adtoolbox_singularity</span><span class="o">+</span><span class="s1">&#39; vsearch --top_hits_only --blast6out &#39;</span><span class="o">+</span>
                    <span class="n">match_table</span><span class="o">+</span>
                    <span class="s1">&#39; --usearch_global &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="p">)</span> <span class="o">+</span>
                    <span class="s1">&#39; --db &#39;</span><span class="o">+</span> <span class="n">gtdb_dir_fasta</span> <span class="o">+</span>
                    <span class="s1">&#39; --id &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">vsearch_similarity</span><span class="p">)</span> <span class="o">+</span>
                    <span class="s1">&#39; --threads &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">vsearch_threads</span><span class="p">)</span><span class="o">+</span>
                    <span class="s1">&#39; --alnout &#39;</span><span class="o">+</span> <span class="n">alignment_dir</span> <span class="o">+</span>
                    <span class="s1">&#39; --top_hits_only&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bash_script</span><span class="p">,</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Metagenomics.assign_ec_to_genome" class="doc doc-heading">
<code class="highlight language-python"><span class="n">assign_ec_to_genome</span><span class="p">(</span><span class="n">alignment_file</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function takes an alignment file and assigns the EC numbers to the genomes based on the alignment file,
and the e-adm groupings of the EC numbers. The output is a dictionary where the keys e-adm reactions and the values are the EC numbers,
that are found in the genome and are grouped under the e-adm reaction.</p>
<p>Example: 
    &gt;&gt;&gt; import os
    &gt;&gt;&gt; output = os.path.join(Main_Dir, "test", "ec_to_genome")
    &gt;&gt;&gt; alignments = ["CP001673.1", "Q8YNF9|1.4.4.2", "0.566", "2859", "414", "0", "1021521", "1024379", "27", "982", "0.000E+00", "1109"]
    &gt;&gt;&gt; headers = ["query", "target", "fident", "alnlen", "mismatch", "gapopen", "qstart", "qend ", "tstart", "tend", "evalue", "bits"]
    &gt;&gt;&gt; hit = "\t".join(alignments)
    &gt;&gt;&gt; headers_tab = "\t".join(headers)
    &gt;&gt;&gt; combine = headers_tab + "\n" + hit
    &gt;&gt;&gt; with open(output, "w") as f:
    ...     f.write(combine)
    161
    &gt;&gt;&gt; obj = Metagenomics(configs.Metagenomics())
    &gt;&gt;&gt; obj.assign_ec_to_genome(output) </p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>alignment_file</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The address of the alignment file.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>dict</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>A dictionary containing the e-adm reactions and the EC numbers that are found in the genome and are grouped under the e-adm reaction.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">assign_ec_to_genome</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">alignment_file</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function takes an alignment file and assigns the EC numbers to the genomes based on the alignment file,</span>
<span class="sd">    and the e-adm groupings of the EC numbers. The output is a dictionary where the keys e-adm reactions and the values are the EC numbers,</span>
<span class="sd">    that are found in the genome and are grouped under the e-adm reaction.</span>

<span class="sd">    Example: </span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; output = os.path.join(Main_Dir, &quot;test&quot;, &quot;ec_to_genome&quot;)</span>
<span class="sd">        &gt;&gt;&gt; alignments = [&quot;CP001673.1&quot;, &quot;Q8YNF9|1.4.4.2&quot;, &quot;0.566&quot;, &quot;2859&quot;, &quot;414&quot;, &quot;0&quot;, &quot;1021521&quot;, &quot;1024379&quot;, &quot;27&quot;, &quot;982&quot;, &quot;0.000E+00&quot;, &quot;1109&quot;]</span>
<span class="sd">        &gt;&gt;&gt; headers = [&quot;query&quot;, &quot;target&quot;, &quot;fident&quot;, &quot;alnlen&quot;, &quot;mismatch&quot;, &quot;gapopen&quot;, &quot;qstart&quot;, &quot;qend &quot;, &quot;tstart&quot;, &quot;tend&quot;, &quot;evalue&quot;, &quot;bits&quot;]</span>
<span class="sd">        &gt;&gt;&gt; hit = &quot;\t&quot;.join(alignments)</span>
<span class="sd">        &gt;&gt;&gt; headers_tab = &quot;\t&quot;.join(headers)</span>
<span class="sd">        &gt;&gt;&gt; combine = headers_tab + &quot;\n&quot; + hit</span>
<span class="sd">        &gt;&gt;&gt; with open(output, &quot;w&quot;) as f:</span>
<span class="sd">        ...     f.write(combine)</span>
<span class="sd">        161</span>
<span class="sd">        &gt;&gt;&gt; obj = Metagenomics(configs.Metagenomics())</span>
<span class="sd">        &gt;&gt;&gt; obj.assign_ec_to_genome(output) </span>

<span class="sd">    Args:</span>
<span class="sd">        alignment_file (str): The address of the alignment file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary containing the e-adm reactions and the EC numbers that are found in the genome and are grouped under the e-adm reaction.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">aligntable</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">alignment_file</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">aligntable</span> <span class="o">=</span> <span class="n">aligntable</span><span class="p">[(</span><span class="n">aligntable</span><span class="p">[</span><span class="s2">&quot;bits&quot;</span><span class="p">]</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">bit_score</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">aligntable</span><span class="p">[</span><span class="s2">&quot;evalue&quot;</span><span class="p">]</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">e_value</span><span class="p">)]</span>

    <span class="n">ec_align_list</span> <span class="o">=</span> <span class="n">aligntable</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ec_align_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ec_align_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> 

    <span class="n">metadatatable</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">csv_reaction_db</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="s2">&quot;EC_Numbers&quot;</span><span class="p">)[([</span><span class="s1">&#39;EC_Numbers&#39;</span><span class="p">,</span><span class="s1">&#39;Modified_ADM_Reactions&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">metadatatable</span><span class="o">=</span><span class="n">metadatatable</span><span class="p">[</span><span class="n">metadatatable</span><span class="p">[</span><span class="s2">&quot;EC_Numbers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">ec_align_list</span><span class="p">)]</span>
    <span class="n">adm_reactions</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">metadatatable</span><span class="p">[</span><span class="s2">&quot;Modified_ADM_Reactions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>
    <span class="n">adm_to_ecs</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="n">adm_reactions</span><span class="p">:</span>
        <span class="n">adm_to_ecs</span><span class="p">[</span><span class="n">reaction</span><span class="p">]</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">metadatatable</span><span class="p">[</span><span class="n">metadatatable</span><span class="p">[</span><span class="s2">&quot;Modified_ADM_Reactions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">reaction</span><span class="p">)][</span><span class="s2">&quot;EC_Numbers&quot;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">adm_to_ecs</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Metagenomics.calculate_group_abundances" class="doc doc-heading">
<code class="highlight language-python"><span class="n">calculate_group_abundances</span><span class="p">(</span><span class="n">elements_feature_abundances</span><span class="p">,</span> <span class="n">rel_abund</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method is defined to calculate the features for each sample given:
1) The relative abundances of the genomes in each sample:
    - In this dictionary the keys are the sample names and the values are dictionaries where the keys are the genome names and the values are the relative abundances of the genomes in the sample.
2) The relative abundances of the elements in each genome.
    - In this dictionary the keys are the genome names and the values are dictionaries where the keys are the element names and the values are the relative abundances of the elements in the genome.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <p>None</p>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>elements_feature_abundances</code></td>
          <td>
                <code>dict[str, dict]</code>
          </td>
          <td><p>A dictionary containing the relative abundances of the elements in each genome.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>rel_abund</code></td>
          <td>
                <code>dict[str, dict]</code>
          </td>
          <td><p>A dictionary containing the relative abundances of the genomes in each sample.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>dict[str, dict[str, float]]</code>
          </td>
          <td><p>dict[str,dict[str,float]]: A dictionary containing the relative abundances of the elements in each sample.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_group_abundances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">elements_feature_abundances</span><span class="p">:</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">dict</span><span class="p">],</span><span class="n">rel_abund</span><span class="p">:</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">dict</span><span class="p">])</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">float</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method is defined to calculate the features for each sample given:</span>
<span class="sd">    1) The relative abundances of the genomes in each sample:</span>
<span class="sd">        - In this dictionary the keys are the sample names and the values are dictionaries where the keys are the genome names and the values are the relative abundances of the genomes in the sample.</span>
<span class="sd">    2) The relative abundances of the elements in each genome.</span>
<span class="sd">        - In this dictionary the keys are the genome names and the values are dictionaries where the keys are the element names and the values are the relative abundances of the elements in the genome.</span>

<span class="sd">    Required Configs:</span>
<span class="sd">        None</span>

<span class="sd">    Args:</span>
<span class="sd">        elements_feature_abundances (dict[str,dict]): A dictionary containing the relative abundances of the elements in each genome.</span>
<span class="sd">        rel_abund (dict[str,dict]): A dictionary containing the relative abundances of the genomes in each sample.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict[str,dict[str,float]]: A dictionary containing the relative abundances of the elements in each sample.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">elements_feature_abundances</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">sample</span><span class="p">,</span><span class="n">abunds</span> <span class="ow">in</span> <span class="n">rel_abund</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">out</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span><span class="o">=</span><span class="n">scaler</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">abunds</span><span class="o">.</span><span class="n">keys</span><span class="p">(),:]</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">abunds</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">out</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Metagenomics.download_genome" class="doc doc-heading">
<code class="highlight language-python"><span class="n">download_genome</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function downloads the genomes from NCBI using the refseq/genbank identifiers.
Note that this function uses rsync to download the genomes. </p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <h4 id="adtoolbox.core.Metagenomics.download_genome--configgenomes_base_dir-the-path-to-the-base-directory-where-the-genomes-will-be-saved">config.genomes_base_dir: The path to the base directory where the genomes will be saved.</h4>
<h4 id="adtoolbox.core.Metagenomics.download_genome--configadtoolbox_docker-the-name-of-the-docker-image-to-be-used-by-adtoolbox-only-if-using-docker-as-container">config.adtoolbox_docker: The name of the docker image to be used by ADToolbox (Only if using Docker as container).</h4>
<h4 id="adtoolbox.core.Metagenomics.download_genome--configadtoolbox_singularity-the-name-of-the-singularity-image-to-be-used-by-adtoolbox-only-if-using-singularity-as-container">config.adtoolbox_singularity: The name of the singularity image to be used by ADToolbox (Only if using Singularity as container).</h4>
</details>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="n">genome_identifier</span><span class="o">=</span><span class="s2">&quot;GCA_937889405.1&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">output</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">obj</span> <span class="o">=</span> <span class="n">Metagenomics</span><span class="p">(</span><span class="n">configs</span><span class="o">.</span><span class="n">Metagenomics</span><span class="p">())</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">obj</span><span class="o">.</span><span class="n">download_genome</span><span class="p">(</span><span class="n">identifier</span><span class="o">=</span><span class="n">genome_identifier</span><span class="p">,</span><span class="n">output_dir</span><span class="o">=</span> <span class="n">output</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;rsync -avz --progress rsync://ftp.ncbi.nlm.nih.gov/genomes/all/GCA/937/889/405 &#39;</span><span class="o">+</span><span class="n">output</span>
</code></pre></div>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>identifier</code></td>
          <td>
                <code>list[str]</code>
          </td>
          <td><p>The list of identifiers for the genomes. It can be either refseq or genbank.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>container</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The container to use. Defaults to "None". You may select from "None", "docker", "singularity".</p></td>
          <td>
                <code>&#39;None&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>The bash script that is used to download the genomes or to be used to download the genomes.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_genome</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">identifier</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">output_dir</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">container</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;This function downloads the genomes from NCBI using the refseq/genbank identifiers.</span>
<span class="sd">    Note that this function uses rsync to download the genomes. </span>

<span class="sd">    Required Configs:</span>
<span class="sd">        config.genomes_base_dir: The path to the base directory where the genomes will be saved.</span>
<span class="sd">        ---------</span>
<span class="sd">        config.adtoolbox_docker: The name of the docker image to be used by ADToolbox (Only if using Docker as container).</span>
<span class="sd">        ---------</span>
<span class="sd">        config.adtoolbox_singularity: The name of the singularity image to be used by ADToolbox (Only if using Singularity as container).</span>
<span class="sd">        ---------</span>
<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import os </span>
<span class="sd">        &gt;&gt;&gt; genome_identifier=&quot;GCA_937889405.1&quot;</span>
<span class="sd">        &gt;&gt;&gt; output=os.path.join(Main_Dir,&quot;test&quot;)</span>
<span class="sd">        &gt;&gt;&gt; obj = Metagenomics(configs.Metagenomics()) </span>
<span class="sd">        &gt;&gt;&gt; assert obj.download_genome(identifier=genome_identifier,output_dir= output)[0] == &#39;rsync -avz --progress rsync://ftp.ncbi.nlm.nih.gov/genomes/all/GCA/937/889/405 &#39;+output</span>

<span class="sd">    Args:</span>
<span class="sd">        identifier list[str]: The list of identifiers for the genomes. It can be either refseq or genbank.</span>
<span class="sd">        container (str, optional): The container to use. Defaults to &quot;None&quot;. You may select from &quot;None&quot;, &quot;docker&quot;, &quot;singularity&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The bash script that is used to download the genomes or to be used to download the genomes.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">base_ncbi_dir</span> <span class="o">=</span> <span class="s1">&#39;rsync://ftp.ncbi.nlm.nih.gov/genomes/all/&#39;</span>
    <span class="n">bash_script</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
    <span class="n">identifier</span><span class="o">=</span><span class="n">identifier</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">specific_ncbi_dir</span> <span class="o">=</span> <span class="n">identifier</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span>\
                        <span class="n">identifier</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span>\
                        <span class="n">identifier</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span>\
                        <span class="n">identifier</span><span class="p">[</span><span class="mi">9</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">genome_dir</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;None&quot;</span><span class="p">:</span>
        <span class="n">bash_script</span><span class="o">+=</span><span class="p">(</span><span class="s1">&#39;rsync -avz --progress &#39;</span><span class="o">+</span><span class="n">base_ncbi_dir</span><span class="o">+</span><span class="n">specific_ncbi_dir</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">genome_dir</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;docker&quot;</span><span class="p">:</span>
        <span class="n">bash_script</span><span class="o">+=</span><span class="p">(</span><span class="s1">&#39;docker run -v &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">genome_dir</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">genome_dir</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">+</span> <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adtoolbox_docker</span><span class="si">}</span><span class="s1"> rsync -avz --progress &#39;</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">base_ncbi_dir</span><span class="o">+</span><span class="n">specific_ncbi_dir</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">genome_dir</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;singularity&quot;</span><span class="p">:</span>
        <span class="n">bash_script</span><span class="o">+=</span><span class="p">(</span><span class="s1">&#39;singularity exec -B &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">genome_dir</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">genome_dir</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">+</span> <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adtoolbox_singularity</span><span class="si">}</span><span class="s1"> rsync -avz --progress &#39;</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">base_ncbi_dir</span><span class="o">+</span><span class="n">specific_ncbi_dir</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">genome_dir</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">bash_script</span><span class="p">,</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Metagenomics.extract_ec_from_alignment" class="doc doc-heading">
<code class="highlight language-python"><span class="n">extract_ec_from_alignment</span><span class="p">(</span><span class="n">alignment_file</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function extracts the number of times an EC number is found in the alignment file when aligned to ADToolbox protein database.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <h4 id="adtoolbox.core.Metagenomics.extract_ec_from_alignment--confige_value-the-e-value-threshold-for-the-filtering-the-alignment-table">config.e_value: The e-value threshold for the filtering the alignment table.</h4>
<h4 id="adtoolbox.core.Metagenomics.extract_ec_from_alignment--configbit_score-the-bit-score-threshold-for-the-filtering-the-alignment-table">config.bit_score: The bit score threshold for the filtering the alignment table.</h4>
<h4 id="adtoolbox.core.Metagenomics.extract_ec_from_alignment--configec_counts_from_alignment-the-address-of-the-json-file-that-the-results-will-be-saved-in">config.ec_counts_from_alignment: The address of the json file that the results will be saved in.</h4>
</details>
<details class="example">
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>import os
output = os.path.join(Main_Dir, "test", "mmseqs_alignments.tsv")
alignments = ["CP001673.1", "Q8YNF9|1.4.4.2", "0.566", "2859", "414", "0", "1021521", "1024379", "27", "982", "0.000E+00", "1109"]
headers = ["query", "target", "fident", "alnlen", "mismatch", "gapopen", "qstart", "qend ", "tstart", "tend", "evalue", "bits"]
hit = "\t".join(alignments)
headers_tab = "\t".join(headers)
combine = headers_tab + "\n" + hit
with open(output, "w") as f:
...     f.write(combine)
161
obj = Metagenomics(configs.Metagenomics())
obj.extract_ec_from_alignment(output) 
{'1.4.4.2': 1}</p>
</blockquote>
</blockquote>
</blockquote>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>alignment_file</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The address of the alignment file.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>dict</code></td>          <td>
                <code>dict[str, int]</code>
          </td>
          <td><p>A dictionary of EC numbers and their counts.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_ec_from_alignment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">alignment_file</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">int</span><span class="p">]:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function extracts the number of times an EC number is found in the alignment file when aligned to ADToolbox protein database.</span>

<span class="sd">    Required Configs:</span>
<span class="sd">        config.e_value: The e-value threshold for the filtering the alignment table.</span>
<span class="sd">        ---------</span>
<span class="sd">        config.bit_score: The bit score threshold for the filtering the alignment table.</span>
<span class="sd">        ---------</span>
<span class="sd">        config.ec_counts_from_alignment: The address of the json file that the results will be saved in.</span>
<span class="sd">        ---------</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; output = os.path.join(Main_Dir, &quot;test&quot;, &quot;mmseqs_alignments.tsv&quot;)</span>
<span class="sd">        &gt;&gt;&gt; alignments = [&quot;CP001673.1&quot;, &quot;Q8YNF9|1.4.4.2&quot;, &quot;0.566&quot;, &quot;2859&quot;, &quot;414&quot;, &quot;0&quot;, &quot;1021521&quot;, &quot;1024379&quot;, &quot;27&quot;, &quot;982&quot;, &quot;0.000E+00&quot;, &quot;1109&quot;]</span>
<span class="sd">        &gt;&gt;&gt; headers = [&quot;query&quot;, &quot;target&quot;, &quot;fident&quot;, &quot;alnlen&quot;, &quot;mismatch&quot;, &quot;gapopen&quot;, &quot;qstart&quot;, &quot;qend &quot;, &quot;tstart&quot;, &quot;tend&quot;, &quot;evalue&quot;, &quot;bits&quot;]</span>
<span class="sd">        &gt;&gt;&gt; hit = &quot;\t&quot;.join(alignments)</span>
<span class="sd">        &gt;&gt;&gt; headers_tab = &quot;\t&quot;.join(headers)</span>
<span class="sd">        &gt;&gt;&gt; combine = headers_tab + &quot;\n&quot; + hit</span>
<span class="sd">        &gt;&gt;&gt; with open(output, &quot;w&quot;) as f:</span>
<span class="sd">        ...     f.write(combine)</span>
<span class="sd">        161</span>
<span class="sd">        &gt;&gt;&gt; obj = Metagenomics(configs.Metagenomics())</span>
<span class="sd">        &gt;&gt;&gt; obj.extract_ec_from_alignment(output) </span>
<span class="sd">        {&#39;1.4.4.2&#39;: 1}</span>

<span class="sd">    Args:</span>
<span class="sd">        alignment_file (str): The address of the alignment file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary of EC numbers and their counts.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span><span class="o">=</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">scan_csv</span><span class="p">(</span><span class="n">alignment_file</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,)</span> 
    <span class="o">.</span><span class="n">filter</span><span class="p">((</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;evalue&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">e_value</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;bits&quot;</span><span class="p">)</span> <span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">bit_score</span><span class="p">))</span>
    <span class="o">.</span><span class="n">with_columns</span><span class="p">((</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;target&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split_exact</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">struct</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;EC&quot;</span><span class="p">)))</span>
    <span class="o">.</span><span class="n">unique</span><span class="p">([</span><span class="s2">&quot;query&quot;</span><span class="p">,</span><span class="s2">&quot;EC&quot;</span><span class="p">],</span><span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;EC&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">streaming</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">to_dicts</span><span class="p">())</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;EC&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Metagenomics.extract_genome_info" class="doc doc-heading">
<code class="highlight language-python"><span class="n">extract_genome_info</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">endpattern</span><span class="o">=</span><span class="s1">&#39;genomic.fna.gz&#39;</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;INCLUDE&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;EXCLUDE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;cds&#39;</span><span class="p">,</span> <span class="s1">&#39;rna&#39;</span><span class="p">]})</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function extracts the genome information from the genomes base directory. The output
is a dictionary where the keys are the genome IDs and the values are the paths to the genome files.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <p>None</p>
</details>      <hr />

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>base_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The path to the base directory where the genomes are saved.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>endpattern</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The end pattern of the genome files. Defaults to "genomic.fna.gz".</p></td>
          <td>
                <code>&#39;genomic.fna.gz&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>filters</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>The filters to be applied to the genome files. This filter must be a </p></td>
          <td>
                <code>{&#39;INCLUDE&#39;: [], &#39;EXCLUDE&#39;: [&#39;cds&#39;, &#39;rna&#39;]}</code>
          </td>
        </tr>
        <tr>
          <td><code>dictionary</code></td>
          <td>
                <code>with two keys</code>
          </td>
          <td><p>INCLUDE and EXCLUDE. The values of these keys must be lists of strings.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Defaults</code></td>
          <td>
                <code>to {&#34;INCLUDE&#34;</code>
          </td>
          <td><p>[],"EXCLUDE":["cds","rna"]}. This defult is compatible with the genomes downloaded</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>dict[str, str]</code>
          </td>
          <td><p>dict[str,str]: A dictionary containing the address of the genomes that are downloaded or to be downloaded.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_genome_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">base_dir</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
                        <span class="n">endpattern</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;genomic.fna.gz&quot;</span><span class="p">,</span>
                        <span class="n">filters</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="p">{</span>
                                      <span class="s2">&quot;INCLUDE&quot;</span><span class="p">:[],</span>
                                      <span class="s2">&quot;EXCLUDE&quot;</span><span class="p">:[</span><span class="s2">&quot;cds&quot;</span><span class="p">,</span><span class="s2">&quot;rna&quot;</span><span class="p">],</span>
                                        <span class="p">})</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;This function extracts the genome information from the genomes base directory. The output</span>
<span class="sd">    is a dictionary where the keys are the genome IDs and the values are the paths to the genome files.</span>

<span class="sd">    Required Configs:</span>
<span class="sd">        None</span>
<span class="sd">    ---------</span>
<span class="sd">    Args:</span>
<span class="sd">        base_dir (str): The path to the base directory where the genomes are saved.</span>
<span class="sd">        endpattern (str, optional): The end pattern of the genome files. Defaults to &quot;genomic.fna.gz&quot;.</span>
<span class="sd">        filters (dict, optional): The filters to be applied to the genome files. This filter must be a </span>
<span class="sd">        dictionary with two keys: INCLUDE and EXCLUDE. The values of these keys must be lists of strings.</span>
<span class="sd">        Defaults to {&quot;INCLUDE&quot;:[],&quot;EXCLUDE&quot;:[&quot;cds&quot;,&quot;rna&quot;]}. This defult is compatible with the genomes downloaded</span>
<span class="sd">        from NCBI i.e. only change this if you are providing your own genomes with different file name conventions.</span>
<span class="sd">    Returns:</span>
<span class="sd">        dict[str,str]: A dictionary containing the address of the genomes that are downloaded or to be downloaded.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">base_dir</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">base_dir</span><span class="p">)</span>
    <span class="n">genome_info</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">genome_dir</span> <span class="ow">in</span> <span class="n">base_dir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">genome_dir</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
            <span class="n">candids</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">genome_dir</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;*</span><span class="si">{</span><span class="n">endpattern</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">candid</span> <span class="ow">in</span> <span class="n">candids</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">i</span> <span class="ow">in</span> <span class="n">candid</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;INCLUDE&quot;</span><span class="p">]])</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">([</span><span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">candid</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;EXCLUDE&quot;</span><span class="p">]]):</span>
                    <span class="n">genome_info</span><span class="p">[</span><span class="n">candid</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_genomic.fna.gz&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">candid</span><span class="o">.</span><span class="n">absolute</span><span class="p">())</span>           
    <span class="k">return</span> <span class="n">genome_info</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Metagenomics.extract_relative_abundances" class="doc doc-heading">
<code class="highlight language-python"><span class="n">extract_relative_abundances</span><span class="p">(</span><span class="n">feature_table_dir</span><span class="p">,</span> <span class="n">sample_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method extracts the relative abundances of the features in each sample from the feature table. The feature table must follow the qiime2 feature-table format.
NOTE: The final feature abundances sum to 1 for each sample.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <p>None</p>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>feature_table_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The path to the feature table.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>sample_names</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[list[str], None]</code>
          </td>
          <td><p>The list of sample names. to be considered. If None, all the samples will be considered. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>top_k</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The number of top features to be used. If -1, all the features will be used. Defaults to -1.</p></td>
          <td>
                <code>-1</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>dict</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>A dictionary containing the relative abundances of the features in each sample.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_relative_abundances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">feature_table_dir</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">sample_names</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span><span class="kc">None</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">top_k</span><span class="p">:</span><span class="nb">int</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">:</span>

    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method extracts the relative abundances of the features in each sample from the feature table. The feature table must follow the qiime2 feature-table format.</span>
<span class="sd">    NOTE: The final feature abundances sum to 1 for each sample.</span>
<span class="sd">    Required Configs:</span>
<span class="sd">        None</span>
<span class="sd">    Args:</span>
<span class="sd">        feature_table_dir (str): The path to the feature table.</span>
<span class="sd">        sample_names (Union[list[str],None], optional): The list of sample names. to be considered. If None, all the samples will be considered. Defaults to None.</span>
<span class="sd">        top_k (int, optional): The number of top features to be used. If -1, all the features will be used. Defaults to -1.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary containing the relative abundances of the features in each sample.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">feature_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">feature_table_dir</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sample_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sample_names</span> <span class="o">=</span> <span class="n">feature_table</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">relative_abundances</span><span class="o">=</span><span class="p">{</span><span class="n">sample</span><span class="p">:[]</span> <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">sample_names</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">top_k</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">top_k</span> <span class="o">=</span> <span class="n">feature_table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">sample_names</span><span class="p">:</span>
        <span class="n">relative_abundances</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">feature_table</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">top_k</span><span class="p">)[</span><span class="n">sample</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">feature_table</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">top_k</span><span class="p">)[</span><span class="n">sample</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">relative_abundances</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Metagenomics.find_top_taxa" class="doc doc-heading">
<code class="highlight language-python"><span class="n">find_top_taxa</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span> <span class="n">treshold</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;top_k&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function needs three inputs from qiime:
1. feature table: This is the abundance of each feature in each sample (TSV).
2. taxonomy table: This is the taxonomy of each feature (TSV). 
3. rep seqs: This is the representative sequence of each feature (fasta).
It then finds the top k features or features that form specific percentile of the community of the sample.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <h4 id="adtoolbox.core.Metagenomics.find_top_taxa--configfeature_table_dir-the-path-to-the-feature-table-tsv-file">config.feature_table_dir: The path to the feature table tsv file.</h4>
<h4 id="adtoolbox.core.Metagenomics.find_top_taxa--configtaxonomy_table_dir-the-path-to-the-taxonomy-table-tsv-file">config.taxonomy_table_dir: The path to the taxonomy table tsv file.</h4>
<h4 id="adtoolbox.core.Metagenomics.find_top_taxa--configrep_seq_fasta-the-path-to-the-representative-sequence-fasta-file">config.rep_seq_fasta: The path to the representative sequence fasta file.</h4>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>sample_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The name of the sample.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>threshold</code></td>
          <td>
                <code>int, float</code>
          </td>
          <td><p>The threshold for the top k or the percentile.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>mode</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Whether to find the top k features or features that form specific percentile of the community of the sample. Defaults to 'top_k'. Options: 'top_k', 'percentile'.</p></td>
          <td>
                <code>&#39;top_k&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>dict</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>A dictionary of the top k features and their taxonomy.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_top_taxa</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">sample_name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
    <span class="n">treshold</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">],</span>
    <span class="n">mode</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;top_k&#39;</span><span class="p">,</span>
    <span class="p">)</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function needs three inputs from qiime:</span>
<span class="sd">    1. feature table: This is the abundance of each feature in each sample (TSV).</span>
<span class="sd">    2. taxonomy table: This is the taxonomy of each feature (TSV). </span>
<span class="sd">    3. rep seqs: This is the representative sequence of each feature (fasta).</span>
<span class="sd">    It then finds the top k features or features that form specific percentile of the community of the sample.</span>

<span class="sd">    Required Configs:</span>

<span class="sd">        config.feature_table_dir: The path to the feature table tsv file.</span>
<span class="sd">        ---------</span>
<span class="sd">        config.taxonomy_table_dir: The path to the taxonomy table tsv file.</span>
<span class="sd">        ---------</span>
<span class="sd">        config.rep_seq_fasta: The path to the representative sequence fasta file.</span>
<span class="sd">        ---------</span>

<span class="sd">    Args:</span>
<span class="sd">        sample_name (str): The name of the sample.</span>
<span class="sd">        threshold (int, float): The threshold for the top k or the percentile.</span>
<span class="sd">        mode (str, optional): Whether to find the top k features or features that form specific percentile of the community of the sample. Defaults to &#39;top_k&#39;. Options: &#39;top_k&#39;, &#39;percentile&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary of the top k features and their taxonomy.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">### Load all the required files</span>
    <span class="n">feature_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feature_table_dir</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">taxonomy_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">taxonomy_table_dir</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">repseqs</span><span class="o">=</span><span class="n">fasta_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">rep_seq_fasta</span><span class="p">)</span>
    <span class="c1">### End Loading</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;top_k&#39;</span><span class="p">:</span>
        <span class="n">sorted_df</span><span class="o">=</span><span class="n">feature_table</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">top_featureids</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">sorted_df</span><span class="p">[</span><span class="s1">&#39;#OTU ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">treshold</span><span class="p">))</span>
        <span class="n">top_taxa</span><span class="o">=</span><span class="p">[</span><span class="n">taxonomy_table</span><span class="p">[</span><span class="n">taxonomy_table</span><span class="p">[</span><span class="s1">&#39;Feature ID&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">featureid</span><span class="p">][</span><span class="s1">&#39;Taxon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">featureid</span> <span class="ow">in</span> <span class="n">top_featureids</span><span class="p">]</span>
        <span class="n">top_repseqs</span><span class="o">=</span><span class="p">[</span><span class="n">repseqs</span><span class="p">[</span><span class="n">featureid</span><span class="p">]</span> <span class="k">for</span> <span class="n">featureid</span> <span class="ow">in</span> <span class="n">top_featureids</span><span class="p">]</span>
        <span class="n">top_abundances</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">sorted_df</span><span class="p">[</span><span class="n">sample_name</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">treshold</span><span class="p">)</span><span class="o">/</span><span class="n">sorted_df</span><span class="p">[</span><span class="n">sample_name</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;percentile&#39;</span><span class="p">:</span>
        <span class="n">feature_table</span><span class="p">[</span><span class="n">sample_name</span><span class="p">]</span><span class="o">=</span><span class="n">feature_table</span><span class="p">[</span><span class="n">sample_name</span><span class="p">]</span><span class="o">/</span><span class="n">feature_table</span><span class="p">[</span><span class="n">sample_name</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">sorted_df</span><span class="o">=</span><span class="n">feature_table</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">sorted_df</span><span class="p">[</span><span class="s1">&#39;cumsum&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sorted_df</span><span class="p">[</span><span class="n">sample_name</span><span class="p">]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span>
        <span class="n">sorted_df_filtered</span><span class="o">=</span><span class="n">sorted_df</span><span class="p">[</span><span class="n">sorted_df</span><span class="p">[</span><span class="s1">&#39;cumsum&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">treshold</span><span class="p">]</span>
        <span class="n">top_featureids</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">sorted_df_filtered</span><span class="p">[</span><span class="s1">&#39;#OTU ID&#39;</span><span class="p">])</span>
        <span class="n">top_taxa</span><span class="o">=</span><span class="p">[</span><span class="n">taxonomy_table</span><span class="p">[</span><span class="n">taxonomy_table</span><span class="p">[</span><span class="s1">&#39;Feature ID&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">featureid</span><span class="p">][</span><span class="s1">&#39;Taxon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">featureid</span> <span class="ow">in</span> <span class="n">top_featureids</span><span class="p">]</span>
        <span class="n">top_repseqs</span><span class="o">=</span><span class="p">[</span><span class="n">repseqs</span><span class="p">[</span><span class="n">featureid</span><span class="p">]</span> <span class="k">for</span> <span class="n">featureid</span> <span class="ow">in</span> <span class="n">top_featureids</span><span class="p">]</span>
        <span class="n">top_abundances</span><span class="o">=</span><span class="n">sorted_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sorted_df_filtered</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="n">sample_name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;mode must be either &#39;top_k&#39; or &#39;percentile&#39;&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;top_featureids&#39;</span><span class="p">:</span><span class="n">top_featureids</span><span class="p">,</span><span class="s1">&#39;top_taxa&#39;</span><span class="p">:</span><span class="n">top_taxa</span><span class="p">,</span><span class="s1">&#39;top_repseqs&#39;</span><span class="p">:</span><span class="n">top_repseqs</span><span class="p">,</span><span class="s1">&#39;top_abundances&#39;</span><span class="p">:</span><span class="n">top_abundances</span><span class="p">}</span>    
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Metagenomics.get_cod_from_ec_counts" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_cod_from_ec_counts</span><span class="p">(</span><span class="n">ec_counts</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function takes a json file that comtains ec counts and converts it to ADM microbial agents counts.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <h4 id="adtoolbox.core.Metagenomics.get_cod_from_ec_counts--configadm_mapping-a-dictionary-that-maps-adm-reactions-to-adm-microbial-agents">config.adm_mapping : A dictionary that maps ADM reactions to ADM microbial agents.</h4>
<h4 id="adtoolbox.core.Metagenomics.get_cod_from_ec_counts--configcsv_reaction_db-the-address-of-the-reaction-database-of-adtoolbox">config.csv_reaction_db : The address of the reaction database of ADToolbox.</h4>
<h4 id="adtoolbox.core.Metagenomics.get_cod_from_ec_counts--configadm_cod_from_ec-the-address-of-the-json-file-that-the-results-will-be-saved-in">config.adm_cod_from_ec  : The address of the json file that the results will be saved in.</h4>
</details>
<details class="example">
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>import os
output = os.path.join(Main_Dir, "test", "cod_from_ec_counts")
alignments = ["CP001673.1", "Q8YNF9|1.4.4.2", "0.566", "2859", "414", "0", "1021521", "1024379", "27", "982", "0.000E+00", "1109"]
headers = ["query", "target", "fident", "alnlen", "mismatch", "gapopen", "qstart", "qend ", "tstart", "tend", "evalue", "bits"]
hit = "\t".join(alignments)
headers_tab = "\t".join(headers)
combine = headers_tab + "\n" + hit
with open(output, "w") as f:
...     f.write(combine)
161
obj = Metagenomics(configs.Metagenomics())
obj.get_cod_from_ec_counts(output) 
[('ADM_microbe_1', 161), ('ADM_microbe_2', 0), ('ADM_microbe_3', 0)]</p>
</blockquote>
</blockquote>
</blockquote>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>ec_counts</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>A dictionary containing the counts for each ec number.  </p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>dict</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>A dictionary containing the ADM microbial agents counts.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_cod_from_ec_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ec_counts</span><span class="p">:</span><span class="nb">dict</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;This function takes a json file that comtains ec counts and converts it to ADM microbial agents counts.</span>
<span class="sd">    Required Configs:</span>
<span class="sd">        config.adm_mapping : A dictionary that maps ADM reactions to ADM microbial agents.</span>
<span class="sd">        ---------</span>
<span class="sd">        config.csv_reaction_db : The address of the reaction database of ADToolbox.</span>
<span class="sd">        ---------</span>
<span class="sd">        config.adm_cod_from_ec  : The address of the json file that the results will be saved in.</span>
<span class="sd">        ---------</span>
<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; output = os.path.join(Main_Dir, &quot;test&quot;, &quot;cod_from_ec_counts&quot;)</span>
<span class="sd">        &gt;&gt;&gt; alignments = [&quot;CP001673.1&quot;, &quot;Q8YNF9|1.4.4.2&quot;, &quot;0.566&quot;, &quot;2859&quot;, &quot;414&quot;, &quot;0&quot;, &quot;1021521&quot;, &quot;1024379&quot;, &quot;27&quot;, &quot;982&quot;, &quot;0.000E+00&quot;, &quot;1109&quot;]</span>
<span class="sd">        &gt;&gt;&gt; headers = [&quot;query&quot;, &quot;target&quot;, &quot;fident&quot;, &quot;alnlen&quot;, &quot;mismatch&quot;, &quot;gapopen&quot;, &quot;qstart&quot;, &quot;qend &quot;, &quot;tstart&quot;, &quot;tend&quot;, &quot;evalue&quot;, &quot;bits&quot;]</span>
<span class="sd">        &gt;&gt;&gt; hit = &quot;\t&quot;.join(alignments)</span>
<span class="sd">        &gt;&gt;&gt; headers_tab = &quot;\t&quot;.join(headers)</span>
<span class="sd">        &gt;&gt;&gt; combine = headers_tab + &quot;\n&quot; + hit</span>
<span class="sd">        &gt;&gt;&gt; with open(output, &quot;w&quot;) as f:</span>
<span class="sd">        ...     f.write(combine)</span>
<span class="sd">        161</span>
<span class="sd">        &gt;&gt;&gt; obj = Metagenomics(configs.Metagenomics())</span>
<span class="sd">        &gt;&gt;&gt; obj.get_cod_from_ec_counts(output) </span>
<span class="sd">        [(&#39;ADM_microbe_1&#39;, 161), (&#39;ADM_microbe_2&#39;, 0), (&#39;ADM_microbe_3&#39;, 0)]</span>

<span class="sd">    Args:</span>
<span class="sd">        ec_counts (dict): A dictionary containing the counts for each ec number.  </span>
<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary containing the ADM microbial agents counts.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reaction_db</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">csv_reaction_db</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="s2">&quot;EC_Numbers&quot;</span><span class="p">)</span>
    <span class="n">reaction_db</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;EC_Numbers&quot;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">adm_reactions_agents</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="mi">0</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adm_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
    <span class="k">for</span> <span class="n">ec</span> <span class="ow">in</span> <span class="n">ec_counts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">l</span><span class="o">=</span><span class="n">reaction_db</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ec</span><span class="p">,</span><span class="s2">&quot;e_adm_Reactions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">adm_rxn</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span> 
            <span class="n">adm_reactions_agents</span><span class="p">[</span><span class="n">adm_rxn</span><span class="p">]</span><span class="o">+=</span><span class="n">ec_counts</span><span class="p">[</span><span class="n">ec</span><span class="p">]</span>
    <span class="n">adm_microbial_agents</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adm_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">adm_microbial_agents</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">=</span><span class="n">adm_reactions_agents</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">adm_microbial_agents</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Metagenomics.get_genomes_from_gtdb_alignment" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_genomes_from_gtdb_alignment</span><span class="p">(</span><span class="n">alignment_dir</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function takes the alignment file generated from the align_to_gtdb function and generates the the genome information
using the GTDB-Tk. In the outputted dictionary, the keys are feature ids and the values are the representative genomes.</p>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">alignments</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;0034e3d0368ec41aeb7f346b434f8d46&quot;</span><span class="p">,</span><span class="s2">&quot;GB_GCA_937889405.1~CALAPC010000121.1&quot;</span><span class="p">,</span><span class="s2">&quot;100.0&quot;</span><span class="p">,</span><span class="s2">&quot;253&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span>     <span class="p">,</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;253&quot;</span><span class="p">,</span>     <span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;1009&quot;</span><span class="p">,</span>     <span class="s2">&quot;-1&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hit</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">alignments</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">output</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Main_Dir</span><span class="p">,</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="s2">&quot;matches.blast&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">... </span>   <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">hit</span><span class="p">)</span>
<span class="go">101</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">obj</span><span class="o">=</span><span class="n">Metagenomics</span><span class="p">(</span><span class="n">configs</span><span class="o">.</span><span class="n">Metagenomics</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">obj</span><span class="o">.</span><span class="n">get_genomes_from_gtdb_alignment</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
<span class="go">{&#39;0034e3d0368ec41aeb7f346b434f8d46&#39;: &#39;GCA_937889405.1&#39;}</span>
</code></pre></div>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>save</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to save the json file or not. Defaults to True.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_genomes_from_gtdb_alignment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">alignment_dir</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;This function takes the alignment file generated from the align_to_gtdb function and generates the the genome information</span>
<span class="sd">    using the GTDB-Tk. In the outputted dictionary, the keys are feature ids and the values are the representative genomes.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; alignments=[&quot;0034e3d0368ec41aeb7f346b434f8d46&quot;,&quot;GB_GCA_937889405.1~CALAPC010000121.1&quot;,&quot;100.0&quot;,&quot;253&quot;,&quot;0&quot;,&quot;0&quot;	,&quot;1&quot;,&quot;253&quot;,	&quot;1&quot;,&quot;1009&quot;,	&quot;-1&quot;,&quot;0&quot;]</span>
<span class="sd">        &gt;&gt;&gt; hit=&quot;\t&quot;.join(alignments)</span>
<span class="sd">        &gt;&gt;&gt; output= os.path.join(Main_Dir,&quot;test&quot;,&quot;matches.blast&quot;)</span>
<span class="sd">        &gt;&gt;&gt; with open(output,&quot;w&quot;) as f:</span>
<span class="sd">        ...    f.write(hit)</span>
<span class="sd">        101</span>
<span class="sd">        &gt;&gt;&gt; obj=Metagenomics(configs.Metagenomics())</span>
<span class="sd">        &gt;&gt;&gt; obj.get_genomes_from_gtdb_alignment(output)</span>
<span class="sd">        {&#39;0034e3d0368ec41aeb7f346b434f8d46&#39;: &#39;GCA_937889405.1&#39;}</span>


<span class="sd">    Args:</span>
<span class="sd">        save (bool, optional): Whether to save the json file or not. Defaults to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">alignment_dir</span><span class="p">)</span>
    <span class="n">aligned</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">matches</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">aligned</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">aligned</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">aligned</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">alignment_dict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">aligned</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">aligned</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">alignment_dict</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Metagenomics.merge_paired_sequences" class="doc doc-heading">
<code class="highlight language-python"><span class="n">merge_paired_sequences</span><span class="p">(</span><span class="n">read_1</span><span class="p">,</span> <span class="n">read_2</span><span class="p">,</span> <span class="n">outputfile</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method merges the paired end reads using the fastp tool. Note that any additional keyword arguments will be passed to the fastp tool.   </p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <p>None</p>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>read_1</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The directory of the forward reads file.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>read_2</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The directory of the reverse reads file.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>outputfile</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The directory of the output file.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>container</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The containerization tool that will be used to run the bash scripts. Defaults to "None". Options are "None","docker","singularity".</p></td>
          <td>
                <code>&#39;None&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
                <code>tuple[str]</code>
          </td>
          <td><p>The bash script that will be used to merge the paired end reads in python string format</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">merge_paired_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">read_1</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">read_2</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">outputfile</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">container</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot; This method merges the paired end reads using the fastp tool. Note that any additional keyword arguments will be passed to the fastp tool.   </span>
<span class="sd">    Required Configs:</span>
<span class="sd">        None</span>
<span class="sd">    Args:</span>
<span class="sd">        read_1 (str): The directory of the forward reads file.</span>
<span class="sd">        read_2 (str): The directory of the reverse reads file.</span>
<span class="sd">        outputfile (str): The directory of the output file.</span>
<span class="sd">        container (str, optional): The containerization tool that will be used to run the bash scripts. Defaults to &quot;None&quot;. Options are &quot;None&quot;,&quot;docker&quot;,&quot;singularity&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The bash script that will be used to merge the paired end reads in python string format</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;None&quot;</span><span class="p">:</span>
        <span class="n">bash_script</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;fastp -i </span><span class="si">{</span><span class="n">read_1</span><span class="si">}</span><span class="s2"> -I </span><span class="si">{</span><span class="n">read_2</span><span class="si">}</span><span class="s2">  -m --merged_out </span><span class="si">{</span><span class="n">outputfile</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">key_</span><span class="o">=</span><span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
            <span class="n">bash_script</span><span class="o">+=</span><span class="sa">f</span><span class="s2">&quot; --</span><span class="si">{</span><span class="n">key_</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2"> &quot;</span>

    <span class="k">elif</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;docker&quot;</span><span class="p">:</span>
        <span class="n">bash_script</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;docker run -v </span><span class="si">{</span><span class="n">read_1</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">read_1</span><span class="si">}</span><span class="s2"> -v </span><span class="si">{</span><span class="n">read_2</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">read_2</span><span class="si">}</span><span class="s2"> -v </span><span class="si">{</span><span class="n">outputfile</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">outputfile</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adtoolbox_docker</span><span class="si">}</span><span class="s2"> fastp -i </span><span class="si">{</span><span class="n">read_1</span><span class="si">}</span><span class="s2"> -I </span><span class="si">{</span><span class="n">read_2</span><span class="si">}</span><span class="s2">  -m --merged_out </span><span class="si">{</span><span class="n">outputfile</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">key_</span><span class="o">=</span><span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
            <span class="n">bash_script</span><span class="o">+=</span><span class="sa">f</span><span class="s2">&quot; --</span><span class="si">{</span><span class="n">key_</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2"> &quot;</span>

    <span class="k">elif</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;singularity&quot;</span><span class="p">:</span>
        <span class="n">bash_script</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;singularity exec </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adtoolbox_singularity</span><span class="si">}</span><span class="s2"> fastp -i </span><span class="si">{</span><span class="n">read_1</span><span class="si">}</span><span class="s2"> -I </span><span class="si">{</span><span class="n">read_2</span><span class="si">}</span><span class="s2">  -m --merged_out </span><span class="si">{</span><span class="n">outputfile</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">key_</span><span class="o">=</span><span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
            <span class="n">bash_script</span><span class="o">+=</span><span class="sa">f</span><span class="s2">&quot; --</span><span class="si">{</span><span class="n">key_</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2"> &quot;</span>

    <span class="k">return</span> <span class="n">bash_script</span><span class="p">,</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Metagenomics.run_qiime2_from_sra" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run_qiime2_from_sra</span><span class="p">(</span><span class="n">read_1</span><span class="p">,</span> <span class="n">read_2</span><span class="p">,</span> <span class="n">sample_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">manifest_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">workings_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save_manifest</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method uses the input fastq files to run qiime2. The method uses the qiime2 template scripts that are provided in pkg_data module.
The method also creates a manifest file for qiime2. The manifest file is created based on the input fastq files.</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <h4 id="adtoolbox.core.Metagenomics.run_qiime2_from_sra--configqiime2_single_end_bash_str-the-path-to-the-qiime2-bash-script-for-single-end-reads">config.qiime2_single_end_bash_str: The path to the qiime2 bash script for single end reads.</h4>
<h4 id="adtoolbox.core.Metagenomics.run_qiime2_from_sra--configqiime2_paired_end_bash_str-the-path-to-the-qiime2-bash-script-for-paired-end-reads">config.qiime2_paired_end_bash_str: The path to the qiime2 bash script for paired end reads.</h4>
<h4 id="adtoolbox.core.Metagenomics.run_qiime2_from_sra--configqiime_classifier_db-the-path-to-the-qiime2-classifier-database">config.qiime_classifier_db: The path to the qiime2 classifier database.</h4>
<h4 id="adtoolbox.core.Metagenomics.run_qiime2_from_sra--configqiime2_docker_image-the-name-of-the-docker-image-to-be-used-by-adtoolbox-only-if-using-docker-as-container">config.qiime2_docker_image: The name of the docker image to be used by ADToolbox (Only if using Docker as container).</h4>
<h4 id="adtoolbox.core.Metagenomics.run_qiime2_from_sra--configqiime2_singularity_image-the-name-of-the-singularity-image-to-be-used-by-adtoolbox-only-if-using-singularity-as-container">config.qiime2_singularity_image: The name of the singularity image to be used by ADToolbox (Only if using Singularity as container).</h4>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>read_1</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>directory of the forward reads file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>read_2</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>directory of the reverse reads file. This is provided only if the reads are paired end. If this is not the case,</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>sample_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The name of the sample. If None, the name of the sample will be the name of the directory where the fastq files are located. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>manifest_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The directory where the manifest file will be saved. If None, the manifest file will be saved in the same directory as the fastq files. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>workings_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The directory where the qiime2 outputs will be saved. If None, the outputs will be saved in the same directory as the fastq files. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>container</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>If you want to run the qiime2 commands in a container, specify the container name here. Defaults to 'None'.</p></td>
          <td>
                <code>&#39;None&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>qiime2_bash_str</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>The bash script that will be used to run qiime2 in python string format</p></td>
        </tr>
        <tr>
<td><code>manifest</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>The manifest file that will be used to run qiime2 in python dictionary format</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span>
<span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span>
<span class="normal">2188</span>
<span class="normal">2189</span>
<span class="normal">2190</span>
<span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span>
<span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span>
<span class="normal">2230</span>
<span class="normal">2231</span>
<span class="normal">2232</span>
<span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span>
<span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span>
<span class="normal">2248</span>
<span class="normal">2249</span>
<span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span>
<span class="normal">2255</span>
<span class="normal">2256</span>
<span class="normal">2257</span>
<span class="normal">2258</span>
<span class="normal">2259</span>
<span class="normal">2260</span>
<span class="normal">2261</span>
<span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span>
<span class="normal">2265</span>
<span class="normal">2266</span>
<span class="normal">2267</span>
<span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span>
<span class="normal">2273</span>
<span class="normal">2274</span>
<span class="normal">2275</span>
<span class="normal">2276</span>
<span class="normal">2277</span>
<span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span>
<span class="normal">2283</span>
<span class="normal">2284</span>
<span class="normal">2285</span>
<span class="normal">2286</span>
<span class="normal">2287</span>
<span class="normal">2288</span>
<span class="normal">2289</span>
<span class="normal">2290</span>
<span class="normal">2291</span>
<span class="normal">2292</span>
<span class="normal">2293</span>
<span class="normal">2294</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_qiime2_from_sra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">read_1</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
                        <span class="n">read_2</span><span class="p">:</span><span class="nb">str</span><span class="o">|</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">sample_name</span><span class="p">:</span><span class="nb">str</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">manifest_dir</span><span class="p">:</span><span class="nb">str</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">workings_dir</span><span class="p">:</span><span class="nb">str</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">save_manifest</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">container</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span>
                        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method uses the input fastq files to run qiime2. The method uses the qiime2 template scripts that are provided in pkg_data module.</span>
<span class="sd">    The method also creates a manifest file for qiime2. The manifest file is created based on the input fastq files.</span>
<span class="sd">    Required Configs:</span>
<span class="sd">        config.qiime2_single_end_bash_str: The path to the qiime2 bash script for single end reads.</span>
<span class="sd">        ---------</span>
<span class="sd">        config.qiime2_paired_end_bash_str: The path to the qiime2 bash script for paired end reads.</span>
<span class="sd">        ---------</span>
<span class="sd">        config.qiime_classifier_db: The path to the qiime2 classifier database.</span>
<span class="sd">        ---------</span>
<span class="sd">        config.qiime2_docker_image: The name of the docker image to be used by ADToolbox (Only if using Docker as container).</span>
<span class="sd">        ---------</span>
<span class="sd">        config.qiime2_singularity_image: The name of the singularity image to be used by ADToolbox (Only if using Singularity as container).</span>
<span class="sd">        ---------</span>
<span class="sd">    Args:</span>
<span class="sd">        read_1 (str): directory of the forward reads file</span>
<span class="sd">        read_2 (str): directory of the reverse reads file. This is provided only if the reads are paired end. If this is not the case,</span>
<span class="sd">        sample_name (str, optional): The name of the sample. If None, the name of the sample will be the name of the directory where the fastq files are located. Defaults to None.</span>
<span class="sd">        manifest_dir (str, optional): The directory where the manifest file will be saved. If None, the manifest file will be saved in the same directory as the fastq files. Defaults to None.</span>
<span class="sd">        workings_dir (str, optional): The directory where the qiime2 outputs will be saved. If None, the outputs will be saved in the same directory as the fastq files. Defaults to None.</span>
<span class="sd">        container (str, optional): If you want to run the qiime2 commands in a container, specify the container name here. Defaults to &#39;None&#39;.</span>
<span class="sd">    Returns:</span>
<span class="sd">        qiime2_bash_str (str): The bash script that will be used to run qiime2 in python string format</span>
<span class="sd">        manifest (dict): The manifest file that will be used to run qiime2 in python dictionary format</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">sample_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sample_name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">read_1</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">manifest_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">manifest_dir</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">read_1</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">manifest_dir</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">manifest_dir</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">workings_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">workings_dir</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">read_1</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">workings_dir</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">workings_dir</span><span class="p">)</span>


    <span class="n">manifest_single</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sample-id&#39;</span><span class="p">:[],</span><span class="s1">&#39;absolute-filepath&#39;</span><span class="p">:[]}</span>
    <span class="n">manifest_paired</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sample-id&#39;</span><span class="p">:[],</span><span class="s1">&#39;forward-absolute-filepath&#39;</span><span class="p">:[],</span><span class="s1">&#39;reverse-absolute-filepath&#39;</span><span class="p">:[]}</span>  
    <span class="k">if</span> <span class="n">read_2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">manifest_paired</span><span class="p">[</span><span class="s1">&#39;sample-id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample_name</span><span class="p">)</span>
        <span class="n">manifest_paired</span><span class="p">[</span><span class="s1">&#39;forward-absolute-filepath&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">read_1</span><span class="p">)</span>
        <span class="n">manifest_paired</span><span class="p">[</span><span class="s1">&#39;reverse-absolute-filepath&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">read_2</span><span class="p">)</span>
        <span class="n">paired_end</span><span class="o">=</span><span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">manifest_single</span><span class="p">[</span><span class="s1">&#39;sample-id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample_name</span><span class="p">)</span>
        <span class="n">manifest_single</span><span class="p">[</span><span class="s1">&#39;absolute-filepath&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">read_1</span><span class="p">)</span>
        <span class="n">paired_end</span><span class="o">=</span><span class="kc">False</span>

    <span class="n">manifest</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">manifest_single</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">paired_end</span> <span class="k">else</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">manifest_paired</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">paired_end</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime2_paired_end_bash_str</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime2_single_end_bash_str</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;p_trunc_len&quot;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">paired_end</span><span class="p">:</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;p-trunc-len&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;p_trunc_len&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;p-trunc-len-f&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;p_trunc_len&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;p-trunc-len-r&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;p_trunc_len&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">paired_end</span><span class="p">:</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;p-trunc-len&gt;&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime2_p_trunc_len</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;p-trunc-len-f&gt;&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime2_p_trunc_len</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;p-trunc-len-r&gt;&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime2_p_trunc_len</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;None&quot;</span><span class="p">:</span>
        <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;manifest&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">manifest_dir</span><span class="p">))</span>
        <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;qiime2_work_dir&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">workings_dir</span><span class="p">))</span>
        <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;classifier&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">))</span>


    <span class="k">elif</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;docker&quot;</span><span class="p">:</span>
        <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">qiime2_bash_str</span><span class="p">):</span>
            <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;qiime&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;biom&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">paired_end</span><span class="p">:</span>
                    <span class="n">pec</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pec</span><span class="o">=</span><span class="s2">&quot;-v &quot;</span><span class="o">+</span><span class="n">read_2</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="n">read_2</span><span class="o">+</span><span class="s2">&quot; &quot;</span>
                <span class="n">qiime2_bash_str</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;docker run --env TMPDIR=/data/tmp -v </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">manifest_dir</span><span class="p">)</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">manifest_dir</span><span class="p">)</span><span class="si">}</span><span class="s2"> -v </span><span class="si">{</span><span class="n">read_1</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">read_1</span><span class="si">}</span><span class="s2"> -v </span><span class="si">{</span><span class="n">read_2</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">read_2</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">pec</span><span class="si">}</span><span class="s2"> -v </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="si">}</span><span class="s2"> -w /data  </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime2_docker_image</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="n">line</span>
        <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">qiime2_bash_str</span><span class="p">)</span>
        <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;manifest&gt;&quot;</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">manifest_dir</span><span class="p">),</span><span class="s2">&quot;manifest.tsv&quot;</span><span class="p">))</span>
        <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;qiime2_work_dir&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">workings_dir</span><span class="p">))</span>
        <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;classifier&gt;&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">paired_end</span><span class="p">:</span>
            <span class="n">manifest</span><span class="p">[</span><span class="s1">&#39;absolute-filepath&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">manifest</span><span class="p">[</span><span class="s1">&#39;absolute-filepath&#39;</span><span class="p">]]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">manifest</span><span class="p">[</span><span class="s1">&#39;forward-absolute-filepath&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">manifest</span><span class="p">[</span><span class="s1">&#39;forward-absolute-filepath&#39;</span><span class="p">]]</span>
            <span class="n">manifest</span><span class="p">[</span><span class="s1">&#39;reverse-absolute-filepath&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">manifest</span><span class="p">[</span><span class="s1">&#39;reverse-absolute-filepath&#39;</span><span class="p">]]</span>

    <span class="k">elif</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;singularity&quot;</span><span class="p">:</span>
        <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">qiime2_bash_str</span><span class="p">):</span>
            <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;qiime&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;biom&quot;</span><span class="p">):</span>
                <span class="n">qiime2_bash_str</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;singularity exec --bind  </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">seqs</span><span class="p">)</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">seqs</span><span class="p">)</span><span class="si">}</span><span class="s2">,$PWD:$PWD,</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">))</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">))</span><span class="si">}</span><span class="s2">,$SINGULARITY_TMPDIR:/tmp  </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime2_singularity_image</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="o">+</span><span class="n">line</span>
        <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">qiime2_bash_str</span><span class="p">)</span>
        <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;manifest&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">manifest_dir</span><span class="p">))</span>
        <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;qiime2_work_dir&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">seqs</span><span class="p">))</span>
        <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;classifier&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">)))</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Container must be None, singularity or docker&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">save_manifest</span><span class="p">:</span>
        <span class="n">manifest</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">manifest_dir</span><span class="p">,</span><span class="s2">&quot;manifest.tsv&quot;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">qiime2_bash_str</span><span class="p">,</span><span class="n">manifest</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Metagenomics.seqs_from_sra" class="doc doc-heading">
<code class="highlight language-python"><span class="n">seqs_from_sra</span><span class="p">(</span><span class="n">accession</span><span class="p">,</span> <span class="n">target_dir</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method downloads the fastq files from the SRA database using the accession number (ONLY SAMPLE ACCESSION AND NOT PROJECT ACCESSION) of the project or run.
The method uses the fasterq-dump tool to download the fastq files. This method also extracts the sample metadata from the SRA database for future use.</p>
<h3 id="adtoolbox.core.Metagenomics.seqs_from_sra--note-in-order-for-this-method-to-work-without-any-container-you-need-to-have-the-sra-toolkit-installed-on-your-system-or">NOTE In order for this method to work without any container, you need to have the SRA toolkit installed on your system or</h3>
<p>at least have prefetch and fasterq-dump installed on your system. For more information on how to install the SRA toolkit, please refer to the following link:
https://github.com/ncbi/sra-tools.</p>
<p>Any additional keyword</p>

<details class="required-configs">
  <summary>Required Configs</summary>
  <p>None</p>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>accession</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The accession number of the SRA project or run</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>target_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The directory where the fastq files will be downloaded</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>container</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The containerization tool that will be used to run the bash scripts. Defaults to "None". Options are "None","docker","singularity"</p></td>
          <td>
                <code>&#39;None&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>prefetch_script</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>The bash script that will be used to download the SRA files in python string format</p></td>
        </tr>
        <tr>
<td><code>sample_metadata</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>A dictionary that contains the sample metadata</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">seqs_from_sra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">accession</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">target_dir</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">container</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">dict</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    This method downloads the fastq files from the SRA database using the accession number (ONLY SAMPLE ACCESSION AND NOT PROJECT ACCESSION) of the project or run.</span>
<span class="sd">    The method uses the fasterq-dump tool to download the fastq files. This method also extracts the sample metadata from the SRA database for future use.</span>
<span class="sd">    #NOTE In order for this method to work without any container, you need to have the SRA toolkit installed on your system or</span>
<span class="sd">    at least have prefetch and fasterq-dump installed on your system. For more information on how to install the SRA toolkit, please refer to the following link:</span>
<span class="sd">    https://github.com/ncbi/sra-tools.</span>

<span class="sd">    Any additional keyword</span>

<span class="sd">    Required Configs:</span>
<span class="sd">        None</span>


<span class="sd">    Args:</span>
<span class="sd">        accession (str): The accession number of the SRA project or run</span>
<span class="sd">        target_dir (str): The directory where the fastq files will be downloaded</span>
<span class="sd">        container (str, optional): The containerization tool that will be used to run the bash scripts. Defaults to &quot;None&quot;. Options are &quot;None&quot;,&quot;docker&quot;,&quot;singularity&quot;</span>

<span class="sd">    Returns:</span>
<span class="sd">        prefetch_script (str): The bash script that will be used to download the SRA files in python string format</span>
<span class="sd">        sample_metadata (dict): A dictionary that contains the sample metadata</span>

<span class="sd">    &quot;&quot;&quot;</span>   
    <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;None&quot;</span><span class="p">:</span>
        <span class="n">prefetch_script</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;#!/bin/bash</span><span class="se">\n</span><span class="s2">prefetch </span><span class="si">{</span><span class="n">accession</span><span class="si">}</span><span class="s2"> -O </span><span class="si">{</span><span class="n">target_dir</span><span class="si">}</span><span class="s2"> --max-size 100000000</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>
        <span class="n">acc_folder</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">target_dir</span><span class="p">)</span><span class="o">/</span><span class="n">accession</span>
        <span class="n">fasterq_dump_script</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
        <span class="n">sra_file</span><span class="o">=</span><span class="n">acc_folder</span><span class="o">/</span><span class="p">(</span><span class="n">accession</span><span class="o">+</span><span class="s2">&quot;.sra&quot;</span><span class="p">)</span>
        <span class="n">fasterq_dump_script</span><span class="o">+=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">fasterq-dump </span><span class="si">{</span><span class="n">sra_file</span><span class="si">}</span><span class="s2"> -O </span><span class="si">{</span><span class="n">acc_folder</span><span class="si">}</span><span class="s2"> --split-files --temp </span><span class="si">{</span><span class="n">acc_folder</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">fasterq_dump_script</span><span class="o">+=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">rm </span><span class="si">{</span><span class="n">sra_file</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">prefetch_script</span><span class="o">+=</span><span class="n">fasterq_dump_script</span>


    <span class="k">elif</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;docker&quot;</span><span class="p">:</span>
        <span class="n">prefetch_script</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="n">prefetch_script</span><span class="o">+=</span><span class="sa">f</span><span class="s2">&quot;docker run -v </span><span class="si">{</span><span class="n">target_dir</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">target_dir</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adtoolbox_docker</span><span class="si">}</span><span class="s2"> prefetch </span><span class="si">{</span><span class="n">accession</span><span class="si">}</span><span class="s2"> -O </span><span class="si">{</span><span class="n">target_dir</span><span class="si">}</span><span class="s2"> --max-size 100000000</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">acc_folder</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">target_dir</span><span class="p">)</span><span class="o">/</span><span class="n">accession</span>
        <span class="n">fasterq_dump_script</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
        <span class="n">sra_file</span><span class="o">=</span><span class="n">acc_folder</span><span class="o">/</span><span class="p">(</span><span class="n">accession</span><span class="o">+</span><span class="s2">&quot;.sra&quot;</span><span class="p">)</span>
        <span class="n">fasterq_dump_script</span><span class="o">+=</span><span class="sa">f</span><span class="s2">&quot;docker run -v </span><span class="si">{</span><span class="n">target_dir</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">target_dir</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adtoolbox_docker</span><span class="si">}</span><span class="s2"> fasterq-dump </span><span class="si">{</span><span class="n">sra_file</span><span class="si">}</span><span class="s2"> -O </span><span class="si">{</span><span class="n">acc_folder</span><span class="si">}</span><span class="s2"> --split-files --temp </span><span class="si">{</span><span class="n">acc_folder</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">fasterq_dump_script</span><span class="o">+=</span><span class="sa">f</span><span class="s2">&quot;docker run -v </span><span class="si">{</span><span class="n">target_dir</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">target_dir</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adtoolbox_docker</span><span class="si">}</span><span class="s2"> rm </span><span class="si">{</span><span class="n">sra_file</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">prefetch_script</span><span class="o">+=</span><span class="n">fasterq_dump_script</span>

    <span class="k">elif</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;singularity&quot;</span><span class="p">:</span>
        <span class="n">prefetch_script</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="n">prefetch_script</span><span class="o">+=</span><span class="sa">f</span><span class="s2">&quot;singularity exec </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adtoolbox_singularity</span><span class="si">}</span><span class="s2"> prefetch </span><span class="si">{</span><span class="n">accession</span><span class="si">}</span><span class="s2"> -O </span><span class="si">{</span><span class="n">target_dir</span><span class="si">}</span><span class="s2"> --max-size 100000000</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">acc_folder</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">target_dir</span><span class="p">)</span><span class="o">/</span><span class="n">accession</span>
        <span class="n">fasterq_dump_script</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
        <span class="n">sra_file</span><span class="o">=</span><span class="n">acc_folder</span><span class="o">/</span><span class="p">(</span><span class="n">accession</span><span class="o">+</span><span class="s2">&quot;.sra&quot;</span><span class="p">)</span>
        <span class="n">fasterq_dump_script</span><span class="o">+=</span><span class="sa">f</span><span class="s2">&quot;singularity exec </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adtoolbox_singularity</span><span class="si">}</span><span class="s2"> fasterq-dump </span><span class="si">{</span><span class="n">sra_file</span><span class="si">}</span><span class="s2"> -O </span><span class="si">{</span><span class="n">acc_folder</span><span class="si">}</span><span class="s2"> --split-files --temp </span><span class="si">{</span><span class="n">acc_folder</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">fasterq_dump_script</span><span class="o">+=</span><span class="sa">f</span><span class="s2">&quot;singularity exec </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adtoolbox_singularity</span><span class="si">}</span><span class="s2"> rm </span><span class="si">{</span><span class="n">sra_file</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">prefetch_script</span><span class="o">+=</span><span class="n">fasterq_dump_script</span>

    <span class="n">sample_metadata</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">get_sample_metadata_from_accession</span><span class="p">(</span><span class="n">accession</span><span class="p">)</span>      


    <span class="k">return</span> <span class="n">prefetch_script</span><span class="p">,</span><span class="n">sample_metadata</span>     
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="adm">adm</h2>
<p>Here is a schematic view of adm API:</p>
<p><img alt="adm" src="../ADM.svg" /></p>
<p>You can access this module by:</p>
<pre><code>from adtoolbox import adm 

</code></pre>
<p>This module includes the following classes:</p>


<div class="doc doc-object doc-module">


<a id="adtoolbox.adm"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="adtoolbox.adm.Model" class="doc doc-heading">
        <code>Model</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Any kinetic model could be an instance of this class.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>model_parameters</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>a dictionary which contains model parameters</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>base_parameters</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>a dictionary which contains base paramters</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>initial_conditions</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>a dictionary containing initial conditions for all species</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>inlet_conditions</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>a dictionary containing inlet conditions for all species</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>feed</code></td>
          <td>
                <code><span title="core.Feed">Feed</span></code>
          </td>
          <td><p>a Feed instance which contains the feed information</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>reactions</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>a list containing all types of reactions</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>species</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>a list containing all species</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>ode_system</code></td>
          <td>
                <code><span title="typing.Callable">Callable</span></code>
          </td>
          <td><p>a callable which outputs the ODE system compatible with Scipy.integrate.solve_ivp</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>build_stoichiometric_matrix(Callable)</code></td>
          <td>
          </td>
          <td><p>a callable which builds the stoichiometric matrix</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>control_state</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>a dictionary containing the states that are desired to be constant. Defaults to {}.</p></td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>Model</code></td>          <td>
          </td>
          <td><p>returns a model instance for downstream purposes.</p></td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>adtoolbox/adm.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Model</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;Any kinetic model could be an instance of this class.</span>
<span class="sd">    Args:</span>
<span class="sd">        model_parameters (dict): a dictionary which contains model parameters</span>
<span class="sd">        base_parameters (dict): a dictionary which contains base paramters</span>
<span class="sd">        initial_conditions (dict): a dictionary containing initial conditions for all species</span>
<span class="sd">        inlet_conditions (dict): a dictionary containing inlet conditions for all species</span>
<span class="sd">        feed (Feed): a Feed instance which contains the feed information</span>
<span class="sd">        reactions (list): a list containing all types of reactions</span>
<span class="sd">        species (list): a list containing all species</span>
<span class="sd">        ode_system (Callable): a callable which outputs the ODE system compatible with Scipy.integrate.solve_ivp</span>
<span class="sd">        build_stoichiometric_matrix(Callable): a callable which builds the stoichiometric matrix</span>
<span class="sd">        control_state (dict, optional): a dictionary containing the states that are desired to be constant. Defaults to {}.</span>



<span class="sd">    Returns:</span>
<span class="sd">        Model: returns a model instance for downstream purposes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                 <span class="n">model_parameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                 <span class="n">base_parameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                 <span class="n">initial_conditions</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                 <span class="n">inlet_conditions</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span>
                 <span class="n">feed</span><span class="p">:</span><span class="n">Feed</span><span class="p">,</span>
                 <span class="n">reactions</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> 
                 <span class="n">species</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> 
                 <span class="n">ode_system</span><span class="p">:</span><span class="n">Callable</span><span class="p">,</span> 
                 <span class="n">build_stoichiometric_matrix</span><span class="p">:</span><span class="n">Callable</span><span class="p">,</span>
                 <span class="n">control_state</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="p">{},</span>
                 <span class="n">name</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;ADM&quot;</span><span class="p">,</span> 
                 <span class="n">switch</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;DAE&quot;</span><span class="p">,</span>
                 <span class="n">simulation_time</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                 <span class="n">time_limit</span><span class="p">:</span><span class="nb">float</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span> <span class="o">=</span> <span class="n">model_parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_parameters</span> <span class="o">=</span> <span class="n">base_parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="o">=</span><span class="n">feed</span>
        <span class="k">for</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">control_state</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">initial_conditions</span><span class="p">[</span><span class="n">items</span><span class="p">]</span><span class="o">=</span><span class="n">control_state</span><span class="p">[</span><span class="n">items</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_state</span><span class="o">=</span><span class="n">control_state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inlet_conditions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="n">inlet_conditions</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="s2">&quot;_in&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">species</span><span class="p">])[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="o">=</span> <span class="n">reactions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">species</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_conditions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="n">initial_conditions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">species</span><span class="p">])[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ic</span><span class="o">=</span><span class="n">initial_conditions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inc</span><span class="o">=</span><span class="n">inlet_conditions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">switch</span> <span class="o">=</span> <span class="n">switch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_stoichiometric_matrix</span> <span class="o">=</span> <span class="n">build_stoichiometric_matrix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ode_system</span> <span class="o">=</span> <span class="n">ode_system</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="o">=</span><span class="n">simulation_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_limit</span><span class="o">=</span><span class="n">time_limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nitrogen_limited</span><span class="o">=</span><span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">s</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the stoichiometric matrix of a model&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_stoichiometric_matrix</span><span class="p">(</span>
            <span class="n">base_parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">,</span><span class="n">model_parameters</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">,</span><span class="n">reactions</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">,</span><span class="n">species</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">,</span><span class="n">feed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="p">,</span> <span class="n">nitrogen_limited</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nitrogen_limited</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                        <span class="n">model_parameters</span><span class="p">:</span> <span class="nb">dict</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">base_parameters</span><span class="p">:</span>  <span class="nb">dict</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">initial_conditions</span><span class="p">:</span> <span class="nb">dict</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">inlet_conditions</span><span class="p">:</span> <span class="nb">dict</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method updates the parameters of the model. Each argument can be a dictionary containing the parameters to be updated.</span>
<span class="sd">        NOTE: It is important to note that you have to separate different kind parameters.</span>
<span class="sd">        Args:</span>
<span class="sd">            model_parameters (dict): a dictionary which contains the model parameters to be updated as keys and their values as values.</span>
<span class="sd">            base_parameters (dict): a dictionary which contains the base parameters to be updated as keys and their values as values.</span>
<span class="sd">            initial_conditions (dict): a dictionary containing the initial conditions to be updated as keys and their values as values.</span>
<span class="sd">            inlet_conditions (dict): a dictionary containing the inlet conditions to be updated as keys and their values as values.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None: This method does not return anything.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">model_parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">model_parameters</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">base_parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_parameters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">base_parameters</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">initial_conditions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">initial_conditions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">initial_conditions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span><span class="o">=</span><span class="n">v</span>
        <span class="k">if</span> <span class="n">inlet_conditions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">inlet_conditions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inlet_conditions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span><span class="o">=</span><span class="n">v</span>




    <span class="k">def</span> <span class="nf">solve_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t_eval</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;BDF&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">_ivp</span><span class="o">.</span><span class="n">ivp</span><span class="o">.</span><span class="n">OdeResult</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to solve the model. </span>
<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import numpy as np</span>
<span class="sd">            &gt;&gt;&gt; reactions=[&#39;rxn1&#39;,&#39;rxn2&#39;]</span>
<span class="sd">            &gt;&gt;&gt; species=[&#39;a&#39;,&#39;b&#39;,&#39;c&#39;]</span>
<span class="sd">            &gt;&gt;&gt; initial_conditions={&#39;a&#39;:.001,&#39;b&#39;:.002,&#39;c&#39;:.003}</span>
<span class="sd">            &gt;&gt;&gt; inlet_conditions={&#39;a_in&#39;:.001,&#39;b_in&#39;:.002,&#39;c_in&#39;:.003}</span>
<span class="sd">            &gt;&gt;&gt; model_parameters={&#39;k1&#39;:0.001,&#39;k2&#39;:0.002}</span>
<span class="sd">            &gt;&gt;&gt; base_parameters={&#39;T&#39;:0.1}</span>
<span class="sd">            &gt;&gt;&gt; feed=Feed(10,20,20,20)</span>
<span class="sd">            &gt;&gt;&gt; def build_stoiciometric_matrix(base_parameters,model_parameters,reactions,species):</span>
<span class="sd">            ...    s = np.zeros((len(species), len(reactions)))</span>
<span class="sd">            ...    s[[0,1],0]=[-1,0.001]</span>
<span class="sd">            ...    s[[1,2],1]=[-5,1]</span>
<span class="sd">            ...    return s</span>
<span class="sd">            &gt;&gt;&gt; def ode_system(t,c,Model1):</span>
<span class="sd">            ...    v = np.zeros((len(Model1.reactions), 1))</span>
<span class="sd">            ...    v[0]=Model1.model_parameters[&#39;k1&#39;]*c[0]*Model1.base_parameters[&#39;T&#39;]/1000</span>
<span class="sd">            ...    v[1]=Model1.model_parameters[&#39;k2&#39;]*c[1]/1000</span>
<span class="sd">            ...    dCdt=np.matmul(Model1.S,v)</span>
<span class="sd">            ...    return dCdt[:, 0]</span>
<span class="sd">            &gt;&gt;&gt; m= Model(model_parameters,base_parameters,initial_conditions,inlet_conditions,reactions,species,ODE_System,Build_Stoiciometric_Matrix)</span>
<span class="sd">            &gt;&gt;&gt; m.solve_model((0,.1),np.linspace(0,0.1,10),method=&#39;RK45&#39;)[&#39;status&#39;]==0</span>
<span class="sd">            True</span>

<span class="sd">        Args:</span>
<span class="sd">            t_eval (np.ndarray): Time points at which the solution is reported</span>
<span class="sd">            method (str, optional): The method used to solve the ODE. Defaults to &quot;BDF&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            scipy.integrate._ivp.ivp.OdeResult: Returns the results of the simulation being run and gives optimized paramters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Fluxes&quot;</span><span class="p">:[]}</span>
        <span class="n">y0</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_conditions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_be_time</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">solve_ivp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ode_system</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="p">),</span> <span class="n">y0</span><span class="p">,</span> <span class="n">t_eval</span><span class="o">=</span><span class="n">t_eval</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="p">],</span><span class="n">rtol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not solve model, setting C to a very large value&quot;</span><span class="p">)</span>
            <span class="n">c</span><span class="o">=</span><span class="n">_Fake_Sol</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">y0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">len</span><span class="p">(</span><span class="n">t_eval</span><span class="p">)))</span><span class="o">*</span><span class="mf">1e10</span><span class="p">,</span><span class="n">t_eval</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">c</span>


       <span class="c1">#C = scipy.integrate.solve_ivp(</span>
       <span class="c1">#        self.ODE_System, t_span, y0, t_eval=T_eval, method=method, args=[self])</span>
       <span class="c1">#</span>
       <span class="c1">#return C</span>



    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Sol</span><span class="p">:</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">_ivp</span><span class="o">.</span><span class="n">ivp</span><span class="o">.</span><span class="n">OdeResult</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Line&quot;</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; A function which returns a plot of the solution from the ODE</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">solution</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="n">Sol</span><span class="o">.</span><span class="n">t</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)):</span>
            <span class="n">solution</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Sol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">sol_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;Line&quot;</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">sol_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">sol_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
                          <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Concentration of species&quot;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="p">{</span>
                    <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
                    <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>

                    <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
                    <span class="s1">&#39;xanchor&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;yanchor&#39;</span><span class="p">:</span> <span class="s1">&#39;top&#39;</span><span class="p">}</span>

            <span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Time (Days)&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Concentrations (kg COD/m^3)&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;Sankey&quot;</span><span class="p">:</span>
            <span class="c1">### Maybe add a sankey plot here later</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="n">fig</span>



    <span class="k">def</span> <span class="nf">dash_app</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sol</span><span class="p">:</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">_ivp</span><span class="o">.</span><span class="n">ivp</span><span class="o">.</span><span class="n">OdeResult</span><span class="p">,</span>
                 <span class="n">escher_map</span><span class="p">:</span><span class="nb">str</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PKG_DATA</span><span class="p">,</span><span class="s2">&quot;Modified_ADM_Map.json&quot;</span><span class="p">),</span>
                 <span class="n">cobra_model</span><span class="p">:</span><span class="nb">str</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PKG_DATA</span><span class="p">,</span><span class="s2">&quot;Modified_ADM_Model.json&quot;</span><span class="p">),</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;A method that creates the dash web app for a model based on an ODE solution.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import numpy as np</span>
<span class="sd">            &gt;&gt;&gt; reactions=[&#39;rxn1&#39;,&#39;rxn2&#39;]</span>
<span class="sd">            &gt;&gt;&gt; species=[&#39;a&#39;,&#39;b&#39;,&#39;c&#39;]</span>
<span class="sd">            &gt;&gt;&gt; initial_conditions={&#39;a&#39;:.001,&#39;b&#39;:.002,&#39;c&#39;:.003}</span>
<span class="sd">            &gt;&gt;&gt; inlet_conditions={&#39;a_in&#39;:.001,&#39;b_in&#39;:.002,&#39;c_in&#39;:.003}</span>
<span class="sd">            &gt;&gt;&gt; model_parameters={&#39;k1&#39;:0.001,&#39;k2&#39;:0.002}</span>
<span class="sd">            &gt;&gt;&gt; base_parameters={&#39;T&#39;:0.1}</span>
<span class="sd">            &gt;&gt;&gt; feed=Feed(10,20,20,20)</span>
<span class="sd">            &gt;&gt;&gt; def build_stoiciometric_matrix(base_parameters,model_parameters,reactions,species):</span>
<span class="sd">            ...    s = np.zeros((len(species), len(reactions)))</span>
<span class="sd">            ...    s[[0,1],0]=[-1,0.001]</span>
<span class="sd">            ...    s[[1,2],1]=[-5,1]</span>
<span class="sd">            ...    return s</span>
<span class="sd">            &gt;&gt;&gt; def ode_system(t,c,Model1):</span>
<span class="sd">            ...    v = np.zeros((len(Model1.reactions), 1))</span>
<span class="sd">            ...    v[0]=Model1.model_parameters[&#39;k1&#39;]*c[0]*Model1.base_parameters[&#39;T&#39;]/1000</span>
<span class="sd">            ...    v[1]=Model1.model_parameters[&#39;k2&#39;]*c[1]/1000</span>
<span class="sd">            ...    dCdt=np.matmul(Model1.S,v)</span>
<span class="sd">            ...    return dCdt[:, 0]</span>
<span class="sd">            &gt;&gt;&gt; m= Model(model_parameters,base_parameters,initial_conditions,inlet_conditions,reactions,species,ODE_System,Build_Stoiciometric_Matrix)</span>
<span class="sd">            &gt;&gt;&gt; m.solve_model((0,.1),np.linspace(0,0.1,10),method=&#39;RK45&#39;)[&#39;status&#39;]==0</span>
<span class="sd">            True</span>
<span class="sd">            &gt;&gt;&gt; m.dash_app(m.solve_model(np.linspace(0,30,1000)))</span>

<span class="sd">        Args:</span>
<span class="sd">            sol (scipy.integrate._ivp.ivp.OdeResult): The solution of the ODE system. This should be the output of the solve_model method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None: This method does not return anything.</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">escher_map</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">escher_map</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">escher_map</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cobra_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cobra_model</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">cobra_model</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="n">app</span> <span class="o">=</span> <span class="n">Dash</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">external_stylesheets</span><span class="o">=</span><span class="p">[</span><span class="n">dbc</span><span class="o">.</span><span class="n">themes</span><span class="o">.</span><span class="n">FLATLY</span><span class="p">])</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;background&#39;</span><span class="p">:</span> <span class="s1">&#39;#659dbd&#39;</span><span class="p">,</span>
            <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="s1">&#39;#3e4444&#39;</span>
        <span class="p">}</span>


        <span class="n">solution</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="n">sol</span><span class="o">.</span><span class="n">t</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)):</span>
            <span class="n">solution</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">sol_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>


        <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">sol_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">sol_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
                      <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Concentration of species&quot;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
        <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
        <span class="s1">&#39;xanchor&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span>
        <span class="s1">&#39;yanchor&#39;</span><span class="p">:</span> <span class="s1">&#39;top&#39;</span><span class="p">},</span>
        <span class="n">legend</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span> <span class="mi">20</span><span class="p">),),</span>
        <span class="n">plot_bgcolor</span><span class="o">=</span><span class="s2">&quot;rgba(0,0,0,0)&quot;</span><span class="p">,</span>
        <span class="n">paper_bgcolor</span><span class="o">=</span><span class="s2">&quot;rgba(0,0,0,0)&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Time (Days)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
            <span class="p">},</span>
             <span class="n">tickfont_size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
        <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span>
        <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Concentrations (kg COD/m^3)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
         <span class="p">},</span>
        <span class="n">tickfont_size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
        <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span>
        <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span>

            <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span><span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

        <span class="n">styles</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;table_width&#39;</span><span class="p">:</span> <span class="s1">&#39;95%&#39;</span><span class="p">,</span>
            <span class="s1">&#39;padding-left&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
            <span class="s1">&#39;container_width&#39;</span><span class="p">:</span> <span class="s1">&#39;85%&#39;</span>
        <span class="p">}</span>
        <span class="n">page</span><span class="o">=</span><span class="p">[</span><span class="n">dbc</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span>
                        <span class="n">html</span><span class="o">.</span><span class="n">H1</span><span class="p">(</span><span class="s2">&quot;ADToolbox Web Interface&quot;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;font-size&quot;</span><span class="p">:</span><span class="s2">&quot;70px&quot;</span><span class="p">,</span> <span class="s2">&quot;padding-top&quot;</span><span class="p">:</span><span class="s2">&quot;50px&quot;</span><span class="p">}),</span><span class="n">className</span><span class="o">=</span><span class="s2">&quot;text-white bg-primary&quot;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;height&quot;</span><span class="p">:</span><span class="s2">&quot;300px&quot;</span><span class="p">,</span><span class="s2">&quot;text-align&quot;</span><span class="p">:</span> <span class="s2">&quot;center&quot;</span><span class="p">},</span> <span class="n">fluid</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                        <span class="n">dbc</span><span class="o">.</span><span class="n">Container</span><span class="p">([</span><span class="n">dbc</span><span class="o">.</span><span class="n">Row</span><span class="p">(</span>
                                    <span class="p">[</span><span class="n">dbc</span><span class="o">.</span><span class="n">Card</span><span class="p">([</span>
                                        <span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> Concentration Plot&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span>
                                            <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
                                            <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;15&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;padding-top&#39;</span><span class="p">:</span> <span class="s1">&#39;50px&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;padding-bottom&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;padding-left&#39;</span><span class="p">:</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;padding-left&#39;</span><span class="p">]</span> <span class="p">},</span>
                                             <span class="n">className</span><span class="o">=</span><span class="s2">&quot;card-title&quot;</span><span class="p">),</span>
                                        <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;Concentrations_Line_Plot&#39;</span><span class="p">,</span>
                                                <span class="n">style</span><span class="o">=</span><span class="p">{</span>
                                                <span class="s2">&quot;height&quot;</span><span class="p">:</span><span class="s2">&quot;600px&quot;</span><span class="p">,</span>
                                                <span class="s2">&quot;padding-left&quot;</span><span class="p">:</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;padding-left&#39;</span><span class="p">],</span>
                                                <span class="s1">&#39;background-color&#39;</span><span class="p">:</span> <span class="s1">&#39;rgba(0,0,0,0)&#39;</span><span class="p">}</span>
                                                <span class="p">),],</span><span class="n">className</span><span class="o">=</span><span class="s1">&#39;bg-light&#39;</span><span class="p">),</span>

                                    <span class="n">dbc</span><span class="o">.</span><span class="n">Card</span><span class="p">([</span><span class="n">html</span><span class="o">.</span><span class="n">H3</span><span class="p">(</span><span class="s2">&quot;Base Parameters&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span>
                                        <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
                                        <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;15&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;padding-top&#39;</span><span class="p">:</span> <span class="s1">&#39;50px&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;padding-bottom&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;padding-left&#39;</span><span class="p">:</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;padding-left&#39;</span><span class="p">]</span>
                                        <span class="p">}),</span>
                                        <span class="n">dash_table</span><span class="o">.</span><span class="n">DataTable</span><span class="p">(</span>
                                        <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;base_parameters&#39;</span><span class="p">,</span>
                                        <span class="n">columns</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;numeric&quot;</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())],</span>
                                        <span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;records&#39;</span><span class="p">),</span>
                                        <span class="n">editable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                        <span class="n">style_table</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;overflowX&#39;</span><span class="p">:</span> <span class="s1">&#39;scroll&#39;</span><span class="p">,</span> <span class="s1">&#39;padding-left&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span><span class="s1">&#39;padding-bottom&#39;</span><span class="p">:</span><span class="s1">&#39;30px&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;table_width&#39;</span><span class="p">]},</span>
                                        <span class="n">style_header</span><span class="o">=</span><span class="p">{</span>
                                        <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;30px&#39;</span><span class="p">,</span>
                                            <span class="p">},</span>
                                        <span class="n">style_data</span><span class="o">=</span><span class="p">{</span>
                                        <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;rgb(250, 250, 250)&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;25px&#39;</span><span class="p">}),],</span><span class="n">className</span><span class="o">=</span><span class="s2">&quot;bg-light&quot;</span><span class="p">),</span>

                                    <span class="n">dbc</span><span class="o">.</span><span class="n">Card</span><span class="p">([</span><span class="n">html</span><span class="o">.</span><span class="n">H3</span><span class="p">(</span><span class="s2">&quot;Model Parameters&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span>
                                        <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
                                        <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;15&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;padding-top&#39;</span><span class="p">:</span> <span class="s1">&#39;50px&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;padding-bottom&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;padding-left&#39;</span><span class="p">:</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;padding-left&#39;</span><span class="p">]</span>
                                        <span class="p">}),</span>
                                        <span class="n">dash_table</span><span class="o">.</span><span class="n">DataTable</span><span class="p">(</span>
                                        <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;model_parameters&#39;</span><span class="p">,</span>
                                        <span class="n">columns</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;numeric&quot;</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())],</span>
                                        <span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;records&#39;</span><span class="p">),</span>
                                        <span class="n">editable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                        <span class="n">style_table</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;overflowX&#39;</span><span class="p">:</span> <span class="s1">&#39;scroll&#39;</span><span class="p">,</span> <span class="s1">&#39;padding-left&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span><span class="s1">&#39;padding-bottom&#39;</span><span class="p">:</span><span class="s1">&#39;30px&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;table_width&#39;</span><span class="p">]},</span>
                                        <span class="n">style_header</span><span class="o">=</span><span class="p">{</span>
                                        <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;30px&#39;</span><span class="p">,</span>
                                            <span class="p">},</span>
                                        <span class="n">style_data</span><span class="o">=</span><span class="p">{</span>
                                        <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;rgb(250, 250, 250)&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;25px&#39;</span><span class="p">}),],</span><span class="n">className</span><span class="o">=</span><span class="s2">&quot;bg-light&quot;</span><span class="p">),</span>

                                    <span class="n">dbc</span><span class="o">.</span><span class="n">Card</span><span class="p">([</span><span class="n">html</span><span class="o">.</span><span class="n">H3</span><span class="p">(</span><span class="s2">&quot;Initial Conditions&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span>
                                        <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
                                        <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;15&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;padding-top&#39;</span><span class="p">:</span> <span class="s1">&#39;50px&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;padding-bottom&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;padding-left&#39;</span><span class="p">:</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;padding-left&#39;</span><span class="p">]</span>
                                        <span class="p">}),</span>
                                        <span class="n">dash_table</span><span class="o">.</span><span class="n">DataTable</span><span class="p">(</span>
                                        <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;initial_conditions&#39;</span><span class="p">,</span>
                                        <span class="n">columns</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;numeric&quot;</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ic</span><span class="o">.</span><span class="n">keys</span><span class="p">())],</span>
                                        <span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ic</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;records&#39;</span><span class="p">),</span>
                                        <span class="n">editable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                        <span class="n">style_table</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;overflowX&#39;</span><span class="p">:</span> <span class="s1">&#39;scroll&#39;</span><span class="p">,</span> <span class="s1">&#39;padding-left&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span><span class="s1">&#39;padding-bottom&#39;</span><span class="p">:</span><span class="s1">&#39;30px&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;table_width&#39;</span><span class="p">]},</span>
                                        <span class="n">style_header</span><span class="o">=</span><span class="p">{</span>
                                        <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;30px&#39;</span><span class="p">,</span>
                                            <span class="p">},</span>
                                        <span class="n">style_data</span><span class="o">=</span><span class="p">{</span>
                                        <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;rgb(250, 250, 250)&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;25px&#39;</span><span class="p">}),],</span><span class="n">className</span><span class="o">=</span><span class="s2">&quot;bg-light&quot;</span><span class="p">),</span>

                                    <span class="n">dbc</span><span class="o">.</span><span class="n">Card</span><span class="p">([</span><span class="n">html</span><span class="o">.</span><span class="n">H3</span><span class="p">(</span><span class="s2">&quot;Inlet Conditions&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span>
                                        <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
                                        <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;15&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;padding-top&#39;</span><span class="p">:</span> <span class="s1">&#39;50px&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;padding-bottom&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;padding-left&#39;</span><span class="p">:</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;padding-left&#39;</span><span class="p">]</span>
                                        <span class="p">}),</span>
                                        <span class="n">dash_table</span><span class="o">.</span><span class="n">DataTable</span><span class="p">(</span>
                                        <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;inlet_conditions&#39;</span><span class="p">,</span>
                                        <span class="n">columns</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;numeric&quot;</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inc</span><span class="o">.</span><span class="n">keys</span><span class="p">())],</span>
                                        <span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inc</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;records&#39;</span><span class="p">),</span>
                                        <span class="n">editable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                        <span class="n">style_table</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;overflowX&#39;</span><span class="p">:</span> <span class="s1">&#39;scroll&#39;</span><span class="p">,</span> <span class="s1">&#39;padding-left&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span><span class="s1">&#39;padding-bottom&#39;</span><span class="p">:</span><span class="s1">&#39;30px&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;table_width&#39;</span><span class="p">]},</span>
                                        <span class="n">style_header</span><span class="o">=</span><span class="p">{</span>
                                        <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;30px&#39;</span><span class="p">,</span>
                                            <span class="p">},</span>
                                        <span class="n">style_data</span><span class="o">=</span><span class="p">{</span>
                                        <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;rgb(250, 250, 250)&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;25px&#39;</span><span class="p">}),],</span><span class="n">className</span><span class="o">=</span><span class="s2">&quot;bg-light&quot;</span><span class="p">),</span>
                                        <span class="p">],</span><span class="n">className</span><span class="o">=</span><span class="s2">&quot;bg-light&quot;</span><span class="p">)],</span><span class="n">fluid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">className</span><span class="o">=</span><span class="s2">&quot;bg-light&quot;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;container_width&#39;</span><span class="p">]}),</span>
                                    <span class="n">dbc</span><span class="o">.</span><span class="n">Container</span><span class="p">([</span><span class="n">dbc</span><span class="o">.</span><span class="n">Row</span><span class="p">(</span>
                                    <span class="p">[</span>
                                    <span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="s2">&quot;Escher Map&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span>
                                    <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
                                    <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;15&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;padding-top&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;padding-bottom&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;padding-left&#39;</span><span class="p">:</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;padding-left&#39;</span><span class="p">]</span>
                                    <span class="p">})</span> <span class="p">,</span>

                                    <span class="n">dcc</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">([</span><span class="s2">&quot;Show Map&quot;</span><span class="p">,</span><span class="s2">&quot;Hide Map&quot;</span><span class="p">],</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="s2">&quot;300px&quot;</span><span class="p">,</span><span class="s2">&quot;font-size&quot;</span><span class="p">:</span><span class="mi">25</span><span class="p">,</span><span class="s1">&#39;padding-left&#39;</span><span class="p">:</span><span class="s1">&#39;2-px&#39;</span><span class="p">},</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;Drop_Down_Escher&quot;</span><span class="p">),</span>
                                    <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="n">children</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;Escher_&quot;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="s2">&quot;100px&quot;</span><span class="p">,</span><span class="s1">&#39;padding-buttom&#39;</span><span class="p">:</span><span class="s1">&#39;20px&#39;</span><span class="p">}),</span>
                                    <span class="p">])],</span> <span class="n">fluid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">className</span><span class="o">=</span><span class="s2">&quot;bg-light pb-3&quot;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;container_width&#39;</span><span class="p">]}),</span>
            <span class="n">dbc</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="n">children</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;Escher&quot;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;align&#39;</span><span class="p">:</span><span class="s1">&#39;center&#39;</span><span class="p">}),</span><span class="n">fluid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">className</span><span class="o">=</span><span class="s2">&quot;bg-light pb-3&quot;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;container_width&#39;</span><span class="p">]}),</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">escher_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">page</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">page</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">page</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>


        <span class="n">app</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s2">&quot;Escher_&quot;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;children&#39;</span><span class="p">),</span> <span class="n">Input</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s2">&quot;Drop_Down_Escher&quot;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="k">def</span> <span class="nf">escher_wrapper</span><span class="p">(</span><span class="n">drop_down_escher</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;drop_down_escher&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">drop_down_escher</span><span class="o">==</span><span class="s2">&quot;Show Map&quot;</span><span class="p">:</span>
                <span class="n">Labels</span><span class="o">=</span><span class="p">{}</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="o">/</span><span class="mi">20</span><span class="p">)):</span>
                    <span class="n">Labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="s1">&#39;style&#39;</span><span class="p">:{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#77b0b1&#39;</span><span class="p">}}</span>
                <span class="n">Labels</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="s2">&quot;Time (Day)&quot;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">}),</span><span class="n">dcc</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="o">/</span><span class="mi">20</span><span class="p">),</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;Escher_Slider&quot;</span><span class="p">,</span><span class="n">marks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">tooltip</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;placement&quot;</span><span class="p">:</span> <span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="s2">&quot;always_visible&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})]</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s2">&quot;Escher&quot;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;children&#39;</span><span class="p">),</span> <span class="n">Input</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s2">&quot;Drop_Down_Escher&quot;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">),</span>
        <span class="n">Input</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s2">&quot;Escher_Slider&quot;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">),</span><span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>        
        <span class="k">def</span> <span class="nf">draw_escher</span><span class="p">(</span><span class="n">drop_down_escher</span><span class="p">,</span><span class="n">escher_slider</span><span class="p">):</span>
            <span class="n">rxn_data</span><span class="o">=</span><span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ode_system</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span><span class="nb">int</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="o">*</span><span class="n">escher_slider</span><span class="p">)],</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">fluxes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;Fluxes&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">):</span>
                <span class="n">rxn_data</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;_&quot;</span><span class="p">)]</span><span class="o">=</span> <span class="n">fluxes</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;min_flux&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">):</span>
                <span class="n">min_scale</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;min_flux&#39;</span><span class="p">)</span> <span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span> <span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">min_scale</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;min&#39;</span> <span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span> <span class="p">}</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_flux&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">):</span>
                <span class="n">max_scale</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_flux&#39;</span><span class="p">)</span> <span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span> <span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">max_scale</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span> <span class="p">}</span>

            <span class="k">if</span> <span class="n">drop_down_escher</span><span class="o">==</span><span class="s2">&quot;Show Map&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">dash_escher</span><span class="o">.</span><span class="n">DashEscher</span><span class="p">(</span><span class="n">mapData</span><span class="o">=</span><span class="n">escher_map</span><span class="p">,</span><span class="n">modelData</span><span class="o">=</span><span class="n">cobra_model</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="p">{</span>
             <span class="s1">&#39;reaction_data&#39;</span><span class="p">:</span><span class="n">rxn_data</span><span class="p">,</span>
             <span class="s1">&#39;enable_keys&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span>
             <span class="s1">&#39;reaction_scale&#39;</span><span class="p">:[</span><span class="n">min_scale</span><span class="p">,</span><span class="n">max_scale</span><span class="p">],</span>
            <span class="p">}</span>
            <span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="s1">&#39;1000px&#39;</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="s1">&#39;100%&#39;</span><span class="p">)</span>
             <span class="p">]</span>
        <span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s1">&#39;Concentrations_Line_Plot&#39;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;figure&#39;</span><span class="p">),</span>
                    <span class="n">Input</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s1">&#39;base_parameters&#39;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">),</span>
                    <span class="n">Input</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s1">&#39;model_parameters&#39;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">),</span>
                    <span class="n">Input</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s1">&#39;initial_conditions&#39;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">),</span>
                    <span class="n">Input</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s1">&#39;inlet_conditions&#39;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">),</span>
                    <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
                    <span class="p">)</span>
        <span class="k">def</span> <span class="nf">update_graph_fig</span><span class="p">(</span><span class="n">base_parameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">model_parameters</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">initial_conditions</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">inlet_conditions</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">plotly</span><span class="o">.</span><span class="n">graph_objects</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_state</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">control_state</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">control_state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">initial_conditions</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">base_parameters</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">base_parameters</span> <span class="o">=</span> <span class="n">base_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_parameters</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initial_conditions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="n">initial_conditions</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">])[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inlet_conditions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="n">inlet_conditions</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="o">+</span><span class="s2">&quot;_in&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">])[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
            <span class="n">update_sol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solve_model</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="p">,</span> <span class="mi">10000</span><span class="p">))</span>

            <span class="n">sol</span><span class="o">=</span><span class="n">update_sol</span>
            <span class="n">solution</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="n">update_sol</span><span class="o">.</span><span class="n">t</span><span class="p">,</span>
                        <span class="p">}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)):</span>
                <span class="n">solution</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">update_sol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">sol_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">sol_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">sol_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
                          <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Concentration of species&quot;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
            <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
            <span class="s1">&#39;xanchor&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span>
            <span class="s1">&#39;yanchor&#39;</span><span class="p">:</span> <span class="s1">&#39;top&#39;</span><span class="p">},</span>
            <span class="n">legend</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span> <span class="mi">20</span><span class="p">),),</span>
            <span class="n">plot_bgcolor</span><span class="o">=</span><span class="s2">&quot;rgba(0,0,0,0)&quot;</span><span class="p">,</span>
            <span class="n">paper_bgcolor</span><span class="o">=</span><span class="s2">&quot;rgba(0,0,0,0)&quot;</span><span class="p">,</span>

                <span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Time (Days)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
                <span class="p">},</span>
                 <span class="n">tickfont_size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
            <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span>
            <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Concentrations (kg COD/m^3)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
             <span class="p">},</span>
            <span class="n">tickfont_size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
            <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span>
            <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span>


                <span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span><span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">fig</span>



        <span class="n">app</span><span class="o">.</span><span class="n">run_server</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">csv_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sol</span><span class="p">:</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">_ivp</span><span class="o">.</span><span class="n">ivp</span><span class="o">.</span><span class="n">OdeResult</span> <span class="p">,</span><span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Converts the results to a pandas data frame then to a csv&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">sol</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">address</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;_Report.csv&quot;</span><span class="p">),</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a copy of the model&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">model_parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                          <span class="n">base_parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">base_parameters</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                          <span class="n">initial_conditions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ic</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                          <span class="n">inlet_conditions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_inc</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                          <span class="n">feed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="p">,</span>
                          <span class="n">reactions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                          <span class="n">species</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                          <span class="n">ode_system</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ode_system</span><span class="p">,</span>
                          <span class="n">build_stoichiometric_matrix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">build_stoichiometric_matrix</span><span class="p">,</span>
                          <span class="n">control_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">control_state</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                          <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                          <span class="n">switch</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">switch</span><span class="p">,</span>
                          <span class="n">time_limit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_limit</span><span class="p">,</span>
                          <span class="n">simulation_time</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">build_cobra_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">address</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This method builds a cobra model from an instance of Model. One particular use</span>
<span class="sd">        of such models is to build an escher map from the model.</span>
<span class="sd">        Args:</span>
<span class="sd">            address (str, optional): The address to save the model. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">cobra</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;CobraPy is not installed, please install it to use this function&quot;</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">cobra</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">:</span>
            <span class="n">temp_reaction</span> <span class="o">=</span> <span class="n">cobra</span><span class="o">.</span><span class="n">Reaction</span><span class="p">(</span><span class="n">reaction</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="n">reaction</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">))</span>
            <span class="n">temp_mets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">reaction</span><span class="p">)]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">met_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">met</span> <span class="ow">in</span> <span class="n">temp_mets</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">metabolite</span> <span class="o">=</span> <span class="n">cobra</span><span class="o">.</span><span class="n">Metabolite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">met</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">),</span>
                                              <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">met</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">),</span> <span class="n">compartment</span><span class="o">=</span><span class="s2">&quot;Model&quot;</span><span class="p">)</span>
                <span class="n">met_dict</span><span class="p">[</span><span class="n">metabolite</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">[</span><span class="n">met</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">reaction</span><span class="p">)]</span>
            <span class="n">temp_reaction</span><span class="o">.</span><span class="n">add_metabolites</span><span class="p">(</span><span class="n">met_dict</span><span class="p">)</span>
            <span class="n">model</span><span class="o">.</span><span class="n">add_reactions</span><span class="p">([</span><span class="n">temp_reaction</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">address</span><span class="p">:</span>
            <span class="n">cobra</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">save_json_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="adtoolbox.adm.Model.s" class="doc doc-heading">
<code class="highlight language-python"><span class="n">s</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns the stoichiometric matrix of a model</p>
  </div>

</div>



<div class="doc doc-object doc-function">



<h3 id="adtoolbox.adm.Model.build_cobra_model" class="doc doc-heading">
<code class="highlight language-python"><span class="n">build_cobra_model</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>This method builds a cobra model from an instance of Model. One particular use
of such models is to build an escher map from the model.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>address</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The address to save the model. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/adm.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">build_cobra_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">address</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This method builds a cobra model from an instance of Model. One particular use</span>
<span class="sd">    of such models is to build an escher map from the model.</span>
<span class="sd">    Args:</span>
<span class="sd">        address (str, optional): The address to save the model. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">cobra</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;CobraPy is not installed, please install it to use this function&quot;</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">cobra</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">:</span>
        <span class="n">temp_reaction</span> <span class="o">=</span> <span class="n">cobra</span><span class="o">.</span><span class="n">Reaction</span><span class="p">(</span><span class="n">reaction</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="n">reaction</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">))</span>
        <span class="n">temp_mets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">reaction</span><span class="p">)]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">met_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">met</span> <span class="ow">in</span> <span class="n">temp_mets</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">metabolite</span> <span class="o">=</span> <span class="n">cobra</span><span class="o">.</span><span class="n">Metabolite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">met</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">),</span>
                                          <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">met</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">),</span> <span class="n">compartment</span><span class="o">=</span><span class="s2">&quot;Model&quot;</span><span class="p">)</span>
            <span class="n">met_dict</span><span class="p">[</span><span class="n">metabolite</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">[</span><span class="n">met</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">reaction</span><span class="p">)]</span>
        <span class="n">temp_reaction</span><span class="o">.</span><span class="n">add_metabolites</span><span class="p">(</span><span class="n">met_dict</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">add_reactions</span><span class="p">([</span><span class="n">temp_reaction</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">address</span><span class="p">:</span>
        <span class="n">cobra</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">save_json_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="adtoolbox.adm.Model.copy" class="doc doc-heading">
<code class="highlight language-python"><span class="n">copy</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns a copy of the model</p>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/adm.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a copy of the model&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">model_parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                      <span class="n">base_parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">base_parameters</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                      <span class="n">initial_conditions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ic</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                      <span class="n">inlet_conditions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_inc</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                      <span class="n">feed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="p">,</span>
                      <span class="n">reactions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                      <span class="n">species</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                      <span class="n">ode_system</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ode_system</span><span class="p">,</span>
                      <span class="n">build_stoichiometric_matrix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">build_stoichiometric_matrix</span><span class="p">,</span>
                      <span class="n">control_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">control_state</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                      <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                      <span class="n">switch</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">switch</span><span class="p">,</span>
                      <span class="n">time_limit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_limit</span><span class="p">,</span>
                      <span class="n">simulation_time</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="adtoolbox.adm.Model.csv_report" class="doc doc-heading">
<code class="highlight language-python"><span class="n">csv_report</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Converts the results to a pandas data frame then to a csv</p>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/adm.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">csv_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sol</span><span class="p">:</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">_ivp</span><span class="o">.</span><span class="n">ivp</span><span class="o">.</span><span class="n">OdeResult</span> <span class="p">,</span><span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Converts the results to a pandas data frame then to a csv&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">sol</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">address</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;_Report.csv&quot;</span><span class="p">),</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
              <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="adtoolbox.adm.Model.dash_app" class="doc doc-heading">
<code class="highlight language-python"><span class="n">dash_app</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">escher_map</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PKG_DATA</span><span class="p">,</span> <span class="s1">&#39;Modified_ADM_Map.json&#39;</span><span class="p">),</span> <span class="n">cobra_model</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PKG_DATA</span><span class="p">,</span> <span class="s1">&#39;Modified_ADM_Model.json&#39;</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>A method that creates the dash web app for a model based on an ODE solution.</p>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reactions</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;rxn1&#39;</span><span class="p">,</span><span class="s1">&#39;rxn2&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">species</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">initial_conditions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="mf">.001</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="mf">.002</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mf">.003</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inlet_conditions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a_in&#39;</span><span class="p">:</span><span class="mf">.001</span><span class="p">,</span><span class="s1">&#39;b_in&#39;</span><span class="p">:</span><span class="mf">.002</span><span class="p">,</span><span class="s1">&#39;c_in&#39;</span><span class="p">:</span><span class="mf">.003</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model_parameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;k1&#39;</span><span class="p">:</span><span class="mf">0.001</span><span class="p">,</span><span class="s1">&#39;k2&#39;</span><span class="p">:</span><span class="mf">0.002</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">base_parameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;T&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">feed</span><span class="o">=</span><span class="n">Feed</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">build_stoiciometric_matrix</span><span class="p">(</span><span class="n">base_parameters</span><span class="p">,</span><span class="n">model_parameters</span><span class="p">,</span><span class="n">reactions</span><span class="p">,</span><span class="n">species</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">species</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">reactions</span><span class="p">)))</span>
<span class="gp">... </span>   <span class="n">s</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.001</span><span class="p">]</span>
<span class="gp">... </span>   <span class="n">s</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">... </span>   <span class="k">return</span> <span class="n">s</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">ode_system</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">Model1</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">Model1</span><span class="o">.</span><span class="n">reactions</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
<span class="gp">... </span>   <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">Model1</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k1&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">Model1</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span>
<span class="gp">... </span>   <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">Model1</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k2&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span>
<span class="gp">... </span>   <span class="n">dCdt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">Model1</span><span class="o">.</span><span class="n">S</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
<span class="gp">... </span>   <span class="k">return</span> <span class="n">dCdt</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">model_parameters</span><span class="p">,</span><span class="n">base_parameters</span><span class="p">,</span><span class="n">initial_conditions</span><span class="p">,</span><span class="n">inlet_conditions</span><span class="p">,</span><span class="n">reactions</span><span class="p">,</span><span class="n">species</span><span class="p">,</span><span class="n">ODE_System</span><span class="p">,</span><span class="n">Build_Stoiciometric_Matrix</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">solve_model</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mf">.1</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;RK45&#39;</span><span class="p">)[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">dash_app</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">solve_model</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">1000</span><span class="p">)))</span>
</code></pre></div>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>sol</code></td>
          <td>
                <code><span title="scipy.integrate">scipy</span>.<span title="scipy.integrate.integrate">integrate</span>.<span title="scipy.integrate._ivp">_ivp</span>.<span title="scipy.integrate._ivp.ivp">ivp</span>.<span title="scipy.integrate._ivp.ivp.OdeResult">OdeResult</span></code>
          </td>
          <td><p>The solution of the ODE system. This should be the output of the solve_model method.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>None</code></td>          <td>
                <code>None</code>
          </td>
          <td><p>This method does not return anything.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/adm.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">dash_app</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sol</span><span class="p">:</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">_ivp</span><span class="o">.</span><span class="n">ivp</span><span class="o">.</span><span class="n">OdeResult</span><span class="p">,</span>
             <span class="n">escher_map</span><span class="p">:</span><span class="nb">str</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PKG_DATA</span><span class="p">,</span><span class="s2">&quot;Modified_ADM_Map.json&quot;</span><span class="p">),</span>
             <span class="n">cobra_model</span><span class="p">:</span><span class="nb">str</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PKG_DATA</span><span class="p">,</span><span class="s2">&quot;Modified_ADM_Model.json&quot;</span><span class="p">),</span>
             <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A method that creates the dash web app for a model based on an ODE solution.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; reactions=[&#39;rxn1&#39;,&#39;rxn2&#39;]</span>
<span class="sd">        &gt;&gt;&gt; species=[&#39;a&#39;,&#39;b&#39;,&#39;c&#39;]</span>
<span class="sd">        &gt;&gt;&gt; initial_conditions={&#39;a&#39;:.001,&#39;b&#39;:.002,&#39;c&#39;:.003}</span>
<span class="sd">        &gt;&gt;&gt; inlet_conditions={&#39;a_in&#39;:.001,&#39;b_in&#39;:.002,&#39;c_in&#39;:.003}</span>
<span class="sd">        &gt;&gt;&gt; model_parameters={&#39;k1&#39;:0.001,&#39;k2&#39;:0.002}</span>
<span class="sd">        &gt;&gt;&gt; base_parameters={&#39;T&#39;:0.1}</span>
<span class="sd">        &gt;&gt;&gt; feed=Feed(10,20,20,20)</span>
<span class="sd">        &gt;&gt;&gt; def build_stoiciometric_matrix(base_parameters,model_parameters,reactions,species):</span>
<span class="sd">        ...    s = np.zeros((len(species), len(reactions)))</span>
<span class="sd">        ...    s[[0,1],0]=[-1,0.001]</span>
<span class="sd">        ...    s[[1,2],1]=[-5,1]</span>
<span class="sd">        ...    return s</span>
<span class="sd">        &gt;&gt;&gt; def ode_system(t,c,Model1):</span>
<span class="sd">        ...    v = np.zeros((len(Model1.reactions), 1))</span>
<span class="sd">        ...    v[0]=Model1.model_parameters[&#39;k1&#39;]*c[0]*Model1.base_parameters[&#39;T&#39;]/1000</span>
<span class="sd">        ...    v[1]=Model1.model_parameters[&#39;k2&#39;]*c[1]/1000</span>
<span class="sd">        ...    dCdt=np.matmul(Model1.S,v)</span>
<span class="sd">        ...    return dCdt[:, 0]</span>
<span class="sd">        &gt;&gt;&gt; m= Model(model_parameters,base_parameters,initial_conditions,inlet_conditions,reactions,species,ODE_System,Build_Stoiciometric_Matrix)</span>
<span class="sd">        &gt;&gt;&gt; m.solve_model((0,.1),np.linspace(0,0.1,10),method=&#39;RK45&#39;)[&#39;status&#39;]==0</span>
<span class="sd">        True</span>
<span class="sd">        &gt;&gt;&gt; m.dash_app(m.solve_model(np.linspace(0,30,1000)))</span>

<span class="sd">    Args:</span>
<span class="sd">        sol (scipy.integrate._ivp.ivp.OdeResult): The solution of the ODE system. This should be the output of the solve_model method.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None: This method does not return anything.</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">escher_map</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">escher_map</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">escher_map</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cobra_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cobra_model</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">cobra_model</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="n">app</span> <span class="o">=</span> <span class="n">Dash</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">external_stylesheets</span><span class="o">=</span><span class="p">[</span><span class="n">dbc</span><span class="o">.</span><span class="n">themes</span><span class="o">.</span><span class="n">FLATLY</span><span class="p">])</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;background&#39;</span><span class="p">:</span> <span class="s1">&#39;#659dbd&#39;</span><span class="p">,</span>
        <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="s1">&#39;#3e4444&#39;</span>
    <span class="p">}</span>


    <span class="n">solution</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="n">sol</span><span class="o">.</span><span class="n">t</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)):</span>
        <span class="n">solution</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">sol_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>


    <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">sol_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">sol_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
                  <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Concentration of species&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="p">{</span>
    <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
    <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
    <span class="s1">&#39;xanchor&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span>
    <span class="s1">&#39;yanchor&#39;</span><span class="p">:</span> <span class="s1">&#39;top&#39;</span><span class="p">},</span>
    <span class="n">legend</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span> <span class="mi">20</span><span class="p">),),</span>
    <span class="n">plot_bgcolor</span><span class="o">=</span><span class="s2">&quot;rgba(0,0,0,0)&quot;</span><span class="p">,</span>
    <span class="n">paper_bgcolor</span><span class="o">=</span><span class="s2">&quot;rgba(0,0,0,0)&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Time (Days)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
        <span class="p">},</span>
         <span class="n">tickfont_size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span>
    <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Concentrations (kg COD/m^3)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
     <span class="p">},</span>
    <span class="n">tickfont_size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span>
    <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span>

        <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span><span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

    <span class="n">styles</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;table_width&#39;</span><span class="p">:</span> <span class="s1">&#39;95%&#39;</span><span class="p">,</span>
        <span class="s1">&#39;padding-left&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
        <span class="s1">&#39;container_width&#39;</span><span class="p">:</span> <span class="s1">&#39;85%&#39;</span>
    <span class="p">}</span>
    <span class="n">page</span><span class="o">=</span><span class="p">[</span><span class="n">dbc</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span>
                    <span class="n">html</span><span class="o">.</span><span class="n">H1</span><span class="p">(</span><span class="s2">&quot;ADToolbox Web Interface&quot;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;font-size&quot;</span><span class="p">:</span><span class="s2">&quot;70px&quot;</span><span class="p">,</span> <span class="s2">&quot;padding-top&quot;</span><span class="p">:</span><span class="s2">&quot;50px&quot;</span><span class="p">}),</span><span class="n">className</span><span class="o">=</span><span class="s2">&quot;text-white bg-primary&quot;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;height&quot;</span><span class="p">:</span><span class="s2">&quot;300px&quot;</span><span class="p">,</span><span class="s2">&quot;text-align&quot;</span><span class="p">:</span> <span class="s2">&quot;center&quot;</span><span class="p">},</span> <span class="n">fluid</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                    <span class="n">dbc</span><span class="o">.</span><span class="n">Container</span><span class="p">([</span><span class="n">dbc</span><span class="o">.</span><span class="n">Row</span><span class="p">(</span>
                                <span class="p">[</span><span class="n">dbc</span><span class="o">.</span><span class="n">Card</span><span class="p">([</span>
                                    <span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> Concentration Plot&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span>
                                        <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
                                        <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;15&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;padding-top&#39;</span><span class="p">:</span> <span class="s1">&#39;50px&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;padding-bottom&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;padding-left&#39;</span><span class="p">:</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;padding-left&#39;</span><span class="p">]</span> <span class="p">},</span>
                                         <span class="n">className</span><span class="o">=</span><span class="s2">&quot;card-title&quot;</span><span class="p">),</span>
                                    <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;Concentrations_Line_Plot&#39;</span><span class="p">,</span>
                                            <span class="n">style</span><span class="o">=</span><span class="p">{</span>
                                            <span class="s2">&quot;height&quot;</span><span class="p">:</span><span class="s2">&quot;600px&quot;</span><span class="p">,</span>
                                            <span class="s2">&quot;padding-left&quot;</span><span class="p">:</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;padding-left&#39;</span><span class="p">],</span>
                                            <span class="s1">&#39;background-color&#39;</span><span class="p">:</span> <span class="s1">&#39;rgba(0,0,0,0)&#39;</span><span class="p">}</span>
                                            <span class="p">),],</span><span class="n">className</span><span class="o">=</span><span class="s1">&#39;bg-light&#39;</span><span class="p">),</span>

                                <span class="n">dbc</span><span class="o">.</span><span class="n">Card</span><span class="p">([</span><span class="n">html</span><span class="o">.</span><span class="n">H3</span><span class="p">(</span><span class="s2">&quot;Base Parameters&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span>
                                    <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
                                    <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;15&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;padding-top&#39;</span><span class="p">:</span> <span class="s1">&#39;50px&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;padding-bottom&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;padding-left&#39;</span><span class="p">:</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;padding-left&#39;</span><span class="p">]</span>
                                    <span class="p">}),</span>
                                    <span class="n">dash_table</span><span class="o">.</span><span class="n">DataTable</span><span class="p">(</span>
                                    <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;base_parameters&#39;</span><span class="p">,</span>
                                    <span class="n">columns</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;numeric&quot;</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())],</span>
                                    <span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;records&#39;</span><span class="p">),</span>
                                    <span class="n">editable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                    <span class="n">style_table</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;overflowX&#39;</span><span class="p">:</span> <span class="s1">&#39;scroll&#39;</span><span class="p">,</span> <span class="s1">&#39;padding-left&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span><span class="s1">&#39;padding-bottom&#39;</span><span class="p">:</span><span class="s1">&#39;30px&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;table_width&#39;</span><span class="p">]},</span>
                                    <span class="n">style_header</span><span class="o">=</span><span class="p">{</span>
                                    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;30px&#39;</span><span class="p">,</span>
                                        <span class="p">},</span>
                                    <span class="n">style_data</span><span class="o">=</span><span class="p">{</span>
                                    <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;rgb(250, 250, 250)&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;25px&#39;</span><span class="p">}),],</span><span class="n">className</span><span class="o">=</span><span class="s2">&quot;bg-light&quot;</span><span class="p">),</span>

                                <span class="n">dbc</span><span class="o">.</span><span class="n">Card</span><span class="p">([</span><span class="n">html</span><span class="o">.</span><span class="n">H3</span><span class="p">(</span><span class="s2">&quot;Model Parameters&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span>
                                    <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
                                    <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;15&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;padding-top&#39;</span><span class="p">:</span> <span class="s1">&#39;50px&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;padding-bottom&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;padding-left&#39;</span><span class="p">:</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;padding-left&#39;</span><span class="p">]</span>
                                    <span class="p">}),</span>
                                    <span class="n">dash_table</span><span class="o">.</span><span class="n">DataTable</span><span class="p">(</span>
                                    <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;model_parameters&#39;</span><span class="p">,</span>
                                    <span class="n">columns</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;numeric&quot;</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())],</span>
                                    <span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;records&#39;</span><span class="p">),</span>
                                    <span class="n">editable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                    <span class="n">style_table</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;overflowX&#39;</span><span class="p">:</span> <span class="s1">&#39;scroll&#39;</span><span class="p">,</span> <span class="s1">&#39;padding-left&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span><span class="s1">&#39;padding-bottom&#39;</span><span class="p">:</span><span class="s1">&#39;30px&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;table_width&#39;</span><span class="p">]},</span>
                                    <span class="n">style_header</span><span class="o">=</span><span class="p">{</span>
                                    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;30px&#39;</span><span class="p">,</span>
                                        <span class="p">},</span>
                                    <span class="n">style_data</span><span class="o">=</span><span class="p">{</span>
                                    <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;rgb(250, 250, 250)&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;25px&#39;</span><span class="p">}),],</span><span class="n">className</span><span class="o">=</span><span class="s2">&quot;bg-light&quot;</span><span class="p">),</span>

                                <span class="n">dbc</span><span class="o">.</span><span class="n">Card</span><span class="p">([</span><span class="n">html</span><span class="o">.</span><span class="n">H3</span><span class="p">(</span><span class="s2">&quot;Initial Conditions&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span>
                                    <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
                                    <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;15&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;padding-top&#39;</span><span class="p">:</span> <span class="s1">&#39;50px&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;padding-bottom&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;padding-left&#39;</span><span class="p">:</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;padding-left&#39;</span><span class="p">]</span>
                                    <span class="p">}),</span>
                                    <span class="n">dash_table</span><span class="o">.</span><span class="n">DataTable</span><span class="p">(</span>
                                    <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;initial_conditions&#39;</span><span class="p">,</span>
                                    <span class="n">columns</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;numeric&quot;</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ic</span><span class="o">.</span><span class="n">keys</span><span class="p">())],</span>
                                    <span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ic</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;records&#39;</span><span class="p">),</span>
                                    <span class="n">editable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                    <span class="n">style_table</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;overflowX&#39;</span><span class="p">:</span> <span class="s1">&#39;scroll&#39;</span><span class="p">,</span> <span class="s1">&#39;padding-left&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span><span class="s1">&#39;padding-bottom&#39;</span><span class="p">:</span><span class="s1">&#39;30px&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;table_width&#39;</span><span class="p">]},</span>
                                    <span class="n">style_header</span><span class="o">=</span><span class="p">{</span>
                                    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;30px&#39;</span><span class="p">,</span>
                                        <span class="p">},</span>
                                    <span class="n">style_data</span><span class="o">=</span><span class="p">{</span>
                                    <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;rgb(250, 250, 250)&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;25px&#39;</span><span class="p">}),],</span><span class="n">className</span><span class="o">=</span><span class="s2">&quot;bg-light&quot;</span><span class="p">),</span>

                                <span class="n">dbc</span><span class="o">.</span><span class="n">Card</span><span class="p">([</span><span class="n">html</span><span class="o">.</span><span class="n">H3</span><span class="p">(</span><span class="s2">&quot;Inlet Conditions&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span>
                                    <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
                                    <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;15&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;padding-top&#39;</span><span class="p">:</span> <span class="s1">&#39;50px&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;padding-bottom&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;padding-left&#39;</span><span class="p">:</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;padding-left&#39;</span><span class="p">]</span>
                                    <span class="p">}),</span>
                                    <span class="n">dash_table</span><span class="o">.</span><span class="n">DataTable</span><span class="p">(</span>
                                    <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;inlet_conditions&#39;</span><span class="p">,</span>
                                    <span class="n">columns</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;numeric&quot;</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inc</span><span class="o">.</span><span class="n">keys</span><span class="p">())],</span>
                                    <span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inc</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;records&#39;</span><span class="p">),</span>
                                    <span class="n">editable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                    <span class="n">style_table</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;overflowX&#39;</span><span class="p">:</span> <span class="s1">&#39;scroll&#39;</span><span class="p">,</span> <span class="s1">&#39;padding-left&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span><span class="s1">&#39;padding-bottom&#39;</span><span class="p">:</span><span class="s1">&#39;30px&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;table_width&#39;</span><span class="p">]},</span>
                                    <span class="n">style_header</span><span class="o">=</span><span class="p">{</span>
                                    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;30px&#39;</span><span class="p">,</span>
                                        <span class="p">},</span>
                                    <span class="n">style_data</span><span class="o">=</span><span class="p">{</span>
                                    <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;rgb(250, 250, 250)&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;25px&#39;</span><span class="p">}),],</span><span class="n">className</span><span class="o">=</span><span class="s2">&quot;bg-light&quot;</span><span class="p">),</span>
                                    <span class="p">],</span><span class="n">className</span><span class="o">=</span><span class="s2">&quot;bg-light&quot;</span><span class="p">)],</span><span class="n">fluid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">className</span><span class="o">=</span><span class="s2">&quot;bg-light&quot;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;container_width&#39;</span><span class="p">]}),</span>
                                <span class="n">dbc</span><span class="o">.</span><span class="n">Container</span><span class="p">([</span><span class="n">dbc</span><span class="o">.</span><span class="n">Row</span><span class="p">(</span>
                                <span class="p">[</span>
                                <span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="s2">&quot;Escher Map&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span>
                                <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
                                <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;15&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;padding-top&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;padding-bottom&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;padding-left&#39;</span><span class="p">:</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;padding-left&#39;</span><span class="p">]</span>
                                <span class="p">})</span> <span class="p">,</span>

                                <span class="n">dcc</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">([</span><span class="s2">&quot;Show Map&quot;</span><span class="p">,</span><span class="s2">&quot;Hide Map&quot;</span><span class="p">],</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="s2">&quot;300px&quot;</span><span class="p">,</span><span class="s2">&quot;font-size&quot;</span><span class="p">:</span><span class="mi">25</span><span class="p">,</span><span class="s1">&#39;padding-left&#39;</span><span class="p">:</span><span class="s1">&#39;2-px&#39;</span><span class="p">},</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;Drop_Down_Escher&quot;</span><span class="p">),</span>
                                <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="n">children</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;Escher_&quot;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="s2">&quot;100px&quot;</span><span class="p">,</span><span class="s1">&#39;padding-buttom&#39;</span><span class="p">:</span><span class="s1">&#39;20px&#39;</span><span class="p">}),</span>
                                <span class="p">])],</span> <span class="n">fluid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">className</span><span class="o">=</span><span class="s2">&quot;bg-light pb-3&quot;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;container_width&#39;</span><span class="p">]}),</span>
        <span class="n">dbc</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="n">children</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;Escher&quot;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;align&#39;</span><span class="p">:</span><span class="s1">&#39;center&#39;</span><span class="p">}),</span><span class="n">fluid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">className</span><span class="o">=</span><span class="s2">&quot;bg-light pb-3&quot;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;container_width&#39;</span><span class="p">]}),</span>
    <span class="p">]</span>
    <span class="k">if</span> <span class="n">escher_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">page</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">page</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">page</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>


    <span class="n">app</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>

    <span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s2">&quot;Escher_&quot;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;children&#39;</span><span class="p">),</span> <span class="n">Input</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s2">&quot;Drop_Down_Escher&quot;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">escher_wrapper</span><span class="p">(</span><span class="n">drop_down_escher</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;drop_down_escher&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">drop_down_escher</span><span class="o">==</span><span class="s2">&quot;Show Map&quot;</span><span class="p">:</span>
            <span class="n">Labels</span><span class="o">=</span><span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="o">/</span><span class="mi">20</span><span class="p">)):</span>
                <span class="n">Labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="s1">&#39;style&#39;</span><span class="p">:{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#77b0b1&#39;</span><span class="p">}}</span>
            <span class="n">Labels</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="s2">&quot;Time (Day)&quot;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">}),</span><span class="n">dcc</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="o">/</span><span class="mi">20</span><span class="p">),</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;Escher_Slider&quot;</span><span class="p">,</span><span class="n">marks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">tooltip</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;placement&quot;</span><span class="p">:</span> <span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="s2">&quot;always_visible&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})]</span>

    <span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s2">&quot;Escher&quot;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;children&#39;</span><span class="p">),</span> <span class="n">Input</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s2">&quot;Drop_Down_Escher&quot;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s2">&quot;Escher_Slider&quot;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">),</span><span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>        
    <span class="k">def</span> <span class="nf">draw_escher</span><span class="p">(</span><span class="n">drop_down_escher</span><span class="p">,</span><span class="n">escher_slider</span><span class="p">):</span>
        <span class="n">rxn_data</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ode_system</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span><span class="nb">int</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="o">*</span><span class="n">escher_slider</span><span class="p">)],</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">fluxes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;Fluxes&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">):</span>
            <span class="n">rxn_data</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;_&quot;</span><span class="p">)]</span><span class="o">=</span> <span class="n">fluxes</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;min_flux&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">):</span>
            <span class="n">min_scale</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;min_flux&#39;</span><span class="p">)</span> <span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span> <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">min_scale</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;min&#39;</span> <span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span> <span class="p">}</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_flux&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">):</span>
            <span class="n">max_scale</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_flux&#39;</span><span class="p">)</span> <span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span> <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_scale</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span> <span class="p">}</span>

        <span class="k">if</span> <span class="n">drop_down_escher</span><span class="o">==</span><span class="s2">&quot;Show Map&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">dash_escher</span><span class="o">.</span><span class="n">DashEscher</span><span class="p">(</span><span class="n">mapData</span><span class="o">=</span><span class="n">escher_map</span><span class="p">,</span><span class="n">modelData</span><span class="o">=</span><span class="n">cobra_model</span><span class="p">,</span>
        <span class="n">options</span><span class="o">=</span><span class="p">{</span>
         <span class="s1">&#39;reaction_data&#39;</span><span class="p">:</span><span class="n">rxn_data</span><span class="p">,</span>
         <span class="s1">&#39;enable_keys&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span>
         <span class="s1">&#39;reaction_scale&#39;</span><span class="p">:[</span><span class="n">min_scale</span><span class="p">,</span><span class="n">max_scale</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="s1">&#39;1000px&#39;</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="s1">&#39;100%&#39;</span><span class="p">)</span>
         <span class="p">]</span>
    <span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s1">&#39;Concentrations_Line_Plot&#39;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;figure&#39;</span><span class="p">),</span>
                <span class="n">Input</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s1">&#39;base_parameters&#39;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">),</span>
                <span class="n">Input</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s1">&#39;model_parameters&#39;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">),</span>
                <span class="n">Input</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s1">&#39;initial_conditions&#39;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">),</span>
                <span class="n">Input</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s1">&#39;inlet_conditions&#39;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">),</span>
                <span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
    <span class="k">def</span> <span class="nf">update_graph_fig</span><span class="p">(</span><span class="n">base_parameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">model_parameters</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">initial_conditions</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">inlet_conditions</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">plotly</span><span class="o">.</span><span class="n">graph_objects</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_state</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">control_state</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">control_state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">initial_conditions</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">base_parameters</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_parameters</span> <span class="o">=</span> <span class="n">base_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_parameters</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_conditions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span><span class="n">initial_conditions</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">])[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inlet_conditions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span><span class="n">inlet_conditions</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="o">+</span><span class="s2">&quot;_in&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">])[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="n">update_sol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solve_model</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="p">,</span> <span class="mi">10000</span><span class="p">))</span>

        <span class="n">sol</span><span class="o">=</span><span class="n">update_sol</span>
        <span class="n">solution</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="n">update_sol</span><span class="o">.</span><span class="n">t</span><span class="p">,</span>
                    <span class="p">}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)):</span>
            <span class="n">solution</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">update_sol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">sol_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">sol_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">sol_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
                      <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Concentration of species&quot;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
        <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
        <span class="s1">&#39;xanchor&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span>
        <span class="s1">&#39;yanchor&#39;</span><span class="p">:</span> <span class="s1">&#39;top&#39;</span><span class="p">},</span>
        <span class="n">legend</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span> <span class="mi">20</span><span class="p">),),</span>
        <span class="n">plot_bgcolor</span><span class="o">=</span><span class="s2">&quot;rgba(0,0,0,0)&quot;</span><span class="p">,</span>
        <span class="n">paper_bgcolor</span><span class="o">=</span><span class="s2">&quot;rgba(0,0,0,0)&quot;</span><span class="p">,</span>

            <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Time (Days)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
            <span class="p">},</span>
             <span class="n">tickfont_size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
        <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span>
        <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Concentrations (kg COD/m^3)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
         <span class="p">},</span>
        <span class="n">tickfont_size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
        <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span>
        <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span>


            <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span><span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">fig</span>



    <span class="n">app</span><span class="o">.</span><span class="n">run_server</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="adtoolbox.adm.Model.plot" class="doc doc-heading">
<code class="highlight language-python"><span class="n">plot</span><span class="p">(</span><span class="n">Sol</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;Line&#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>A function which returns a plot of the solution from the ODE</p>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/adm.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Sol</span><span class="p">:</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">_ivp</span><span class="o">.</span><span class="n">ivp</span><span class="o">.</span><span class="n">OdeResult</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Line&quot;</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; A function which returns a plot of the solution from the ODE</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">solution</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="n">Sol</span><span class="o">.</span><span class="n">t</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)):</span>
        <span class="n">solution</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Sol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">sol_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;Line&quot;</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">sol_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">sol_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
                      <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Concentration of species&quot;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
                <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>

                <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
                <span class="s1">&#39;xanchor&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span>
                <span class="s1">&#39;yanchor&#39;</span><span class="p">:</span> <span class="s1">&#39;top&#39;</span><span class="p">}</span>

        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Time (Days)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Concentrations (kg COD/m^3)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;Sankey&quot;</span><span class="p">:</span>
        <span class="c1">### Maybe add a sankey plot here later</span>
        <span class="k">pass</span>

    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="adtoolbox.adm.Model.solve_model" class="doc doc-heading">
<code class="highlight language-python"><span class="n">solve_model</span><span class="p">(</span><span class="n">t_eval</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;BDF&#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Function to solve the model. </p>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reactions</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;rxn1&#39;</span><span class="p">,</span><span class="s1">&#39;rxn2&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">species</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">initial_conditions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="mf">.001</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="mf">.002</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mf">.003</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inlet_conditions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a_in&#39;</span><span class="p">:</span><span class="mf">.001</span><span class="p">,</span><span class="s1">&#39;b_in&#39;</span><span class="p">:</span><span class="mf">.002</span><span class="p">,</span><span class="s1">&#39;c_in&#39;</span><span class="p">:</span><span class="mf">.003</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model_parameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;k1&#39;</span><span class="p">:</span><span class="mf">0.001</span><span class="p">,</span><span class="s1">&#39;k2&#39;</span><span class="p">:</span><span class="mf">0.002</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">base_parameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;T&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">feed</span><span class="o">=</span><span class="n">Feed</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">build_stoiciometric_matrix</span><span class="p">(</span><span class="n">base_parameters</span><span class="p">,</span><span class="n">model_parameters</span><span class="p">,</span><span class="n">reactions</span><span class="p">,</span><span class="n">species</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">species</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">reactions</span><span class="p">)))</span>
<span class="gp">... </span>   <span class="n">s</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.001</span><span class="p">]</span>
<span class="gp">... </span>   <span class="n">s</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">... </span>   <span class="k">return</span> <span class="n">s</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">ode_system</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">Model1</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">Model1</span><span class="o">.</span><span class="n">reactions</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
<span class="gp">... </span>   <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">Model1</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k1&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">Model1</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span>
<span class="gp">... </span>   <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">Model1</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k2&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span>
<span class="gp">... </span>   <span class="n">dCdt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">Model1</span><span class="o">.</span><span class="n">S</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
<span class="gp">... </span>   <span class="k">return</span> <span class="n">dCdt</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">model_parameters</span><span class="p">,</span><span class="n">base_parameters</span><span class="p">,</span><span class="n">initial_conditions</span><span class="p">,</span><span class="n">inlet_conditions</span><span class="p">,</span><span class="n">reactions</span><span class="p">,</span><span class="n">species</span><span class="p">,</span><span class="n">ODE_System</span><span class="p">,</span><span class="n">Build_Stoiciometric_Matrix</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">solve_model</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mf">.1</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;RK45&#39;</span><span class="p">)[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span>
<span class="go">True</span>
</code></pre></div>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>t_eval</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>Time points at which the solution is reported</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>method</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The method used to solve the ODE. Defaults to "BDF".</p></td>
          <td>
                <code>&#39;BDF&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="scipy.integrate">scipy</span>.<span title="scipy.integrate.integrate">integrate</span>.<span title="scipy.integrate._ivp">_ivp</span>.<span title="scipy.integrate._ivp.ivp">ivp</span>.<span title="scipy.integrate._ivp.ivp.OdeResult">OdeResult</span></code>
          </td>
          <td><p>scipy.integrate._ivp.ivp.OdeResult: Returns the results of the simulation being run and gives optimized paramters.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/adm.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">solve_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t_eval</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;BDF&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">_ivp</span><span class="o">.</span><span class="n">ivp</span><span class="o">.</span><span class="n">OdeResult</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to solve the model. </span>
<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; reactions=[&#39;rxn1&#39;,&#39;rxn2&#39;]</span>
<span class="sd">        &gt;&gt;&gt; species=[&#39;a&#39;,&#39;b&#39;,&#39;c&#39;]</span>
<span class="sd">        &gt;&gt;&gt; initial_conditions={&#39;a&#39;:.001,&#39;b&#39;:.002,&#39;c&#39;:.003}</span>
<span class="sd">        &gt;&gt;&gt; inlet_conditions={&#39;a_in&#39;:.001,&#39;b_in&#39;:.002,&#39;c_in&#39;:.003}</span>
<span class="sd">        &gt;&gt;&gt; model_parameters={&#39;k1&#39;:0.001,&#39;k2&#39;:0.002}</span>
<span class="sd">        &gt;&gt;&gt; base_parameters={&#39;T&#39;:0.1}</span>
<span class="sd">        &gt;&gt;&gt; feed=Feed(10,20,20,20)</span>
<span class="sd">        &gt;&gt;&gt; def build_stoiciometric_matrix(base_parameters,model_parameters,reactions,species):</span>
<span class="sd">        ...    s = np.zeros((len(species), len(reactions)))</span>
<span class="sd">        ...    s[[0,1],0]=[-1,0.001]</span>
<span class="sd">        ...    s[[1,2],1]=[-5,1]</span>
<span class="sd">        ...    return s</span>
<span class="sd">        &gt;&gt;&gt; def ode_system(t,c,Model1):</span>
<span class="sd">        ...    v = np.zeros((len(Model1.reactions), 1))</span>
<span class="sd">        ...    v[0]=Model1.model_parameters[&#39;k1&#39;]*c[0]*Model1.base_parameters[&#39;T&#39;]/1000</span>
<span class="sd">        ...    v[1]=Model1.model_parameters[&#39;k2&#39;]*c[1]/1000</span>
<span class="sd">        ...    dCdt=np.matmul(Model1.S,v)</span>
<span class="sd">        ...    return dCdt[:, 0]</span>
<span class="sd">        &gt;&gt;&gt; m= Model(model_parameters,base_parameters,initial_conditions,inlet_conditions,reactions,species,ODE_System,Build_Stoiciometric_Matrix)</span>
<span class="sd">        &gt;&gt;&gt; m.solve_model((0,.1),np.linspace(0,0.1,10),method=&#39;RK45&#39;)[&#39;status&#39;]==0</span>
<span class="sd">        True</span>

<span class="sd">    Args:</span>
<span class="sd">        t_eval (np.ndarray): Time points at which the solution is reported</span>
<span class="sd">        method (str, optional): The method used to solve the ODE. Defaults to &quot;BDF&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        scipy.integrate._ivp.ivp.OdeResult: Returns the results of the simulation being run and gives optimized paramters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Fluxes&quot;</span><span class="p">:[]}</span>
    <span class="n">y0</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_conditions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_be_time</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">solve_ivp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ode_system</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="p">),</span> <span class="n">y0</span><span class="p">,</span> <span class="n">t_eval</span><span class="o">=</span><span class="n">t_eval</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="p">],</span><span class="n">rtol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not solve model, setting C to a very large value&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">=</span><span class="n">_Fake_Sol</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">y0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">len</span><span class="p">(</span><span class="n">t_eval</span><span class="p">)))</span><span class="o">*</span><span class="mf">1e10</span><span class="p">,</span><span class="n">t_eval</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">c</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="adtoolbox.adm.Model.update_parameters" class="doc doc-heading">
<code class="highlight language-python"><span class="n">update_parameters</span><span class="p">(</span><span class="n">model_parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">base_parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">initial_conditions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inlet_conditions</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>This method updates the parameters of the model. Each argument can be a dictionary containing the parameters to be updated.
NOTE: It is important to note that you have to separate different kind parameters.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>model_parameters</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>a dictionary which contains the model parameters to be updated as keys and their values as values.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>base_parameters</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>a dictionary which contains the base parameters to be updated as keys and their values as values.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>initial_conditions</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>a dictionary containing the initial conditions to be updated as keys and their values as values.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>inlet_conditions</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>a dictionary containing the inlet conditions to be updated as keys and their values as values.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>None</code></td>          <td>
                <code>None</code>
          </td>
          <td><p>This method does not return anything.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/adm.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                    <span class="n">model_parameters</span><span class="p">:</span> <span class="nb">dict</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">base_parameters</span><span class="p">:</span>  <span class="nb">dict</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">initial_conditions</span><span class="p">:</span> <span class="nb">dict</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">inlet_conditions</span><span class="p">:</span> <span class="nb">dict</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method updates the parameters of the model. Each argument can be a dictionary containing the parameters to be updated.</span>
<span class="sd">    NOTE: It is important to note that you have to separate different kind parameters.</span>
<span class="sd">    Args:</span>
<span class="sd">        model_parameters (dict): a dictionary which contains the model parameters to be updated as keys and their values as values.</span>
<span class="sd">        base_parameters (dict): a dictionary which contains the base parameters to be updated as keys and their values as values.</span>
<span class="sd">        initial_conditions (dict): a dictionary containing the initial conditions to be updated as keys and their values as values.</span>
<span class="sd">        inlet_conditions (dict): a dictionary containing the inlet conditions to be updated as keys and their values as values.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None: This method does not return anything.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">model_parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">model_parameters</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">base_parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_parameters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">base_parameters</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">initial_conditions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">initial_conditions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initial_conditions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span><span class="o">=</span><span class="n">v</span>
    <span class="k">if</span> <span class="n">inlet_conditions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">inlet_conditions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inlet_conditions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span><span class="o">=</span><span class="n">v</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="adtoolbox.adm.adm1_ode_sys" class="doc doc-heading">
<code class="highlight language-python"><span class="n">adm1_ode_sys</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>The ODE system for the original ADM.
No testing is done.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>t</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>a matrix of zeros to be filled</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>c</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>an array of concentrations to be filled</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Model</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="adtoolbox.adm.Model" href="#adtoolbox.adm.Model">Model</a></code>
          </td>
          <td><p>The an instance of Model to calculate ODE with</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>np.ndarray: The output is dCdt, the change of concentration with respect to time.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/adm.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">adm1_ode_sys</span><span class="p">(</span><span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span><span class="n">Model</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; The ODE system for the original ADM.</span>
<span class="sd">        No testing is done.</span>

<span class="sd">        Args:</span>
<span class="sd">            t (float):a matrix of zeros to be filled</span>
<span class="sd">            c (np.ndarray): an array of concentrations to be filled</span>
<span class="sd">            Model (Model): The an instance of Model to calculate ODE with</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.ndarray: The output is dCdt, the change of concentration with respect to time.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">c</span><span class="p">[</span><span class="mi">34</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">-</span> <span class="n">c</span><span class="p">[</span><span class="mi">33</span><span class="p">]</span>
    <span class="n">c</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">-</span> <span class="n">c</span><span class="p">[</span><span class="mi">31</span><span class="p">]</span>
    <span class="n">I_pH_aa</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;K_pH_aa&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;nn_aa&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span>
        <span class="n">c</span><span class="p">[</span><span class="mi">26</span><span class="p">],</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;nn_aa&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;K_pH_aa&quot;</span><span class="p">],</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;nn_aa&#39;</span><span class="p">]))</span>
    <span class="n">I_pH_ac</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_ac&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;n_ac&quot;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span>
        <span class="n">c</span><span class="p">[</span><span class="mi">26</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_ac&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_ac&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_ac&#39;</span><span class="p">])</span>
    <span class="n">I_pH_h2</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_h2&#39;</span><span class="p">]</span><span class="o">**</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_h2&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span>
        <span class="n">c</span><span class="p">[</span><span class="mi">26</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_h2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_h2&#39;</span><span class="p">]</span><span class="o">**</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_h2&#39;</span><span class="p">])</span>
    <span class="n">I_IN_lim</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_IN&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">c</span><span class="p">[</span><span class="mi">10</span><span class="p">]))</span>
    <span class="n">I_h2_fa</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">/</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_I_h2_fa&#39;</span><span class="p">]))</span>
    <span class="n">I_h2_c4</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">/</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_I_h2_c4&#39;</span><span class="p">]))</span>
    <span class="n">I_h2_pro</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">/</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_I_h2_pro&#39;</span><span class="p">])))</span>
    <span class="n">I_nh3</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">33</span><span class="p">]</span><span class="o">/</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_I_nh3&#39;</span><span class="p">]))</span>
    <span class="n">I5</span> <span class="o">=</span> <span class="p">(</span><span class="n">I_pH_aa</span> <span class="o">*</span> <span class="n">I_IN_lim</span><span class="p">)</span>
    <span class="n">I6</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">I5</span><span class="p">)</span>
    <span class="n">I7</span> <span class="o">=</span> <span class="p">(</span><span class="n">I_pH_aa</span> <span class="o">*</span> <span class="n">I_IN_lim</span> <span class="o">*</span> <span class="n">I_h2_fa</span><span class="p">)</span>
    <span class="n">I8</span> <span class="o">=</span> <span class="p">(</span><span class="n">I_pH_aa</span> <span class="o">*</span> <span class="n">I_IN_lim</span> <span class="o">*</span> <span class="n">I_h2_c4</span><span class="p">)</span>
    <span class="n">I9</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">I8</span><span class="p">)</span>
    <span class="n">I10</span> <span class="o">=</span> <span class="p">(</span><span class="n">I_pH_aa</span> <span class="o">*</span> <span class="n">I_IN_lim</span> <span class="o">*</span> <span class="n">I_h2_pro</span><span class="p">)</span>
    <span class="n">I11</span> <span class="o">=</span> <span class="p">(</span><span class="n">I_pH_ac</span> <span class="o">*</span> <span class="n">I_IN_lim</span> <span class="o">*</span> <span class="n">I_nh3</span><span class="p">)</span>
    <span class="n">I12</span> <span class="o">=</span> <span class="p">(</span><span class="n">I_pH_h2</span> <span class="o">*</span> <span class="n">I_IN_lim</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;k_dis&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span>

    <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_hyd_ch&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_hyd_pr&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_hyd_li&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span>

    <span class="n">v</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_su&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> \
<span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_su&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span><span class="o">*</span><span class="n">I5</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_aa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_aa&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span><span class="o">*</span><span class="n">I6</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_fa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_fa&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span><span class="o">*</span><span class="n">I7</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_c4&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_c4&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> \
        <span class="n">c</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">))</span><span class="o">*</span><span class="n">I8</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_c4&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_c4&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="o">*</span> \
        <span class="n">c</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">))</span><span class="o">*</span><span class="n">I9</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_pr&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_pro&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span><span class="o">*</span><span class="n">I10</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_ac&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">21</span><span class="p">]</span><span class="o">*</span><span class="n">I11</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_h2&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_h2&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">22</span><span class="p">]</span><span class="o">*</span><span class="n">I12</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_su&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_aa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_fa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_c4&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_pro&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">21</span><span class="p">]</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_h2&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">22</span><span class="p">]</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_va&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">27</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_va&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="mi">26</span><span class="p">])</span> <span class="o">-</span>
         <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_va&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_bu&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">28</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_bu&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="mi">26</span><span class="p">])</span> <span class="o">-</span>
         <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_bu&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">21</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_pro&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_pro&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="mi">26</span><span class="p">])</span> <span class="o">-</span>
         <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_pro&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">22</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_ac&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">30</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_ac&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="mi">26</span><span class="p">])</span> <span class="o">-</span>
         <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_ac&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">23</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_co2&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">31</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_co2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="mi">26</span><span class="p">])</span> <span class="o">-</span>
         <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_co2&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">24</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_IN&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">33</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_IN&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="mi">26</span><span class="p">])</span> <span class="o">-</span>
         <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_IN&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span>
    <span class="n">p_gas_h2</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">35</span><span class="p">]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;R&quot;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;T_op&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">16</span>
    <span class="n">p_gas_ch4</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">36</span><span class="p">]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;R&quot;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;T_op&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">64</span>
    <span class="n">p_gas_co2</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">37</span><span class="p">]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;R&quot;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;T_op&quot;</span><span class="p">]</span>
    <span class="n">p_gas_h2o</span> <span class="o">=</span> <span class="mf">0.0313</span> <span class="o">*</span> \
        <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">5290</span> <span class="o">*</span>
               <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;T_base&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;T_op&quot;</span><span class="p">]))</span>
    <span class="n">P_gas</span> <span class="o">=</span> <span class="n">p_gas_h2</span> <span class="o">+</span> <span class="n">p_gas_ch4</span> <span class="o">+</span> <span class="n">p_gas_co2</span> <span class="o">+</span> <span class="n">p_gas_h2o</span>
    <span class="n">q_gas</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
        <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_p&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">P_gas</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;P_atm&#39;</span><span class="p">])))</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">25</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_L_a&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">-</span> <span class="mi">16</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_H_h2&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">p_gas_h2</span><span class="p">)</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">26</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_L_a&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">-</span> <span class="mi">64</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_H_ch4&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">p_gas_ch4</span><span class="p">)</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">27</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_L_a&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_H_co2&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">p_gas_co2</span><span class="p">)</span>
    <span class="n">dCdt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_IN&#39;</span><span class="p">)]</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
        <span class="n">model</span><span class="o">.</span><span class="n">nitrogen_limited</span><span class="o">=</span><span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">model</span><span class="o">.</span><span class="n">nitrogen_limited</span><span class="o">=</span><span class="kc">False</span>

    <span class="n">phi</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">24</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="mi">34</span><span class="p">]</span><span class="o">-</span><span class="n">c</span><span class="p">[</span><span class="mi">31</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">30</span><span class="p">]</span> <span class="o">/</span> <span class="mi">64</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="o">/</span> <span class="mi">112</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">28</span><span class="p">]</span> <span class="o">/</span> <span class="mi">160</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">27</span><span class="p">]</span> <span class="o">/</span> <span class="mi">208</span><span class="p">)</span> <span class="o">-</span> <span class="n">c</span><span class="p">[</span><span class="mi">25</span><span class="p">]</span>
    <span class="n">c</span><span class="p">[</span><span class="mi">26</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">phi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">phi</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_w&#39;</span><span class="p">]))</span>

    <span class="n">dCdt</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="mi">35</span><span class="p">]</span> <span class="o">=</span> <span class="n">dCdt</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="mi">35</span><span class="p">]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;q_in&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;V_liq&quot;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">inlet_conditions</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="mi">35</span><span class="p">]</span><span class="o">-</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">35</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>


    <span class="n">dCdt</span><span class="p">[</span><span class="mi">35</span><span class="p">:]</span> <span class="o">=</span> <span class="n">dCdt</span><span class="p">[</span><span class="mi">35</span><span class="p">:]</span><span class="o">+</span><span class="n">q_gas</span><span class="o">/</span><span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;V_gas&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">inlet_conditions</span><span class="p">[</span><span class="mi">35</span><span class="p">:]</span><span class="o">-</span><span class="n">c</span><span class="p">[</span><span class="mi">35</span><span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">dCdt</span><span class="p">[[</span><span class="mi">26</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">34</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">switch</span> <span class="o">==</span> <span class="s2">&quot;DAE&quot;</span><span class="p">:</span>
        <span class="n">dCdt</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">dCdt</span><span class="p">[</span><span class="mi">27</span><span class="p">:</span> <span class="mi">32</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">dCdt</span><span class="p">[</span><span class="mi">33</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">control_state</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">control_state</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">state</span><span class="p">)]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">control_state</span><span class="p">[</span><span class="n">state</span><span class="p">]</span>
            <span class="n">dCdt</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">state</span><span class="p">)]</span><span class="o">=</span><span class="mi">0</span>


    <span class="k">return</span> <span class="n">dCdt</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.adm.build_adm1_stoiciometric_matrix" class="doc doc-heading">
<code class="highlight language-python"><span class="n">build_adm1_stoiciometric_matrix</span><span class="p">(</span><span class="n">base_parameters</span><span class="p">,</span> <span class="n">model_parameters</span><span class="p">,</span> <span class="n">reactons</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">feed</span><span class="p">,</span> <span class="n">nitrogen_limited</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function builds the stoichiometric matrix for the ADM1 Model.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>base_parameters</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>a dictionary containing the base parameters</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>model_parameters</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>a dictionary containing the model parameters</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>reactons</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>a list containing all reactions</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>species</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>a list containing all species</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>feed</code></td>
          <td>
                <code><span title="core.Feed">Feed</span></code>
          </td>
          <td><p>a Feed instance which contains the feed information</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>nitrogen_limited</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>A boolean which indicates whether the model is nitrogen limited. Defaults to False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>np.ndarray: Returns the stoichiometric matrix of the ADM1 model.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/adm.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">build_adm1_stoiciometric_matrix</span><span class="p">(</span><span class="n">base_parameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">model_parameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">reactons</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">species</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span><span class="n">feed</span><span class="p">:</span><span class="n">Feed</span><span class="p">,</span><span class="n">nitrogen_limited</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;This function builds the stoichiometric matrix for the ADM1 Model.</span>
<span class="sd">    Args:</span>
<span class="sd">        base_parameters (dict): a dictionary containing the base parameters</span>
<span class="sd">        model_parameters (dict): a dictionary containing the model parameters</span>
<span class="sd">        reactons (list): a list containing all reactions</span>
<span class="sd">        species (list): a list containing all species</span>
<span class="sd">        feed (Feed): a Feed instance which contains the feed information</span>
<span class="sd">        nitrogen_limited (bool, optional): A boolean which indicates whether the model is nitrogen limited. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Returns the stoichiometric matrix of the ADM1 model.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">species</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">reactons</span><span class="p">)))</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;f_fa_li&quot;</span><span class="p">]),</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;f_fa_li&quot;</span><span class="p">]),</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">Y_aa</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">nitrogen_limited</span> <span class="k">else</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa&#39;</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_aa</span><span class="p">)</span> <span class="o">*</span>
                    <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_va_aa&#39;</span><span class="p">],</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">Y_su</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">nitrogen_limited</span> <span class="k">else</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su&#39;</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_su</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_bu_su&#39;</span><span class="p">],</span>
                       <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_aa</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;f_bu_aa&quot;</span><span class="p">],</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;Y_su&quot;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_pro_su&#39;</span><span class="p">],</span>
                          <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_aa</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;f_pro_aa&quot;</span><span class="p">],</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_c4&#39;</span><span class="p">])</span><span class="o">*</span><span class="mf">0.54</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">Y_fa</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">nitrogen_limited</span> <span class="k">else</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_fa&#39;</span><span class="p">]</span> 
    <span class="n">S</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_su</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_ac_su&#39;</span><span class="p">],</span>
                                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_aa</span><span class="p">)</span> <span class="o">*</span>
                                    <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_ac_aa&#39;</span><span class="p">],</span>
                                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_fa</span><span class="p">)</span><span class="o">*</span><span class="mf">0.7</span><span class="p">,</span>
                                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_c4&#39;</span><span class="p">])</span><span class="o">*</span><span class="mf">0.31</span><span class="p">,</span>
                                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_c4&#39;</span><span class="p">])</span><span class="o">*</span><span class="mf">0.8</span><span class="p">,</span>
                                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro&#39;</span><span class="p">])</span><span class="o">*</span><span class="mf">0.57</span><span class="p">,</span>
                                    <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">25</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_su</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_h2_su&#39;</span><span class="p">],</span>
                                        <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_aa</span><span class="p">)</span> <span class="o">*</span>
                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_h2_aa&#39;</span><span class="p">],</span>
                                        <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_fa</span><span class="p">)</span><span class="o">*</span><span class="mf">0.3</span><span class="p">,</span>
                                        <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_c4&#39;</span><span class="p">])</span><span class="o">*</span><span class="mf">0.15</span><span class="p">,</span>
                                        <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_c4&#39;</span><span class="p">])</span><span class="o">*</span><span class="mf">0.2</span><span class="p">,</span>
                                        <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro&#39;</span><span class="p">])</span><span class="o">*</span><span class="mf">0.43</span><span class="p">,</span>
                                        <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                        <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">26</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac&#39;</span><span class="p">]),</span>
                          <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_h2&#39;</span><span class="p">]),</span>
                          <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">s_1</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_xc&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_sI_xc&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_sI&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_ch_xc&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ch&#39;</span><span class="p">]</span> <span class="o">+</span>
           <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_pr_xc&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_pr&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_li_xc&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_li&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_xI_xc&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_xI&#39;</span><span class="p">])</span>
    <span class="n">s_2</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ch&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_su&#39;</span><span class="p">])</span>
    <span class="n">s_3</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_pr&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_aa&#39;</span><span class="p">])</span>
    <span class="n">s_4</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_li&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_fa_li&#39;</span><span class="p">])</span> <span class="o">*</span>
           <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_su&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_fa_li&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_fa&#39;</span><span class="p">])</span>
    <span class="n">s_5</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_su&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Y_su</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_bu_su&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bu&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_pro_su&#39;</span><span class="p">]</span>
                                                                             <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_pro&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_ac_su&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">Y_su</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>
    <span class="n">s_6</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_aa&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Y_aa</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_va_aa&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_va&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_bu_aa&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bu&#39;</span><span class="p">]</span> <span class="o">+</span>
                                                                             <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_pro_aa&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_pro&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_ac_aa&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">Y_aa</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>
    <span class="n">s_7</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_fa&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Y_fa</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.7</span> <span class="o">*</span>
           <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">Y_fa</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>
    <span class="n">s_8</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_va&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_c4&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.54</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_pro&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span>
        <span class="mi">1</span> <span class="o">-</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_c4&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.31</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_c4&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>
    <span class="n">s_9</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bu&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_c4&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.8</span> <span class="o">*</span>
           <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_c4&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>
    <span class="n">s_10</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_pro&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.57</span> <span class="o">*</span>
            <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>
    <span class="n">s_11</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac&#39;</span><span class="p">])</span> <span class="o">*</span>
            <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ch4&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>
    <span class="n">s_12</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_h2&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ch4&#39;</span><span class="p">]</span> <span class="o">+</span>
            <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_h2&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>
    <span class="n">s_13</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_xc&#39;</span><span class="p">])</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">27</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">s_1</span><span class="p">,</span> <span class="o">-</span><span class="n">s_2</span><span class="p">,</span> <span class="o">-</span><span class="n">s_3</span><span class="p">,</span> <span class="o">-</span><span class="n">s_4</span><span class="p">,</span> <span class="o">-</span>
                                                                                    <span class="n">s_5</span><span class="p">,</span> <span class="o">-</span><span class="n">s_6</span><span class="p">,</span> <span class="o">-</span><span class="n">s_7</span><span class="p">,</span> <span class="o">-</span><span class="n">s_8</span><span class="p">,</span> <span class="o">-</span><span class="n">s_9</span><span class="p">,</span> <span class="o">-</span><span class="n">s_10</span><span class="p">,</span> <span class="o">-</span><span class="n">s_11</span><span class="p">,</span> <span class="o">-</span><span class="n">s_12</span><span class="p">,</span> <span class="o">-</span><span class="n">s_13</span><span class="p">,</span> <span class="o">-</span><span class="n">s_13</span><span class="p">,</span> <span class="o">-</span><span class="n">s_13</span><span class="p">,</span> <span class="o">-</span><span class="n">s_13</span><span class="p">,</span> <span class="o">-</span><span class="n">s_13</span><span class="p">,</span> <span class="o">-</span><span class="n">s_13</span><span class="p">,</span> <span class="o">-</span><span class="n">s_13</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_xc&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_xI_xc&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_I&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_sI_xc&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_I&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_pr_xc&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_aa&#39;</span><span class="p">],</span>
                                                                        <span class="o">-</span><span class="n">Y_su</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_aa&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">Y_aa</span> <span class="o">*</span>
                                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                                        <span class="o">-</span><span class="n">Y_fa</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                                        <span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_c4&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                                        <span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_c4&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                                        <span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                                        <span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                                        <span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_h2&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">]</span> <span class="o">-</span>
                                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_xc&#39;</span><span class="p">],</span>
                                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">]</span> <span class="o">-</span>
                                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_xc&#39;</span><span class="p">],</span>
                                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">]</span> <span class="o">-</span>
                                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_xc&#39;</span><span class="p">],</span>
                                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">]</span> <span class="o">-</span>
                                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_xc&#39;</span><span class="p">],</span>
                                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">]</span> <span class="o">-</span>
                                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_xc&#39;</span><span class="p">],</span>
                                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">]</span> <span class="o">-</span>
                                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_xc&#39;</span><span class="p">],</span>
                                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_xc&#39;</span><span class="p">]]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_sI_xc&#39;</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">13</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_ch_xc&#39;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_pr_xc&#39;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_li_xc&#39;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">12</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">Y_su</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">17</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">13</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">Y_aa</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">18</span><span class="p">,</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">14</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">Y_fa</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">19</span><span class="p">,</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">15</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_c4&#39;</span><span class="p">],</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_c4&#39;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">16</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro&#39;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">21</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">17</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac&#39;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">22</span><span class="p">,</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">18</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_h2&#39;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">23</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_xI_xc&#39;</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">24</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">26</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">27</span><span class="p">,</span> <span class="mi">19</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">28</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">29</span><span class="p">,</span> <span class="mi">21</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">22</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">31</span><span class="p">,</span> <span class="mi">23</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">32</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">33</span><span class="p">,</span> <span class="mi">24</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">34</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">35</span><span class="p">,</span> <span class="mi">25</span><span class="p">]</span> <span class="o">=</span> <span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;V_liq&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;V_gas&#39;</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">36</span><span class="p">,</span> <span class="mi">26</span><span class="p">]</span> <span class="o">=</span> <span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;V_liq&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;V_gas&#39;</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">37</span><span class="p">,</span> <span class="mi">27</span><span class="p">]</span> <span class="o">=</span> <span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;V_liq&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;V_gas&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">S</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.adm.build_e_adm_2_stoichiometric_matrix" class="doc doc-heading">
<code class="highlight language-python"><span class="n">build_e_adm_2_stoichiometric_matrix</span><span class="p">(</span><span class="n">base_parameters</span><span class="p">,</span> <span class="n">model_parameters</span><span class="p">,</span> <span class="n">reactions</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">feed</span><span class="p">,</span> <span class="n">nitrogen_limited</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function builds the stoichiometric matrix for e-ADM2 Model.</p>
<pre><code>Model Parameters (dict): a dictionary which contains model parameters
base_parameters (dict): a dictionary which contains base paramters
Initial Conditions (dict): a dictionary containing inlet conditions for all species
Inlet Conditions (dict): a dictionary containing inlet conditions for all species
reactions (list): a list containing all of the reaction names
species (list): a list containing all species
</code></pre>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>np.ndarray: Returns an matrix of stochiometic values.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/adm.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">build_e_adm_2_stoichiometric_matrix</span><span class="p">(</span><span class="n">base_parameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                                             <span class="n">model_parameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                                             <span class="n">reactions</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                                             <span class="n">species</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                                             <span class="n">feed</span><span class="p">:</span><span class="n">Feed</span><span class="p">,</span>
                                             <span class="n">nitrogen_limited</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    This function builds the stoichiometric matrix for e-ADM2 Model.</span>

<span class="sd">        Model Parameters (dict): a dictionary which contains model parameters</span>
<span class="sd">        base_parameters (dict): a dictionary which contains base paramters</span>
<span class="sd">        Initial Conditions (dict): a dictionary containing inlet conditions for all species</span>
<span class="sd">        Inlet Conditions (dict): a dictionary containing inlet conditions for all species</span>
<span class="sd">        reactions (list): a list containing all of the reaction names</span>
<span class="sd">        species (list): a list containing all species</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Returns an matrix of stochiometic values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">species</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">reactions</span><span class="p">)))</span>
    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;TSS&quot;</span><span class="p">,</span> <span class="s2">&quot;X_ch&quot;</span><span class="p">,</span> <span class="s2">&quot;X_pr&quot;</span><span class="p">,</span> <span class="s2">&quot;X_li&quot;</span><span class="p">,</span> <span class="s2">&quot;X_I&quot;</span><span class="p">])),</span>
      <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;TSS_Disintegration&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">feed</span><span class="o">.</span><span class="n">ch_tss</span><span class="p">,</span> <span class="n">feed</span><span class="o">.</span><span class="n">prot_tss</span><span class="p">,</span> <span class="n">feed</span><span class="o">.</span><span class="n">lip_tss</span><span class="p">,</span> <span class="n">feed</span><span class="o">.</span><span class="n">xi_tss</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;TDS&quot;</span><span class="p">,</span> <span class="s2">&quot;X_ch&quot;</span><span class="p">,</span> <span class="s2">&quot;X_pr&quot;</span><span class="p">,</span> <span class="s2">&quot;X_li&quot;</span><span class="p">,</span> <span class="s2">&quot;S_I&quot;</span><span class="p">])),</span> <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;TDS_Disintegration&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                                                                                  <span class="n">feed</span><span class="o">.</span><span class="n">ch_tds</span><span class="p">,</span> <span class="n">feed</span><span class="o">.</span><span class="n">prot_tds</span><span class="p">,</span> <span class="n">feed</span><span class="o">.</span><span class="n">lip_tds</span><span class="p">,</span> <span class="n">feed</span><span class="o">.</span><span class="n">si_tds</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_ch&quot;</span><span class="p">,</span> <span class="s2">&quot;S_su&quot;</span><span class="p">])),</span>
      <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Hydrolysis carbohydrates&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_pr&quot;</span><span class="p">,</span> <span class="s2">&quot;S_aa&quot;</span><span class="p">])),</span>
      <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Hydrolysis proteins&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_li&quot;</span><span class="p">,</span> <span class="s2">&quot;S_fa&quot;</span><span class="p">])),</span>
      <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Hydrolysis lipids&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">Y_su</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">nitrogen_limited</span> <span class="k">else</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su&#39;</span><span class="p">]</span>
    <span class="n">f_ac_su</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_pro_su&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_su&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_su&#39;</span><span class="p">]</span>
    <span class="n">f_IC_su</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_su&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_su</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_pro_su&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_pro&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_su</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_su&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_et&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_su</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_su&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_lac&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_su</span><span class="p">)</span><span class="o">*</span><span class="n">f_ac_su</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="n">Y_su</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>


    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_su&quot;</span><span class="p">,</span> <span class="s2">&quot;S_pro&quot;</span><span class="p">,</span> <span class="s2">&quot;S_et&quot;</span><span class="p">,</span> <span class="s2">&quot;S_lac&quot;</span><span class="p">,</span> <span class="s2">&quot;S_ac&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IN&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IC&quot;</span><span class="p">,</span> <span class="s2">&quot;X_su&quot;</span><span class="p">])),</span>
      <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of sugars&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                              <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_su</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_pro_su&#39;</span><span class="p">],</span>
                                              <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_su</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_su&#39;</span><span class="p">],</span>
                                              <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_su</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_su&#39;</span><span class="p">],</span>
                                              <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_su</span><span class="p">)</span> <span class="o">*</span> <span class="n">f_ac_su</span><span class="p">,</span>
                                              <span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">Y_su</span><span class="p">,</span>
                                              <span class="n">f_IC_su</span><span class="p">,</span>
                                              <span class="n">Y_su</span><span class="p">]</span>

    <span class="n">Y_aa</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">nitrogen_limited</span> <span class="k">else</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa&#39;</span><span class="p">]</span>
    <span class="n">f_ac_aa</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_pro_aa&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_aa&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_aa&#39;</span><span class="p">]</span>
    <span class="n">f_IC_aa</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_aa&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_aa</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_pro_aa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_pro&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_aa</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_aa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_et&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_aa</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_aa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_lac&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_aa</span><span class="p">)</span><span class="o">*</span><span class="n">f_ac_aa</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="n">Y_aa</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>



    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_aa&quot;</span><span class="p">,</span> <span class="s2">&quot;S_pro&quot;</span><span class="p">,</span> <span class="s2">&quot;S_et&quot;</span><span class="p">,</span> <span class="s2">&quot;S_lac&quot;</span><span class="p">,</span> <span class="s2">&quot;S_ac&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IN&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IC&quot;</span><span class="p">,</span> <span class="s2">&quot;X_aa&quot;</span><span class="p">])),</span>
      <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of amino acids&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                   <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_aa</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_pro_aa&#39;</span><span class="p">],</span>
                                                   <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_aa</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_aa&#39;</span><span class="p">],</span>
                                                   <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_aa</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_aa&#39;</span><span class="p">],</span>
                                                   <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_aa</span><span class="p">)</span> <span class="o">*</span> <span class="n">f_ac_aa</span><span class="p">,</span>
                                                   <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_aa&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">Y_aa</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                   <span class="n">f_IC_aa</span><span class="p">,</span>
                                                   <span class="n">Y_aa</span><span class="p">]</span>

    <span class="n">Y_fa</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">nitrogen_limited</span> <span class="k">else</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_fa&#39;</span><span class="p">]</span>
    <span class="n">f_ac_fa</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_pro_fa&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_fa&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_fa&#39;</span><span class="p">]</span>
    <span class="n">f_IC_fa</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_fa&#39;</span><span class="p">]</span><span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_fa</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_pro_fa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_pro&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_fa</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_fa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_et&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_fa</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_fa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_lac&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_fa</span><span class="p">)</span><span class="o">*</span><span class="n">f_ac_fa</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="n">Y_fa</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>
    <span class="c1"># if f_IC_fa&lt;0:</span>
    <span class="c1">#     raise ValueError(&quot;f_IC_fa is negative&quot;) </span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_fa&quot;</span><span class="p">,</span> <span class="s2">&quot;S_pro&quot;</span><span class="p">,</span> <span class="s2">&quot;S_et&quot;</span><span class="p">,</span> <span class="s2">&quot;S_lac&quot;</span><span class="p">,</span> <span class="s2">&quot;S_ac&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IN&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IC&quot;</span><span class="p">,</span> <span class="s2">&quot;X_fa&quot;</span><span class="p">])),</span>
      <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of LCFA&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                            <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_fa</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_pro_fa&#39;</span><span class="p">],</span>
                                            <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_fa</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_fa&#39;</span><span class="p">],</span>
                                            <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_fa</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_fa&#39;</span><span class="p">],</span>
                                            <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_fa</span><span class="p">)</span> <span class="o">*</span> <span class="n">f_ac_fa</span><span class="p">,</span>
                                            <span class="o">-</span><span class="n">Y_fa</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                            <span class="n">f_IC_fa</span><span class="p">,</span>
                                            <span class="n">Y_fa</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">f_ac_fa</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="n">f_ac_aa</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="n">f_ac_su</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;f_ac is negative&quot;</span><span class="p">)</span>
    <span class="n">Y_ac_et</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">nitrogen_limited</span> <span class="k">else</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac_et&#39;</span><span class="p">]</span>
    <span class="n">Y_ac_lac</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">nitrogen_limited</span> <span class="k">else</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac_lac&#39;</span><span class="p">]</span>
    <span class="n">f_IC_ac_et</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_et&#39;</span><span class="p">]</span> <span class="o">+</span>
                   <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_ac&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">Y_ac_et</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_bu_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bu&#39;</span><span class="p">]</span> <span class="o">+</span>
                   <span class="n">Y_ac_et</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>

    <span class="n">f_IC_ac_lac</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_lac&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_ac&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">Y_ac_lac</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_bu_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bu&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="n">Y_ac_lac</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>


    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_ac&quot;</span><span class="p">,</span> <span class="s2">&quot;S_et&quot;</span><span class="p">,</span> <span class="s2">&quot;S_bu&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IN&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IC&quot;</span><span class="p">,</span> <span class="s2">&quot;S_h2&quot;</span><span class="p">,</span> <span class="s2">&quot;X_ac_et&quot;</span><span class="p">])),</span>
      <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of acetate_et&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                  <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_ac&#39;</span><span class="p">],</span>
                                                  <span class="p">(</span><span class="mi">1</span><span class="o">-</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_ac&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_bu_ac&#39;</span><span class="p">],</span>
                                                  <span class="o">-</span><span class="n">Y_ac_et</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                  <span class="n">f_IC_ac_et</span><span class="p">,</span>
                                                  <span class="p">(</span><span class="mi">1</span><span class="o">-</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_ac&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">Y_ac_et</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_bu_ac&#39;</span><span class="p">]),</span>
                                                  <span class="n">Y_ac_et</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_ac&quot;</span><span class="p">,</span> <span class="s2">&quot;S_lac&quot;</span><span class="p">,</span> <span class="s2">&quot;S_bu&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IN&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IC&quot;</span><span class="p">,</span> <span class="s2">&quot;S_h2&quot;</span><span class="p">,</span> <span class="s2">&quot;X_ac_lac&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of acetate_lac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                    <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_ac&#39;</span><span class="p">],</span>
                                                     <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_ac&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">Y_ac_lac</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_bu_ac&#39;</span><span class="p">],</span>
                                                     <span class="o">-</span><span class="n">Y_ac_lac</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                     <span class="n">f_IC_ac_lac</span><span class="p">,</span>
                                                     <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_ac&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">Y_ac_lac</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_bu_ac&#39;</span><span class="p">]),</span>
                                                     <span class="n">Y_ac_lac</span><span class="p">]</span>

    <span class="n">Y_pro_et</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">nitrogen_limited</span> <span class="k">else</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro_et&#39;</span><span class="p">]</span>
    <span class="n">Y_pro_lac</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">nitrogen_limited</span> <span class="k">else</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro_et&#39;</span><span class="p">]</span>

    <span class="n">f_IC_pro_et</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_pro&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_pro&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_et&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_pro&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">Y_pro_et</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_va_pro&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_va&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="p">(</span><span class="n">Y_pro_et</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>

    <span class="n">f_IC_pro_lac</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_pro&#39;</span><span class="p">]</span> <span class="o">+</span>
                     <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_pro&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_lac&#39;</span><span class="p">]</span> <span class="o">+</span>
                     <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_pro&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">Y_pro_lac</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_va_pro&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_va&#39;</span><span class="p">]</span> <span class="o">+</span>
                     <span class="p">(</span><span class="n">Y_pro_lac</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>




    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_pro&quot;</span><span class="p">,</span> <span class="s2">&quot;S_et&quot;</span><span class="p">,</span> <span class="s2">&quot;S_va&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IN&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IC&quot;</span><span class="p">,</span> <span class="s2">&quot;S_h2&quot;</span><span class="p">,</span> <span class="s2">&quot;X_chain_et&quot;</span><span class="p">])),</span>
      <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of propionate_et&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                    <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_pro&#39;</span><span class="p">],</span>
                                                     <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_pro&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">Y_pro_et</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_va_pro&#39;</span><span class="p">],</span>
                                                     <span class="o">-</span><span class="n">Y_pro_et</span> <span class="o">*</span>  <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                     <span class="n">f_IC_pro_et</span><span class="p">,</span>
                                                     <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_pro&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">Y_pro_et</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_va_pro&#39;</span><span class="p">]),</span>
                                                     <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_chain_et_pro&#39;</span><span class="p">]]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_pro&quot;</span><span class="p">,</span> <span class="s2">&quot;S_lac&quot;</span><span class="p">,</span> <span class="s2">&quot;S_va&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IN&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IC&quot;</span><span class="p">,</span> <span class="s2">&quot;S_h2&quot;</span><span class="p">,</span> <span class="s2">&quot;X_chain_lac&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of propionate_lac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_pro&#39;</span><span class="p">],</span>
                                                        <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_pro&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">Y_pro_lac</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_va_pro&#39;</span><span class="p">],</span>
                                                        <span class="o">-</span><span class="n">Y_pro_lac</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                        <span class="n">f_IC_pro_lac</span><span class="p">,</span>
                                                        <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_pro&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">Y_pro_lac</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_va_pro&#39;</span><span class="p">]),</span>
                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_chain_lac_pro&#39;</span><span class="p">]]</span>

    <span class="n">Y_bu_et</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">nitrogen_limited</span> <span class="k">else</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_bu_et&#39;</span><span class="p">]</span>
    <span class="n">Y_bu_lac</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">nitrogen_limited</span> <span class="k">else</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_bu_lac&#39;</span><span class="p">]</span>
    <span class="n">f_IC_bu_et</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bu&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_bu&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_et&#39;</span><span class="p">]</span> <span class="o">+</span>
                   <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_bu&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">Y_bu_et</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_cap_bu&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_cap&#39;</span><span class="p">]</span> <span class="o">+</span>
                   <span class="p">(</span><span class="n">Y_bu_et</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>

    <span class="n">f_IC_bu_lac</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bu&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_bu&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_lac&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_bu&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">Y_bu_lac</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_cap_bu&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_cap&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="p">(</span><span class="n">Y_bu_lac</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>


    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_bu&quot;</span><span class="p">,</span> <span class="s2">&quot;S_et&quot;</span><span class="p">,</span> <span class="s2">&quot;S_cap&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IN&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IC&quot;</span><span class="p">,</span> <span class="s2">&quot;S_h2&quot;</span><span class="p">,</span> <span class="s2">&quot;X_chain_et&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of butyrate_et&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                     <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_bu&#39;</span><span class="p">],</span>
                                                     <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_bu&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">Y_bu_et</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_cap_bu&#39;</span><span class="p">],</span>
                                                     <span class="o">-</span><span class="n">Y_bu_et</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                     <span class="n">f_IC_bu_et</span><span class="p">,</span>
                                                     <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_bu&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">Y_bu_et</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_cap_bu&#39;</span><span class="p">]),</span>
                                                     <span class="n">Y_bu_et</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_bu&quot;</span><span class="p">,</span> <span class="s2">&quot;S_lac&quot;</span><span class="p">,</span> <span class="s2">&quot;S_cap&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IN&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IC&quot;</span><span class="p">,</span> <span class="s2">&quot;S_h2&quot;</span><span class="p">,</span> <span class="s2">&quot;X_chain_lac&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of butyrate_lac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                      <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_bu&#39;</span><span class="p">],</span>
                                                      <span class="p">(</span><span class="mi">1</span><span class="o">-</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_bu&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">Y_bu_lac</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_cap_bu&#39;</span><span class="p">],</span>
                                                      <span class="o">-</span><span class="n">Y_bu_lac</span> <span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                      <span class="n">f_IC_bu_lac</span><span class="p">,</span>
                                                      <span class="p">(</span><span class="mi">1</span><span class="o">-</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_bu&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">Y_bu_lac</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_cap_bu&#39;</span><span class="p">]),</span>
                                                      <span class="n">Y_bu_lac</span><span class="p">]</span>


    <span class="n">Y_va</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">nitrogen_limited</span> <span class="k">else</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_va&#39;</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_va&quot;</span><span class="p">,</span> <span class="s2">&quot;S_pro&quot;</span><span class="p">,</span> <span class="s2">&quot;X_VFA_deg&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of valerate&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                  <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_va</span><span class="p">),</span>
                                                  <span class="n">Y_va</span><span class="p">,</span>
                                                  <span class="p">]</span>

    <span class="n">Y_cap</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">nitrogen_limited</span> <span class="k">else</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_cap&#39;</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_cap&quot;</span><span class="p">,</span> <span class="s2">&quot;S_ac&quot;</span><span class="p">,</span> <span class="s2">&quot;X_VFA_deg&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of caproate&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                  <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Y_cap</span><span class="p">),</span>
                                                  <span class="n">Y_cap</span><span class="p">]</span>

    <span class="n">Y_cap</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">nitrogen_limited</span> <span class="k">else</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_bu&#39;</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_bu&quot;</span><span class="p">,</span> <span class="s2">&quot;S_ac&quot;</span><span class="p">,</span> <span class="s2">&quot;X_VFA_deg&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of butyrate&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                  <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Y_cap</span><span class="p">),</span>
                                                  <span class="n">Y_cap</span><span class="p">]</span>



    <span class="n">Y_Me_ac</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">nitrogen_limited</span> <span class="k">else</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;Y_Me_ac&quot;</span><span class="p">]</span>
    <span class="n">f_IC_Me_ach2</span> <span class="o">=</span><span class="mi">0</span>
    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_gas_h2&quot;</span><span class="p">,</span> <span class="s2">&quot;S_ac&quot;</span><span class="p">,</span> <span class="s2">&quot;S_ch4&quot;</span><span class="p">,</span> <span class="s2">&quot;X_Me_ac&quot;</span><span class="p">,</span> <span class="s1">&#39;S_IC&#39;</span><span class="p">,</span> <span class="s1">&#39;S_IN&#39;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Methanogenessis from acetate and h2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                                   <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_ac_h2&#39;</span><span class="p">],</span>
                                                                   <span class="p">(</span><span class="mi">1</span> <span class="o">+</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_ac_h2&#39;</span><span class="p">]</span><span class="o">-</span> <span class="n">Y_Me_ac</span><span class="p">),</span>
                                                                   <span class="n">Y_Me_ac</span><span class="p">,</span>
                                                                   <span class="n">f_IC_Me_ach2</span><span class="p">,</span>
                                                                    <span class="o">-</span><span class="n">Y_Me_ac</span> <span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">]</span>
                                                                   <span class="p">]</span>

    <span class="n">Y_Me_CO2</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">nitrogen_limited</span> <span class="k">else</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;Y_Me_CO2&quot;</span><span class="p">]</span>


    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_gas_h2&quot;</span><span class="p">,</span> <span class="s2">&quot;S_gas_ch4&quot;</span><span class="p">,</span> <span class="s2">&quot;X_Me_CO2&quot;</span><span class="p">,</span> <span class="s1">&#39;S_gas_co2&#39;</span><span class="p">,</span><span class="s2">&quot;S_IN&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Methanogenessis from CO2 and h2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                               <span class="p">(</span><span class="mi">1</span> <span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_co2_ch4&#39;</span><span class="p">]</span><span class="o">-</span> <span class="n">Y_Me_CO2</span><span class="p">),</span>
                                                               <span class="p">(</span><span class="n">Y_Me_CO2</span><span class="p">),</span>
                                                               <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_co2_ch4&#39;</span><span class="p">],</span>
                                                                <span class="o">-</span><span class="n">Y_Me_CO2</span> <span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">]</span>
                                                                <span class="p">]</span>



    <span class="n">Y_ac_et_ox</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">nitrogen_limited</span> <span class="k">else</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;Y_ac_et_ox&quot;</span><span class="p">]</span>
    <span class="n">f_IC_et_ox</span><span class="o">=-</span><span class="p">(</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_et&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_ac_et_ox</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">]</span>
                    <span class="o">+</span><span class="n">Y_ac_et_ox</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">])</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_et&quot;</span><span class="p">,</span> <span class="s2">&quot;X_et&quot;</span><span class="p">,</span><span class="s2">&quot;S_ac&quot;</span><span class="p">,</span><span class="s2">&quot;S_IC&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of ethanol&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_ac_et_ox</span><span class="p">,</span><span class="n">Y_ac_et_ox</span><span class="p">,</span><span class="n">f_IC_et_ox</span><span class="p">]</span>


    <span class="n">Y_pro_lac_ox</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">nitrogen_limited</span> <span class="k">else</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro_lac_ox&#39;</span><span class="p">]</span>
    <span class="n">f_IC_lac_ox</span><span class="o">=-</span><span class="p">(</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_lac&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_pro_lac_ox</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">]</span>
                <span class="o">+</span><span class="n">Y_pro_lac_ox</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_pro&#39;</span><span class="p">])</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_lac&quot;</span> <span class="p">,</span><span class="s2">&quot;S_pro&quot;</span><span class="p">,</span><span class="s2">&quot;X_lac&quot;</span><span class="p">,</span><span class="s2">&quot;S_IC&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of lactate&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">Y_pro_lac_ox</span><span class="p">,</span><span class="n">Y_pro_lac_ox</span><span class="p">,</span><span class="n">f_IC_lac_ox</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_su&quot;</span><span class="p">,</span> <span class="s2">&quot;TSS&quot;</span><span class="p">,</span><span class="s2">&quot;S_IN&quot;</span><span class="p">,</span><span class="s2">&quot;S_IC&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of Xsu&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">]]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_aa&quot;</span><span class="p">,</span> <span class="s2">&quot;TSS&quot;</span><span class="p">,</span><span class="s2">&quot;S_IN&quot;</span><span class="p">,</span><span class="s2">&quot;S_IC&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of Xaa&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">]]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_fa&quot;</span><span class="p">,</span> <span class="s2">&quot;TSS&quot;</span><span class="p">,</span><span class="s2">&quot;S_IN&quot;</span><span class="p">,</span><span class="s2">&quot;S_IC&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of Xfa&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">]]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_ac_et&quot;</span><span class="p">,</span> <span class="s2">&quot;TSS&quot;</span><span class="p">,</span><span class="s2">&quot;S_IN&quot;</span><span class="p">,</span><span class="s2">&quot;S_IC&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of X_ac_et&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">]]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_ac_lac&quot;</span><span class="p">,</span> <span class="s2">&quot;TSS&quot;</span><span class="p">,</span><span class="s2">&quot;S_IN&quot;</span><span class="p">,</span><span class="s2">&quot;S_IC&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of X_ac_lac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">]]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_chain_et&quot;</span><span class="p">,</span> <span class="s2">&quot;TSS&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IN&quot;</span><span class="p">,</span><span class="s2">&quot;S_IC&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of X_chain_et&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">]]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_chain_lac&quot;</span><span class="p">,</span> <span class="s2">&quot;TSS&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IN&quot;</span><span class="p">,</span><span class="s2">&quot;S_IC&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of X_chain_lac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">]]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_VFA_deg&quot;</span><span class="p">,</span> <span class="s2">&quot;TSS&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IN&quot;</span><span class="p">,</span><span class="s2">&quot;S_IC&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of X_VFA_deg&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">]]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_Me_ac&quot;</span><span class="p">,</span> <span class="s2">&quot;TSS&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IN&quot;</span><span class="p">,</span><span class="s2">&quot;S_IC&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of X_Me_ac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">]]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_Me_CO2&quot;</span><span class="p">,</span> <span class="s2">&quot;TSS&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IN&quot;</span><span class="p">,</span><span class="s2">&quot;S_IC&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of X_Me_CO2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">]]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_va_ion&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Va)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_bu_ion&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Bu)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_pro_ion&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Pro)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_cap_ion&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Cap)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_lac_ion&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Lac)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_ac_ion&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Ac)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_hco3_ion&quot;</span><span class="p">])),</span>  <span class="c1"># I don&#39;t think this is right، should look at the reaction in ADM1</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (CO2)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_nh3&quot;</span><span class="p">,</span> <span class="s2">&quot;S_nh4_ion&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (In)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># I don&#39;t think this is right، should look at the reaction in ADM1</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_h2&quot;</span><span class="p">,</span> <span class="s2">&quot;S_gas_h2&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Gas Transfer H2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;V_liq&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;V_gas&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_ch4&quot;</span><span class="p">,</span> <span class="s2">&quot;S_gas_ch4&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Gas Transfer CH4&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;V_liq&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;V_gas&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_co2&quot;</span><span class="p">,</span> <span class="s2">&quot;S_gas_co2&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Gas Transfer CO2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;V_liq&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;V_gas&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">S</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.adm.build_e_adm_stoiciometric_matrix" class="doc doc-heading">
<code class="highlight language-python"><span class="n">build_e_adm_stoiciometric_matrix</span><span class="p">(</span><span class="n">base_parameters</span><span class="p">,</span> <span class="n">model_parameters</span><span class="p">,</span> <span class="n">reactions</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">feed</span><span class="p">,</span> <span class="n">nitrogen_limited</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function builds the stoichiometric matrix for the e_ADM Model.</p>
<pre><code>Model Parameters (dict): a dictionary which contains model parameters
base_parameters (dict): a dictionary which contains base paramters
Initial Conditions (dict): a dictionary containing inlet conditions for all species
Inlet Conditions (dict): a dictionary containing inlet conditions for all species
reactions (list): a list containing all of the reaction names
species (list): a list containing all species
</code></pre>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>np.ndarray: Returns an matrix of stochiometic values.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/adm.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">build_e_adm_stoiciometric_matrix</span><span class="p">(</span><span class="n">base_parameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                                     <span class="n">model_parameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                                     <span class="n">reactions</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                                     <span class="n">species</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                                     <span class="n">feed</span><span class="p">:</span><span class="n">Feed</span><span class="p">,</span>
                                     <span class="n">nitrogen_limited</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    This function builds the stoichiometric matrix for the e_ADM Model.</span>

<span class="sd">        Model Parameters (dict): a dictionary which contains model parameters</span>
<span class="sd">        base_parameters (dict): a dictionary which contains base paramters</span>
<span class="sd">        Initial Conditions (dict): a dictionary containing inlet conditions for all species</span>
<span class="sd">        Inlet Conditions (dict): a dictionary containing inlet conditions for all species</span>
<span class="sd">        reactions (list): a list containing all of the reaction names</span>
<span class="sd">        species (list): a list containing all species</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Returns an matrix of stochiometic values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">species</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">reactions</span><span class="p">)))</span>
    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;TSS&quot;</span><span class="p">,</span> <span class="s2">&quot;X_ch&quot;</span><span class="p">,</span> <span class="s2">&quot;X_pr&quot;</span><span class="p">,</span> <span class="s2">&quot;X_li&quot;</span><span class="p">,</span> <span class="s2">&quot;X_I&quot;</span><span class="p">])),</span>
      <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;TSS_Disintegration&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">feed</span><span class="o">.</span><span class="n">ch_tss</span><span class="p">,</span> <span class="n">feed</span><span class="o">.</span><span class="n">prot_tss</span><span class="p">,</span> <span class="n">feed</span><span class="o">.</span><span class="n">lip_tss</span><span class="p">,</span><span class="n">feed</span><span class="o">.</span><span class="n">xi_tss</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;TDS&quot;</span><span class="p">,</span> <span class="s2">&quot;X_ch&quot;</span><span class="p">,</span> <span class="s2">&quot;X_pr&quot;</span><span class="p">,</span> <span class="s2">&quot;X_li&quot;</span><span class="p">,</span> <span class="s2">&quot;S_I&quot;</span><span class="p">])),</span> <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;TDS_Disintegration&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                                                                            <span class="n">feed</span><span class="o">.</span><span class="n">ch_tds</span><span class="p">,</span> <span class="n">feed</span><span class="o">.</span><span class="n">prot_tds</span><span class="p">,</span> <span class="n">feed</span><span class="o">.</span><span class="n">lip_tds</span><span class="p">,</span> <span class="n">feed</span><span class="o">.</span><span class="n">si_tds</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_ch&quot;</span><span class="p">,</span> <span class="s2">&quot;S_su&quot;</span><span class="p">])),</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Hydrolysis carbohydrates&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_pr&quot;</span><span class="p">,</span> <span class="s2">&quot;S_aa&quot;</span><span class="p">])),</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Hydrolysis proteins&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_li&quot;</span><span class="p">,</span> <span class="s2">&quot;S_fa&quot;</span><span class="p">])),</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Hydrolysis lipids&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">f_IC_su_et</span><span class="o">=-</span><span class="p">(</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_su&#39;</span><span class="p">]</span><span class="o">+</span>
               <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su_et&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_et&#39;</span><span class="p">]</span><span class="o">+</span>
               <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su_et&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">]</span>
              <span class="p">)</span>

    <span class="n">f_IC_su_lac</span><span class="o">=-</span><span class="p">(</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_su&#39;</span><span class="p">]</span><span class="o">+</span>
              <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su_lac&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_lac&#39;</span><span class="p">]</span><span class="o">+</span>
              <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su_lac&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">]</span>
              <span class="p">)</span>

    <span class="n">f_IC_su_ac</span><span class="o">=-</span><span class="p">(</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_su&#39;</span><span class="p">]</span><span class="o">+</span>
               <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su_ac&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">]</span><span class="o">+</span>
               <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su_ac&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">]</span>
              <span class="p">)</span>
    <span class="n">f_IC_su_pro</span><span class="o">=-</span><span class="p">(</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_su&#39;</span><span class="p">]</span><span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su_pro&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_pro&#39;</span><span class="p">]</span><span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su_pro&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">]</span>
              <span class="p">)</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_su&quot;</span><span class="p">,</span><span class="s2">&quot;S_et&quot;</span><span class="p">,</span><span class="s2">&quot;S_IN&quot;</span><span class="p">,</span><span class="s2">&quot;S_IC&quot;</span><span class="p">,</span><span class="s2">&quot;X_su&quot;</span><span class="p">])),</span>
     <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Su_to_et&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                         <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su_et&#39;</span><span class="p">]),</span>
                                           <span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">]</span><span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su_et&#39;</span><span class="p">],</span>
                                            <span class="n">f_IC_su_et</span><span class="p">,</span>
                                            <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su_et&#39;</span><span class="p">]]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_su&quot;</span><span class="p">,</span><span class="s2">&quot;S_lac&quot;</span><span class="p">,</span><span class="s2">&quot;S_IN&quot;</span><span class="p">,</span><span class="s2">&quot;S_IC&quot;</span><span class="p">,</span><span class="s2">&quot;X_su&quot;</span><span class="p">])),</span>
     <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Su_to_lac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su_lac&#39;</span><span class="p">]),</span>
                                                <span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">]</span><span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su_lac&#39;</span><span class="p">],</span>
                                                <span class="n">f_IC_su_lac</span><span class="p">,</span>
                                                <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su_lac&#39;</span><span class="p">]]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_su&quot;</span><span class="p">,</span><span class="s2">&quot;S_ac&quot;</span><span class="p">,</span><span class="s2">&quot;S_IN&quot;</span><span class="p">,</span><span class="s2">&quot;S_IC&quot;</span><span class="p">,</span><span class="s2">&quot;X_su&quot;</span><span class="p">])),</span>
      <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Su_to_ac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su_ac&#39;</span><span class="p">]),</span>
                                    <span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">]</span><span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su_ac&#39;</span><span class="p">],</span>
                                    <span class="n">f_IC_su_ac</span><span class="p">,</span>
                                    <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su_ac&#39;</span><span class="p">]]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_su&quot;</span><span class="p">,</span><span class="s2">&quot;S_pro&quot;</span><span class="p">,</span><span class="s2">&quot;S_IN&quot;</span><span class="p">,</span><span class="s2">&quot;S_IC&quot;</span><span class="p">,</span><span class="s2">&quot;X_su&quot;</span><span class="p">])),</span>
            <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Su_to_pro&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                            <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su_pro&#39;</span><span class="p">]),</span>
                                              <span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">]</span><span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su_pro&#39;</span><span class="p">],</span>
                                              <span class="n">f_IC_su_pro</span><span class="p">,</span>
                                              <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su_pro&#39;</span><span class="p">]]</span>

    <span class="n">f_IC_aa_lac</span><span class="o">=-</span><span class="p">(</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_aa&#39;</span><span class="p">]</span><span class="o">+</span>
              <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa_lac&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_lac&#39;</span><span class="p">]</span><span class="o">+</span>
              <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa_lac&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">]</span>
              <span class="p">)</span>

    <span class="n">f_IC_aa_ac</span><span class="o">=-</span><span class="p">(</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_aa&#39;</span><span class="p">]</span><span class="o">+</span>
              <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa_ac&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">]</span><span class="o">+</span>
              <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa_ac&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">]</span>
              <span class="p">)</span>

    <span class="n">f_IC_aa_pro</span><span class="o">=-</span><span class="p">(</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_aa&#39;</span><span class="p">]</span><span class="o">+</span>
              <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa_pro&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_pro&#39;</span><span class="p">]</span><span class="o">+</span>
              <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa_pro&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">]</span>
              <span class="p">)</span>


    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_aa&quot;</span><span class="p">,</span><span class="s2">&quot;S_lac&quot;</span><span class="p">,</span><span class="s2">&quot;S_IN&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IC&quot;</span><span class="p">,</span> <span class="s2">&quot;X_aa&quot;</span><span class="p">])),</span>
      <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;aas_to_lac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                             <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa_lac&#39;</span><span class="p">]),</span>
                                             <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_aa&#39;</span><span class="p">]</span><span class="o">-</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa_lac&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                             <span class="n">f_IC_aa_lac</span><span class="p">,</span>
                                             <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa_lac&#39;</span><span class="p">]]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_aa&quot;</span><span class="p">,</span><span class="s2">&quot;S_pro&quot;</span><span class="p">,</span><span class="s2">&quot;S_IN&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IC&quot;</span><span class="p">,</span> <span class="s2">&quot;X_aa&quot;</span><span class="p">])),</span>
      <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;aas_to_pro&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                             <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa_pro&#39;</span><span class="p">]),</span>
                                             <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_aa&#39;</span><span class="p">]</span><span class="o">-</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa_pro&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                             <span class="n">f_IC_aa_pro</span><span class="p">,</span>
                                             <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa_pro&#39;</span><span class="p">]]</span>


    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_aa&quot;</span><span class="p">,</span><span class="s2">&quot;S_ac&quot;</span><span class="p">,</span><span class="s2">&quot;S_IN&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IC&quot;</span><span class="p">,</span> <span class="s2">&quot;X_aa&quot;</span><span class="p">])),</span>
      <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;aas_to_ac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                             <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa_ac&#39;</span><span class="p">]),</span>
                                             <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_aa&#39;</span><span class="p">]</span><span class="o">-</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa_ac&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                             <span class="n">f_IC_aa_ac</span><span class="p">,</span>
                                             <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa_ac&#39;</span><span class="p">]]</span>

    <span class="n">Y_fa</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">nitrogen_limited</span> <span class="k">else</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_fa&#39;</span><span class="p">]</span>
    <span class="n">f_IC_fa</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_fa&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_fa</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_pro_fa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_pro&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_fa</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_ac_fa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_fa</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_fa&quot;</span><span class="p">,</span> <span class="s2">&quot;S_pro&quot;</span><span class="p">,</span> <span class="s2">&quot;S_ac&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IN&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IC&quot;</span><span class="p">,</span> <span class="s2">&quot;X_fa&quot;</span><span class="p">])),</span>
      <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of LCFA&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                            <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_fa</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_pro_fa&#39;</span><span class="p">],</span>
                                            <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_fa</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_ac_fa&#39;</span><span class="p">],</span>
                                              <span class="o">-</span><span class="n">Y_fa</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                              <span class="n">f_IC_fa</span><span class="p">,</span>
                                              <span class="n">Y_fa</span><span class="p">]</span>
<span class="c1">#HERE</span>
    <span class="n">Y_ac_et</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">nitrogen_limited</span> <span class="k">else</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac_et&#39;</span><span class="p">]</span>
    <span class="n">Y_ac_lac</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">nitrogen_limited</span> <span class="k">else</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac_lac&#39;</span><span class="p">]</span>
    <span class="n">f_IC_ac_et</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_ac_et</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_ac&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">]</span> <span class="o">+</span>
                   <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_ac_et</span><span class="p">)</span><span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_et&#39;</span><span class="p">]</span> <span class="o">+</span>
                   <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_ac_et</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_bu_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bu&#39;</span><span class="p">]</span> <span class="o">+</span>
                   <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_ac_et</span><span class="p">)</span><span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>  

    <span class="n">f_IC_ac_lac</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_ac_lac</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_ac&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_ac_lac</span><span class="p">)</span><span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_ac&#39;</span><span class="p">]</span><span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_lac&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_ac_lac</span><span class="p">)</span><span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_bu_ac&#39;</span><span class="p">]</span><span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bu&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_ac_lac</span><span class="p">)</span><span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_ac&quot;</span><span class="p">,</span> <span class="s2">&quot;S_et&quot;</span><span class="p">,</span> <span class="s2">&quot;S_bu&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IN&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IC&quot;</span><span class="p">,</span> <span class="s2">&quot;S_h2&quot;</span><span class="p">,</span> <span class="s2">&quot;X_ac_et&quot;</span><span class="p">])),</span>
      <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of acetate_et&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_ac_et</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_ac&#39;</span><span class="p">],</span>
                                                  <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_ac_et</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_ac&#39;</span><span class="p">],</span>
                                                  <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_bu_ac&#39;</span><span class="p">],</span>
                                                  <span class="o">-</span><span class="n">Y_ac_et</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                  <span class="n">f_IC_ac_et</span><span class="p">,</span>
                                                  <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_ac_et</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_bu_ac&#39;</span><span class="p">]),</span>
                                                  <span class="n">Y_ac_et</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_ac&quot;</span><span class="p">,</span> <span class="s2">&quot;S_lac&quot;</span><span class="p">,</span> <span class="s2">&quot;S_bu&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IN&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IC&quot;</span><span class="p">,</span> <span class="s2">&quot;S_h2&quot;</span><span class="p">,</span> <span class="s2">&quot;X_ac_lac&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of acetate_lac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_ac_lac</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_ac&#39;</span><span class="p">],</span>
                                                     <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_ac_lac</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_ac&#39;</span><span class="p">],</span>
                                                     <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_ac_lac</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_bu_ac&#39;</span><span class="p">],</span>
                                                     <span class="o">-</span><span class="n">Y_ac_lac</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span> 
                                                     <span class="n">f_IC_ac_lac</span><span class="p">,</span>
                                                     <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_ac_lac</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_bu_ac&#39;</span><span class="p">]),</span>
                                                     <span class="n">Y_ac_lac</span><span class="p">]</span>

    <span class="n">Y_pro_et</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">nitrogen_limited</span> <span class="k">else</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro_et&#39;</span><span class="p">]</span>
    <span class="n">Y_pro_lac</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">nitrogen_limited</span> <span class="k">else</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro_lac&#39;</span><span class="p">]</span>

    <span class="n">f_IC_pro_et</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_pro_et</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_pro&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_pro&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_pro_et</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_pro&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_et&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_pro_et</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_va_pro&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_va&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_pro_et</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>

    <span class="n">f_IC_pro_lac</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_pro_lac</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_pro&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_pro&#39;</span><span class="p">]</span> <span class="o">+</span>
                     <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_pro_lac</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_pro&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_lac&#39;</span><span class="p">]</span> <span class="o">+</span>
                     <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_pro_lac</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_va_pro&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_va&#39;</span><span class="p">]</span> <span class="o">+</span>
                     <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_pro_lac</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_pro&quot;</span><span class="p">,</span> <span class="s2">&quot;S_et&quot;</span><span class="p">,</span> <span class="s2">&quot;S_va&quot;</span><span class="p">,</span><span class="s2">&quot;S_IC&quot;</span><span class="p">,</span><span class="s2">&quot;S_IN&quot;</span><span class="p">,</span><span class="s2">&quot;S_h2&quot;</span><span class="p">,</span> <span class="s2">&quot;X_chain_et&quot;</span><span class="p">])),</span>
      <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of propionate_et&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_chain_et_pro&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_pro&#39;</span><span class="p">],</span>
                                                     <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_chain_et_pro&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_pro&#39;</span><span class="p">],</span>
                                                     <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_chain_et_pro&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_va_pro&#39;</span><span class="p">],</span>
                                                     <span class="n">f_IC_pro_et</span><span class="p">,</span>
                                                     <span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_chain_et_pro&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                     <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_chain_et_pro&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_va_pro&#39;</span><span class="p">]),</span>
                                                     <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_chain_et_pro&#39;</span><span class="p">]]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_pro&quot;</span><span class="p">,</span> <span class="s2">&quot;S_lac&quot;</span><span class="p">,</span> <span class="s2">&quot;S_va&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IC&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IN&quot;</span><span class="p">,</span> <span class="s2">&quot;S_h2&quot;</span><span class="p">,</span> <span class="s2">&quot;X_chain_lac&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of propionate_lac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_chain_lac_pro&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_pro&#39;</span><span class="p">],</span>
                                                        <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_chain_lac_pro&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_pro&#39;</span><span class="p">],</span>
                                                        <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_chain_lac_pro&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_va_pro&#39;</span><span class="p">],</span>
                                                        <span class="n">f_IC_pro_lac</span><span class="p">,</span>
                                                        <span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_chain_lac_pro&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                        <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_chain_lac_pro&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_va_pro&#39;</span><span class="p">]),</span>
                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_chain_lac_pro&#39;</span><span class="p">]]</span>

    <span class="n">Y_bu_et</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">nitrogen_limited</span> <span class="k">else</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_bu_et&#39;</span><span class="p">]</span>
    <span class="n">Y_pro_lac</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">nitrogen_limited</span> <span class="k">else</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro_lac&#39;</span><span class="p">]</span>

    <span class="n">f_IC_bu_et</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_bu_et</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_bu&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bu&#39;</span><span class="p">]</span> <span class="o">+</span>
                   <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_bu_et</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_bu&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_et&#39;</span><span class="p">]</span> <span class="o">+</span>
                   <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_bu_et</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_cap_bu&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_cap&#39;</span><span class="p">]</span> <span class="o">+</span>
                   <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_bu_et</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>

    <span class="n">f_IC_bu_lac</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_pro_lac</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_bu&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bu&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_pro_lac</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_bu&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_lac&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_pro_lac</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_cap_bu&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_cap&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_pro_lac</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_bu&quot;</span><span class="p">,</span> <span class="s2">&quot;S_et&quot;</span><span class="p">,</span> <span class="s2">&quot;S_cap&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IC&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IN&quot;</span><span class="p">,</span> <span class="s2">&quot;S_h2&quot;</span><span class="p">,</span> <span class="s2">&quot;X_chain_et&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of butyrate_et&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_bu_et</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_bu&#39;</span><span class="p">],</span>
                                                     <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_bu_et</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_bu&#39;</span><span class="p">],</span>
                                                     <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_bu_et</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_cap_bu&#39;</span><span class="p">],</span>
                                                     <span class="n">f_IC_bu_et</span><span class="p">,</span>
                                                     <span class="o">-</span><span class="n">Y_bu_et</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                     <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_bu_et</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_cap_bu&#39;</span><span class="p">]),</span>
                                                     <span class="n">Y_bu_et</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_bu&quot;</span><span class="p">,</span> <span class="s2">&quot;S_lac&quot;</span><span class="p">,</span> <span class="s2">&quot;S_cap&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IC&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IN&quot;</span><span class="p">,</span> <span class="s2">&quot;S_h2&quot;</span><span class="p">,</span> <span class="s2">&quot;X_chain_lac&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of butyrate_lac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_pro_lac</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_bu&#39;</span><span class="p">],</span>
                                                      <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_pro_lac</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_bu&#39;</span><span class="p">],</span>
                                                      <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_pro_lac</span><span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_cap_bu&#39;</span><span class="p">],</span>
                                                      <span class="n">f_IC_bu_lac</span><span class="p">,</span>
                                                      <span class="o">-</span><span class="n">Y_pro_lac</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                      <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_pro_lac</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_cap_bu&#39;</span><span class="p">]),</span>
                                                      <span class="n">Y_pro_lac</span><span class="p">]</span>

    <span class="n">Y_va</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">nitrogen_limited</span> <span class="k">else</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_va&#39;</span><span class="p">]</span>
    <span class="n">Y_cap</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">nitrogen_limited</span> <span class="k">else</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_cap&#39;</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_va&quot;</span><span class="p">,</span> <span class="s2">&quot;S_pro&quot;</span><span class="p">,</span> <span class="s2">&quot;X_VFA_deg&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of valerate&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                  <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_va</span><span class="p">),</span>
                                                  <span class="n">Y_va</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_cap&quot;</span><span class="p">,</span> <span class="s2">&quot;S_ac&quot;</span><span class="p">,</span> <span class="s2">&quot;X_VFA_deg&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of caproate&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                  <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Y_cap</span><span class="p">),</span>
                                                  <span class="n">Y_cap</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_bu&quot;</span><span class="p">,</span> <span class="s2">&quot;S_ac&quot;</span><span class="p">,</span> <span class="s2">&quot;X_VFA_deg&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of butyrate&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                  <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_bu&#39;</span><span class="p">]),</span>
                                                  <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_bu&#39;</span><span class="p">]]</span>

    <span class="n">Y_Me_ac</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">nitrogen_limited</span> <span class="k">else</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;Y_Me_ac&quot;</span><span class="p">]</span>
    <span class="n">f_IC_Me_ach2</span> <span class="o">=</span><span class="mi">0</span>
    <span class="n">f_IC_Me_ach2</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_h2_ac&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_ac_h2&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">]</span><span class="o">+</span>
                     <span class="p">(</span><span class="mi">1</span> <span class="o">-</span><span class="n">Y_Me_ac</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ch4&#39;</span><span class="p">]</span><span class="o">+</span>
                     <span class="n">Y_Me_ac</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>



    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_h2&quot;</span><span class="p">,</span> <span class="s2">&quot;S_ac&quot;</span><span class="p">,</span> <span class="s2">&quot;S_ch4&quot;</span><span class="p">,</span> <span class="s2">&quot;X_Me_ac&quot;</span><span class="p">,</span> <span class="s1">&#39;S_IC&#39;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Methanogenessis from acetate and h2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_h2_ac&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_ac_h2&#39;</span><span class="p">],</span>
                    <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_h2_ac&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_ac_h2&#39;</span><span class="p">],</span>
                    <span class="p">(</span><span class="mi">1</span> <span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_h2_ac&#39;</span><span class="p">]),</span>
                    <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_h2_ac&#39;</span><span class="p">],</span>
                    <span class="n">f_IC_Me_ach2</span><span class="p">]</span>

    <span class="n">f_IC_Me_CO2h2</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_h2_CO2&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ch4&#39;</span><span class="p">]</span> <span class="o">+</span>
                      <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_h2_CO2&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_h2&quot;</span><span class="p">,</span> <span class="s2">&quot;S_ch4&quot;</span><span class="p">,</span> <span class="s2">&quot;X_Me_CO2&quot;</span><span class="p">,</span> <span class="s1">&#39;S_IC&#39;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Methanogenessis from CO2 and h2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                               <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_h2_CO2&#39;</span><span class="p">]),</span>
                                                               <span class="p">(</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_h2_CO2&#39;</span><span class="p">]),</span>
                                                               <span class="n">f_IC_Me_CO2h2</span><span class="p">]</span>

    <span class="n">Y_ac_et_ox</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">nitrogen_limited</span> <span class="k">else</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;Y_ac_et_ox&quot;</span><span class="p">]</span>

    <span class="n">f_IC_et_ox</span><span class="o">=-</span><span class="p">(</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_et&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_ac_et_ox</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">]</span>
                    <span class="o">+</span><span class="n">Y_ac_et_ox</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">])</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_et&quot;</span><span class="p">,</span> <span class="s2">&quot;X_et&quot;</span><span class="p">,</span><span class="s2">&quot;S_ac&quot;</span><span class="p">,</span><span class="s2">&quot;S_IC&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of ethanol&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">Y_ac_et_ox</span><span class="p">,(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_ac_et_ox</span><span class="p">),</span><span class="n">f_IC_et_ox</span><span class="p">]</span>


    <span class="n">Y_pro_lac_ox</span><span class="o">=</span><span class="mi">0</span> <span class="k">if</span> <span class="n">nitrogen_limited</span> <span class="k">else</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro_lac_ox&#39;</span><span class="p">]</span>
    <span class="n">f_IC_lac_ox</span><span class="o">=-</span><span class="p">(</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_lac&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_pro_lac_ox</span><span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">]</span>
                <span class="o">+</span><span class="n">Y_pro_lac_ox</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_pro&#39;</span><span class="p">])</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_lac&quot;</span><span class="p">,</span> <span class="s2">&quot;X_lac&quot;</span><span class="p">,</span><span class="s2">&quot;S_pro&quot;</span><span class="p">,</span><span class="s2">&quot;S_IC&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of lactate&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">Y_pro_lac_ox</span><span class="p">,(</span><span class="mi">1</span><span class="o">-</span><span class="n">Y_pro_lac_ox</span><span class="p">),</span><span class="n">f_IC_lac_ox</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_su&quot;</span><span class="p">,</span> <span class="s2">&quot;TSS&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of Xsu&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_aa&quot;</span><span class="p">,</span> <span class="s2">&quot;TSS&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of Xaa&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_fa&quot;</span><span class="p">,</span> <span class="s2">&quot;TSS&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of Xfa&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_ac_et&quot;</span><span class="p">,</span> <span class="s2">&quot;TSS&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of X_ac_et&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_ac_lac&quot;</span><span class="p">,</span> <span class="s2">&quot;TSS&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of X_ac_lac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_chain_et&quot;</span><span class="p">,</span> <span class="s2">&quot;TSS&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of X_chain_et&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_chain_lac&quot;</span><span class="p">,</span> <span class="s2">&quot;TSS&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of X_chain_lac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_VFA_deg&quot;</span><span class="p">,</span> <span class="s2">&quot;TSS&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of X_VFA_deg&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_Me_ac&quot;</span><span class="p">,</span> <span class="s2">&quot;TSS&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of X_Me_ac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_Me_CO2&quot;</span><span class="p">,</span> <span class="s2">&quot;TSS&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of X_Me_CO2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_va_ion&quot;</span><span class="p">,</span><span class="s2">&quot;S_va&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Va)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_bu_ion&quot;</span><span class="p">,</span><span class="s2">&quot;S_bu&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Bu)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_pro_ion&quot;</span><span class="p">,</span><span class="s2">&quot;S_pro&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Pro)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_cap_ion&quot;</span><span class="p">,</span><span class="s2">&quot;S_cap&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Cap)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_lac_ion&quot;</span><span class="p">,</span><span class="s2">&quot;S_lac&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Lac)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_ac_ion&quot;</span><span class="p">,</span><span class="s2">&quot;S_ac&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Ac)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_co2&quot;</span><span class="p">,</span> <span class="s2">&quot;S_hco3_ion&quot;</span><span class="p">])),</span>  <span class="c1"># I don&#39;t think this is right، should look at the reaction in ADM1</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (CO2)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_nh3&quot;</span><span class="p">,</span> <span class="s2">&quot;S_nh4_ion&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (In)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># I don&#39;t think this is right، should look at the reaction in ADM1</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_h2&quot;</span><span class="p">,</span> <span class="s2">&quot;S_gas_h2&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Gas Transfer H2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;V_liq&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;V_gas&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_ch4&quot;</span><span class="p">,</span> <span class="s2">&quot;S_gas_ch4&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Gas Transfer CH4&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;V_liq&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;V_gas&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_co2&quot;</span><span class="p">,</span> <span class="s2">&quot;S_gas_co2&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Gas Transfer CO2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;V_liq&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;V_gas&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">S</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.adm.e_adm_2_ode_sys" class="doc doc-heading">
<code class="highlight language-python"><span class="n">e_adm_2_ode_sys</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function is used to build the ODEs of the e-adm2 model.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>t</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>a matrix of zeros to be filled</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>c</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>an array of concentrations to be filled</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Model</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="adtoolbox.adm.Model" href="#adtoolbox.adm.Model">Model</a></code>
          </td>
          <td><p>The model to calculate ODE with</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>np.ndarray: The output is dCdt, the change of concentration with respect to time.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/adm.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">e_adm_2_ode_sys</span><span class="p">(</span><span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function is used to build the ODEs of the e-adm2 model.</span>

<span class="sd">    Args:</span>
<span class="sd">        t (float):a matrix of zeros to be filled</span>
<span class="sd">        c (np.ndarray): an array of concentrations to be filled</span>
<span class="sd">        Model (Model): The model to calculate ODE with</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: The output is dCdt, the change of concentration with respect to time. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">### Initialize the ion concentrations</span>
    <span class="c1"># if t==0:</span>
    <span class="k">if</span> <span class="n">t</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_va_ion&#39;</span><span class="p">)]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_va&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_va&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_va&#39;</span><span class="p">)]</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu_ion&#39;</span><span class="p">)]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_bu&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_bu&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu&#39;</span><span class="p">)]</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro_ion&#39;</span><span class="p">)]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_pro&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_pro&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro&#39;</span><span class="p">)]</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_cap_ion&#39;</span><span class="p">)]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_cap&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_cap&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_cap&#39;</span><span class="p">)]</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac_ion&#39;</span><span class="p">)]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_ac&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_ac&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac&#39;</span><span class="p">)]</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac_ion&#39;</span><span class="p">)]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_lac&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_lac&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span>    
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_hco3_ion&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_IC&#39;</span><span class="p">)]</span> <span class="o">-</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_co2&#39;</span><span class="p">)]</span>
        <span class="n">phi</span><span class="o">=</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_w&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)]</span><span class="o">-</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_anion&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_cation&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_nh4_ion&#39;</span><span class="p">)]</span><span class="o">-</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_hco3_ion&#39;</span><span class="p">)]</span><span class="o">-</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac_ion&#39;</span><span class="p">)]</span> <span class="o">/</span> <span class="mi">88</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac_ion&#39;</span><span class="p">)]</span> <span class="o">/</span> <span class="mi">64</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro_ion&#39;</span><span class="p">)]</span> <span class="o">/</span>
                                                                                                                                                                     <span class="mi">112</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu_ion&#39;</span><span class="p">)]</span> <span class="o">/</span> <span class="mi">160</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_cap_ion&#39;</span><span class="p">)]</span> <span class="o">/</span> <span class="mi">230</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_va_ion&#39;</span><span class="p">)]</span> <span class="o">/</span> <span class="mi">208</span><span class="p">)</span><span class="o">-</span><span class="n">phi</span>

    <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_hco3_ion&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_co2&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_IC&#39;</span><span class="p">)]</span><span class="o">/</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_co2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span>
    <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_nh4_ion&#39;</span><span class="p">)]</span><span class="o">=</span>  <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_b_nh3&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_IN&#39;</span><span class="p">)]</span><span class="o">/</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_b_nh3&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;K_W&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span>

    <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_co2&#39;</span><span class="p">)]</span><span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_IC&#39;</span><span class="p">)]</span> <span class="o">-</span>  <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_hco3_ion&#39;</span><span class="p">)]</span>
    <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_nh3&#39;</span><span class="p">)]</span><span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_IN&#39;</span><span class="p">)]</span> <span class="o">-</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_nh4_ion&#39;</span><span class="p">)]</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">model</span><span class="o">.</span><span class="n">_be_time</span> <span class="p">)</span><span class="o">&gt;</span><span class="n">model</span><span class="o">.</span><span class="n">time_limit</span> <span class="ow">and</span> <span class="n">model</span><span class="o">.</span><span class="n">time_limit</span><span class="o">!=-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Time limit exceeded&quot;</span><span class="p">)</span>


    <span class="n">I_pH_aa</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;K_pH_aa&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;nn_aa&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)],</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;nn_aa&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;K_pH_aa&quot;</span><span class="p">],</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;nn_aa&#39;</span><span class="p">]))</span>
    <span class="n">I_pH_ac</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_ac&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;n_ac&quot;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_ac&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_ac&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_ac&#39;</span><span class="p">])</span>
    <span class="n">I_pH_pro</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_pro&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;n_pro&quot;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_pro&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_pro&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_pro&#39;</span><span class="p">])</span>
    <span class="n">I_pH_bu</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_bu&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;n_bu&quot;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_bu&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_bu&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_bu&#39;</span><span class="p">])</span>
    <span class="n">I_pH_va</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_va&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;n_va&quot;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_va&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_va&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_va&#39;</span><span class="p">])</span>
    <span class="n">I_pH_cap</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_cap&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;n_cap&quot;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_cap&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_cap&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_cap&#39;</span><span class="p">])</span>
    <span class="n">I_pH_h2</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_h2&#39;</span><span class="p">]</span><span class="o">**</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_h2&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_h2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_h2&#39;</span><span class="p">]</span><span class="o">**</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_h2&#39;</span><span class="p">])</span>

    <span class="n">I_IN_lim</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_IN&#39;</span><span class="p">)]</span> <span class="o">/</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_IN&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span><span class="p">)))</span>

    <span class="n">I_h2_fa</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span>  <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_h2&#39;</span><span class="p">)]</span> <span class="o">/</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_I_h2_fa&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span><span class="p">)))</span>

    <span class="n">I_h2_c4</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span>  <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_h2&#39;</span><span class="p">)]</span> <span class="o">/</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_I_h2_c4&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span><span class="p">)))</span>

    <span class="n">I_h2_pro</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span>  <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_h2&#39;</span><span class="p">)]</span> <span class="o">/</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_I_h2_pro&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span><span class="p">)))</span>

    <span class="n">I_nh3</span> <span class="o">=</span>    <span class="mi">1</span><span class="o">/</span>  <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_nh3&#39;</span><span class="p">)]</span> <span class="o">/</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_I_nh3&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span><span class="p">)))</span>

    <span class="n">I_h2_oxidation</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_h2&#39;</span><span class="p">)]</span> <span class="o">/</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_I_h2_ox&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span><span class="p">)))</span>

    <span class="n">I5</span> <span class="o">=</span>    <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">I_pH_aa</span> <span class="o">*</span> <span class="n">I_IN_lim</span><span class="p">))</span>
    <span class="n">I6</span> <span class="o">=</span>    <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">I5</span><span class="p">)</span>
    <span class="n">I7</span> <span class="o">=</span>    <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">I_pH_aa</span> <span class="o">*</span> <span class="n">I_IN_lim</span> <span class="o">*</span> <span class="n">I_h2_fa</span><span class="p">))</span>
    <span class="n">I8</span> <span class="o">=</span>    <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">I_pH_aa</span> <span class="o">*</span> <span class="n">I_IN_lim</span> <span class="o">*</span> <span class="n">I_h2_c4</span><span class="p">))</span>
    <span class="n">I9</span> <span class="o">=</span>    <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">I8</span><span class="p">)</span>
    <span class="n">I10</span> <span class="o">=</span>   <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">I_pH_pro</span> <span class="o">*</span> <span class="n">I_IN_lim</span> <span class="o">*</span> <span class="n">I_h2_pro</span><span class="p">))</span>
    <span class="n">I11</span> <span class="o">=</span>   <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">I_pH_ac</span> <span class="o">*</span> <span class="n">I_IN_lim</span> <span class="o">*</span> <span class="n">I_nh3</span><span class="p">))</span>
    <span class="n">I12</span> <span class="o">=</span>   <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">I_pH_h2</span> <span class="o">*</span> <span class="n">I_IN_lim</span><span class="p">))</span>
    <span class="n">I13</span> <span class="o">=</span>   <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">I_pH_cap</span> <span class="o">*</span> <span class="n">I_IN_lim</span> <span class="o">*</span> <span class="n">I_h2_c4</span><span class="p">))</span>
    <span class="n">I14</span> <span class="o">=</span>   <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">I_pH_bu</span> <span class="o">*</span> <span class="n">I_IN_lim</span> <span class="o">*</span> <span class="n">I_h2_c4</span><span class="p">))</span>
    <span class="n">I15</span> <span class="o">=</span>   <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">I_pH_va</span> <span class="o">*</span> <span class="n">I_IN_lim</span> <span class="o">*</span> <span class="n">I_h2_c4</span><span class="p">))</span>
    <span class="n">I16</span> <span class="o">=</span>   <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">I_IN_lim</span> <span class="o">*</span> <span class="n">I_nh3</span><span class="o">*</span><span class="n">I_pH_aa</span><span class="o">*</span><span class="n">I_h2_oxidation</span><span class="p">)</span>

    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;TSS_Disintegration&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;k_dis_TSS&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;TSS&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;TDS_Disintegration&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;k_dis_TDS&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;TDS&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Hydrolysis carbohydrates&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_hyd_ch&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_ch&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Hydrolysis proteins&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_hyd_pr&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_pr&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Hydrolysis lipids&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_hyd_li&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_li&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of sugars&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_su&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_su&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_su&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_su&#39;</span><span class="p">)])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_su&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I5</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of amino acids&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_aa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_aa&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_aa&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_aa&#39;</span><span class="p">)]</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_aa&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I6</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of LCFA&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_fa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_fa&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_fa&#39;</span><span class="p">]</span> <span class="o">+</span>
         <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_fa&#39;</span><span class="p">)])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_fa&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I7</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of acetate_et&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_ac_et&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_ac_et&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I11</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of acetate_lac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_ac_lac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_ac_lac&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I11</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of propionate_et&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_pro&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_pro&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_pro_et&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_chain_et&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I10</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of propionate_lac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_pro&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_pro&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_pro_lac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_chain_lac&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I10</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of butyrate_et&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_bu&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_bu&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_bu_et&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_chain_et&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I14</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of butyrate_lac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_bu&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_bu&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_bu_lac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_chain_lac&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I14</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of valerate&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_va&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_va&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_va&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_va&#39;</span><span class="p">)]</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_VFA_deg&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I15</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of caproate&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_cap&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_cap&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_cap&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_cap&#39;</span><span class="p">)]</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_VFA_deg&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I13</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of butyrate&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_bu_deg&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_bu&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu&#39;</span><span class="p">)]</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_VFA_deg&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I13</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Methanogenessis from acetate and h2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_h2_Me_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_gas_h2&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_h2_Me_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_gas_h2&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_ac_Me&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
            <span class="s1">&#39;S_ac&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_gas_h2&#39;</span><span class="p">)]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span><span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_Me_ac&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I12</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Methanogenessis from CO2 and h2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_h2_Me_CO2&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_gas_h2&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_gas_co2&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_h2_Me_CO2&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_gas_h2&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_CO2_Me&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
            <span class="s1">&#39;S_gas_co2&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_gas_co2&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_gas_h2&#39;</span><span class="p">)]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span><span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_Me_CO2&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I12</span>


    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of ethanol&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_et&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_et&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;X_et&quot;</span><span class="p">)]</span><span class="o">*</span><span class="n">I16</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of lactate&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_lac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_lac&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_lac&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I16</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of Xsu&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_su&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_su&#39;</span><span class="p">)]</span>
    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of Xaa&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_aa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_aa&#39;</span><span class="p">)]</span>
    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of Xfa&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_fa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_fa&#39;</span><span class="p">)]</span>
    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of X_ac_et&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_ac_et&#39;</span><span class="p">)]</span>
    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of X_ac_lac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_ac_lac&#39;</span><span class="p">)]</span>
    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of X_chain_et&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_chain_et&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_chain_et&#39;</span><span class="p">)]</span>
    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of X_chain_lac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_chain_lac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_chain_lac&#39;</span><span class="p">)]</span>
    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of X_VFA_deg&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_VFA_deg&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_VFA_deg&#39;</span><span class="p">)]</span>
    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of X_Me_ac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_Me_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_Me_ac&#39;</span><span class="p">)]</span>
    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of X_Me_CO2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_Me_CO2&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_Me_CO2&#39;</span><span class="p">)]</span>
    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of Xet&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_et&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_et&#39;</span><span class="p">)]</span>
    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of Xlac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_lac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_lac&#39;</span><span class="p">)]</span>


    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Va)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_va&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_va_ion&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_va&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span> <span class="o">-</span>
         <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_va&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_va&#39;</span><span class="p">)])</span>
    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Bu)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_bu&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu_ion&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_bu&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span> <span class="o">-</span>
         <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_bu&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu&#39;</span><span class="p">)])</span>
    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Pro)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_pro&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro_ion&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_pro&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span> <span class="o">-</span>
         <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_pro&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro&#39;</span><span class="p">)])</span>
    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Cap)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_cap&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_cap_ion&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_cap&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span> <span class="o">-</span>
         <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_cap&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_cap&#39;</span><span class="p">)])</span>
    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Lac)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_lac&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac_ion&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_lac&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span> <span class="o">-</span>
         <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_lac&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)])</span>
    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Ac)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_ac&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac_ion&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_ac&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span> <span class="o">-</span>
         <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_ac&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac&#39;</span><span class="p">)])</span>
    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (CO2)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_co2&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_hco3_ion&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_co2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span> <span class="o">-</span>
         <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_co2&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_IC&#39;</span><span class="p">)])</span>
    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (In)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_IN&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_nh3&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_IN&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span> <span class="o">-</span>
         <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_IN&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_IC&#39;</span><span class="p">)])</span>


    <span class="n">p_gas_h2</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_gas_h2&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;R&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;T_op&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">16</span>
    <span class="n">p_gas_ch4</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_gas_ch4&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;R&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;T_op&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">64</span>
    <span class="n">p_gas_co2</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_gas_co2&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;R&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;T_op&quot;</span><span class="p">]</span>
    <span class="n">p_gas_h2o</span> <span class="o">=</span> <span class="mf">0.0313</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">5290</span> <span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;T_base&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;T_op&quot;</span><span class="p">]))</span>

    <span class="n">P_gas</span> <span class="o">=</span> <span class="n">p_gas_h2</span> <span class="o">+</span> <span class="n">p_gas_ch4</span> <span class="o">+</span> <span class="n">p_gas_co2</span> <span class="o">+</span> <span class="n">p_gas_h2o</span>

    <span class="n">q_gas</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_p&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">P_gas</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;P_atm&#39;</span><span class="p">])))</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Gas Transfer H2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_L_a&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_h2&#39;</span><span class="p">)]</span> <span class="o">-</span> <span class="mi">16</span> <span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_H_h2&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">p_gas_h2</span><span class="p">))</span>
    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Gas Transfer CH4&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_L_a&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ch4&#39;</span><span class="p">)]</span> <span class="o">-</span> <span class="mi">64</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_H_ch4&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">p_gas_ch4</span><span class="p">))</span>
    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Gas Transfer CO2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_L_a&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_co2&#39;</span><span class="p">)]</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_H_co2&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">p_gas_co2</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_IN&#39;</span><span class="p">)]</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
        <span class="n">model</span><span class="o">.</span><span class="n">nitrogen_limited</span><span class="o">=</span><span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">model</span><span class="o">.</span><span class="n">nitrogen_limited</span><span class="o">=</span><span class="kc">False</span>

    <span class="n">dCdt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_cation&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_nh4_ion&#39;</span><span class="p">)]</span><span class="o">-</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_hco3_ion&#39;</span><span class="p">)]</span><span class="o">-</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac_ion&#39;</span><span class="p">)]</span> <span class="o">/</span> <span class="mi">88</span><span class="p">)</span> <span class="o">-</span> \
    <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac_ion&#39;</span><span class="p">)]</span> <span class="o">/</span> <span class="mi">64</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro_ion&#39;</span><span class="p">)]</span> <span class="o">/</span> <span class="mi">112</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu_ion&#39;</span><span class="p">)]</span> <span class="o">/</span> <span class="mi">160</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_cap_ion&#39;</span><span class="p">)]</span> <span class="o">/</span> <span class="mi">230</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_va_ion&#39;</span><span class="p">)]</span> <span class="o">/</span> <span class="mi">208</span><span class="p">)</span> <span class="o">-</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_anion&#39;</span><span class="p">)]</span>

    <span class="k">if</span> <span class="s1">&#39;S_H_ion&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">control_state</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">control_state</span><span class="p">[</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">phi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">phi</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_w&#39;</span><span class="p">]))</span>

    <span class="n">dCdt</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">dCdt</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;q_in&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;V_liq&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">inlet_conditions</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="n">dCdt</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">=</span> <span class="n">dCdt</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span><span class="o">+</span><span class="n">q_gas</span><span class="o">/</span><span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;V_gas&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">inlet_conditions</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span><span class="o">-</span><span class="n">c</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="n">dCdt</span><span class="p">[[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">),</span> <span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_co2&#39;</span><span class="p">),</span> <span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_nh4_ion&#39;</span><span class="p">)],</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">switch</span> <span class="o">==</span> <span class="s2">&quot;DAE&quot;</span><span class="p">:</span>
        <span class="n">dCdt</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_va_ion&#39;</span><span class="p">):</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_co2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">dCdt</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_nh3&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_va_ion&#39;</span><span class="p">)]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_va&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_va&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_va&#39;</span><span class="p">)]</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu_ion&#39;</span><span class="p">)]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_bu&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_bu&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu&#39;</span><span class="p">)]</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro_ion&#39;</span><span class="p">)]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_pro&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_pro&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro&#39;</span><span class="p">)]</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_cap_ion&#39;</span><span class="p">)]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_cap&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_cap&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_cap&#39;</span><span class="p">)]</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac_ion&#39;</span><span class="p">)]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_ac&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_ac&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac&#39;</span><span class="p">)]</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac_ion&#39;</span><span class="p">)]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_lac&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_lac&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span>    
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_hco3_ion&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_IC&#39;</span><span class="p">)]</span> <span class="o">-</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_co2&#39;</span><span class="p">)]</span>




    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">control_state</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">control_state</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">state</span><span class="p">)]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">control_state</span><span class="p">[</span><span class="n">state</span><span class="p">]</span>
            <span class="n">dCdt</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">state</span><span class="p">)]</span><span class="o">=</span><span class="mi">0</span>

    <span class="n">model</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;Fluxes&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">v</span>
    <span class="k">return</span> <span class="n">dCdt</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.adm.e_adm_ode_sys" class="doc doc-heading">
<code class="highlight language-python"><span class="n">e_adm_ode_sys</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function is used to build the ODEs of the e_adm model.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>t</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>a matrix of zeros to be filled</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>c</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>an array of concentrations to be filled</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Model</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="adtoolbox.adm.Model" href="#adtoolbox.adm.Model">Model</a></code>
          </td>
          <td><p>The model to calculate ODE with</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>np.ndarray: The output is dCdt, the change of concentration with respect to time.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/adm.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">e_adm_ode_sys</span><span class="p">(</span><span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function is used to build the ODEs of the e_adm model.</span>

<span class="sd">    Args:</span>
<span class="sd">        t (float):a matrix of zeros to be filled</span>
<span class="sd">        c (np.ndarray): an array of concentrations to be filled</span>
<span class="sd">        Model (Model): The model to calculate ODE with</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: The output is dCdt, the change of concentration with respect to time. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">c</span><span class="p">[</span><span class="n">c</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)]</span><span class="o">=</span><span class="mf">0.000001</span>
    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">switch</span> <span class="o">==</span> <span class="s2">&quot;DAE&quot;</span><span class="p">:</span>

        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_va_ion&#39;</span><span class="p">)]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_va&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_va&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_va&#39;</span><span class="p">)]</span>

        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu_ion&#39;</span><span class="p">)]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_bu&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_bu&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu&#39;</span><span class="p">)]</span>

        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro_ion&#39;</span><span class="p">)]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_pro&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_pro&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro&#39;</span><span class="p">)]</span>

        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_cap_ion&#39;</span><span class="p">)]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_cap&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_cap&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_cap&#39;</span><span class="p">)]</span>

        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac_ion&#39;</span><span class="p">)]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_ac&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_ac&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac&#39;</span><span class="p">)]</span>

        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac_ion&#39;</span><span class="p">)]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_lac&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_lac&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Va)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_va&#39;</span><span class="p">]</span> <span class="o">*</span> \
            <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_va_ion&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_va&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span> <span class="o">-</span>
             <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_va&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_va&#39;</span><span class="p">)])</span>

        <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Bu)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_bu&#39;</span><span class="p">]</span> <span class="o">*</span> \
            <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu_ion&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_bu&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span> <span class="o">-</span>
             <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_bu&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu&#39;</span><span class="p">)])</span>

        <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Pro)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_pro&#39;</span><span class="p">]</span> <span class="o">*</span> \
            <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro_ion&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_pro&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span> <span class="o">-</span>
             <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_pro&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro&#39;</span><span class="p">)])</span>

        <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Cap)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_cap&#39;</span><span class="p">]</span> <span class="o">*</span> \
            <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_cap_ion&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_cap&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span> <span class="o">-</span>
             <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_cap&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_cap&#39;</span><span class="p">)])</span>

        <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Lac)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_lac&#39;</span><span class="p">]</span> <span class="o">*</span> \
            <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac_ion&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_lac&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span> <span class="o">-</span>
             <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_lac&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)])</span>

        <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Ac)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_ac&#39;</span><span class="p">]</span> <span class="o">*</span> \
            <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac_ion&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_ac&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span> <span class="o">-</span>
             <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_ac&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac&#39;</span><span class="p">)])</span>

        <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (CO2)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_co2&#39;</span><span class="p">]</span> <span class="o">*</span> \
            <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_hco3_ion&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_co2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span> <span class="o">-</span>
             <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_co2&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_IC&#39;</span><span class="p">)])</span>

        <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (In)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_IN&#39;</span><span class="p">]</span> <span class="o">*</span> \
            <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_nh3&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_IN&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span> <span class="o">-</span>
             <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_IN&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_IC&#39;</span><span class="p">)])</span>

    <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_nh4_ion&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="s1">&#39;S_IN&#39;</span><span class="p">)]</span> <span class="o">-</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_nh3&#39;</span><span class="p">)]</span>
    <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_co2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="s1">&#39;S_IC&#39;</span><span class="p">)]</span> <span class="o">-</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_hco3_ion&#39;</span><span class="p">)]</span>
    <span class="n">I_pH_aa</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;K_pH_aa&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;nn_aa&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)],</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;nn_aa&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;K_pH_aa&quot;</span><span class="p">],</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;nn_aa&#39;</span><span class="p">]))</span>

    <span class="n">I_pH_ac</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_ac&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;n_ac&quot;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_ac&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_ac&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_ac&#39;</span><span class="p">])</span>

    <span class="n">I_pH_pro</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_pro&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;n_pro&quot;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_pro&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_pro&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_pro&#39;</span><span class="p">])</span>

    <span class="n">I_pH_bu</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_bu&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;n_bu&quot;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_bu&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_bu&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_bu&#39;</span><span class="p">])</span>

    <span class="n">I_pH_va</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_va&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;n_va&quot;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_va&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_va&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_va&#39;</span><span class="p">])</span>

    <span class="n">I_pH_cap</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_cap&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;n_cap&quot;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_cap&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_cap&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_cap&#39;</span><span class="p">])</span>

    <span class="n">I_pH_h2</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_h2&#39;</span><span class="p">]</span><span class="o">**</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_h2&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_h2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_h2&#39;</span><span class="p">]</span><span class="o">**</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_h2&#39;</span><span class="p">])</span>

    <span class="n">I_IN_lim</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> \
        <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_IN&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_IN&#39;</span><span class="p">)]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span><span class="p">)))</span>

    <span class="n">I_h2_fa</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_h2&#39;</span><span class="p">)]</span> <span class="o">/</span>
                   <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_I_h2_fa&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span><span class="p">)))</span>

    <span class="n">I_h2_c4</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_h2&#39;</span><span class="p">)]</span> <span class="o">/</span>
                   <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_I_h2_c4&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span><span class="p">)))</span>

    <span class="n">I_h2_pro</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_h2&#39;</span><span class="p">)]</span> <span class="o">/</span>
                <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_I_h2_pro&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span><span class="p">))))</span>

    <span class="n">I_nh3</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_nh3&#39;</span><span class="p">)]</span> <span class="o">/</span>
               <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_I_nh3&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span><span class="p">)))</span>

    <span class="n">I_h2_oxidation</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_h2&#39;</span><span class="p">)]</span> <span class="o">/</span>
                <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_I_h2_ox&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span><span class="p">))))</span>

    <span class="c1"># I5 = (I_pH_aa * I_IN_lim)</span>
    <span class="c1"># I6 = I5.copy()</span>
    <span class="c1"># I7 = (I_pH_aa * I_IN_lim * I_h2_fa)</span>
    <span class="c1"># I8 = (I_pH_aa * I_IN_lim * I_h2_c4)</span>
    <span class="c1"># I9 = I8.copy()</span>
    <span class="c1"># I10 = (I_pH_pro * I_IN_lim * I_h2_pro)</span>
    <span class="c1"># I11 = (I_pH_ac * I_IN_lim * I_nh3)</span>
    <span class="c1"># I12 = (I_pH_h2 * I_IN_lim)</span>
    <span class="c1"># I13 = (I_pH_cap * I_IN_lim * I_h2_c4)</span>
    <span class="c1"># I14 = (I_pH_bu * I_IN_lim * I_h2_c4)</span>
    <span class="c1"># I15 = (I_pH_va * I_IN_lim * I_h2_c4)</span>
    <span class="c1"># I16 = I_IN_lim * I_nh3*I_pH_aa*I_h2_oxidation</span>
    <span class="n">I5</span>  <span class="o">=</span> <span class="mi">1</span>
    <span class="n">I6</span>  <span class="o">=</span> <span class="mi">1</span>
    <span class="n">I7</span>  <span class="o">=</span> <span class="mi">1</span>
    <span class="n">I8</span>  <span class="o">=</span> <span class="mi">1</span>
    <span class="n">I9</span>  <span class="o">=</span> <span class="mi">1</span> <span class="c1">#one</span>
    <span class="n">I10</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">I11</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">I12</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">I13</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">I14</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">I15</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">I16</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="s1">&#39;TSS_Disintegration&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;k_dis_TSS&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;TSS&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="s1">&#39;TDS_Disintegration&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;k_dis_TDS&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;TDS&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Hydrolysis carbohydrates&#39;</span><span class="p">)</span>
      <span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_hyd_ch&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_ch&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Hydrolysis proteins&#39;</span><span class="p">)</span>
      <span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_hyd_pr&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_pr&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Hydrolysis lipids&#39;</span><span class="p">)</span>
      <span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_hyd_li&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_li&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Su_to_et&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_su_et&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_su&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_su_et&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_su&#39;</span><span class="p">)])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_su&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I5</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Su_to_lac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_su_lac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_su&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_su_lac&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_su&#39;</span><span class="p">)]</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_su&#39;</span><span class="p">)]</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_su&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_X_su_lac&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">I5</span>    

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Su_to_ac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_su_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_su&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_su_ac&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_su&#39;</span><span class="p">)]</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_su&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I5</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Su_to_pro&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_su_pro&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_su&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_su_pro&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_su&#39;</span><span class="p">)]</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_su&#39;</span><span class="p">)]</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_su&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_X_su_pro&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">I5</span>        


    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;aas_to_lac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_aa_lac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_aa&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_aa_lac&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_aa&#39;</span><span class="p">)]</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_aa&#39;</span><span class="p">)]</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_aa&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_X_aa_lac&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">I6</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;aas_to_pro&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_aa_pro&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_aa&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_aa_pro&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_aa&#39;</span><span class="p">)]</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_aa&#39;</span><span class="p">)]</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_aa&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_X_aa_pro&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">I6</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;aas_to_ac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_aa_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_aa&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_aa_ac&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_aa&#39;</span><span class="p">)]</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_aa&#39;</span><span class="p">)]</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_aa&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_X_aa_ac&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">I6</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of LCFA&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_fa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_fa&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_fa&#39;</span><span class="p">]</span> <span class="o">+</span>
         <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_fa&#39;</span><span class="p">)])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_fa&#39;</span><span class="p">)]</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_fa&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_X_fa&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">I7</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of acetate_et&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_ac_et&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_ac_et&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_ac_et&#39;</span><span class="p">)]</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_ac_et&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_X_ac_et&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">I11</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of acetate_lac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_ac_lac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_ac_lac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_ac_lac&#39;</span><span class="p">)]</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_ac_lac&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_X_ac_lac&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">I11</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of propionate_et&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_pro_et&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_pro&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_pro_et&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_chain_et&#39;</span><span class="p">)]</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_chain_et&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_X_chain_et&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">I10</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of propionate_lac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_pro_lac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_pro&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_pro_lac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_chain_lac&#39;</span><span class="p">)]</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_chain_lac&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_X_chain_lac&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">I10</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of butyrate_et&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_bu_et&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_bu&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_bu_et&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_chain_et&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I14</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of butyrate_lac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_bu_lac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_bu&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_bu_lac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_chain_lac&#39;</span><span class="p">)]</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_chain_lac&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_X_chain_lac&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">I14</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of butyrate&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_bu&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu&#39;</span><span class="p">)]</span><span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_bu&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu&#39;</span><span class="p">)])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_VFA_deg&#39;</span><span class="p">)]</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_VFA_deg&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_X_VFA_deg&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">I14</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of valerate&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_va&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_va&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_va&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_va&#39;</span><span class="p">)])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_VFA_deg&#39;</span><span class="p">)]</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_VFA_deg&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_X_VFA_deg&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">I15</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of caproate&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_cap&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_cap&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_cap&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_cap&#39;</span><span class="p">)])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_VFA_deg&#39;</span><span class="p">)]</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_VFA_deg&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_X_VFA_deg&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">I13</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Methanogenessis from acetate and h2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_h2_Me_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_h2&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_h2_Me_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_h2&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_ac_Me&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
            <span class="s1">&#39;S_ac&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_h2&#39;</span><span class="p">)]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span><span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_Me_ac&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I12</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Methanogenessis from CO2 and h2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_h2_Me_CO2&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_h2&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_co2&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_h2_Me_CO2&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_h2&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_CO2_Me&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
            <span class="s1">&#39;S_co2&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_co2&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_h2&#39;</span><span class="p">)]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span><span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_Me_CO2&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I12</span>


    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of ethanol&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_et&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_et&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;X_et&quot;</span><span class="p">)]</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;X_et&quot;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_X_et&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">I16</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of lactate&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_lac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_lac&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_lac&#39;</span><span class="p">)]</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_lac&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_X_lac&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">I16</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="s1">&#39;Decay of Xsu&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_su&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_su&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="s1">&#39;Decay of Xaa&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_aa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_aa&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="s1">&#39;Decay of Xfa&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_fa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_fa&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="s1">&#39;Decay of X_ac_et&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_ac_et&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="s1">&#39;Decay of X_ac_lac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_ac_lac&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="s1">&#39;Decay of X_chain_et&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_chain_et&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_chain_et&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of X_chain_lac&#39;</span><span class="p">)</span>
      <span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_chain_lac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_chain_lac&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="s1">&#39;Decay of X_VFA_deg&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_VFA_deg&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_VFA_deg&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="s1">&#39;Decay of X_Me_ac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_Me_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_Me_ac&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="s1">&#39;Decay of X_Me_CO2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_Me_CO2&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_Me_CO2&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="s1">&#39;Decay of Xet&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_et&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_et&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="s1">&#39;Decay of Xlac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_lac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_lac&#39;</span><span class="p">)]</span>



    <span class="n">p_gas_h2</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_gas_h2&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;R&quot;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;T_op&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">16</span>
    <span class="n">p_gas_ch4</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_gas_ch4&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;R&quot;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;T_op&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">64</span>
    <span class="n">p_gas_co2</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_gas_co2&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;R&quot;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;T_op&quot;</span><span class="p">]</span>
    <span class="n">p_gas_h2o</span> <span class="o">=</span> <span class="mf">0.0313</span> <span class="o">*</span> \
        <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">5290</span> <span class="o">*</span>
               <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;T_base&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;T_op&quot;</span><span class="p">]))</span>
    <span class="n">P_gas</span> <span class="o">=</span> <span class="n">p_gas_h2</span> <span class="o">+</span> <span class="n">p_gas_ch4</span> <span class="o">+</span> <span class="n">p_gas_co2</span> <span class="o">+</span> <span class="n">p_gas_h2o</span>
    <span class="n">q_gas</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
        <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_p&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">P_gas</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;P_atm&#39;</span><span class="p">])))</span>
    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Gas Transfer H2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_L_a&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_h2&#39;</span><span class="p">)]</span> <span class="o">-</span> <span class="mi">16</span> <span class="o">*</span>
         <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_H_h2&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">p_gas_h2</span><span class="p">)</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Gas Transfer CH4&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_L_a&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ch4&#39;</span><span class="p">)]</span> <span class="o">-</span> <span class="mi">64</span> <span class="o">*</span>
         <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_H_ch4&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">p_gas_ch4</span><span class="p">))</span>
    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Gas Transfer CO2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_L_a&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_co2&#39;</span><span class="p">)]</span> <span class="o">-</span>
         <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_H_co2&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">p_gas_co2</span><span class="p">))</span>

    <span class="n">dCdt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

    <span class="n">phi</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_cation&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_nh4_ion&#39;</span><span class="p">)]</span><span class="o">-</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_hco3_ion&#39;</span><span class="p">)]</span><span class="o">-</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac_ion&#39;</span><span class="p">)]</span> <span class="o">/</span> <span class="mi">88</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac_ion&#39;</span><span class="p">)]</span> <span class="o">/</span> <span class="mi">64</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro_ion&#39;</span><span class="p">)]</span> <span class="o">/</span>
                                                                                                                                                                     <span class="mi">112</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu_ion&#39;</span><span class="p">)]</span> <span class="o">/</span> <span class="mi">160</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_cap_ion&#39;</span><span class="p">)]</span> <span class="o">/</span> <span class="mi">230</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_va_ion&#39;</span><span class="p">)]</span> <span class="o">/</span> <span class="mi">208</span><span class="p">)</span> <span class="o">-</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_anion&#39;</span><span class="p">)]</span>
    <span class="k">if</span> <span class="s1">&#39;S_H_ion&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">control_state</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">control_state</span><span class="p">[</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">phi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
        <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">phi</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_w&#39;</span><span class="p">]))</span>

    <span class="n">dCdt</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">dCdt</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;q_in&#39;</span><span class="p">]</span> <span class="o">/</span> \
        <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;V_liq&quot;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">inlet_conditions</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="fm">__len__</span><span class="p">(</span>
        <span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="n">dCdt</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">=</span> <span class="n">dCdt</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span><span class="o">+</span><span class="n">q_gas</span><span class="o">/</span><span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;V_gas&quot;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">inlet_conditions</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span> <span class="o">-</span>
         <span class="mi">3</span><span class="p">:]</span><span class="o">-</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="n">dCdt</span><span class="p">[[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">),</span> <span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="s1">&#39;S_co2&#39;</span><span class="p">),</span> <span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_nh4_ion&#39;</span><span class="p">)],</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_IN&#39;</span><span class="p">)]</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">:</span>
        <span class="n">model</span><span class="o">.</span><span class="n">nitrogen_limited</span><span class="o">=</span><span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">model</span><span class="o">.</span><span class="n">nitrogen_limited</span><span class="o">=</span><span class="kc">False</span>

    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">switch</span> <span class="o">==</span> <span class="s2">&quot;DAE&quot;</span><span class="p">:</span>
        <span class="c1"># dCdt[model.species.index(&#39;S_h2&#39;)] = 0</span>

        <span class="n">dCdt</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_va_ion&#39;</span><span class="p">):</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_co2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">dCdt</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_nh3&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">control_state</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">control_state</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">state</span><span class="p">)]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">control_state</span><span class="p">[</span><span class="n">state</span><span class="p">]</span>
            <span class="n">dCdt</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">state</span><span class="p">)]</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">model</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;Fluxes&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">v</span>
    <span class="k">return</span> <span class="n">dCdt</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.a00a7c5e.min.js"></script>
      
    
  </body>
</html>