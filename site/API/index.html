
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../CLI/">
      
      
        <link rel="next" href="../Parameter_Tuning/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.9">
    
    
      
        <title>API - ADToolbox</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0d440cfe.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="ADToolbox" class="md-header__button md-logo" aria-label="ADToolbox" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ADToolbox
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="ADToolbox" class="md-nav__button md-logo" aria-label="ADToolbox" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    ADToolbox
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Welcome to ADToolbox
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../CLI/" class="md-nav__link">
        Commandline Interface
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        API
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#core" class="md-nav__link">
    core
  </a>
  
    <nav class="md-nav" aria-label="core">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-pipeline" class="md-nav__link">
    1. Pipeline
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Pipeline" class="md-nav__link">
    adtoolbox.core.Pipeline
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Pipeline.extract_reqs_sats" class="md-nav__link">
    extract_reqs_sats()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Pipeline.validate" class="md-nav__link">
    validate()
  </a>
  
    <nav class="md-nav" aria-label="validate()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2-sequence_toolkit" class="md-nav__link">
    2. Sequence_Toolkit
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Sequence_Toolkit" class="md-nav__link">
    adtoolbox.core.Sequence_Toolkit
  </a>
  
    <nav class="md-nav" aria-label="adtoolbox.core.Sequence_Toolkit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3-reaction_toolkit" class="md-nav__link">
    3. Reaction_Toolkit
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Reaction_Toolkit" class="md-nav__link">
    adtoolbox.core.Reaction_Toolkit
  </a>
  
    <nav class="md-nav" aria-label="adtoolbox.core.Reaction_Toolkit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#4-reaction" class="md-nav__link">
    4. Reaction
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Reaction" class="md-nav__link">
    adtoolbox.core.Reaction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Reaction.stoichiometry" class="md-nav__link">
    stoichiometry
  </a>
  
    <nav class="md-nav" aria-label="stoichiometry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5-metabolite" class="md-nav__link">
    5. Metabolite
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metabolite" class="md-nav__link">
    adtoolbox.core.Metabolite
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metabolite.cod_calc" class="md-nav__link">
    cod_calc()
  </a>
  
    <nav class="md-nav" aria-label="cod_calc()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#6-database" class="md-nav__link">
    6. Database
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database" class="md-nav__link">
    adtoolbox.core.Database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.add_feedstock_to_database_from_file" class="md-nav__link">
    add_feedstock_to_database_from_file()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.cazy_ec" class="md-nav__link">
    cazy_ec()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.download_adm1_parameters" class="md-nav__link">
    download_adm1_parameters()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.download_all_databases" class="md-nav__link">
    download_all_databases()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.download_modified_adm_parameters" class="md-nav__link">
    download_modified_adm_parameters()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.download_seed_databases" class="md-nav__link">
    download_seed_databases()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.ec_from_csv" class="md-nav__link">
    ec_from_csv()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.filter_seed_from_ec" class="md-nav__link">
    filter_seed_from_ec()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.get_experimental_data_studies" class="md-nav__link">
    get_experimental_data_studies()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.get_metagenomics_studies" class="md-nav__link">
    get_metagenomics_studies()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.init_feedstock_database" class="md-nav__link">
    init_feedstock_database()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.instantiate_rxn_from_seed" class="md-nav__link">
    instantiate_rxn_from_seed()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.metadata_from_ec" class="md-nav__link">
    metadata_from_ec()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.protein_db_from_ec" class="md-nav__link">
    protein_db_from_ec()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.seed_from_ec" class="md-nav__link">
    seed_from_ec()
  </a>
  
    <nav class="md-nav" aria-label="seed_from_ec()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#7-metagenomics" class="md-nav__link">
    7. Metagenomics
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics" class="md-nav__link">
    adtoolbox.core.Metagenomics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.align_genomes_to_protein_db" class="md-nav__link">
    align_genomes_to_protein_db()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.align_to_gtdb" class="md-nav__link">
    align_to_gtdb()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.calculate_microbial_portions" class="md-nav__link">
    calculate_microbial_portions()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.download_genomes" class="md-nav__link">
    download_genomes()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.extract_relative_abundances" class="md-nav__link">
    extract_relative_abundances()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.find_top_k_repseqs" class="md-nav__link">
    find_top_k_repseqs()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.get_genomes_from_gtdb_alignment" class="md-nav__link">
    get_genomes_from_gtdb_alignment()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.get_requirements_a2g" class="md-nav__link">
    get_requirements_a2g()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.make_json_from_genomes" class="md-nav__link">
    make_json_from_genomes()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.run_qiime2_from_sra" class="md-nav__link">
    run_qiime2_from_sra()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.seqs_from_sra" class="md-nav__link">
    seqs_from_sra()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adm" class="md-nav__link">
    adm
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.adm" class="md-nav__link">
    adtoolbox.adm
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.adm.Model" class="md-nav__link">
    Model
  </a>
  
    <nav class="md-nav" aria-label="Model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adtoolbox.adm.Model.csv_report" class="md-nav__link">
    csv_report()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.adm.Model.dash_app" class="md-nav__link">
    dash_app()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.adm.Model.plot" class="md-nav__link">
    plot()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.adm.Model.sol_to_df" class="md-nav__link">
    sol_to_df()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.adm.Model.solve_model" class="md-nav__link">
    solve_model()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.adm.adm1_ode_sys" class="md-nav__link">
    adm1_ode_sys()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.adm.build_adm1_stoiciometric_matrix" class="md-nav__link">
    build_adm1_stoiciometric_matrix()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.adm.build_modified_adm_stoichiometric_matrix" class="md-nav__link">
    build_modified_adm_stoichiometric_matrix()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.adm.modified_adm_ode_sys" class="md-nav__link">
    modified_adm_ode_sys()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configs" class="md-nav__link">
    configs
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Parameter_Tuning/" class="md-nav__link">
        Parameter Tuning
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#core" class="md-nav__link">
    core
  </a>
  
    <nav class="md-nav" aria-label="core">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-pipeline" class="md-nav__link">
    1. Pipeline
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Pipeline" class="md-nav__link">
    adtoolbox.core.Pipeline
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Pipeline.extract_reqs_sats" class="md-nav__link">
    extract_reqs_sats()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Pipeline.validate" class="md-nav__link">
    validate()
  </a>
  
    <nav class="md-nav" aria-label="validate()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2-sequence_toolkit" class="md-nav__link">
    2. Sequence_Toolkit
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Sequence_Toolkit" class="md-nav__link">
    adtoolbox.core.Sequence_Toolkit
  </a>
  
    <nav class="md-nav" aria-label="adtoolbox.core.Sequence_Toolkit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3-reaction_toolkit" class="md-nav__link">
    3. Reaction_Toolkit
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Reaction_Toolkit" class="md-nav__link">
    adtoolbox.core.Reaction_Toolkit
  </a>
  
    <nav class="md-nav" aria-label="adtoolbox.core.Reaction_Toolkit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#4-reaction" class="md-nav__link">
    4. Reaction
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Reaction" class="md-nav__link">
    adtoolbox.core.Reaction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Reaction.stoichiometry" class="md-nav__link">
    stoichiometry
  </a>
  
    <nav class="md-nav" aria-label="stoichiometry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5-metabolite" class="md-nav__link">
    5. Metabolite
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metabolite" class="md-nav__link">
    adtoolbox.core.Metabolite
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metabolite.cod_calc" class="md-nav__link">
    cod_calc()
  </a>
  
    <nav class="md-nav" aria-label="cod_calc()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#6-database" class="md-nav__link">
    6. Database
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database" class="md-nav__link">
    adtoolbox.core.Database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.add_feedstock_to_database_from_file" class="md-nav__link">
    add_feedstock_to_database_from_file()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.cazy_ec" class="md-nav__link">
    cazy_ec()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.download_adm1_parameters" class="md-nav__link">
    download_adm1_parameters()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.download_all_databases" class="md-nav__link">
    download_all_databases()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.download_modified_adm_parameters" class="md-nav__link">
    download_modified_adm_parameters()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.download_seed_databases" class="md-nav__link">
    download_seed_databases()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.ec_from_csv" class="md-nav__link">
    ec_from_csv()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.filter_seed_from_ec" class="md-nav__link">
    filter_seed_from_ec()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.get_experimental_data_studies" class="md-nav__link">
    get_experimental_data_studies()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.get_metagenomics_studies" class="md-nav__link">
    get_metagenomics_studies()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.init_feedstock_database" class="md-nav__link">
    init_feedstock_database()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.instantiate_rxn_from_seed" class="md-nav__link">
    instantiate_rxn_from_seed()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.metadata_from_ec" class="md-nav__link">
    metadata_from_ec()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.protein_db_from_ec" class="md-nav__link">
    protein_db_from_ec()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Database.seed_from_ec" class="md-nav__link">
    seed_from_ec()
  </a>
  
    <nav class="md-nav" aria-label="seed_from_ec()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#7-metagenomics" class="md-nav__link">
    7. Metagenomics
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics" class="md-nav__link">
    adtoolbox.core.Metagenomics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.align_genomes_to_protein_db" class="md-nav__link">
    align_genomes_to_protein_db()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.align_to_gtdb" class="md-nav__link">
    align_to_gtdb()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.calculate_microbial_portions" class="md-nav__link">
    calculate_microbial_portions()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.download_genomes" class="md-nav__link">
    download_genomes()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.extract_relative_abundances" class="md-nav__link">
    extract_relative_abundances()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.find_top_k_repseqs" class="md-nav__link">
    find_top_k_repseqs()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.get_genomes_from_gtdb_alignment" class="md-nav__link">
    get_genomes_from_gtdb_alignment()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.get_requirements_a2g" class="md-nav__link">
    get_requirements_a2g()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.make_json_from_genomes" class="md-nav__link">
    make_json_from_genomes()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.run_qiime2_from_sra" class="md-nav__link">
    run_qiime2_from_sra()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.core.Metagenomics.seqs_from_sra" class="md-nav__link">
    seqs_from_sra()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adm" class="md-nav__link">
    adm
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.adm" class="md-nav__link">
    adtoolbox.adm
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.adm.Model" class="md-nav__link">
    Model
  </a>
  
    <nav class="md-nav" aria-label="Model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adtoolbox.adm.Model.csv_report" class="md-nav__link">
    csv_report()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.adm.Model.dash_app" class="md-nav__link">
    dash_app()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.adm.Model.plot" class="md-nav__link">
    plot()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.adm.Model.sol_to_df" class="md-nav__link">
    sol_to_df()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adtoolbox.adm.Model.solve_model" class="md-nav__link">
    solve_model()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.adm.adm1_ode_sys" class="md-nav__link">
    adm1_ode_sys()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.adm.build_adm1_stoiciometric_matrix" class="md-nav__link">
    build_adm1_stoiciometric_matrix()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.adm.build_modified_adm_stoichiometric_matrix" class="md-nav__link">
    build_modified_adm_stoichiometric_matrix()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adtoolbox.adm.modified_adm_ode_sys" class="md-nav__link">
    modified_adm_ode_sys()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configs" class="md-nav__link">
    configs
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="api">API</h1>
<p>ADToolbox has its own way of figuring out the path to the required files and configurations required for running different methods. The entire toolbox relies on the configs module. Objects of different classes in ADToolbox are instantiated by an instance
of the corresponding class in the configs module. For instance, if you want to use the methods of the metagenomics class in core module, you should do the following:</p>
<pre><code>from adtoolbox import configs and core

metag_conf=configs.Metagenomics() 
metag_object=core.Metagenomics(metag_conf)

</code></pre>
<p>Doing this will result in that any core.Metagenomics method will refer to the defult configurations defined in the configs module. If you want to overwright the defult configuration, you can pass the desired argument to the configs.Metagenomics constructor. For example, if you want to change the docker repository for VSEARCH
you can:</p>
<pre><code>
metag_conf=configs.Metagenomics(vsearch_docker=&quot;mydocker&quot;) 
metag_object=core.Metagenomics(metag_conf)

</code></pre>
<p>Now when you execute the corresponding method in core.Metagenomics it will use mydocker repository instead of the defult. To learn more about defult configs, go to the configs api.</p>
<h2 id="core">core</h2>
<p>You can access this module by:</p>
<pre><code>from adtoolbox import core 

</code></pre>
<p>This module includes the following classes:</p>
<h3 id="1-pipeline">1. Pipeline</h3>


<div class="doc doc-object doc-class">


<a id="adtoolbox.core.Pipeline"></a>
  <div class="doc doc-contents first">

  
      <p>A class for running a chain of commands in series with parallelism.</p>


        <details class="quote">
          <summary>Source code in <code>adtoolbox/core.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Pipeline</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A class for running a chain of commands in series with parallelism.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">commands</span><span class="p">:</span><span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">],</span><span class="n">executer</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">=</span><span class="n">commands</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">executer</span><span class="o">=</span><span class="n">executer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kbase_config</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;kbase_config&quot;</span><span class="p">,</span><span class="n">configs</span><span class="o">.</span><span class="n">Kbase</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_config</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;database_config&quot;</span><span class="p">,</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reaction_toolkit_config</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reaction_toolkit_config&quot;</span><span class="p">,</span><span class="n">configs</span><span class="o">.</span><span class="n">Reaction_Toolkit</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metagenomics_config</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metagenomics_config&quot;</span><span class="p">,</span><span class="n">configs</span><span class="o">.</span><span class="n">Metagenomics</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alignment_config</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;alignment_config&quot;</span><span class="p">,</span><span class="n">configs</span><span class="o">.</span><span class="n">Alignment</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_adm_config</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;original_adm_config&quot;</span><span class="p">,</span><span class="n">configs</span><span class="o">.</span><span class="n">Original_ADM1</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modified_adm_config</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;modified_adm_config&quot;</span><span class="p">,</span><span class="n">configs</span><span class="o">.</span><span class="n">Modified_ADM</span><span class="p">())</span>


    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbose</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validates the pipeline commands. Runs the following checks:</span>
<span class="sd">        1. Input to the first command is correct.&quot;&quot;&quot;</span>

        <span class="n">satisfied</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Configs.Metagenomics&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Configs.Database&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Configs.Reaction_Toolkit&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Configs.Kbase&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Configs.Alignment&quot;</span><span class="p">,</span>
                    <span class="p">]</span>
        <span class="n">requirements</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">failure</span><span class="o">=</span><span class="p">{</span>
            <span class="n">com</span><span class="o">.</span><span class="vm">__name__</span> <span class="p">:[]</span> <span class="k">for</span> <span class="n">com</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span>
         <span class="p">}</span>
        <span class="n">success</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">:</span>
            <span class="n">satisfied</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">Pipeline</span><span class="o">.</span><span class="n">extract_reqs_sats</span><span class="p">(</span><span class="n">command</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">requirements</span><span class="o">=</span><span class="n">Pipeline</span><span class="o">.</span><span class="n">extract_reqs_sats</span><span class="p">(</span><span class="n">command</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">req</span> <span class="ow">in</span> <span class="n">requirements</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">req</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">satisfied</span><span class="p">:</span>
                    <span class="n">failure</span><span class="p">[</span><span class="n">command</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">failure</span><span class="p">[</span><span class="n">command</span><span class="o">.</span><span class="vm">__name__</span><span class="p">])</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">success</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;[bold green]The following commands are valid:[/bold green]&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">com</span> <span class="ow">in</span> <span class="n">success</span><span class="p">:</span>
                <span class="n">failure</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="n">com</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">com</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;[bold red]The following commands are invalid:[/bold red]&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">com</span> <span class="ow">in</span> <span class="n">failure</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">com</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">failure</span><span class="p">[</span><span class="n">com</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


        <span class="k">return</span> <span class="n">success</span><span class="p">,</span><span class="n">failure</span>









    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">extract_reqs_sats</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extracts the requirements and satisfactions from a command using the tags in the docstrings&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;Requires:&quot;</span> <span class="ow">in</span> <span class="n">command</span><span class="o">.</span><span class="vm">__doc__</span> <span class="ow">and</span> <span class="s2">&quot;Satisfies:&quot;</span> <span class="ow">in</span> <span class="n">command</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">:</span>
            <span class="n">reqs</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;&lt;R&gt;.+&lt;/R&gt;&quot;</span><span class="p">,</span><span class="n">command</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">reqs</span><span class="p">):</span>
                <span class="n">reqs</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;R&gt;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;/R&gt;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">sats</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;&lt;S&gt;.+&lt;/S&gt;&quot;</span><span class="p">,</span><span class="n">command</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sats</span><span class="p">):</span>
                <span class="n">sats</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;S&gt;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;/S&gt;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The command docstring for </span><span class="si">{</span><span class="n">command</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> is not properly formatted. Please use the following tags: &lt;R&gt; and &lt;S&gt; for requirements and satisfactions respectively.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">reqs</span><span class="p">,</span><span class="n">sats</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Pipeline.extract_reqs_sats" class="doc doc-heading">
<code class="highlight language-python"><span class="n">extract_reqs_sats</span><span class="p">(</span><span class="n">command</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Extracts the requirements and satisfactions from a command using the tags in the docstrings</p>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">extract_reqs_sats</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extracts the requirements and satisfactions from a command using the tags in the docstrings&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="s2">&quot;Requires:&quot;</span> <span class="ow">in</span> <span class="n">command</span><span class="o">.</span><span class="vm">__doc__</span> <span class="ow">and</span> <span class="s2">&quot;Satisfies:&quot;</span> <span class="ow">in</span> <span class="n">command</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">:</span>
        <span class="n">reqs</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;&lt;R&gt;.+&lt;/R&gt;&quot;</span><span class="p">,</span><span class="n">command</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">reqs</span><span class="p">):</span>
            <span class="n">reqs</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;R&gt;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;/R&gt;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">sats</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;&lt;S&gt;.+&lt;/S&gt;&quot;</span><span class="p">,</span><span class="n">command</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sats</span><span class="p">):</span>
            <span class="n">sats</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;S&gt;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;/S&gt;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The command docstring for </span><span class="si">{</span><span class="n">command</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> is not properly formatted. Please use the following tags: &lt;R&gt; and &lt;S&gt; for requirements and satisfactions respectively.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">reqs</span><span class="p">,</span><span class="n">sats</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Pipeline.validate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validate</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Validates the pipeline commands. Runs the following checks:
1. Input to the first command is correct.</p>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbose</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validates the pipeline commands. Runs the following checks:</span>
<span class="sd">    1. Input to the first command is correct.&quot;&quot;&quot;</span>

    <span class="n">satisfied</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Configs.Metagenomics&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Configs.Database&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Configs.Reaction_Toolkit&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Configs.Kbase&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Configs.Alignment&quot;</span><span class="p">,</span>
                <span class="p">]</span>
    <span class="n">requirements</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">failure</span><span class="o">=</span><span class="p">{</span>
        <span class="n">com</span><span class="o">.</span><span class="vm">__name__</span> <span class="p">:[]</span> <span class="k">for</span> <span class="n">com</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span>
     <span class="p">}</span>
    <span class="n">success</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">:</span>
        <span class="n">satisfied</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">Pipeline</span><span class="o">.</span><span class="n">extract_reqs_sats</span><span class="p">(</span><span class="n">command</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">requirements</span><span class="o">=</span><span class="n">Pipeline</span><span class="o">.</span><span class="n">extract_reqs_sats</span><span class="p">(</span><span class="n">command</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">req</span> <span class="ow">in</span> <span class="n">requirements</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">req</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">satisfied</span><span class="p">:</span>
                <span class="n">failure</span><span class="p">[</span><span class="n">command</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">failure</span><span class="p">[</span><span class="n">command</span><span class="o">.</span><span class="vm">__name__</span><span class="p">])</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">success</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;[bold green]The following commands are valid:[/bold green]&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">com</span> <span class="ow">in</span> <span class="n">success</span><span class="p">:</span>
            <span class="n">failure</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="n">com</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">com</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;[bold red]The following commands are invalid:[/bold red]&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">com</span> <span class="ow">in</span> <span class="n">failure</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">com</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">failure</span><span class="p">[</span><span class="n">com</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">success</span><span class="p">,</span><span class="n">failure</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h3 id="2-sequence_toolkit">2. Sequence_Toolkit</h3>


<div class="doc doc-object doc-class">


<a id="adtoolbox.core.Sequence_Toolkit"></a>
  <div class="doc doc-contents first">



        <details class="quote">
          <summary>Source code in <code>adtoolbox/core.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Sequence_Toolkit</span><span class="p">:</span>

    <span class="n">aa_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span>
               <span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">]</span>
    <span class="n">n_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;Protein&#39;</span><span class="p">,</span> <span class="n">length</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">type_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">length</span>

    <span class="k">def</span> <span class="nf">seq_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;Protein&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aa_list</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">)])</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;DNA&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_list</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">)])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Type not recognized&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mutate_random</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">number_of_mutations</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;Protein&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_mutations</span><span class="p">):</span>
                <span class="n">seq</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
                <span class="n">seq</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">))]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aa_list</span><span class="p">)</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;DNA&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_mutations</span><span class="p">):</span>
                <span class="n">seq</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
                <span class="n">seq</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">))]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_list</span><span class="p">)</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div><h3 id="3-reaction_toolkit">3. Reaction_Toolkit</h3>


<div class="doc doc-object doc-class">


<a id="adtoolbox.core.Reaction_Toolkit"></a>
  <div class="doc doc-contents first">

  
      <p>A Class for converting ec numbers to reaction objects or extracting any information from the seed database</p>


        <details class="quote">
          <summary>Source code in <code>adtoolbox/core.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Reaction_Toolkit</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Class for converting ec numbers to reaction objects or extracting any information from the seed database</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compound_db</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Reaction_Toolkit</span><span class="p">()</span><span class="o">.</span><span class="n">compound_db</span><span class="p">,</span> <span class="n">reaction_db</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Reaction_Toolkit</span><span class="p">()</span><span class="o">.</span><span class="n">reaction_db</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reaction_db</span> <span class="o">=</span> <span class="n">reaction_db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compound_db</span> <span class="o">=</span> <span class="n">compound_db</span>

    <span class="k">def</span> <span class="nf">instantiate_rxns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ec_number</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;Single_Match&#39;</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reaction_db</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;Single_Match&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;ec_numbers&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">ec_number</span> <span class="ow">in</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;ec_numbers&#39;</span><span class="p">]:</span>
                        <span class="k">return</span> <span class="n">Reaction</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;Multiple_Match&#39;</span><span class="p">:</span>
            <span class="n">matched_rxns</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">Reaction</span><span class="p">(</span><span class="n">rxn</span><span class="p">)</span> <span class="k">for</span> <span class="n">rxn</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">if</span> <span class="n">rxn</span><span class="p">[</span><span class="s1">&#39;ec_numbers&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="n">ec_number</span><span class="p">]]</span>
            <span class="k">return</span> <span class="n">matched_rxns</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mode not recognized!&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">instantiate_metabs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed_id</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">compound_db</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="c1"># Maybe contain is better than == below\\To be completed</span>
        <span class="n">matched_compounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">Metabolite</span><span class="p">(</span><span class="n">met</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">met</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">if</span> <span class="n">met</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">seed_id</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">matched_compounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div><h3 id="4-reaction">4. Reaction</h3>


<div class="doc doc-object doc-class">


<a id="adtoolbox.core.Reaction"></a>
  <div class="doc doc-contents first">

  
      <p>This class is used to store and process the reaction information.
In order to instantiate a reaction object, you need to pass a dictionary of the reaction information.
This dictionary must include 'name','stoichiometry' keys. This follows the format of the seed database.</p>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s1">&#39;D-glucose-6-phosphate aldose-ketose-isomerase&#39;</span><span class="p">,</span><span class="s2">&quot;stoichiometry&quot;</span><span class="p">:</span><span class="s1">&#39;-1:cpd00079:0:0:&quot;D-glucose-6-phosphate&quot;;1:cpd00072:0:0:&quot;D-fructose-6-phosphate&quot;&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">=</span><span class="n">Reaction</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">D-glucose-6-phosphate aldose-ketose-isomerase</span>
</code></pre></div>


        <details class="quote">
          <summary>Source code in <code>adtoolbox/core.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Reaction</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is used to store and process the reaction information.</span>
<span class="sd">    In order to instantiate a reaction object, you need to pass a dictionary of the reaction information.</span>
<span class="sd">    This dictionary must include &#39;name&#39;,&#39;stoichiometry&#39; keys. This follows the format of the seed database.</span>
<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; A={&quot;name&quot;:&#39;D-glucose-6-phosphate aldose-ketose-isomerase&#39;,&quot;stoichiometry&quot;:&#39;-1:cpd00079:0:0:\&quot;D-glucose-6-phosphate\&quot;;1:cpd00072:0:0:\&quot;D-fructose-6-phosphate\&quot;&#39;}</span>
<span class="sd">        &gt;&gt;&gt; a=Reaction(A)</span>
<span class="sd">        &gt;&gt;&gt; print(a)</span>
<span class="sd">        D-glucose-6-phosphate aldose-ketose-isomerase</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict</span> <span class="o">=</span> <span class="nb">dict</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">stoichiometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the stoichiometry of the reaction by the seed id of the compounds as key and the</span>
<span class="sd">        stoichiometric coefficient as value.</span>
<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; A={&quot;name&quot;:&#39;D-glucose-6-phosphate aldose-ketose-isomerase&#39;,&quot;stoichiometry&quot;:&#39;-1:cpd00079:0:0:\&quot;D-glucose-6-phosphate\&quot;;1:cpd00072:0:0:\&quot;D-fructose-6-phosphate\&quot;&#39;}</span>
<span class="sd">            &gt;&gt;&gt; a=Reaction(A)</span>
<span class="sd">            &gt;&gt;&gt; a.Stoichiometry=={&#39;cpd00079&#39;: -1, &#39;cpd00072&#39;: 1}</span>
<span class="sd">            True</span>

<span class="sd">        Args:</span>
<span class="sd">            self (Reaction): An instance of the Reaction.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: The stoichiometry of the reaction by the seed id of the compounds as key and the</span>
<span class="sd">        stoichiometric coefficient as value.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">S</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">compound</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;stoichiometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">):</span>
            <span class="n">S</span><span class="p">[</span><span class="n">compound</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">compound</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">S</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h2 id="adtoolbox.core.Reaction.stoichiometry" class="doc doc-heading">
<code class="highlight language-python"><span class="n">stoichiometry</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Returns the stoichiometry of the reaction by the seed id of the compounds as key and the
stoichiometric coefficient as value.</p>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s1">&#39;D-glucose-6-phosphate aldose-ketose-isomerase&#39;</span><span class="p">,</span><span class="s2">&quot;stoichiometry&quot;</span><span class="p">:</span><span class="s1">&#39;-1:cpd00079:0:0:&quot;D-glucose-6-phosphate&quot;;1:cpd00072:0:0:&quot;D-fructose-6-phosphate&quot;&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">=</span><span class="n">Reaction</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">Stoichiometry</span><span class="o">==</span><span class="p">{</span><span class="s1">&#39;cpd00079&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;cpd00072&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="go">True</span>
</code></pre></div>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>self</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="adtoolbox.core.Reaction" href="#adtoolbox.core.Reaction">Reaction</a></code>
          </td>
          <td><p>An instance of the Reaction.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>dict</code></td>          <td>
          </td>
          <td><p>The stoichiometry of the reaction by the seed id of the compounds as key and the</p></td>
        </tr>
    </tbody>
  </table>
      <p>stoichiometric coefficient as value.</p>
  </div>

</div>





  </div>

  </div>

</div><h3 id="5-metabolite">5. Metabolite</h3>


<div class="doc doc-object doc-class">


<a id="adtoolbox.core.Metabolite"></a>
  <div class="doc doc-contents first">

  
      <p>Any metabolite with seed id can be an instance of this class.
In order to instantiate a Metabolite object, you first define a dictionary in seed database format.
This dictionary must have  "name", "mass", and "formula" keys, but it is okay if it has other keys.</p>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;methane&quot;</span><span class="p">,</span><span class="s2">&quot;mass&quot;</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span><span class="s2">&quot;formula&quot;</span><span class="p">:</span><span class="s2">&quot;CH4&quot;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">=</span><span class="n">Metabolite</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">methane</span>
</code></pre></div>


        <details class="quote">
          <summary>Source code in <code>adtoolbox/core.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Metabolite</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Any metabolite with seed id can be an instance of this class.</span>
<span class="sd">    In order to instantiate a Metabolite object, you first define a dictionary in seed database format.</span>
<span class="sd">    This dictionary must have  &quot;name&quot;, &quot;mass&quot;, and &quot;formula&quot; keys, but it is okay if it has other keys.</span>
<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; A={&quot;name&quot;:&quot;methane&quot;,&quot;mass&quot;:16,&quot;formula&quot;:&quot;CH4&quot;}</span>
<span class="sd">        &gt;&gt;&gt; a=Metabolite(A)</span>
<span class="sd">        &gt;&gt;&gt; print(a)</span>
<span class="sd">        methane</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict</span> <span class="o">=</span> <span class="nb">dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cod_calc</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">cod_calc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the conversion rates for g/l -&gt; gCOD/l</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; A={&quot;name&quot;:&quot;methane&quot;,&quot;mass&quot;:16,&quot;formula&quot;:&quot;CH4&quot;}</span>
<span class="sd">            &gt;&gt;&gt; a=Metabolite(A)</span>
<span class="sd">            &gt;&gt;&gt; a.COD</span>
<span class="sd">            4.0</span>

<span class="sd">        Args:</span>
<span class="sd">            self (Metabolite): An instance of the Metabolite class: Note</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: COD conversion from g/l to gCOD/l</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;formula&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;mass&#39;</span><span class="p">]:</span>
            <span class="n">contents</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">atoms</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;O&quot;</span><span class="p">]</span>
            <span class="n">mw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;mass&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">atom</span><span class="o">+</span><span class="s1">&#39;\d*&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;formula&#39;</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">atom</span><span class="o">+</span><span class="s1">&#39;\d*&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;formula&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">group</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">contents</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">contents</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                            <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">atom</span><span class="o">+</span><span class="s1">&#39;\d*&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;formula&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">group</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">contents</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="n">mw</span><span class="o">*</span><span class="p">(</span><span class="n">contents</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">contents</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">contents</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">])</span><span class="o">/</span><span class="mi">4</span><span class="o">*</span><span class="mi">32</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;None&#39;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Metabolite.cod_calc" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cod_calc</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Calculates the conversion rates for g/l -&gt; gCOD/l</p>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;methane&quot;</span><span class="p">,</span><span class="s2">&quot;mass&quot;</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span><span class="s2">&quot;formula&quot;</span><span class="p">:</span><span class="s2">&quot;CH4&quot;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">=</span><span class="n">Metabolite</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">COD</span>
<span class="go">4.0</span>
</code></pre></div>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>self</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="adtoolbox.core.Metabolite" href="#adtoolbox.core.Metabolite">Metabolite</a></code>
          </td>
          <td><p>An instance of the Metabolite class: Note</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>float</code></td>          <td>
                <code>float</code>
          </td>
          <td><p>COD conversion from g/l to gCOD/l</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cod_calc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the conversion rates for g/l -&gt; gCOD/l</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; A={&quot;name&quot;:&quot;methane&quot;,&quot;mass&quot;:16,&quot;formula&quot;:&quot;CH4&quot;}</span>
<span class="sd">        &gt;&gt;&gt; a=Metabolite(A)</span>
<span class="sd">        &gt;&gt;&gt; a.COD</span>
<span class="sd">        4.0</span>

<span class="sd">    Args:</span>
<span class="sd">        self (Metabolite): An instance of the Metabolite class: Note</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: COD conversion from g/l to gCOD/l</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;formula&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;mass&#39;</span><span class="p">]:</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;O&quot;</span><span class="p">]</span>
        <span class="n">mw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;mass&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">atom</span><span class="o">+</span><span class="s1">&#39;\d*&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;formula&#39;</span><span class="p">]):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">atom</span><span class="o">+</span><span class="s1">&#39;\d*&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;formula&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">group</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">contents</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">contents</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                        <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">atom</span><span class="o">+</span><span class="s1">&#39;\d*&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;formula&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">group</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">contents</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="n">mw</span><span class="o">*</span><span class="p">(</span><span class="n">contents</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">contents</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">contents</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">])</span><span class="o">/</span><span class="mi">4</span><span class="o">*</span><span class="mi">32</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;None&#39;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h3 id="6-database">6. Database</h3>
<p>Here is a schematic of the Database Module</p>
<p><img alt="database" src="../Database.svg" /></p>


<div class="doc doc-object doc-class">


<a id="adtoolbox.core.Database"></a>
  <div class="doc doc-contents first">

  
      <p>This class will handle all of the functions required for providing the database for ADToolbox.</p>


        <details class="quote">
          <summary>Source code in <code>adtoolbox/core.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Database</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This class will handle all of the functions required for providing the database for ADToolbox.</span>
<span class="sd">    &#39;&#39;&#39;</span>


    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">()):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>


    <span class="k">def</span> <span class="nf">_initialize_protein_database</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function intializes ADToolbox&#39;s protein database by creating an empty fasta file.</span>
<span class="sd">        Be careful, this will overwrite any existing file with the same name.&quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">pass</span>


    <span class="k">def</span> <span class="nf">filter_seed_from_ec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ec_list</span><span class="p">,</span>
                            <span class="n">reaction_db</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">()</span><span class="o">.</span><span class="n">reaction_db</span><span class="p">,</span>
                            <span class="n">compound_db</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">()</span><span class="o">.</span><span class="n">compound_db</span><span class="p">,</span>
                            <span class="n">local_reaction_db</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">()</span><span class="o">.</span><span class="n">local_reaction_db</span><span class="p">,</span>
                            <span class="n">local_compound_db</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">()</span><span class="o">.</span><span class="n">local_compound_db</span><span class="p">,</span>
                            <span class="n">save</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        This function takes a list of ec numbers Generates a mini-seed JSON files. This is supposed to</span>
<span class="sd">        make the code a lot faster, but makes no difference in terms of outputs, and won&#39;t probably need</span>
<span class="sd">        frequent updates.</span>

<span class="sd">        Args:</span>
<span class="sd">            ec_list (list): The list of EC numbers that you want the mini seed database to include.</span>
<span class="sd">            reaction_db (str, optional): The path to the main model seed reaction database. Defaults to configs.Database().reaction_db.</span>
<span class="sd">            compound_db (str, optional): The path to the main model seed compound database. Defaults to configs.Database().compound_db.</span>
<span class="sd">            local_reaction_db (str, optional): Path to where you want the mini seed reaction database to be saved. Defaults to configs.Database().local_reaction_db.</span>
<span class="sd">            local_compound_db (str, optional): Path to where you want the mini seed compound database to be saved. Defaults to configs.Database().local_compound_db.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: A tuple containing the mini seed reaction database and the mini seed compound database.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">## TODO: Make this function more efficient by using pandas an search using .str.contains. This would be way faster</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">reaction_db</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">main_reaction_db</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">compound_db</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">main_compound_db</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="n">cached_compounds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">local_rxn_db</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">local_comp_db</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ec</span> <span class="ow">in</span> <span class="n">track</span><span class="p">(</span><span class="n">ec_list</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Extracting the relevant reactions:&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">rxn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">main_reaction_db</span><span class="p">):</span>
                <span class="k">if</span>  <span class="n">ec</span> <span class="ow">in</span> <span class="n">rxn</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;ec_numbers&#39;</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="n">local_rxn_db</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rxn</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">Mets</span> <span class="ow">in</span> <span class="n">rxn</span><span class="p">[</span><span class="s2">&quot;compound_ids&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">Mets</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cached_compounds</span><span class="p">:</span>
                            <span class="n">cached_compounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Mets</span><span class="p">)</span>

        <span class="n">cached_compounds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">cached_compounds</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">compound</span> <span class="ow">in</span> <span class="n">track</span><span class="p">(</span><span class="n">cached_compounds</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Extracting the relevant compounds:&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">Comp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">main_compound_db</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">compound</span> <span class="o">==</span> <span class="n">Comp</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]:</span>
                    <span class="n">local_comp_db</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Comp</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_reaction_db</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">local_rxn_db</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_compound_db</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">local_comp_db</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">local_rxn_db</span><span class="p">,</span> <span class="n">local_comp_db</span>



    <span class="c1"># def add_protein_from_uniprot(self, uniprot_ecs):</span>

    <span class="c1">#     pdb.set_trace()</span>
    <span class="c1">#     with open(self.config.protein_db, &#39;a&#39;) as f:</span>
    <span class="c1">#         for items in track(uniprot_ecs,description=&quot;[yellow] --&gt; Fetching the protein sequences from Uniprot: &quot;):</span>
    <span class="c1">#             try:</span>
    <span class="c1">#                 file = Database.session.get(</span>
    <span class="c1">#                     f&quot;https://rest.uniprot.org/uniprotkb/{items[0]}.fasta&quot;, timeout=10)</span>
    <span class="c1">#             except requests.exceptions.ConnectionError:</span>
    <span class="c1">#                 print(&quot;Could not fetch the sequence! Trying again ...&quot;)</span>
    <span class="c1">#                 time.sleep(10)</span>
    <span class="c1">#                 file = Database.session.get(</span>
    <span class="c1">#                     Base_URL+items[0]+&quot;.fasta&quot;, timeout=10)</span>
    <span class="c1">#                 if file.ok:</span>
    <span class="c1">#                     print(</span>
    <span class="c1">#                         f&quot;Retry was successful: {items[0]} was fetched successfully!&quot;)</span>
    <span class="c1">#                 else:</span>
    <span class="c1">#                     print(</span>
    <span class="c1">#                         f&quot;Retry was unsuccessful: {items[0]} ignored!&quot;)</span>
    <span class="c1">#                     # I can add this uniprot id to a log file</span>
    <span class="c1">#                 continue</span>
    <span class="c1">#             if file.ok:</span>
    <span class="c1">#                 f.write(f&#39;&gt;{items[0]}|{items[1]}\n&#39;)</span>
    <span class="c1">#                 f.write(&#39;&#39;.join(file.text.split(&#39;\n&#39;)[1:-1]))</span>
    <span class="c1">#                 f.write(&#39;\n&#39;)</span>

    <span class="k">def</span> <span class="nf">protein_db_from_ec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ec_list</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span><span class="n">mode</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function takes a list of EC numbers and fetches the protein sequences mapped to those EC numbers from Uniprot.</span>
<span class="sd">        The protein sequences are then written to the protein database file.</span>

<span class="sd">        Args:</span>
<span class="sd">            ec_list (list): A list of EC numbers.</span>
<span class="sd">            mode (str, optional): The mode in which the protein database file is opened. Defaults to &quot;a&quot;.</span>

<span class="sd">        Returns: </span>
<span class="sd">            dict: A dictionary containing the protein sequences mapped to the EC numbers.&quot;&quot;&quot;</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
        <span class="n">retry</span> <span class="o">=</span> <span class="n">Retry</span><span class="p">(</span><span class="n">connect</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">backoff_factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">adapter</span> <span class="o">=</span> <span class="n">HTTPAdapter</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="n">retry</span><span class="p">)</span>
        <span class="n">session</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s1">&#39;http://&#39;</span><span class="p">,</span> <span class="n">adapter</span><span class="p">)</span>

        <span class="n">protein_seqs</span><span class="o">=</span><span class="p">{}</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ec</span> <span class="ow">in</span> <span class="n">track</span><span class="p">(</span><span class="n">ec_list</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Writing the protein database:&quot;</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">file</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;https://rest.uniprot.org/uniprotkb/stream?format=fasta&amp;query=%28%28ec%3A</span><span class="si">{</span><span class="n">ec</span><span class="si">}</span><span class="s2">%29%20AND%20%28reviewed%3Atrue%29%20NOT%20%28taxonomy_id%3A2759%29%29&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

                <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="ow">or</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span><span class="p">:</span>

                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Request Error! Trying again ...&quot;</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
                    <span class="n">file</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;https://rest.uniprot.org/uniprotkb/stream?format=fasta&amp;query=%28%28ec%3A</span><span class="si">{</span><span class="n">ec</span><span class="si">}</span><span class="s2">%29%20AND%20%28reviewed%3Atrue%29%20NOT%20%28taxonomy_id%3A2759%29%29&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
                <span class="c1"># This alsp does a sanity check</span>

                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Something went wrong!&#39;</span><span class="p">)</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">text</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">):</span>
                        <span class="n">uniprot</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&gt;</span><span class="si">{</span><span class="n">uniprot</span><span class="si">}</span><span class="s1">|</span><span class="si">{</span><span class="n">ec</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                        <span class="n">protein_seqs</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]</span><span class="o">=</span><span class="n">line</span>

        <span class="k">return</span> <span class="n">protein_seqs</span>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">ec_from_csv</span><span class="p">(</span><span class="n">csv_file</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">list</span><span class="p">:</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function reads a csv file and returns a list of ec numbers. The csv file should have a column named &quot;EC_Numbers&quot; and the delimiter </span>
<span class="sd">        that is used in in your file should be defined as an argument.</span>

<span class="sd">        Args:</span>
<span class="sd">            csv_file (str): The path to the csv file.</span>
<span class="sd">            Sep (str, optional): The delimiter used in the csv file. Defaults to &#39;,&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A cleaned list of ec numbers.&quot;&quot;&quot;</span>


        <span class="k">try</span><span class="p">:</span>

            <span class="n">ec_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">csv_file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">Sep</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;str&quot;</span><span class="p">)</span>
            <span class="n">ec_list</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">ec_list</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s2">&quot;EC_Numbers&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">output_ec_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ec_list</span><span class="p">[</span><span class="s2">&quot;EC_Numbers&quot;</span><span class="p">])</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">output_ec_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;The ec list is empty; Check the file&quot;</span>

        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CSV file not found&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">ParserError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>

            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;CSV file not in the correct format; Check the delimiter and column names!&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>

            <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>


        <span class="k">return</span> <span class="n">output_ec_list</span>




    <span class="k">def</span> <span class="nf">cazy_ec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Scraps the ec numbers from links of the Cazy website.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list of ec numbers.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">ec_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">Database</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">cazy_links</span><span class="p">:</span>

            <span class="n">page</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
            <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s2">&quot;cadre_principal&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span>
                <span class="s2">&quot;th&quot;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s2">&quot;thec&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ec_number</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;-&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ec_number</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">ec_number</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>

                    <span class="n">ec_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ec_number</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ec numbers extracted from Cazy website!&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ec_list</span>


    <span class="k">def</span> <span class="nf">seed_from_ec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ec_Number</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;single_match&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Given EC number, this function returns the corresponding Seed IDs from the SEED reaction database.</span>

<span class="sd">        Args:</span>
<span class="sd">            ec_Number (str): The EC number.</span>
<span class="sd">            mode (str, optional): The mode in which the function should run. Defaults to &#39;single_match&#39;. You can choose between &#39;single_match&#39; and &#39;Multiple_Match&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list of Seed IDs.&quot;&quot;&quot;</span>

        <span class="c1">##TODO This function can use pandas to speed up the process</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reaction_db</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> 

            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;single_match&#39;</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;ec_numbers&#39;</span><span class="p">]:</span>

                    <span class="k">if</span> <span class="n">ec_Number</span> <span class="ow">in</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;ec_numbers&#39;</span><span class="p">]:</span>

                        <span class="k">return</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]]</span>

        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;Multiple_Match&#39;</span><span class="p">:</span>

            <span class="n">matched_rxn</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">([</span>

                <span class="n">rxn</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">rxn</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">if</span> <span class="n">rxn</span><span class="p">[</span><span class="s1">&#39;ec_numbers&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="n">ec_Number</span><span class="p">]])))</span>

            <span class="k">return</span> <span class="n">matched_rxn</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mode not recognized!&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">instantiate_rxn_from_seed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">seed_id_list</span><span class="p">:</span><span class="nb">list</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function that idenifies reaction seed ID&#39;s and instantiates them in the Reaction class.</span>
<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; seed_id_List = [&#39;rxn00002&#39;,&#39;rxn00003&#39;,&#39;rxn00005&#39;]</span>
<span class="sd">            &gt;&gt;&gt; dbconfigs = configs.Database()</span>
<span class="sd">            &gt;&gt;&gt; rxnlist = Database(dbconfigs).Instantiate_Rxn_From_Seed(seed_id_List)</span>
<span class="sd">            &gt;&gt;&gt; assert type(rxnlist[0])==Reaction</span>

<span class="sd">        Args:</span>
<span class="sd">            seed_id_List (list): A list of relevant seed ID entries [rxn#####]</span>

<span class="sd">        Returns:</span>
<span class="sd">            rxn_list: A list including reaction instances in the database class for each seed ID in input list.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">## TODO: This function can be sped up by using pandas</span>

        <span class="n">rxn_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reaction_db</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">seed_id</span> <span class="ow">in</span> <span class="n">seed_id_list</span><span class="p">:</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>

                    <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]:</span>

                        <span class="k">if</span> <span class="n">seed_id</span> <span class="ow">in</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]:</span>

                            <span class="n">rxn_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Reaction</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                            <span class="k">break</span>

        <span class="k">return</span> <span class="n">rxn_list</span>

    <span class="k">def</span> <span class="nf">metadata_from_ec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ec_list</span><span class="p">:</span><span class="nb">list</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function returns a pandas dataframe containing relevant pathway and reactions for</span>
<span class="sd">        each ec number input.</span>
<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; ec_list = [&#39;1.1.1.1&#39;,&#39;1.1.1.2&#39;] </span>
<span class="sd">            &gt;&gt;&gt; metadata= Database().Metadata_From_ec(ec_list) # doctest: +ELLIPSIS </span>
<span class="sd">            Finding ...</span>
<span class="sd">            &gt;&gt;&gt; assert type(metadata)==pd.DataFrame</span>
<span class="sd">            &gt;&gt;&gt; assert set(metadata[&#39;ec_Numbers&#39;].to_list())==set(ec_list)</span>
<span class="sd">            &gt;&gt;&gt; assert set([&quot;ec_Numbers&quot;, &quot;seed_ids&quot;,&quot;Reaction_Names&quot;, &quot;Pathways&quot;])==set(metadata.columns)</span>
<span class="sd">            &gt;&gt;&gt; assert metadata.shape==(len(ec_list),4)</span>

<span class="sd">        Args:</span>
<span class="sd">            ec_list (list): A list of relevant ec numbers.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: A pandas dataframe including reaction metadata or pathways for each ec number in list.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">full_table</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ec_Numbers&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;seed_ids&quot;</span><span class="p">:</span> <span class="p">[],</span>
                      <span class="s2">&quot;Reaction_Names&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;Pathways&quot;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Finding ec Metadata ...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ec</span> <span class="ow">in</span> <span class="n">track</span><span class="p">(</span><span class="n">ec_list</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span> <span class="s2">&quot;Collecting Metadata for ec numbers&quot;</span><span class="p">):</span>
            <span class="n">seed_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_from_ec</span><span class="p">(</span><span class="n">ec</span><span class="p">,</span> <span class="n">Mode</span><span class="o">=</span><span class="s1">&#39;Multiple_Match&#39;</span><span class="p">)</span>
            <span class="n">full_table</span><span class="p">[</span><span class="s1">&#39;ec_Numbers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ec</span><span class="p">)</span>
            <span class="n">full_table</span><span class="p">[</span><span class="s1">&#39;seed_ids&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seed_id</span><span class="p">)</span>
            <span class="n">Temp_rxns</span> <span class="o">=</span> <span class="n">Database</span><span class="p">()</span><span class="o">.</span><span class="n">instantiate_rxn_from_seed</span><span class="p">(</span><span class="n">seed_id</span><span class="p">)</span>
            <span class="n">Temp_rxn_Names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">([</span><span class="n">reaction</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                                   <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="n">Temp_rxns</span><span class="p">])</span>
            <span class="n">Temp_rxn_Path</span> <span class="o">=</span> <span class="nb">list</span><span class="p">([</span><span class="n">reaction</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s2">&quot;pathways&quot;</span><span class="p">]</span>
                                  <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="n">Temp_rxns</span><span class="p">])</span>
            <span class="n">full_table</span><span class="p">[</span><span class="s2">&quot;Pathways&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Temp_rxn_Path</span><span class="p">)</span>
            <span class="n">full_table</span><span class="p">[</span><span class="s2">&quot;Reaction_Names&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Temp_rxn_Names</span><span class="p">)</span>

        <span class="n">full_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">full_table</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">full_table</span>

    <span class="k">def</span> <span class="nf">init_feedstock_database</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Makes an empty feedstock database json file.</span>
<span class="sd">        BE CAREFUL: This will overwrite the current database file.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">dec</span><span class="o">=</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Are you sure you want to create a new database? (y/n): &quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dec</span><span class="o">==</span><span class="s2">&quot;y&quot;</span><span class="p">:</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">([],</span> <span class="n">f</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Aborting!&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1">## TO-DO: Error and Failure handling</span>

    <span class="k">def</span> <span class="nf">_add_feedstock_to_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feedstock</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Adds a feedstock to the feedstock database.</span>
<span class="sd">        A Feed Stock must be a dictionary with the following keys:</span>
<span class="sd">        &quot;Name&quot;: Name of the feedstock</span>
<span class="sd">        &quot;TS&quot;: Totall Solids (in COD)</span>
<span class="sd">        &quot;TSS&quot;: Totall Suspended Solids (in COD)</span>
<span class="sd">        &quot;Lipids&quot;: Lipids (in COD)</span>
<span class="sd">        &quot;Proteins&quot;: Proteins (in COD)</span>
<span class="sd">        &quot;Carbohydrates&quot;: Carbohydrates (in COD)</span>
<span class="sd">        &quot;PI&quot;: Particulate Inerts</span>
<span class="sd">        &quot;SI&quot;: Soluble Inerts</span>
<span class="sd">        &quot;Notes&quot;: Additional notes like the source of the data</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">database</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Feedstock database not found! Creating new one...&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_feedstock_database</span><span class="p">()</span>

        <span class="k">finally</span><span class="p">:</span>

            <span class="n">database</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feedstock</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_feedstock_to_database_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Adds a feedstock to the feedstock database from a csv file.</span>
<span class="sd">        A Feed Stock spreadsheet must be a table with the following columns:</span>
<span class="sd">        &quot;Name&quot;, &quot;TS&quot;, &quot;TSS&quot;, &quot;Lipids&quot;, &quot;Proteins&quot;, &quot;Carbohydrates&quot;, &quot;PI&quot;, &quot;SI&quot;, &quot;Notes&quot;</span>
<span class="sd">        File_Path does not come with a default path, since it is advised to not populate the</span>
<span class="sd">        project directory with feedstock spreadsheets unwanted.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;File not found!&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">counter</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">feedstock</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_feedstock_to_database</span><span class="p">(</span><span class="n">feedstock</span><span class="p">)</span>
            <span class="n">counter</span><span class="o">+=</span><span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> Feedstocks added to the database!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">download_adm1_parameters</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Downloads the parameters needed for running ADM models in ADToolbox</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">base_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">base_dir</span><span class="p">)</span>
        <span class="n">model_parameters_dir</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">model_parameters</span>
        <span class="n">base_parameters_dir</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">base_parameters</span>
        <span class="n">initial_conditions_dir</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">initial_conditions</span>
        <span class="n">inlet_conditions_dir</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">inlet_conditions</span>
        <span class="n">reactions_dir</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">reactions</span>
        <span class="n">species_dir</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">species</span>
        <span class="n">model_parameters</span><span class="o">=</span><span class="s2">&quot;https://github.com/ParsaGhadermazi/Database/raw/main/ADToolbox/ADM1/ADM1_Model_Parameters.json&quot;</span>
        <span class="n">base_parameters</span><span class="o">=</span><span class="s2">&quot;https://github.com/ParsaGhadermazi/Database/raw/main/ADToolbox/ADM1/ADM1_Base_Parameters.json&quot;</span>
        <span class="n">initial_conditions</span><span class="o">=</span><span class="s2">&quot;https://github.com/ParsaGhadermazi/Database/blob/main/ADToolbox/ADM1/ADM1_Initial_Conditions.json&quot;</span>
        <span class="n">inlet_conditions</span><span class="o">=</span><span class="s2">&quot;https://github.com/ParsaGhadermazi/Database/raw/main/ADToolbox/ADM1/ADM1_Inlet_Conditions.json&quot;</span>
        <span class="n">reactions</span><span class="o">=</span><span class="s2">&quot;https://github.com/ParsaGhadermazi/Database/raw/main/ADToolbox/ADM1/ADM1_Reactions.json&quot;</span>
        <span class="n">species</span><span class="o">=</span><span class="s2">&quot;https://github.com/ParsaGhadermazi/Database/raw/main/ADToolbox/ADM1/ADM1_Species.json&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model_parameters</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">model_parameters_dir</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">base_parameters</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">base_parameters_dir</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">initial_conditions</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">initial_conditions_dir</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">inlet_conditions</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">inlet_conditions_dir</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reactions</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">reactions_dir</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">species_dir</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">download_modified_adm_parameters</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>    
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Downloads the parameters needed for running ADM models in ADToolbox</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">base_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">base_dir</span><span class="p">)</span>
        <span class="n">model_parameters_dir</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">model_parameters</span>
        <span class="n">base_parameters_dir</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">base_parameters</span>
        <span class="n">initial_conditions_dir</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">initial_conditions</span>
        <span class="n">inlet_conditions_dir</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">inlet_conditions</span>
        <span class="n">reactions_dir</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">reactions</span>
        <span class="n">species_dir</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">species</span>
        <span class="n">model_parameters</span><span class="o">=</span><span class="s2">&quot;https://github.com/ParsaGhadermazi/Database/raw/main/ADToolbox/Modified_ADM/Modified_ADM_Model_Parameters.json&quot;</span>
        <span class="n">base_parameters</span><span class="o">=</span><span class="s2">&quot;https://github.com/ParsaGhadermazi/Database/raw/main/ADToolbox/Modified_ADM/Modified_ADM_Base_Parameters.json&quot;</span>
        <span class="n">initial_conditions</span><span class="o">=</span><span class="s2">&quot;https://github.com/ParsaGhadermazi/Database/raw/main/ADToolbox/Modified_ADM/Modified_ADM_Initial_Conditions.json&quot;</span>
        <span class="n">inlet_conditions</span><span class="o">=</span><span class="s2">&quot;https://github.com/ParsaGhadermazi/Database/raw/main/ADToolbox/Modified_ADM/Modified_ADM_Inlet_Conditions.json&quot;</span>
        <span class="n">reactions</span><span class="o">=</span><span class="s2">&quot;https://github.com/ParsaGhadermazi/Database/raw/main/ADToolbox/Modified_ADM/Modified_ADM_Reactions.json&quot;</span>
        <span class="n">species</span><span class="o">=</span><span class="s2">&quot;https://github.com/ParsaGhadermazi/Database/raw/main/ADToolbox/Modified_ADM/Modified_ADM_Species.json&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model_parameters</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">model_parameters_dir</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">base_parameters</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">base_parameters_dir</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">initial_conditions</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">initial_conditions_dir</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">inlet_conditions</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">inlet_conditions_dir</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reactions</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">reactions_dir</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">species_dir</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>



    <span class="k">def</span> <span class="nf">download_seed_databases</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span> <span class="p">:</span>
        <span class="s2">&quot;Download the modelseed rection database&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">seed_rxn_url</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reaction_db</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">download_protein_database</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db_url</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">download_reaction_database</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">adtoolbox_rxn_db_url</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">csv_reaction_db</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">download_feed_database</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db_url</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">download_qiime_classifier_db</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db_url</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">block_size</span> <span class="o">=</span> <span class="mi">1024</span>
        <span class="n">total_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content-length&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">Progress</span><span class="p">()</span> <span class="k">as</span> <span class="n">progress</span><span class="p">:</span>
                <span class="n">task</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="s2">&quot;Downloading the qiime&#39;s classifier database...&quot;</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="n">total_size</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">block_size</span><span class="p">):</span>
                    <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[bold green]Download finished[/bold green]&quot;</span><span class="p">)</span>





    <span class="c1"># def download_escher_files(self)-&gt; None:</span>
    <span class="c1">#     for i in self.config.escher_files_urls:</span>
    <span class="c1">#         r = requests.get(i, allow_redirects=True)</span>
    <span class="c1">#         with open(os.path.join(self.config.,i.split(&quot;/&quot;)[-1]), &#39;wb&#39;) as f:</span>
    <span class="c1">#             f.write(r.content)</span>

    <span class="k">def</span> <span class="nf">get_metagenomics_studies</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function will return accession numbers in all metagenomics studies on the kbase.</span>
<span class="sd">        Requires:</span>
<span class="sd">            &lt;R&gt;Configs.Database&lt;/R&gt;</span>
<span class="sd">        Satisfies:</span>
<span class="sd">            &lt;S&gt;project_accession&lt;/S&gt;</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">metagenomics_studies</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">kbase_db</span><span class="o">.</span><span class="n">metagenomics_studies</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;ᚢ&quot;</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span><span class="n">engine</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>

            <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;[bold red]KBase Database is not found. Please download/build/configure the database first.[/bold red]&quot;</span><span class="p">)</span>


        <span class="k">return</span> <span class="n">metagenomics_studies</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;list&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_experimental_data_studies</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function will download the kbase database from the remote repository.</span>
<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">kbase_db</span><span class="o">.</span><span class="n">urls</span><span class="p">[</span><span class="s1">&#39;metagenomics_studies&#39;</span><span class="p">],</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">kbase_db</span><span class="o">.</span><span class="n">base_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">kbase_db</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">kbase_db</span><span class="o">.</span><span class="n">metagenomics_studies</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[bold green]Downloaded </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">kbase_db</span><span class="o">.</span><span class="n">urls</span><span class="p">[</span><span class="s1">&#39;metagenomics_studies&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">[/bold green]&quot;</span><span class="p">)</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">kbase_db</span><span class="o">.</span><span class="n">urls</span><span class="p">[</span><span class="s1">&#39;exmpermental_data_references&#39;</span><span class="p">],</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">kbase_db</span><span class="o">.</span><span class="n">experimental_data_references</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

        <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[bold green]Downloaded </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">kbase_db</span><span class="o">.</span><span class="n">urls</span><span class="p">[</span><span class="s1">&#39;exmpermental_data_references&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">[/bold green]&quot;</span><span class="p">)</span>  

    <span class="k">def</span> <span class="nf">download_all_databases</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function will download all the required databases for the ADToolbox.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">base_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">base_dir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_seed_databases</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_protein_database</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_reaction_database</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_feed_database</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_kbase_database</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.add_feedstock_to_database_from_file" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_feedstock_to_database_from_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Adds a feedstock to the feedstock database from a csv file.
A Feed Stock spreadsheet must be a table with the following columns:
"Name", "TS", "TSS", "Lipids", "Proteins", "Carbohydrates", "PI", "SI", "Notes"
File_Path does not come with a default path, since it is advised to not populate the
project directory with feedstock spreadsheets unwanted.</p>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_feedstock_to_database_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Adds a feedstock to the feedstock database from a csv file.</span>
<span class="sd">    A Feed Stock spreadsheet must be a table with the following columns:</span>
<span class="sd">    &quot;Name&quot;, &quot;TS&quot;, &quot;TSS&quot;, &quot;Lipids&quot;, &quot;Proteins&quot;, &quot;Carbohydrates&quot;, &quot;PI&quot;, &quot;SI&quot;, &quot;Notes&quot;</span>
<span class="sd">    File_Path does not come with a default path, since it is advised to not populate the</span>
<span class="sd">    project directory with feedstock spreadsheets unwanted.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">f</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;File not found!&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">counter</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="n">feedstock</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_feedstock_to_database</span><span class="p">(</span><span class="n">feedstock</span><span class="p">)</span>
        <span class="n">counter</span><span class="o">+=</span><span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> Feedstocks added to the database!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.cazy_ec" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cazy_ec</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Scraps the ec numbers from links of the Cazy website.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>list</code></td>          <td>
          </td>
          <td><p>A list of ec numbers.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cazy_ec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Scraps the ec numbers from links of the Cazy website.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of ec numbers.</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">ec_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">Database</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">cazy_links</span><span class="p">:</span>

        <span class="n">page</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
        <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s2">&quot;cadre_principal&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span>
            <span class="s2">&quot;th&quot;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s2">&quot;thec&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ec_number</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;-&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ec_number</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">ec_number</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>

                <span class="n">ec_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ec_number</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ec numbers extracted from Cazy website!&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ec_list</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.download_adm1_parameters" class="doc doc-heading">
<code class="highlight language-python"><span class="n">download_adm1_parameters</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Downloads the parameters needed for running ADM models in ADToolbox</p>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">download_adm1_parameters</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Downloads the parameters needed for running ADM models in ADToolbox</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">base_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">base_dir</span><span class="p">)</span>
    <span class="n">model_parameters_dir</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">model_parameters</span>
    <span class="n">base_parameters_dir</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">base_parameters</span>
    <span class="n">initial_conditions_dir</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">initial_conditions</span>
    <span class="n">inlet_conditions_dir</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">inlet_conditions</span>
    <span class="n">reactions_dir</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">reactions</span>
    <span class="n">species_dir</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">species</span>
    <span class="n">model_parameters</span><span class="o">=</span><span class="s2">&quot;https://github.com/ParsaGhadermazi/Database/raw/main/ADToolbox/ADM1/ADM1_Model_Parameters.json&quot;</span>
    <span class="n">base_parameters</span><span class="o">=</span><span class="s2">&quot;https://github.com/ParsaGhadermazi/Database/raw/main/ADToolbox/ADM1/ADM1_Base_Parameters.json&quot;</span>
    <span class="n">initial_conditions</span><span class="o">=</span><span class="s2">&quot;https://github.com/ParsaGhadermazi/Database/blob/main/ADToolbox/ADM1/ADM1_Initial_Conditions.json&quot;</span>
    <span class="n">inlet_conditions</span><span class="o">=</span><span class="s2">&quot;https://github.com/ParsaGhadermazi/Database/raw/main/ADToolbox/ADM1/ADM1_Inlet_Conditions.json&quot;</span>
    <span class="n">reactions</span><span class="o">=</span><span class="s2">&quot;https://github.com/ParsaGhadermazi/Database/raw/main/ADToolbox/ADM1/ADM1_Reactions.json&quot;</span>
    <span class="n">species</span><span class="o">=</span><span class="s2">&quot;https://github.com/ParsaGhadermazi/Database/raw/main/ADToolbox/ADM1/ADM1_Species.json&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model_parameters</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">model_parameters_dir</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">base_parameters</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">base_parameters_dir</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">initial_conditions</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">initial_conditions_dir</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">inlet_conditions</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">inlet_conditions_dir</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reactions</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">reactions_dir</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">species_dir</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.download_all_databases" class="doc doc-heading">
<code class="highlight language-python"><span class="n">download_all_databases</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function will download all the required databases for the ADToolbox.</p>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_all_databases</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function will download all the required databases for the ADToolbox.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">base_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">base_dir</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">download_seed_databases</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">download_protein_database</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">download_reaction_database</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">download_feed_database</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">download_kbase_database</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.download_modified_adm_parameters" class="doc doc-heading">
<code class="highlight language-python"><span class="n">download_modified_adm_parameters</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Downloads the parameters needed for running ADM models in ADToolbox</p>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">download_modified_adm_parameters</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>    
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Downloads the parameters needed for running ADM models in ADToolbox</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">base_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">base_dir</span><span class="p">)</span>
    <span class="n">model_parameters_dir</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">model_parameters</span>
    <span class="n">base_parameters_dir</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">base_parameters</span>
    <span class="n">initial_conditions_dir</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">initial_conditions</span>
    <span class="n">inlet_conditions_dir</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">inlet_conditions</span>
    <span class="n">reactions_dir</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">reactions</span>
    <span class="n">species_dir</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">species</span>
    <span class="n">model_parameters</span><span class="o">=</span><span class="s2">&quot;https://github.com/ParsaGhadermazi/Database/raw/main/ADToolbox/Modified_ADM/Modified_ADM_Model_Parameters.json&quot;</span>
    <span class="n">base_parameters</span><span class="o">=</span><span class="s2">&quot;https://github.com/ParsaGhadermazi/Database/raw/main/ADToolbox/Modified_ADM/Modified_ADM_Base_Parameters.json&quot;</span>
    <span class="n">initial_conditions</span><span class="o">=</span><span class="s2">&quot;https://github.com/ParsaGhadermazi/Database/raw/main/ADToolbox/Modified_ADM/Modified_ADM_Initial_Conditions.json&quot;</span>
    <span class="n">inlet_conditions</span><span class="o">=</span><span class="s2">&quot;https://github.com/ParsaGhadermazi/Database/raw/main/ADToolbox/Modified_ADM/Modified_ADM_Inlet_Conditions.json&quot;</span>
    <span class="n">reactions</span><span class="o">=</span><span class="s2">&quot;https://github.com/ParsaGhadermazi/Database/raw/main/ADToolbox/Modified_ADM/Modified_ADM_Reactions.json&quot;</span>
    <span class="n">species</span><span class="o">=</span><span class="s2">&quot;https://github.com/ParsaGhadermazi/Database/raw/main/ADToolbox/Modified_ADM/Modified_ADM_Species.json&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model_parameters</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">model_parameters_dir</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">base_parameters</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">base_parameters_dir</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">initial_conditions</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">initial_conditions_dir</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">inlet_conditions</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">inlet_conditions_dir</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reactions</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">reactions_dir</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">species_dir</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.download_seed_databases" class="doc doc-heading">
<code class="highlight language-python"><span class="n">download_seed_databases</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Download the modelseed rection database</p>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_seed_databases</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span> <span class="p">:</span>
    <span class="s2">&quot;Download the modelseed rection database&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">seed_rxn_url</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reaction_db</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.ec_from_csv" class="doc doc-heading">
<code class="highlight language-python"><span class="n">ec_from_csv</span><span class="p">(</span><span class="n">csv_file</span><span class="p">,</span> <span class="n">Sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function reads a csv file and returns a list of ec numbers. The csv file should have a column named "EC_Numbers" and the delimiter 
that is used in in your file should be defined as an argument.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>csv_file</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The path to the csv file.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Sep</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The delimiter used in the csv file. Defaults to ','.</p></td>
          <td>
                <code>&#39;,&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>list</code></td>          <td>
                <code>list</code>
          </td>
          <td><p>A cleaned list of ec numbers.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">ec_from_csv</span><span class="p">(</span><span class="n">csv_file</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">list</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;This function reads a csv file and returns a list of ec numbers. The csv file should have a column named &quot;EC_Numbers&quot; and the delimiter </span>
<span class="sd">    that is used in in your file should be defined as an argument.</span>

<span class="sd">    Args:</span>
<span class="sd">        csv_file (str): The path to the csv file.</span>
<span class="sd">        Sep (str, optional): The delimiter used in the csv file. Defaults to &#39;,&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A cleaned list of ec numbers.&quot;&quot;&quot;</span>


    <span class="k">try</span><span class="p">:</span>

        <span class="n">ec_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">csv_file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">Sep</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;str&quot;</span><span class="p">)</span>
        <span class="n">ec_list</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ec_list</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s2">&quot;EC_Numbers&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">output_ec_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ec_list</span><span class="p">[</span><span class="s2">&quot;EC_Numbers&quot;</span><span class="p">])</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span>
            <span class="n">output_ec_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;The ec list is empty; Check the file&quot;</span>

    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CSV file not found&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">ParserError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>

        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;CSV file not in the correct format; Check the delimiter and column names!&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">output_ec_list</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.filter_seed_from_ec" class="doc doc-heading">
<code class="highlight language-python"><span class="n">filter_seed_from_ec</span><span class="p">(</span><span class="n">ec_list</span><span class="p">,</span> <span class="n">reaction_db</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">()</span><span class="o">.</span><span class="n">reaction_db</span><span class="p">,</span> <span class="n">compound_db</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">()</span><span class="o">.</span><span class="n">compound_db</span><span class="p">,</span> <span class="n">local_reaction_db</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">()</span><span class="o">.</span><span class="n">local_reaction_db</span><span class="p">,</span> <span class="n">local_compound_db</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">()</span><span class="o">.</span><span class="n">local_compound_db</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function takes a list of ec numbers Generates a mini-seed JSON files. This is supposed to
make the code a lot faster, but makes no difference in terms of outputs, and won't probably need
frequent updates.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>ec_list</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>The list of EC numbers that you want the mini seed database to include.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>reaction_db</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The path to the main model seed reaction database. Defaults to configs.Database().reaction_db.</p></td>
          <td>
                <code>configs.Database().reaction_db</code>
          </td>
        </tr>
        <tr>
          <td><code>compound_db</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The path to the main model seed compound database. Defaults to configs.Database().compound_db.</p></td>
          <td>
                <code>configs.Database().compound_db</code>
          </td>
        </tr>
        <tr>
          <td><code>local_reaction_db</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Path to where you want the mini seed reaction database to be saved. Defaults to configs.Database().local_reaction_db.</p></td>
          <td>
                <code>configs.Database().local_reaction_db</code>
          </td>
        </tr>
        <tr>
          <td><code>local_compound_db</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Path to where you want the mini seed compound database to be saved. Defaults to configs.Database().local_compound_db.</p></td>
          <td>
                <code>configs.Database().local_compound_db</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>tuple</code></td>          <td>
                <code>tuple</code>
          </td>
          <td><p>A tuple containing the mini seed reaction database and the mini seed compound database.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">filter_seed_from_ec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ec_list</span><span class="p">,</span>
                        <span class="n">reaction_db</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">()</span><span class="o">.</span><span class="n">reaction_db</span><span class="p">,</span>
                        <span class="n">compound_db</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">()</span><span class="o">.</span><span class="n">compound_db</span><span class="p">,</span>
                        <span class="n">local_reaction_db</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">()</span><span class="o">.</span><span class="n">local_reaction_db</span><span class="p">,</span>
                        <span class="n">local_compound_db</span><span class="o">=</span><span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">()</span><span class="o">.</span><span class="n">local_compound_db</span><span class="p">,</span>
                        <span class="n">save</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    This function takes a list of ec numbers Generates a mini-seed JSON files. This is supposed to</span>
<span class="sd">    make the code a lot faster, but makes no difference in terms of outputs, and won&#39;t probably need</span>
<span class="sd">    frequent updates.</span>

<span class="sd">    Args:</span>
<span class="sd">        ec_list (list): The list of EC numbers that you want the mini seed database to include.</span>
<span class="sd">        reaction_db (str, optional): The path to the main model seed reaction database. Defaults to configs.Database().reaction_db.</span>
<span class="sd">        compound_db (str, optional): The path to the main model seed compound database. Defaults to configs.Database().compound_db.</span>
<span class="sd">        local_reaction_db (str, optional): Path to where you want the mini seed reaction database to be saved. Defaults to configs.Database().local_reaction_db.</span>
<span class="sd">        local_compound_db (str, optional): Path to where you want the mini seed compound database to be saved. Defaults to configs.Database().local_compound_db.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing the mini seed reaction database and the mini seed compound database.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">## TODO: Make this function more efficient by using pandas an search using .str.contains. This would be way faster</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">reaction_db</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">main_reaction_db</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">compound_db</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">main_compound_db</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="n">cached_compounds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">local_rxn_db</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">local_comp_db</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ec</span> <span class="ow">in</span> <span class="n">track</span><span class="p">(</span><span class="n">ec_list</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Extracting the relevant reactions:&quot;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">rxn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">main_reaction_db</span><span class="p">):</span>
            <span class="k">if</span>  <span class="n">ec</span> <span class="ow">in</span> <span class="n">rxn</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;ec_numbers&#39;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">local_rxn_db</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rxn</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">Mets</span> <span class="ow">in</span> <span class="n">rxn</span><span class="p">[</span><span class="s2">&quot;compound_ids&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">Mets</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cached_compounds</span><span class="p">:</span>
                        <span class="n">cached_compounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Mets</span><span class="p">)</span>

    <span class="n">cached_compounds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">cached_compounds</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">compound</span> <span class="ow">in</span> <span class="n">track</span><span class="p">(</span><span class="n">cached_compounds</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Extracting the relevant compounds:&quot;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">Comp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">main_compound_db</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">compound</span> <span class="o">==</span> <span class="n">Comp</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]:</span>
                <span class="n">local_comp_db</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Comp</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_reaction_db</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">local_rxn_db</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_compound_db</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">local_comp_db</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">local_rxn_db</span><span class="p">,</span> <span class="n">local_comp_db</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.get_experimental_data_studies" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_experimental_data_studies</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function will download the kbase database from the remote repository.</p>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_experimental_data_studies</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function will download the kbase database from the remote repository.</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">kbase_db</span><span class="o">.</span><span class="n">urls</span><span class="p">[</span><span class="s1">&#39;metagenomics_studies&#39;</span><span class="p">],</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">kbase_db</span><span class="o">.</span><span class="n">base_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">kbase_db</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">kbase_db</span><span class="o">.</span><span class="n">metagenomics_studies</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[bold green]Downloaded </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">kbase_db</span><span class="o">.</span><span class="n">urls</span><span class="p">[</span><span class="s1">&#39;metagenomics_studies&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">[/bold green]&quot;</span><span class="p">)</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">kbase_db</span><span class="o">.</span><span class="n">urls</span><span class="p">[</span><span class="s1">&#39;exmpermental_data_references&#39;</span><span class="p">],</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">kbase_db</span><span class="o">.</span><span class="n">experimental_data_references</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

    <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[bold green]Downloaded </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">kbase_db</span><span class="o">.</span><span class="n">urls</span><span class="p">[</span><span class="s1">&#39;exmpermental_data_references&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">[/bold green]&quot;</span><span class="p">)</span>  
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.get_metagenomics_studies" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_metagenomics_studies</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function will return accession numbers in all metagenomics studies on the kbase.</p>

<details class="requires">
  <summary>Requires</summary>
  <p><R>Configs.Database</R></p>
</details>
<details class="satisfies">
  <summary>Satisfies</summary>
  <p><S>project_accession</S></p>
</details>
      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_metagenomics_studies</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function will return accession numbers in all metagenomics studies on the kbase.</span>
<span class="sd">    Requires:</span>
<span class="sd">        &lt;R&gt;Configs.Database&lt;/R&gt;</span>
<span class="sd">    Satisfies:</span>
<span class="sd">        &lt;S&gt;project_accession&lt;/S&gt;</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">metagenomics_studies</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">kbase_db</span><span class="o">.</span><span class="n">metagenomics_studies</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;ᚢ&quot;</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span><span class="n">engine</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>

        <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;[bold red]KBase Database is not found. Please download/build/configure the database first.[/bold red]&quot;</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">metagenomics_studies</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;list&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.init_feedstock_database" class="doc doc-heading">
<code class="highlight language-python"><span class="n">init_feedstock_database</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Makes an empty feedstock database json file.
BE CAREFUL: This will overwrite the current database file.</p>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">init_feedstock_database</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Makes an empty feedstock database json file.</span>
<span class="sd">    BE CAREFUL: This will overwrite the current database file.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">dec</span><span class="o">=</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Are you sure you want to create a new database? (y/n): &quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dec</span><span class="o">==</span><span class="s2">&quot;y&quot;</span><span class="p">:</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed_db</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">([],</span> <span class="n">f</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Aborting!&quot;</span><span class="p">)</span>
        <span class="k">return</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.instantiate_rxn_from_seed" class="doc doc-heading">
<code class="highlight language-python"><span class="n">instantiate_rxn_from_seed</span><span class="p">(</span><span class="n">seed_id_list</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function that idenifies reaction seed ID's and instantiates them in the Reaction class.</p>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">seed_id_List</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;rxn00002&#39;</span><span class="p">,</span><span class="s1">&#39;rxn00003&#39;</span><span class="p">,</span><span class="s1">&#39;rxn00005&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dbconfigs</span> <span class="o">=</span> <span class="n">configs</span><span class="o">.</span><span class="n">Database</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rxnlist</span> <span class="o">=</span> <span class="n">Database</span><span class="p">(</span><span class="n">dbconfigs</span><span class="p">)</span><span class="o">.</span><span class="n">Instantiate_Rxn_From_Seed</span><span class="p">(</span><span class="n">seed_id_List</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">rxnlist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">==</span><span class="n">Reaction</span>
</code></pre></div>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>seed_id_List</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>A list of relevant seed ID entries [rxn#####]</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>rxn_list</code></td>          <td>
                <code>list</code>
          </td>
          <td><p>A list including reaction instances in the database class for each seed ID in input list.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">instantiate_rxn_from_seed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">seed_id_list</span><span class="p">:</span><span class="nb">list</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function that idenifies reaction seed ID&#39;s and instantiates them in the Reaction class.</span>
<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; seed_id_List = [&#39;rxn00002&#39;,&#39;rxn00003&#39;,&#39;rxn00005&#39;]</span>
<span class="sd">        &gt;&gt;&gt; dbconfigs = configs.Database()</span>
<span class="sd">        &gt;&gt;&gt; rxnlist = Database(dbconfigs).Instantiate_Rxn_From_Seed(seed_id_List)</span>
<span class="sd">        &gt;&gt;&gt; assert type(rxnlist[0])==Reaction</span>

<span class="sd">    Args:</span>
<span class="sd">        seed_id_List (list): A list of relevant seed ID entries [rxn#####]</span>

<span class="sd">    Returns:</span>
<span class="sd">        rxn_list: A list including reaction instances in the database class for each seed ID in input list.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">## TODO: This function can be sped up by using pandas</span>

    <span class="n">rxn_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reaction_db</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">seed_id</span> <span class="ow">in</span> <span class="n">seed_id_list</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]:</span>

                    <span class="k">if</span> <span class="n">seed_id</span> <span class="ow">in</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]:</span>

                        <span class="n">rxn_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Reaction</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                        <span class="k">break</span>

    <span class="k">return</span> <span class="n">rxn_list</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.metadata_from_ec" class="doc doc-heading">
<code class="highlight language-python"><span class="n">metadata_from_ec</span><span class="p">(</span><span class="n">ec_list</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function returns a pandas dataframe containing relevant pathway and reactions for
each ec number input.</p>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">ec_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1.1.1.1&#39;</span><span class="p">,</span><span class="s1">&#39;1.1.1.2&#39;</span><span class="p">]</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="n">metadata</span><span class="o">=</span> <span class="n">Database</span><span class="p">()</span><span class="o">.</span><span class="n">Metadata_From_ec</span><span class="p">(</span><span class="n">ec_list</span><span class="p">)</span>
<span class="go">Finding ...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span><span class="o">==</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;ec_Numbers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span><span class="o">==</span><span class="nb">set</span><span class="p">(</span><span class="n">ec_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;ec_Numbers&quot;</span><span class="p">,</span> <span class="s2">&quot;seed_ids&quot;</span><span class="p">,</span><span class="s2">&quot;Reaction_Names&quot;</span><span class="p">,</span> <span class="s2">&quot;Pathways&quot;</span><span class="p">])</span><span class="o">==</span><span class="nb">set</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">metadata</span><span class="o">.</span><span class="n">shape</span><span class="o">==</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ec_list</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>
</code></pre></div>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>ec_list</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>A list of relevant ec numbers.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>pd.DataFrame: A pandas dataframe including reaction metadata or pathways for each ec number in list.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">metadata_from_ec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ec_list</span><span class="p">:</span><span class="nb">list</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function returns a pandas dataframe containing relevant pathway and reactions for</span>
<span class="sd">    each ec number input.</span>
<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; ec_list = [&#39;1.1.1.1&#39;,&#39;1.1.1.2&#39;] </span>
<span class="sd">        &gt;&gt;&gt; metadata= Database().Metadata_From_ec(ec_list) # doctest: +ELLIPSIS </span>
<span class="sd">        Finding ...</span>
<span class="sd">        &gt;&gt;&gt; assert type(metadata)==pd.DataFrame</span>
<span class="sd">        &gt;&gt;&gt; assert set(metadata[&#39;ec_Numbers&#39;].to_list())==set(ec_list)</span>
<span class="sd">        &gt;&gt;&gt; assert set([&quot;ec_Numbers&quot;, &quot;seed_ids&quot;,&quot;Reaction_Names&quot;, &quot;Pathways&quot;])==set(metadata.columns)</span>
<span class="sd">        &gt;&gt;&gt; assert metadata.shape==(len(ec_list),4)</span>

<span class="sd">    Args:</span>
<span class="sd">        ec_list (list): A list of relevant ec numbers.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: A pandas dataframe including reaction metadata or pathways for each ec number in list.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">full_table</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ec_Numbers&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;seed_ids&quot;</span><span class="p">:</span> <span class="p">[],</span>
                  <span class="s2">&quot;Reaction_Names&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;Pathways&quot;</span><span class="p">:</span> <span class="p">[]}</span>
    <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Finding ec Metadata ...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ec</span> <span class="ow">in</span> <span class="n">track</span><span class="p">(</span><span class="n">ec_list</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span> <span class="s2">&quot;Collecting Metadata for ec numbers&quot;</span><span class="p">):</span>
        <span class="n">seed_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_from_ec</span><span class="p">(</span><span class="n">ec</span><span class="p">,</span> <span class="n">Mode</span><span class="o">=</span><span class="s1">&#39;Multiple_Match&#39;</span><span class="p">)</span>
        <span class="n">full_table</span><span class="p">[</span><span class="s1">&#39;ec_Numbers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ec</span><span class="p">)</span>
        <span class="n">full_table</span><span class="p">[</span><span class="s1">&#39;seed_ids&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seed_id</span><span class="p">)</span>
        <span class="n">Temp_rxns</span> <span class="o">=</span> <span class="n">Database</span><span class="p">()</span><span class="o">.</span><span class="n">instantiate_rxn_from_seed</span><span class="p">(</span><span class="n">seed_id</span><span class="p">)</span>
        <span class="n">Temp_rxn_Names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">([</span><span class="n">reaction</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                               <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="n">Temp_rxns</span><span class="p">])</span>
        <span class="n">Temp_rxn_Path</span> <span class="o">=</span> <span class="nb">list</span><span class="p">([</span><span class="n">reaction</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s2">&quot;pathways&quot;</span><span class="p">]</span>
                              <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="n">Temp_rxns</span><span class="p">])</span>
        <span class="n">full_table</span><span class="p">[</span><span class="s2">&quot;Pathways&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Temp_rxn_Path</span><span class="p">)</span>
        <span class="n">full_table</span><span class="p">[</span><span class="s2">&quot;Reaction_Names&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Temp_rxn_Names</span><span class="p">)</span>

    <span class="n">full_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">full_table</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">full_table</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.protein_db_from_ec" class="doc doc-heading">
<code class="highlight language-python"><span class="n">protein_db_from_ec</span><span class="p">(</span><span class="n">ec_list</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function takes a list of EC numbers and fetches the protein sequences mapped to those EC numbers from Uniprot.
The protein sequences are then written to the protein database file.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>ec_list</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>A list of EC numbers.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>mode</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The mode in which the protein database file is opened. Defaults to "a".</p></td>
          <td>
                <code>&#39;a&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>
      <p>Returns: 
    dict: A dictionary containing the protein sequences mapped to the EC numbers.</p>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">protein_db_from_ec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ec_list</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span><span class="n">mode</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This function takes a list of EC numbers and fetches the protein sequences mapped to those EC numbers from Uniprot.</span>
<span class="sd">    The protein sequences are then written to the protein database file.</span>

<span class="sd">    Args:</span>
<span class="sd">        ec_list (list): A list of EC numbers.</span>
<span class="sd">        mode (str, optional): The mode in which the protein database file is opened. Defaults to &quot;a&quot;.</span>

<span class="sd">    Returns: </span>
<span class="sd">        dict: A dictionary containing the protein sequences mapped to the EC numbers.&quot;&quot;&quot;</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
    <span class="n">retry</span> <span class="o">=</span> <span class="n">Retry</span><span class="p">(</span><span class="n">connect</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">backoff_factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">adapter</span> <span class="o">=</span> <span class="n">HTTPAdapter</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="n">retry</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s1">&#39;http://&#39;</span><span class="p">,</span> <span class="n">adapter</span><span class="p">)</span>

    <span class="n">protein_seqs</span><span class="o">=</span><span class="p">{}</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ec</span> <span class="ow">in</span> <span class="n">track</span><span class="p">(</span><span class="n">ec_list</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Writing the protein database:&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">file</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;https://rest.uniprot.org/uniprotkb/stream?format=fasta&amp;query=%28%28ec%3A</span><span class="si">{</span><span class="n">ec</span><span class="si">}</span><span class="s2">%29%20AND%20%28reviewed%3Atrue%29%20NOT%20%28taxonomy_id%3A2759%29%29&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

            <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="ow">or</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span><span class="p">:</span>

                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Request Error! Trying again ...&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
                <span class="n">file</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;https://rest.uniprot.org/uniprotkb/stream?format=fasta&amp;query=%28%28ec%3A</span><span class="si">{</span><span class="n">ec</span><span class="si">}</span><span class="s2">%29%20AND%20%28reviewed%3Atrue%29%20NOT%20%28taxonomy_id%3A2759%29%29&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
            <span class="c1"># This alsp does a sanity check</span>

            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Something went wrong!&#39;</span><span class="p">)</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">text</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">):</span>
                    <span class="n">uniprot</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&gt;</span><span class="si">{</span><span class="n">uniprot</span><span class="si">}</span><span class="s1">|</span><span class="si">{</span><span class="n">ec</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">protein_seqs</span><span class="p">[</span><span class="n">uniprot</span><span class="p">]</span><span class="o">=</span><span class="n">line</span>

    <span class="k">return</span> <span class="n">protein_seqs</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Database.seed_from_ec" class="doc doc-heading">
<code class="highlight language-python"><span class="n">seed_from_ec</span><span class="p">(</span><span class="n">ec_Number</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;single_match&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Given EC number, this function returns the corresponding Seed IDs from the SEED reaction database.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>ec_Number</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The EC number.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>mode</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The mode in which the function should run. Defaults to 'single_match'. You can choose between 'single_match' and 'Multiple_Match'.</p></td>
          <td>
                <code>&#39;single_match&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>list</code></td>          <td>
                <code>list</code>
          </td>
          <td><p>A list of Seed IDs.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">seed_from_ec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ec_Number</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;single_match&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Given EC number, this function returns the corresponding Seed IDs from the SEED reaction database.</span>

<span class="sd">    Args:</span>
<span class="sd">        ec_Number (str): The EC number.</span>
<span class="sd">        mode (str, optional): The mode in which the function should run. Defaults to &#39;single_match&#39;. You can choose between &#39;single_match&#39; and &#39;Multiple_Match&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of Seed IDs.&quot;&quot;&quot;</span>

    <span class="c1">##TODO This function can use pandas to speed up the process</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reaction_db</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> 

        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;single_match&#39;</span><span class="p">:</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;ec_numbers&#39;</span><span class="p">]:</span>

                <span class="k">if</span> <span class="n">ec_Number</span> <span class="ow">in</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;ec_numbers&#39;</span><span class="p">]:</span>

                    <span class="k">return</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]]</span>

    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;Multiple_Match&#39;</span><span class="p">:</span>

        <span class="n">matched_rxn</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">([</span>

            <span class="n">rxn</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">rxn</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">if</span> <span class="n">rxn</span><span class="p">[</span><span class="s1">&#39;ec_numbers&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="n">ec_Number</span><span class="p">]])))</span>

        <span class="k">return</span> <span class="n">matched_rxn</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mode not recognized!&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h3 id="7-metagenomics">7. Metagenomics</h3>
<p>Here is a schematic view of core.Metagenomics API:</p>
<p><img alt="schema" src="../Metagenomics.svg" /></p>


<div class="doc doc-object doc-class">


<a id="adtoolbox.core.Metagenomics"></a>
  <div class="doc doc-contents first">

  
      <p>A Core class that handles the metganomics data
Init this with a Metagenomics class of config module</p>
<p>It takes three diferent types of input:</p>
<p>1- QIIMEII Outputs -&gt; Refer to the documentation for the required files and format
2- Shotgun Short reads -&gt; Refer to the documentation for the required files and format
3- MAGs -&gt; Refer to the documentation for the required files and format</p>
<p>This class will use other classes to generate the required files for downstream analysis.</p>


        <details class="quote">
          <summary>Source code in <code>adtoolbox/core.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Metagenomics</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Core class that handles the metganomics data</span>
<span class="sd">    Init this with a Metagenomics class of config module</span>



<span class="sd">    It takes three diferent types of input:</span>


<span class="sd">    1- QIIMEII Outputs -&gt; Refer to the documentation for the required files and format</span>
<span class="sd">    2- Shotgun Short reads -&gt; Refer to the documentation for the required files and format</span>
<span class="sd">    3- MAGs -&gt; Refer to the documentation for the required files and format</span>

<span class="sd">    This class will use other classes to generate the required files for downstream analysis.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">config</span><span class="p">:</span><span class="n">configs</span><span class="o">.</span><span class="n">Metagenomics</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">=</span><span class="n">config</span>

    <span class="k">def</span> <span class="nf">get_requirements_a2g</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function will automatically download the required files for Amplicon to Genome functionality.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_db</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_db</span><span class="p">)</span>

        <span class="n">url</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Version&#39;</span><span class="p">:</span> <span class="s1">&#39;https://data.ace.uq.edu.au/public/gtdb/data/releases/latest/VERSION&#39;</span><span class="p">,</span>
               <span class="s1">&#39;MD5SUM&#39;</span><span class="p">:</span> <span class="s1">&#39;https://data.ace.uq.edu.au/public/gtdb/data/releases/latest/MD5SUM&#39;</span><span class="p">,</span>
               <span class="s1">&#39;FILE_DESCRIPTIONS&#39;</span><span class="p">:</span> <span class="s1">&#39;https://data.ace.uq.edu.au/public/gtdb/data/releases/latest/FILE_DESCRIPTIONS&#39;</span><span class="p">,</span>
               <span class="s1">&#39;metadata_field_desc&#39;</span><span class="p">:</span> <span class="s1">&#39;https://data.ace.uq.edu.au/public/gtdb/data/releases/latest/auxillary_files/metadata_field_desc.tsv&#39;</span><span class="p">,</span>
               <span class="s1">&#39;bac120_metadata&#39;</span><span class="p">:</span> <span class="s1">&#39;https://data.ace.uq.edu.au/public/gtdb/data/releases/latest/bac120_metadata.tar.gz&#39;</span><span class="p">,</span>
               <span class="s1">&#39;bac120_ssu&#39;</span><span class="p">:</span> <span class="s1">&#39;https://data.ace.uq.edu.au/public/gtdb/data/releases/latest/genomic_files_reps/bac120_ssu_reps.tar.gz&#39;</span>
               <span class="p">}</span>
        <span class="k">if</span> <span class="n">progress</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Version&#39;</span><span class="p">,</span> <span class="s1">&#39;MD5SUM&#39;</span><span class="p">,</span> <span class="s1">&#39;FILE_DESCRIPTIONS&#39;</span><span class="p">]:</span>
                <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="n">keys</span><span class="p">],</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">progress</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
                    <span class="n">total_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content-length&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                    <span class="n">block_size</span> <span class="o">=</span> <span class="mi">1024</span>
                    <span class="k">with</span> <span class="n">Progress</span><span class="p">()</span> <span class="k">as</span> <span class="n">progress</span><span class="p">:</span>
                        <span class="n">task1</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="s2">&quot;Downloading &quot;</span> <span class="o">+</span> <span class="n">keys</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="n">total_size</span><span class="p">)</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_db</span><span class="p">,</span> <span class="n">keys</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">block_size</span><span class="p">):</span>
                                <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">task1</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
                                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="s1">&#39;metadata_field_desc&#39;</span><span class="p">],</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">progress</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
                <span class="n">total_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content-length&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                <span class="n">block_size</span> <span class="o">=</span> <span class="mi">1024</span>
                <span class="k">with</span> <span class="n">Progress</span><span class="p">()</span> <span class="k">as</span> <span class="n">progress</span><span class="p">:</span>
                    <span class="n">task1</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="s2">&quot;Downloading metadata_field_desc.tsv&quot;</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="n">total_size</span><span class="p">)</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_db</span><span class="p">,</span> <span class="s1">&#39;metadata_field_desc.tsv&#39;</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">block_size</span><span class="p">):</span>
                            <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">task1</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;bac120_metadata&#39;</span><span class="p">,</span> <span class="s1">&#39;bac120_ssu&#39;</span><span class="p">]:</span>
                <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="n">keys</span><span class="p">],</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">progress</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
                    <span class="n">total_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content-length&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                    <span class="n">block_size</span> <span class="o">=</span> <span class="mi">1024</span>
                    <span class="k">with</span> <span class="n">Progress</span><span class="p">()</span> <span class="k">as</span> <span class="n">progress</span><span class="p">:</span>
                        <span class="n">task1</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="s2">&quot;Downloading &quot;</span> <span class="o">+</span> <span class="n">keys</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="n">total_size</span><span class="p">)</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_db</span><span class="p">,</span> <span class="n">keys</span><span class="o">+</span><span class="s1">&#39;.tar.gz&#39;</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">block_size</span><span class="p">):</span>
                                <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">task1</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
                                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Version&#39;</span><span class="p">,</span> <span class="s1">&#39;MD5SUM&#39;</span><span class="p">,</span> <span class="s1">&#39;FILE_DESCRIPTIONS&#39;</span><span class="p">]:</span>
                <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="n">keys</span><span class="p">],</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">progress</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_db</span><span class="p">,</span> <span class="n">keys</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="s1">&#39;metadata_field_desc&#39;</span><span class="p">],</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">progress</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_db</span><span class="p">,</span> <span class="s1">&#39;metadata_field_desc.tsv&#39;</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;bac120_metadata&#39;</span><span class="p">,</span> <span class="s1">&#39;bac120_ssu&#39;</span><span class="p">]:</span>
                <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="n">keys</span><span class="p">],</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">progress</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_db</span><span class="p">,</span> <span class="n">keys</span><span class="o">+</span><span class="s1">&#39;.tar.gz&#39;</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">find_top_k_repseqs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">sample_names</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span><span class="kc">None</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span>
                            <span class="p">,</span><span class="n">save</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">:</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function takes three inputs from qiime:</span>
<span class="sd">        1. feature table: This is the abundance of each feature in each sample (TSV).</span>
<span class="sd">        2. taxonomy table: This is the taxonomy of each feature (TSV). </span>
<span class="sd">        3. rep seqs: This is the representative sequence of each feature (fasta).</span>
<span class="sd">        It then finds the top k features for each sample and then finds the genomes for each feature (if there is one).</span>
<span class="sd">        It then returns a dictionary of the genomes for the sample(s) along with the NCBI name and the</span>
<span class="sd">        address where they are stored.</span>

<span class="sd">        Requires:</span>

<span class="sd">        Satisfies:</span>

<span class="sd">        Args:</span>
<span class="sd">            sample_name (str, optional): The name of the sample. Defaults to None.</span>
<span class="sd">            if None, it will find top k genomes for all samples.</span>
<span class="sd">            save (bool, optional): Whether to save the top k repseqs. Defaults to True. If true it saves three files:</span>
<span class="sd">            1. top_k_repseqs.fasta: this is the fasta file of the top k repseqs. The header is the feature id and the sequence is the </span>
<span class="sd">            representative sequence.</span>
<span class="sd">            2. top_featureids: This is a table that has the feature ids for the top k features for each sample.</span>
<span class="sd">            3. top_k_taxa: This is a table that has the taxonomy identifier for the top k features for each sample.</span>


<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary has all top_repseqs, top_featureids, and top_k_taxa. You can access them with the corresponding keys. </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">feature_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feature_table_dir</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">taxonomy_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">taxonomy_table_dir</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">repseqs</span><span class="o">=</span><span class="n">fasta_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">rep_seq_fasta</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sample_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">feature_table</span> <span class="o">=</span> <span class="n">feature_table</span><span class="p">[</span><span class="n">sample_names</span><span class="p">]</span>

        <span class="n">top_featureids</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">top_repseqs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">top_k_taxa</span> <span class="o">=</span> <span class="p">{}</span>


        <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">feature_table</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">top_featureids</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">feature_table</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
                <span class="n">sample</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;#OTU ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">k</span><span class="p">))</span>
            <span class="n">top_k_taxa</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">taxonomy_table</span><span class="p">[</span><span class="n">taxonomy_table</span><span class="p">[</span><span class="s2">&quot;Feature ID&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">feature</span><span class="p">][</span><span class="s2">&quot;Taxon&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">top_featureids</span><span class="p">[</span><span class="n">sample</span><span class="p">]]</span>
            <span class="n">top_repseqs</span> <span class="o">|=</span> <span class="p">{</span><span class="n">feature</span><span class="p">:</span><span class="n">repseqs</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">top_featureids</span><span class="p">[</span><span class="n">sample</span><span class="p">]}</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">top_featureids</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_outputs_dir</span><span class="p">,</span><span class="s1">&#39;Top_k_FeatureIDs.csv&#39;</span><span class="p">))</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">top_k_taxa</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_outputs_dir</span><span class="p">,</span><span class="s1">&#39;Top_k_Taxa.csv&#39;</span><span class="p">))</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_top_repseq_dir</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">top_repseqs</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="o">+</span><span class="n">feature</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">top_repseqs</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>                

        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;top_featureids&#39;</span><span class="p">:</span><span class="n">top_featureids</span><span class="p">,</span><span class="s1">&#39;top_k_taxa&#39;</span><span class="p">:</span><span class="n">top_k_taxa</span><span class="p">,</span><span class="s1">&#39;top_repseqs&#39;</span><span class="p">:</span><span class="n">top_repseqs</span><span class="p">}</span>



    <span class="k">def</span> <span class="nf">align_to_gtdb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">run</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">save</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">container</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function takes the representative sequences of the top k features and generates the script to</span>
<span class="sd">        align these feature sequences to gtdb using VSEARCH. If you intend to run this you either</span>
<span class="sd">        need to have VSEARCH installed or run it with a container option. You can use either the docker or singularity</span>
<span class="sd">        as container options. Otherwise you can use None and run it with the assumption that VSEARCH is installed.</span>
<span class="sd">        If you only want the script and not to run it, set run to False.</span>

<span class="sd">        Requires:</span>

<span class="sd">        Satisfies:</span>

<span class="sd">        Args:</span>
<span class="sd">            run (bool, optional): Whether to run the script. Defaults to True.</span>
<span class="sd">            save (bool, optional): Whether to save the script. Defaults to True.</span>
<span class="sd">            container (str, optional): The container to use. Defaults to &quot;None&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The script that was run or supposed to be running later.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">alignment_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_outputs_dir</span><span class="p">,</span><span class="s1">&#39;Alignments&#39;</span><span class="p">)</span>
        <span class="n">match_table</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_outputs_dir</span><span class="p">,</span><span class="s1">&#39;matches.blast&#39;</span><span class="p">)</span>
        <span class="n">gtdb_dir_fasta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">gtdb_dir_fasta</span>
        <span class="n">query</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_top_repseq_dir</span>
        <span class="n">dirs</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_outputs_dir</span><span class="p">,</span>
            <span class="n">gtdb_dir_fasta</span><span class="p">,</span>
            <span class="n">query</span>
            <span class="p">]</span>
        <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;None&quot;</span><span class="p">:</span>

            <span class="n">bash_script</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;#!/bin/bash</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="s1">&#39;vsearch --top_hits_only --blast6out &#39;</span><span class="o">+</span>
                        <span class="n">match_table</span><span class="o">+</span>
                        <span class="s1">&#39; --usearch_global &#39;</span><span class="o">+</span> <span class="n">query</span> <span class="o">+</span>
                        <span class="s1">&#39; --db &#39;</span><span class="o">+</span> <span class="n">gtdb_dir_fasta</span> <span class="o">+</span>
                        <span class="s1">&#39; --id &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_similarity</span><span class="p">)</span> <span class="o">+</span>
                        <span class="s1">&#39; --threads &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">vsearch_threads</span><span class="p">)</span><span class="o">+</span>
                        <span class="s1">&#39; --alnout &#39;</span><span class="o">+</span> <span class="n">alignment_dir</span> <span class="o">+</span>
                        <span class="s1">&#39; --top_hits_only&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;docker&quot;</span><span class="p">:</span>
            <span class="n">bash_script</span><span class="o">=</span><span class="s2">&quot;#!/bin/bash</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span><span class="s1">&#39;docker run -it &#39;</span>
            <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
                <span class="n">bash_script</span><span class="o">+=</span><span class="p">(</span><span class="s1">&#39;-v &#39;</span><span class="o">+</span><span class="nb">dir</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="nb">dir</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

            <span class="n">bash_script</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_docker</span><span class="o">+</span><span class="s1">&#39; vsearch --top_hits_only --blast6out &#39;</span><span class="o">+</span>
                        <span class="n">match_table</span><span class="o">+</span>
                        <span class="s1">&#39; --usearch_global &#39;</span><span class="o">+</span> <span class="n">query</span> <span class="o">+</span>
                        <span class="s1">&#39; --db &#39;</span><span class="o">+</span> <span class="n">gtdb_dir_fasta</span> <span class="o">+</span>
                        <span class="s1">&#39; --id &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_similarity</span><span class="p">)</span> <span class="o">+</span>
                        <span class="s1">&#39; --threads &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">vsearch_threads</span><span class="p">)</span><span class="o">+</span>
                        <span class="s1">&#39; --alnout &#39;</span><span class="o">+</span> <span class="n">alignment_dir</span> <span class="o">+</span>
                        <span class="s1">&#39; --top_hits_only&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;singularity&quot;</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Singularity is not fully supported yet&quot;</span><span class="p">)</span>
            <span class="n">bash_script</span><span class="o">=</span><span class="s2">&quot;#!/bin/bash</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span><span class="s1">&#39;singularity run &#39;</span>
            <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
                <span class="n">bash_script</span><span class="o">+=</span><span class="p">(</span><span class="s1">&#39;-B &#39;</span><span class="o">+</span><span class="nb">dir</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="nb">dir</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

            <span class="n">bash_script</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_singularity</span><span class="o">+</span><span class="s1">&#39; vsearch --top_hits_only --blast6out &#39;</span><span class="o">+</span>
                        <span class="n">match_table</span><span class="o">+</span>
                        <span class="s1">&#39; --usearch_global &#39;</span><span class="o">+</span> <span class="n">query</span> <span class="o">+</span>
                        <span class="s1">&#39; --db &#39;</span><span class="o">+</span> <span class="n">gtdb_dir_fasta</span> <span class="o">+</span>
                        <span class="s1">&#39; --id &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_similarity</span><span class="p">)</span> <span class="o">+</span>
                        <span class="s1">&#39; --threads &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">vsearch_threads</span><span class="p">)</span><span class="o">+</span>
                        <span class="s1">&#39; --alnout &#39;</span><span class="o">+</span> <span class="n">alignment_dir</span> <span class="o">+</span>
                        <span class="s1">&#39; --top_hits_only&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>



        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">vsearch_script_dir</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">bash_script</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">run</span><span class="p">:</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">bash_script</span><span class="p">,</span><span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">bash_script</span>

    <span class="k">def</span> <span class="nf">get_genomes_from_gtdb_alignment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">save</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function takes the alignment file generated from the align_to_gtdb function and generates the the genome information</span>
<span class="sd">        using the GTDB-Tk. if you want to save the information as a json file set save to True.</span>

<span class="sd">        Requires:</span>

<span class="sd">        Satisfies:</span>

<span class="sd">        Args:</span>
<span class="sd">            save (bool, optional): Whether to save the feature:genome_id mapping as a json file. Defaults to True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary containing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_outputs_dir</span><span class="p">,</span><span class="s1">&#39;matches.blast&#39;</span><span class="p">)</span>
        <span class="n">aligned</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">matches</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">aligned</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">aligned</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">aligned</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]))</span>
        <span class="n">alignment_dict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">aligned</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">aligned</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feature_to_taxa</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">alignment_dict</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">alignment_dict</span>


    <span class="k">def</span> <span class="nf">download_genomes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">identifiers</span><span class="p">:</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span><span class="n">save</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">run</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">container</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function downloads the genomes from NCBI using the refseq/genbank identifiers.</span>
<span class="sd">        If you want to save the json file that is holding the information for each genome, set save to True.</span>
<span class="sd">        Note that this function uses rsync to download the genomes. Also this function does not come with a run option.</span>


<span class="sd">        Requires:</span>

<span class="sd">        Satisfies:</span>

<span class="sd">        Args:</span>
<span class="sd">            identifier list[str]: The list of identifiers for the genomes. It can be either refseq or genbank.</span>
<span class="sd">            save (bool, optional): Whether to save the genome information as a json file. Defaults to True.</span>
<span class="sd">            container (str, optional): The container to use. Defaults to &quot;None&quot;. You may select from &quot;None&quot;, &quot;docker&quot;, &quot;singularity&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary containing the address of the genomes that are downloaded or to be downloaded.</span>
<span class="sd">            str: The bash script that is used to download the genomes or to be used to download the genomes.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">genome_info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">base_ncbi_dir</span> <span class="o">=</span> <span class="s1">&#39;rsync://ftp.ncbi.nlm.nih.gov/genomes/all/&#39;</span>
        <span class="n">bash_script</span><span class="o">=</span><span class="s2">&quot;#!/bin/bash</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="n">identifiers</span><span class="p">:</span>
            <span class="n">specific_ncbi_dir</span> <span class="o">=</span> <span class="n">identifier</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span>\
                                <span class="n">identifier</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span>\
                                <span class="n">identifier</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span>\
                                <span class="n">identifier</span><span class="p">[</span><span class="mi">9</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">genome_dir</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genome_save_dir</span><span class="p">(</span><span class="n">identifier</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;None&quot;</span><span class="p">:</span>
                <span class="n">bash_script</span><span class="o">+=</span><span class="p">(</span><span class="s1">&#39;rsync -avz --progress &#39;</span><span class="o">+</span><span class="n">base_ncbi_dir</span><span class="o">+</span><span class="n">specific_ncbi_dir</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genome_save_dir</span><span class="p">(</span><span class="n">identifier</span><span class="p">))</span>


            <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;docker&quot;</span><span class="p">:</span>
                <span class="n">bash_script</span><span class="o">+=</span><span class="p">(</span><span class="s1">&#39;docker run -it -v &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">genome_dir</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">genome_dir</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">+</span> <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_docker</span><span class="si">}</span><span class="s1"> rsync -avz --progress &#39;</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">base_ncbi_dir</span><span class="o">+</span><span class="n">specific_ncbi_dir</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">genome_dir</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;singularity&quot;</span><span class="p">:</span>
                <span class="n">bash_script</span><span class="o">+=</span><span class="p">(</span><span class="s1">&#39;singularity run -B &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">genome_dir</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">genome_dir</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">+</span> <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_singularity</span><span class="si">}</span><span class="s1"> rsync -avz --progress &#39;</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">base_ncbi_dir</span><span class="o">+</span><span class="n">specific_ncbi_dir</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">genome_dir</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genome_save_dir</span><span class="p">(</span><span class="n">identifier</span><span class="p">))</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;**/*fna.gz&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="s1">&#39;rna&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="k">if</span> <span class="s1">&#39;cds&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                        <span class="k">if</span> <span class="s1">&#39;genomic&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                            <span class="n">genomics_file</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

            <span class="n">genome_info</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">genomics_file</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genomes_json_info</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">genome_info</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">genome_info</span><span class="p">,</span> <span class="n">bash_script</span>


    <span class="k">def</span> <span class="nf">align_genomes_to_protein_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">run</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">save</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">container</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is a function that will align genomes to the Protein Database of the ADToolbox using local alignment</span>
<span class="sd">        and then will return a dictionary of the alignment results with the aligned genome identifiers as key and the genome as value.</span>
<span class="sd">        If you want to save the scripts, set save to True. Note that the alignment tables will be saved in any case.</span>
<span class="sd">        Note that this function uses mmseqs2 to align the genomes to the protein database. So, to run this function without </span>
<span class="sd">        any container you need to have mmseqs2 installed on your system. However, if you want to run this function with a container,</span>
<span class="sd">        you need to have the container installed on your system. You may select from &quot;None&quot;, &quot;docker&quot;, &quot;singularity&quot;.</span>

<span class="sd">        Requires:</span>

<span class="sd">        Satisfies:</span>

<span class="sd">        Args:</span>
<span class="sd">            run (bool, optional): Whether to run the alignment. Defaults to True.</span>
<span class="sd">            save (bool, optional): Whether to save the alignment scripts. Defaults to True.</span>
<span class="sd">            container (str, optional): The container to use. Defaults to &quot;None&quot;. You may select from &quot;None&quot;, &quot;docker&quot;, &quot;singularity&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary containing the alignment results.</span>
<span class="sd">            str: The bash script that is used to align the genomes or to be used to align the genomes.</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genomes_json_info</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">genomes_info</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">valid_genomes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">genome_ids</span> <span class="ow">in</span> <span class="n">track</span><span class="p">(</span><span class="n">genomes_info</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Fetching Genomes ...&quot;</span><span class="p">):</span>
            <span class="n">Totall_Genomes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">genomes_info</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">genomes_info</span><span class="p">[</span><span class="n">genome_ids</span><span class="p">]):</span>
                <span class="n">valid_genomes</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[green]</span><span class="si">{</span><span class="n">valid_genomes</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">Totall_Genomes</span><span class="si">}</span><span class="s2"> Genomes are valid&quot;</span><span class="p">)</span>


        <span class="n">genome_alignment_files</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;None&quot;</span><span class="p">:</span>
            <span class="n">bash_script</span> <span class="o">=</span> <span class="s2">&quot;#!/bin/bash</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">genome_id</span> <span class="ow">in</span> <span class="n">genomes_info</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">alignment_file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genome_alignment_output</span><span class="p">,</span><span class="s2">&quot;Alignment_Results_mmseq_&quot;</span><span class="o">+</span><span class="n">genome_id</span><span class="o">+</span><span class="s2">&quot;.tsv&quot;</span><span class="p">)</span>
                <span class="n">bash_script</span> <span class="o">+=</span> <span class="s2">&quot;mmseqs easy-search &quot;</span> <span class="o">+</span> \
                    <span class="n">genomes_info</span><span class="p">[</span><span class="n">genome_id</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> \
                    <span class="n">alignment_file</span><span class="o">+</span> <span class="s2">&quot; tmp</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                <span class="n">genome_alignment_files</span><span class="p">[</span><span class="n">genome_id</span><span class="p">]</span><span class="o">=</span><span class="n">alignment_file</span>

        <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;docker&quot;</span><span class="p">:</span>
            <span class="n">bash_script</span> <span class="o">=</span> <span class="s2">&quot;#!/bin/bash</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">genome_id</span> <span class="ow">in</span> <span class="n">genomes_info</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">alignment_file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genome_alignment_output</span><span class="p">,</span><span class="s2">&quot;Alignment_Results_mmseq_&quot;</span><span class="o">+</span><span class="n">genome_id</span><span class="o">+</span><span class="s2">&quot;.tsv&quot;</span><span class="p">)</span>
                <span class="n">bash_script</span> <span class="o">+=</span><span class="s2">&quot;docker run -it &quot;</span><span class="o">+</span> \
                <span class="s2">&quot; -v &quot;</span><span class="o">+</span><span class="n">genomes_info</span><span class="p">[</span><span class="n">genome_id</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="n">genomes_info</span><span class="p">[</span><span class="n">genome_id</span><span class="p">]</span><span class="o">+</span> \
                <span class="s2">&quot; -v &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="o">+</span> \
                <span class="s2">&quot; -v &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genome_alignment_output</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genome_alignment_output</span><span class="o">+</span> \
                <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_docker</span><span class="si">}</span><span class="s2">  mmseqs easy-search &quot;</span> <span class="o">+</span> \
                    <span class="n">genomes_info</span><span class="p">[</span><span class="n">genome_id</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> \
                    <span class="n">alignment_file</span><span class="o">+</span> <span class="s2">&quot; tmpfiles</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                <span class="n">genome_alignment_files</span><span class="p">[</span><span class="n">genome_id</span><span class="p">]</span><span class="o">=</span><span class="n">alignment_file</span>

        <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;singularity&quot;</span><span class="p">:</span>
            <span class="n">bash_script</span> <span class="o">=</span> <span class="s2">&quot;#!/bin/bash</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">genome_id</span> <span class="ow">in</span> <span class="n">genomes_info</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">alignment_file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genome_alignment_output</span><span class="p">,</span><span class="s2">&quot;Alignment_Results_mmseq_&quot;</span><span class="o">+</span><span class="n">genome_id</span><span class="o">+</span><span class="s2">&quot;.tsv&quot;</span><span class="p">)</span>
                <span class="n">bash_script</span> <span class="o">+=</span><span class="s2">&quot;singularity run -B &quot;</span><span class="o">+</span> \
                <span class="s2">&quot; -B &quot;</span><span class="o">+</span><span class="n">genomes_info</span><span class="p">[</span><span class="n">genome_id</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="n">genomes_info</span><span class="p">[</span><span class="n">genome_id</span><span class="p">]</span><span class="o">+</span> \
                <span class="s2">&quot; -B &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="o">+</span> \
                <span class="s2">&quot; -B &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genome_alignment_output</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genome_alignment_output</span><span class="o">+</span> \
                <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_singularity</span><span class="si">}</span><span class="s2">  mmseqs easy-search &quot;</span> <span class="o">+</span> \
                    <span class="n">genomes_info</span><span class="p">[</span><span class="n">genome_id</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> \
                    <span class="n">alignment_file</span><span class="o">+</span> <span class="s2">&quot; tmpfiles</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                <span class="n">genome_alignment_files</span><span class="p">[</span><span class="n">genome_id</span><span class="p">]</span><span class="o">=</span><span class="n">alignment_file</span>



        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genome_alignment_output_json</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">genome_alignment_files</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genome_alignment_script</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">bash_script</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">run</span><span class="p">:</span>

            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">bash_script</span><span class="p">,</span><span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">genome_alignment_files</span><span class="p">,</span> <span class="n">bash_script</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">make_json_from_genomes</span><span class="p">(</span><span class="n">input_dir</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">output_dir</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function takes a csv file directory. The CSV file must include three columns:</span>
<span class="sd">        1- genome_id: Identifier for the genome, preferrably; NCBI ID</span>
<span class="sd">        2- NCBI_Name: NCBI taxonomy name for the genome: Does not need to be in a specific format</span>
<span class="sd">        3- Genome_Dir: Absolute path to the fasta files: NOT .gz</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">genomes_json</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">genomes_table</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">genomes_table</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;genome_id&quot;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span><span class="p">[</span><span class="n">gi</span><span class="p">]</span> <span class="ow">in</span> <span class="n">genomes_table</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">genomes_json</span><span class="p">[</span><span class="n">gi</span><span class="p">]</span><span class="o">=</span><span class="p">{}</span>
            <span class="n">genomes_json</span><span class="p">[</span><span class="n">gi</span><span class="p">][</span><span class="s2">&quot;NCBI_Name&quot;</span><span class="p">]</span><span class="o">=</span> <span class="n">genomes_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gi</span><span class="p">,</span><span class="s2">&quot;NCBI_Name&quot;</span><span class="p">]</span>
            <span class="n">genomes_json</span><span class="p">[</span><span class="n">gi</span><span class="p">][</span><span class="s2">&quot;Genome_Dir&quot;</span><span class="p">]</span><span class="o">=</span> <span class="n">genomes_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gi</span><span class="p">,</span><span class="s2">&quot;Genome_Dir&quot;</span><span class="p">]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">genomes_json</span><span class="p">,</span><span class="n">fp</span><span class="p">)</span>
        <span class="k">return</span>



    <span class="k">def</span> <span class="nf">adm_from_alignment_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">adm_rxns</span><span class="p">,</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;Modified_ADM_Reactions&quot;</span><span class="p">):</span>
        <span class="n">rt</span> <span class="o">=</span> <span class="n">Reaction_Toolkit</span><span class="p">(</span><span class="n">reaction_db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">seed_rxn_db</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genome_alignment_output_json</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json_report</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">reaction_db</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">csv_reaction_db</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="n">json_adm_output</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">adm_reaction</span> <span class="ow">in</span> <span class="n">track</span><span class="p">([</span><span class="n">Rxn</span> <span class="k">for</span> <span class="n">Rxn</span> <span class="ow">in</span> <span class="n">adm_rxns</span><span class="p">],</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Finding Alignments to ADM reactions&quot;</span><span class="p">):</span>
            <span class="n">json_adm_output</span><span class="p">[</span><span class="n">adm_reaction</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">genome_id</span> <span class="ow">in</span> <span class="n">json_report</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">json_report</span><span class="p">[</span><span class="n">genome_id</span><span class="p">][</span><span class="s1">&#39;Alignment_File&#39;</span><span class="p">]):</span>
                    <span class="n">json_adm_output</span><span class="p">[</span><span class="n">adm_reaction</span><span class="p">][</span><span class="n">json_report</span><span class="p">[</span><span class="n">genome_id</span><span class="p">]</span>
                                                  <span class="p">[</span><span class="s1">&#39;NCBI_Name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">temp_tsv</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span>
                        <span class="n">json_report</span><span class="p">[</span><span class="n">genome_id</span><span class="p">][</span><span class="s1">&#39;Alignment_File&#39;</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">a_filter</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp_tsv</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">bit_score</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
                        <span class="n">temp_tsv</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">e_value</span><span class="p">)</span>
                    <span class="n">temp_tsv</span> <span class="o">=</span> <span class="n">temp_tsv</span><span class="p">[</span><span class="n">a_filter</span><span class="p">]</span>
                    <span class="n">ecs</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">temp_tsv</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span>
                    <span class="nb">filter</span> <span class="o">=</span> <span class="p">(</span><span class="n">reaction_db</span><span class="p">[</span><span class="s1">&#39;EC_Numbers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">ecs</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">reaction_db</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">adm_reaction</span><span class="p">))</span>
                    <span class="n">filtered_rxns</span> <span class="o">=</span> <span class="n">reaction_db</span><span class="p">[</span><span class="nb">filter</span><span class="p">]</span>
                    <span class="n">ecs</span> <span class="o">=</span> <span class="n">filtered_rxns</span><span class="p">[</span><span class="s1">&#39;EC_Numbers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

                    <span class="n">ec_dict</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">for</span> <span class="n">ec</span> <span class="ow">in</span> <span class="n">ecs</span><span class="p">:</span>
                        <span class="n">ec_dict</span><span class="p">[</span><span class="n">ec</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">L</span> <span class="o">=</span> <span class="n">rt</span><span class="o">.</span><span class="n">instantiate_rxns</span><span class="p">(</span><span class="n">ec</span><span class="p">,</span> <span class="s2">&quot;Multiple_Match&quot;</span><span class="p">)</span>
                        <span class="p">[</span><span class="n">ec_dict</span><span class="p">[</span><span class="n">ec</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">rxn</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span> <span class="k">for</span> <span class="n">rxn</span> <span class="ow">in</span> <span class="n">L</span> <span class="k">if</span> <span class="n">rxn</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ec_dict</span><span class="p">[</span><span class="n">ec</span><span class="p">]]</span>

                    <span class="n">json_adm_output</span><span class="p">[</span><span class="n">adm_reaction</span><span class="p">][</span><span class="n">json_report</span><span class="p">[</span><span class="n">genome_id</span><span class="p">]</span>
                                                  <span class="p">[</span><span class="s1">&#39;NCBI_Name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">ec_dict</span>


        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genome_adm_map_json</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">json_adm_output</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">json_adm_output</span>
        <span class="c1"># So far it has gotten really complicated, after making sure it works, instead of adding ec numbers I&#39;ll add [SEED,STR] so</span>
        <span class="c1"># that it can be used for downstream analysis</span>

    <span class="k">def</span> <span class="nf">extract_relative_abundances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sample_names</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span><span class="kc">None</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">save</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">:</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function will extract relative abundances for top k taxa from top k taxa table</span>
<span class="sd">        and feature table. It will return a dictionary with the top k taxa genomes as keys and the relative abundances as values</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">feature_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feature_table_dir</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sample_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sample_names</span> <span class="o">=</span> <span class="n">feature_table</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">relative_abundances</span><span class="o">=</span><span class="p">{</span><span class="n">sample</span><span class="p">:[]</span> <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">sample_names</span><span class="p">}</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feature_to_taxa</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">feature_genome_map</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">features</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">feature_genome_map</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">genomes</span><span class="o">=</span><span class="p">[</span><span class="n">feature_genome_map</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">sample_names</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
                <span class="n">relative_abundances</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">feature_table</span><span class="p">[</span><span class="s1">&#39;#OTU ID&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">feature</span><span class="p">,</span><span class="n">sample</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>

        <span class="n">abundances</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">relative_abundances</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">genomes</span><span class="p">)</span>
        <span class="n">rel_abunds</span><span class="o">=</span><span class="n">abundances</span><span class="o">/</span><span class="n">abundances</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">rel_abunds</span><span class="o">=</span><span class="n">rel_abunds</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genome_relative_abundances</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">rel_abunds</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rel_abunds</span>

    <span class="k">def</span> <span class="nf">calculate_microbial_portions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">microbe_reaction_map</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span><span class="n">save</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;This method calculates COD fraction of each microbial term in a model</span>

<span class="sd">        Args:</span>

<span class="sd">            microbe_reaction_map (dict): This dictionary must determine the association between</span>
<span class="sd">            microbial species in the model and the reactions that these species are involved</span>
<span class="sd">            in. In the case of Modified-ADM, this dictionary is the following:</span>

<span class="sd">            microbe_reaction_map={</span>
<span class="sd">                            &quot;Hydrolysis carbohydrates&quot;:&quot;X_ch&quot;,</span>
<span class="sd">                            &quot;Hydrolysis proteins&quot;:&quot;X_pr&quot;,</span>
<span class="sd">                            &quot;Hydrolysis lipids&quot;:&quot;X_li&quot;,</span>
<span class="sd">                            &quot;Uptake of sugars&quot;:&quot;X_su&quot;,</span>
<span class="sd">                            &quot;Uptake of amino acids&quot;:&quot;X_aa&quot;,</span>
<span class="sd">                            &quot;Uptake of LCFA&quot;:&quot;X_fa&quot;,</span>
<span class="sd">                            &quot;Uptake of acetate_et&quot;:&quot;X_ac_et&quot;,</span>
<span class="sd">                            &quot;Uptake of acetate_lac&quot;:&quot;X_ac_lac&quot;,</span>
<span class="sd">                            &quot;Uptake of propionate_et&quot;:&quot;X_chain_et&quot;,</span>
<span class="sd">                            &quot;Uptake of propionate_lac&quot;:&quot;X_chain_lac&quot;,</span>
<span class="sd">                            &quot;Uptake of butyrate_et&quot;:&quot;X_chain_et&quot;,</span>
<span class="sd">                            &quot;Uptake of butyrate_lac&quot;:&quot;X_chain_lac&quot;,</span>
<span class="sd">                            &quot;Uptake of valerate&quot;:&quot;X_VFA_deg&quot;,</span>
<span class="sd">                            &quot;Uptake of caproate&quot;:&quot;X_VFA_deg&quot;,</span>
<span class="sd">                            &quot;Methanogenessis from acetate and h2&quot;:&quot;X_Me_ac&quot;,</span>
<span class="sd">                            &quot;Methanogenessis from CO2 and h2&quot;:&quot;X_Me_CO2&quot;,</span>
<span class="sd">                            &quot;Uptake of ethanol&quot;:&quot;X_et&quot;,</span>
<span class="sd">                            &quot;Uptake of lactate&quot;:&quot;X_lac&quot;,} </span>

<span class="sd">            genome_info: This dictionary is the output of the align_genomes method. It holds</span>
<span class="sd">            the information about the directory holding the result of aligning the genomes of</span>
<span class="sd">            interest and other useful information</span>

<span class="sd">            relative_abundances: This dictionary holds the relative abundace of each genome in the </span>
<span class="sd">            community. The keys of this dictionary are genome_id similar to the output of align_genomes.</span>
<span class="sd">            NOTE: The relative abundances must be between 0,1</span>
<span class="sd">            For example: </span>
<span class="sd">            relative_abundances={</span>
<span class="sd">                &quot;Genome_1&quot;:0.56,</span>
<span class="sd">                &quot;Genome_2&quot;:0.11,</span>
<span class="sd">                &quot;Genome_3&quot;:0.22,</span>
<span class="sd">                &quot;Genome_4&quot;:0.11</span>
<span class="sd">            }</span>


<span class="sd">        Returns:</span>
<span class="sd">            cod (dict): This dictionary includes the fraction of COD that belongs to each microbial species in the</span>
<span class="sd">            model. </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">cod</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">reaction_db</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">csv_reaction_db</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">reaction_db</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;EC_Numbers&#39;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">reaction_db</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;EC_Numbers&quot;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">model_species</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">microbe_reaction_map</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genome_relative_abundances</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">relative_abundances</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genome_alignment_output_json</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>    
            <span class="n">genome_info</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">relative_abundances</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

            <span class="n">cod_portion</span><span class="o">=</span><span class="n">Additive_Dict</span><span class="p">([(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">model_species</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">genome_id</span> <span class="ow">in</span> <span class="n">relative_abundances</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">temp_tsv</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span>
                            <span class="n">genome_info</span><span class="p">[</span><span class="n">genome_id</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                <span class="nb">filter</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp_tsv</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">bit_score</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
                            <span class="n">temp_tsv</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">e_value</span><span class="p">)</span>
                <span class="n">temp_tsv</span> <span class="o">=</span> <span class="n">temp_tsv</span><span class="p">[</span><span class="nb">filter</span><span class="p">]</span>
                <span class="n">unique_ecs</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">temp_tsv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]))</span>
                <span class="n">cleaned_reaction_list</span><span class="o">=</span><span class="p">[]</span>
                <span class="p">[</span><span class="n">cleaned_reaction_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span><span class="n">reaction_db</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ec</span><span class="p">,</span><span class="s2">&quot;Modified_ADM_Reactions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)))</span> <span class="k">for</span> <span class="n">ec</span> <span class="ow">in</span> <span class="n">unique_ecs</span> <span class="k">if</span> <span class="n">ec</span> <span class="ow">in</span> <span class="n">reaction_db</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
                <span class="n">pathway_counts</span><span class="o">=</span><span class="n">Counter</span><span class="p">(</span><span class="n">cleaned_reaction_list</span><span class="p">)</span>
                <span class="n">pathway_counts</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">SUM</span><span class="o">=</span><span class="nb">sum</span><span class="p">([</span><span class="n">pathway_counts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">pathway_counts</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pathway_counts</span><span class="p">:</span>
                    <span class="n">pathway_counts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">pathway_counts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">SUM</span>
                <span class="n">microbial_species</span><span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">microbe_reaction_map</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">pathway_counts</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">pathway_counts</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">])</span>
                <span class="n">cod_portion</span><span class="o">=</span><span class="n">cod_portion</span><span class="o">+</span><span class="n">Additive_Dict</span><span class="p">(</span><span class="n">microbial_species</span><span class="p">)</span><span class="o">*</span><span class="n">relative_abundances</span><span class="p">[</span><span class="n">sample</span><span class="p">][</span><span class="n">genome_id</span><span class="p">]</span>
                <span class="n">SUM</span><span class="o">=</span><span class="nb">sum</span><span class="p">([</span><span class="n">cod_portion</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cod_portion</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">SUM</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cod_portion</span><span class="p">:</span>

                        <span class="n">cod_portion</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cod_portion</span><span class="p">:</span>
                        <span class="n">cod_portion</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">cod_portion</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">SUM</span>


            <span class="n">cod</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span><span class="o">=</span><span class="n">cod_portion</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">cod_output_json</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">cod</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>


        <span class="k">return</span> <span class="n">cod</span>

    <span class="k">def</span> <span class="nf">seqs_from_sra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">accession</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">save</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">run</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">container</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        This method downloads the fastq files from the SRA database using the accession number of the project or run.</span>
<span class="sd">        The method uses the fasterq-dump tool to download the fastq files. The method also creates two bash scripts</span>
<span class="sd">        that can be used to download the fastq files. The first bash script is used to download the SRA files using the</span>
<span class="sd">        prefetch tool. The second bash script is used to convert the SRA files to fastq files using the fasterq-dump tool.</span>
<span class="sd">        depending on the prefered containerization tool, the bash scripts can be converted to singularity or docker containers commands.</span>
<span class="sd">        In the case of docker or singularity you do not need to install the SRA tools on your machine. However, you need to have the</span>
<span class="sd">        containerization tool installed on your machine.</span>

<span class="sd">        Requires:</span>
<span class="sd">            &lt;R&gt;project_accession&lt;/R&gt;</span>
<span class="sd">            &lt;R&gt;Configs.Metagenomics&lt;/R&gt;</span>
<span class="sd">        Satisfies:</span>
<span class="sd">            &lt;S&gt;sra_project_dir&lt;/S&gt;</span>
<span class="sd">            &lt;S&gt;sra_seq_prefetch_bash_str&lt;/S&gt;</span>
<span class="sd">            &lt;S&gt;sra_seq_fasterq_dump_bash_str&lt;/S&gt;</span>
<span class="sd">            &lt;S&gt;manifest_dict&lt;/S&gt;</span>
<span class="sd">            &lt;if&gt; save=True&lt;/if&gt;&lt;S&gt;sra_seq_prefetch_bash_file&lt;/S&gt;</span>
<span class="sd">            &lt;if&gt; save=True&lt;/if&gt;&lt;S&gt;sra_seq_fasterq_dump_bash_file&lt;/S&gt;</span>
<span class="sd">            &lt;if&gt; run=True&lt;/if&gt;&lt;S&gt;.fastq_files&lt;/S&gt;</span>

<span class="sd">        Args:</span>
<span class="sd">            accession (str): The accession number of the SRA project or run</span>
<span class="sd">            save (bool, optional): If True, the  bash scripts will be saved in the SRA work directory. Defaults to True.</span>
<span class="sd">            run (bool, optional): If True, the bash scripts will be executed. Defaults to True. You must have the SRA toolkit installed in your system.</span>

<span class="sd">        Returns:</span>
<span class="sd">            prefetch_script (str): The bash script that will be used to download the SRA files in python string format</span>
<span class="sd">            fasterq_dump_script (str): The bash script that will be used to convert the SRA files to fastq files in python string format</span>

<span class="sd">        &quot;&quot;&quot;</span>   
        <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;None&quot;</span><span class="p">:</span>
            <span class="n">prefetch_script</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;#!/bin/bash</span>
<span class="s2">            prefetch </span><span class="si">{</span><span class="n">accession</span><span class="si">}</span><span class="s2"> -O </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sra_work_dir</span><span class="p">(</span><span class="n">accession</span><span class="p">),</span><span class="s2">&quot;seqs&quot;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>

            <span class="n">fasterq_dump_script</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;#!/bin/bash</span>
<span class="s2">            for i in $(ls ./seqs/) ; do</span>
<span class="s2">            fasterq-dump --split-files seqs/$i/*.sra -O seqs/$i/</span>
<span class="s2">            rm seqs/$i/*.sra</span>
<span class="s2">            done</span>
<span class="s2">            &quot;&quot;&quot;</span>

        <span class="k">elif</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;docker&quot;</span><span class="p">:</span>
            <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Docker is not supported yet&quot;</span><span class="p">)</span>

        <span class="n">project_path</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sra_work_dir</span><span class="p">(</span><span class="n">accession</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">project_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">project_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">project_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;prefetch.sh&quot;</span><span class="p">),</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">prefetch_script</span><span class="p">)</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">project_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;fasterq_dump.sh&quot;</span><span class="p">),</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fasterq_dump_script</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">run</span><span class="p">:</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">project_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;prefetch.sh&quot;</span><span class="p">))],</span><span class="n">cwd</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">project_path</span><span class="p">))</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">project_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;fasterq_dump.sh&quot;</span><span class="p">))],</span><span class="n">cwd</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">project_path</span><span class="p">))</span>



        <span class="k">return</span> <span class="n">prefetch_script</span><span class="p">,</span><span class="n">fasterq_dump_script</span>

    <span class="k">def</span> <span class="nf">run_qiime2_from_sra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">accession</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">save</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">run</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">container</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Requires:</span>
<span class="sd">            &lt;R&gt;project_accession&lt;/R&gt;</span>
<span class="sd">            &lt;R&gt;Configs.Metagenomics&lt;/R&gt;</span>
<span class="sd">            &lt;R&gt;sra_project_dir&lt;/R&gt;</span>
<span class="sd">            &lt;R&gt;.fastq_files&lt;/R&gt;</span>
<span class="sd">        Satisfies:</span>
<span class="sd">            &lt;S&gt;qiime2_work_dir&lt;/S&gt;</span>
<span class="sd">            &lt;S&gt;qiime2_bash_str&lt;/S&gt;</span>
<span class="sd">            &lt;S&gt;manifest.csv&lt;/S&gt;</span>
<span class="sd">            &lt;if&gt;save=True&lt;/if&gt;&lt;S&gt;qiime2_bash_file&lt;/S&gt;</span>
<span class="sd">            &lt;if&gt;run=True&lt;/if&gt;&lt;S&gt;qiime2_outputs&lt;/S&gt;</span>
<span class="sd">        Args:</span>
<span class="sd">            accession (str): The accession number of the SRA project or run</span>
<span class="sd">            save (bool, optional): If True, the  bash scripts will be saved in the SRA work directory. Defaults to True.</span>
<span class="sd">            run (bool, optional): If True, the bash scripts will be executed. Defaults to True. You must have the SRA toolkit installed in your system.</span>
<span class="sd">            container (str, optional): If you want to run the qiime2 commands in a container, specify the container name here. Defaults to &#39;None&#39;.</span>
<span class="sd">        Returns:</span>
<span class="sd">            qiime2_bash_str (str): The bash script that will be used to run qiime2 in python string format</span>
<span class="sd">            manifest (dict): The manifest file that will be used to run qiime2 in python dictionary format</span>

<span class="sd">        TODO:</span>
<span class="sd">            add the ability to submit slurm jobs to cluster</span>
<span class="sd">            add singularity support</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">qiime2_work_dir</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime2_work_dir</span><span class="p">(</span><span class="n">accession</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">qiime2_work_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">qiime2_work_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">sra_project_dir</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sra_work_dir</span><span class="p">(</span><span class="n">accession</span><span class="p">))</span>
        <span class="n">seqs</span><span class="o">=</span><span class="n">sra_project_dir</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;seqs&quot;</span><span class="p">)</span>
        <span class="n">manifest_single</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sample-id&#39;</span><span class="p">:[],</span><span class="s1">&#39;absolute-filepath&#39;</span><span class="p">:[]}</span>
        <span class="n">manifest_paired</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sample-id&#39;</span><span class="p">:[],</span><span class="s1">&#39;forward-absolute-filepath&#39;</span><span class="p">:[],</span><span class="s1">&#39;reverse-absolute-filepath&#39;</span><span class="p">:[]}</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">seqs</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.fastq&quot;</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">r1</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*_1.fastq&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">r2</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*_2.fastq&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">manifest_paired</span><span class="p">[</span><span class="s1">&#39;sample-id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">manifest_paired</span><span class="p">[</span><span class="s1">&#39;forward-absolute-filepath&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">r1</span><span class="p">))</span>
                    <span class="n">manifest_paired</span><span class="p">[</span><span class="s1">&#39;reverse-absolute-filepath&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">r2</span><span class="p">))</span>
                    <span class="n">paired_end</span><span class="o">=</span><span class="kc">True</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.fastq&quot;</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">r1</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.fastq&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">manifest_single</span><span class="p">[</span><span class="s1">&#39;sample-id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">manifest_single</span><span class="p">[</span><span class="s1">&#39;absolute-filepath&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">r1</span><span class="p">))</span>
                    <span class="n">paired_end</span><span class="o">=</span><span class="kc">False</span>

        <span class="n">manifest</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">manifest_single</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">paired_end</span> <span class="k">else</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">manifest_paired</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">paired_end</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime2_paired_end_bash_str</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime2_single_end_bash_str</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="n">manifest_dir</span><span class="o">=</span><span class="n">sra_project_dir</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;manifest.tsv&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;None&quot;</span><span class="p">:</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;manifest&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">manifest_dir</span><span class="p">))</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;qiime2_work_dir&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">qiime2_work_dir</span><span class="p">))</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;classifier&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;docker&quot;</span><span class="p">:</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">qiime2_bash_str</span><span class="p">):</span>
                <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;qiime&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;biom&quot;</span><span class="p">):</span>
                    <span class="n">qiime2_bash_str</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;docker run --env TMPDIR=/data/tmp -v </span><span class="si">{</span><span class="n">sra_project_dir</span><span class="si">}</span><span class="s2">:/data/ -v </span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="si">}</span><span class="s2">:/data/</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> -w /data  </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime2_docker_image</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="n">line</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">qiime2_bash_str</span><span class="p">)</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;manifest&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">manifest_dir</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;qiime2_work_dir&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">qiime2_work_dir</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;classifier&gt;&quot;</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">)))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">paired_end</span><span class="p">:</span>
                <span class="n">manifest</span><span class="p">[</span><span class="s1">&#39;absolute-filepath&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/data&quot;</span><span class="p">)</span><span class="o">/</span><span class="n">seqs</span><span class="o">.</span><span class="n">name</span><span class="o">/</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="o">/</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">manifest</span><span class="p">[</span><span class="s1">&#39;absolute-filepath&#39;</span><span class="p">]]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">manifest</span><span class="p">[</span><span class="s1">&#39;forward-absolute-filepath&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/data&quot;</span><span class="p">)</span><span class="o">/</span><span class="n">seqs</span><span class="o">.</span><span class="n">name</span><span class="o">/</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="o">/</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">manifest</span><span class="p">[</span><span class="s1">&#39;forward-absolute-filepath&#39;</span><span class="p">]]</span>
                <span class="n">manifest</span><span class="p">[</span><span class="s1">&#39;reverse-absolute-filepath&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/data&quot;</span><span class="p">)</span><span class="o">/</span><span class="n">seqs</span><span class="o">.</span><span class="n">name</span><span class="o">/</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="o">/</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">manifest</span><span class="p">[</span><span class="s1">&#39;reverse-absolute-filepath&#39;</span><span class="p">]]</span>

        <span class="k">elif</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;singularity&quot;</span><span class="p">:</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">qiime2_bash_str</span><span class="p">):</span>
                <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;qiime&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;biom&quot;</span><span class="p">):</span>
                    <span class="n">qiime2_bash_str</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;singularity exec --bind  $PWD:$PWD,</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">))</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">))</span><span class="si">}</span><span class="s2">,$SINGULARITY_TMPDIR:/tmp  </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime2_singularity_image</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="o">+</span><span class="n">line</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">qiime2_bash_str</span><span class="p">)</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;manifest&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">manifest_dir</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;qiime2_work_dir&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">qiime2_work_dir</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;classifier&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">)))</span>

            <span class="c1"># if not paired_end:</span>
            <span class="c1">#     manifest[&#39;absolute-filepath&#39;]=[&quot;/&quot;+str(Path(seqs.name)/pathlib.Path(x).parent.name/pathlib.Path(x).name) for x in manifest[&#39;absolute-filepath&#39;]]</span>
            <span class="c1"># else:</span>
            <span class="c1">#     manifest[&#39;forward-absolute-filepath&#39;]=[&quot;/&quot;+str(Path(seqs.name)/pathlib.Path(x).parent.name/pathlib.Path(x).name) for x in manifest[&#39;forward-absolute-filepath&#39;]]</span>
            <span class="c1">#     manifest[&#39;reverse-absolute-filepath&#39;]=[&quot;/&quot;+str(Path(seqs.name)/pathlib.Path(x).parent.name/pathlib.Path(x).name) for x in manifest[&#39;reverse-absolute-filepath&#39;]]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Container must be None, singularity or docker&quot;</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">manifest</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">sra_project_dir</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;manifest.tsv&quot;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">qiime2_work_dir</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;qiime2.sh&quot;</span><span class="p">),</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">qiime2_bash_str</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">run</span><span class="p">:</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">qiime2_work_dir</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;qiime2.sh&quot;</span><span class="p">))],</span><span class="n">cwd</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">qiime2_work_dir</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">qiime2_bash_str</span><span class="p">,</span><span class="n">manifest</span>

    <span class="k">def</span> <span class="nf">extract_taxonomy_features</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Metagenomics.align_genomes_to_protein_db" class="doc doc-heading">
<code class="highlight language-python"><span class="n">align_genomes_to_protein_db</span><span class="p">(</span><span class="n">run</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This is a function that will align genomes to the Protein Database of the ADToolbox using local alignment
and then will return a dictionary of the alignment results with the aligned genome identifiers as key and the genome as value.
If you want to save the scripts, set save to True. Note that the alignment tables will be saved in any case.
Note that this function uses mmseqs2 to align the genomes to the protein database. So, to run this function without 
any container you need to have mmseqs2 installed on your system. However, if you want to run this function with a container,
you need to have the container installed on your system. You may select from "None", "docker", "singularity".</p>
<p>Requires:</p>
<p>Satisfies:</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>run</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to run the alignment. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>save</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to save the alignment scripts. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>container</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The container to use. Defaults to "None". You may select from "None", "docker", "singularity".</p></td>
          <td>
                <code>&#39;None&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>dict</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>A dictionary containing the alignment results.</p></td>
        </tr>
        <tr>
<td><code>str</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>The bash script that is used to align the genomes or to be used to align the genomes.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">align_genomes_to_protein_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">run</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">save</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">container</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a function that will align genomes to the Protein Database of the ADToolbox using local alignment</span>
<span class="sd">    and then will return a dictionary of the alignment results with the aligned genome identifiers as key and the genome as value.</span>
<span class="sd">    If you want to save the scripts, set save to True. Note that the alignment tables will be saved in any case.</span>
<span class="sd">    Note that this function uses mmseqs2 to align the genomes to the protein database. So, to run this function without </span>
<span class="sd">    any container you need to have mmseqs2 installed on your system. However, if you want to run this function with a container,</span>
<span class="sd">    you need to have the container installed on your system. You may select from &quot;None&quot;, &quot;docker&quot;, &quot;singularity&quot;.</span>

<span class="sd">    Requires:</span>

<span class="sd">    Satisfies:</span>

<span class="sd">    Args:</span>
<span class="sd">        run (bool, optional): Whether to run the alignment. Defaults to True.</span>
<span class="sd">        save (bool, optional): Whether to save the alignment scripts. Defaults to True.</span>
<span class="sd">        container (str, optional): The container to use. Defaults to &quot;None&quot;. You may select from &quot;None&quot;, &quot;docker&quot;, &quot;singularity&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary containing the alignment results.</span>
<span class="sd">        str: The bash script that is used to align the genomes or to be used to align the genomes.</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genomes_json_info</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">genomes_info</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">valid_genomes</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">genome_ids</span> <span class="ow">in</span> <span class="n">track</span><span class="p">(</span><span class="n">genomes_info</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Fetching Genomes ...&quot;</span><span class="p">):</span>
        <span class="n">Totall_Genomes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">genomes_info</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">genomes_info</span><span class="p">[</span><span class="n">genome_ids</span><span class="p">]):</span>
            <span class="n">valid_genomes</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[green]</span><span class="si">{</span><span class="n">valid_genomes</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">Totall_Genomes</span><span class="si">}</span><span class="s2"> Genomes are valid&quot;</span><span class="p">)</span>


    <span class="n">genome_alignment_files</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;None&quot;</span><span class="p">:</span>
        <span class="n">bash_script</span> <span class="o">=</span> <span class="s2">&quot;#!/bin/bash</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">genome_id</span> <span class="ow">in</span> <span class="n">genomes_info</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">alignment_file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genome_alignment_output</span><span class="p">,</span><span class="s2">&quot;Alignment_Results_mmseq_&quot;</span><span class="o">+</span><span class="n">genome_id</span><span class="o">+</span><span class="s2">&quot;.tsv&quot;</span><span class="p">)</span>
            <span class="n">bash_script</span> <span class="o">+=</span> <span class="s2">&quot;mmseqs easy-search &quot;</span> <span class="o">+</span> \
                <span class="n">genomes_info</span><span class="p">[</span><span class="n">genome_id</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> \
                <span class="n">alignment_file</span><span class="o">+</span> <span class="s2">&quot; tmp</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="n">genome_alignment_files</span><span class="p">[</span><span class="n">genome_id</span><span class="p">]</span><span class="o">=</span><span class="n">alignment_file</span>

    <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;docker&quot;</span><span class="p">:</span>
        <span class="n">bash_script</span> <span class="o">=</span> <span class="s2">&quot;#!/bin/bash</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">genome_id</span> <span class="ow">in</span> <span class="n">genomes_info</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">alignment_file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genome_alignment_output</span><span class="p">,</span><span class="s2">&quot;Alignment_Results_mmseq_&quot;</span><span class="o">+</span><span class="n">genome_id</span><span class="o">+</span><span class="s2">&quot;.tsv&quot;</span><span class="p">)</span>
            <span class="n">bash_script</span> <span class="o">+=</span><span class="s2">&quot;docker run -it &quot;</span><span class="o">+</span> \
            <span class="s2">&quot; -v &quot;</span><span class="o">+</span><span class="n">genomes_info</span><span class="p">[</span><span class="n">genome_id</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="n">genomes_info</span><span class="p">[</span><span class="n">genome_id</span><span class="p">]</span><span class="o">+</span> \
            <span class="s2">&quot; -v &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="o">+</span> \
            <span class="s2">&quot; -v &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genome_alignment_output</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genome_alignment_output</span><span class="o">+</span> \
            <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_docker</span><span class="si">}</span><span class="s2">  mmseqs easy-search &quot;</span> <span class="o">+</span> \
                <span class="n">genomes_info</span><span class="p">[</span><span class="n">genome_id</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> \
                <span class="n">alignment_file</span><span class="o">+</span> <span class="s2">&quot; tmpfiles</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="n">genome_alignment_files</span><span class="p">[</span><span class="n">genome_id</span><span class="p">]</span><span class="o">=</span><span class="n">alignment_file</span>

    <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;singularity&quot;</span><span class="p">:</span>
        <span class="n">bash_script</span> <span class="o">=</span> <span class="s2">&quot;#!/bin/bash</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">genome_id</span> <span class="ow">in</span> <span class="n">genomes_info</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">alignment_file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genome_alignment_output</span><span class="p">,</span><span class="s2">&quot;Alignment_Results_mmseq_&quot;</span><span class="o">+</span><span class="n">genome_id</span><span class="o">+</span><span class="s2">&quot;.tsv&quot;</span><span class="p">)</span>
            <span class="n">bash_script</span> <span class="o">+=</span><span class="s2">&quot;singularity run -B &quot;</span><span class="o">+</span> \
            <span class="s2">&quot; -B &quot;</span><span class="o">+</span><span class="n">genomes_info</span><span class="p">[</span><span class="n">genome_id</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="n">genomes_info</span><span class="p">[</span><span class="n">genome_id</span><span class="p">]</span><span class="o">+</span> \
            <span class="s2">&quot; -B &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span><span class="o">+</span> \
            <span class="s2">&quot; -B &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genome_alignment_output</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genome_alignment_output</span><span class="o">+</span> \
            <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_singularity</span><span class="si">}</span><span class="s2">  mmseqs easy-search &quot;</span> <span class="o">+</span> \
                <span class="n">genomes_info</span><span class="p">[</span><span class="n">genome_id</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">protein_db</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> \
                <span class="n">alignment_file</span><span class="o">+</span> <span class="s2">&quot; tmpfiles</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="n">genome_alignment_files</span><span class="p">[</span><span class="n">genome_id</span><span class="p">]</span><span class="o">=</span><span class="n">alignment_file</span>



    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genome_alignment_output_json</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">genome_alignment_files</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genome_alignment_script</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">bash_script</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">run</span><span class="p">:</span>

        <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">bash_script</span><span class="p">,</span><span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">genome_alignment_files</span><span class="p">,</span> <span class="n">bash_script</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Metagenomics.align_to_gtdb" class="doc doc-heading">
<code class="highlight language-python"><span class="n">align_to_gtdb</span><span class="p">(</span><span class="n">run</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function takes the representative sequences of the top k features and generates the script to
align these feature sequences to gtdb using VSEARCH. If you intend to run this you either
need to have VSEARCH installed or run it with a container option. You can use either the docker or singularity
as container options. Otherwise you can use None and run it with the assumption that VSEARCH is installed.
If you only want the script and not to run it, set run to False.</p>
<p>Requires:</p>
<p>Satisfies:</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>run</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to run the script. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>save</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to save the script. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>container</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The container to use. Defaults to "None".</p></td>
          <td>
                <code>&#39;None&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>The script that was run or supposed to be running later.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">align_to_gtdb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">run</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">save</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">container</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This function takes the representative sequences of the top k features and generates the script to</span>
<span class="sd">    align these feature sequences to gtdb using VSEARCH. If you intend to run this you either</span>
<span class="sd">    need to have VSEARCH installed or run it with a container option. You can use either the docker or singularity</span>
<span class="sd">    as container options. Otherwise you can use None and run it with the assumption that VSEARCH is installed.</span>
<span class="sd">    If you only want the script and not to run it, set run to False.</span>

<span class="sd">    Requires:</span>

<span class="sd">    Satisfies:</span>

<span class="sd">    Args:</span>
<span class="sd">        run (bool, optional): Whether to run the script. Defaults to True.</span>
<span class="sd">        save (bool, optional): Whether to save the script. Defaults to True.</span>
<span class="sd">        container (str, optional): The container to use. Defaults to &quot;None&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The script that was run or supposed to be running later.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">alignment_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_outputs_dir</span><span class="p">,</span><span class="s1">&#39;Alignments&#39;</span><span class="p">)</span>
    <span class="n">match_table</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_outputs_dir</span><span class="p">,</span><span class="s1">&#39;matches.blast&#39;</span><span class="p">)</span>
    <span class="n">gtdb_dir_fasta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">gtdb_dir_fasta</span>
    <span class="n">query</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_top_repseq_dir</span>
    <span class="n">dirs</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_outputs_dir</span><span class="p">,</span>
        <span class="n">gtdb_dir_fasta</span><span class="p">,</span>
        <span class="n">query</span>
        <span class="p">]</span>
    <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;None&quot;</span><span class="p">:</span>

        <span class="n">bash_script</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;#!/bin/bash</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="s1">&#39;vsearch --top_hits_only --blast6out &#39;</span><span class="o">+</span>
                    <span class="n">match_table</span><span class="o">+</span>
                    <span class="s1">&#39; --usearch_global &#39;</span><span class="o">+</span> <span class="n">query</span> <span class="o">+</span>
                    <span class="s1">&#39; --db &#39;</span><span class="o">+</span> <span class="n">gtdb_dir_fasta</span> <span class="o">+</span>
                    <span class="s1">&#39; --id &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_similarity</span><span class="p">)</span> <span class="o">+</span>
                    <span class="s1">&#39; --threads &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">vsearch_threads</span><span class="p">)</span><span class="o">+</span>
                    <span class="s1">&#39; --alnout &#39;</span><span class="o">+</span> <span class="n">alignment_dir</span> <span class="o">+</span>
                    <span class="s1">&#39; --top_hits_only&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;docker&quot;</span><span class="p">:</span>
        <span class="n">bash_script</span><span class="o">=</span><span class="s2">&quot;#!/bin/bash</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span><span class="s1">&#39;docker run -it &#39;</span>
        <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
            <span class="n">bash_script</span><span class="o">+=</span><span class="p">(</span><span class="s1">&#39;-v &#39;</span><span class="o">+</span><span class="nb">dir</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="nb">dir</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

        <span class="n">bash_script</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_docker</span><span class="o">+</span><span class="s1">&#39; vsearch --top_hits_only --blast6out &#39;</span><span class="o">+</span>
                    <span class="n">match_table</span><span class="o">+</span>
                    <span class="s1">&#39; --usearch_global &#39;</span><span class="o">+</span> <span class="n">query</span> <span class="o">+</span>
                    <span class="s1">&#39; --db &#39;</span><span class="o">+</span> <span class="n">gtdb_dir_fasta</span> <span class="o">+</span>
                    <span class="s1">&#39; --id &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_similarity</span><span class="p">)</span> <span class="o">+</span>
                    <span class="s1">&#39; --threads &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">vsearch_threads</span><span class="p">)</span><span class="o">+</span>
                    <span class="s1">&#39; --alnout &#39;</span><span class="o">+</span> <span class="n">alignment_dir</span> <span class="o">+</span>
                    <span class="s1">&#39; --top_hits_only&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;singularity&quot;</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Singularity is not fully supported yet&quot;</span><span class="p">)</span>
        <span class="n">bash_script</span><span class="o">=</span><span class="s2">&quot;#!/bin/bash</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span><span class="s1">&#39;singularity run &#39;</span>
        <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
            <span class="n">bash_script</span><span class="o">+=</span><span class="p">(</span><span class="s1">&#39;-B &#39;</span><span class="o">+</span><span class="nb">dir</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="nb">dir</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

        <span class="n">bash_script</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_singularity</span><span class="o">+</span><span class="s1">&#39; vsearch --top_hits_only --blast6out &#39;</span><span class="o">+</span>
                    <span class="n">match_table</span><span class="o">+</span>
                    <span class="s1">&#39; --usearch_global &#39;</span><span class="o">+</span> <span class="n">query</span> <span class="o">+</span>
                    <span class="s1">&#39; --db &#39;</span><span class="o">+</span> <span class="n">gtdb_dir_fasta</span> <span class="o">+</span>
                    <span class="s1">&#39; --id &#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_similarity</span><span class="p">)</span> <span class="o">+</span>
                    <span class="s1">&#39; --threads &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">vsearch_threads</span><span class="p">)</span><span class="o">+</span>
                    <span class="s1">&#39; --alnout &#39;</span><span class="o">+</span> <span class="n">alignment_dir</span> <span class="o">+</span>
                    <span class="s1">&#39; --top_hits_only&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>



    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">vsearch_script_dir</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">bash_script</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">run</span><span class="p">:</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">bash_script</span><span class="p">,</span><span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">bash_script</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Metagenomics.calculate_microbial_portions" class="doc doc-heading">
<code class="highlight language-python"><span class="n">calculate_microbial_portions</span><span class="p">(</span><span class="n">microbe_reaction_map</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method calculates COD fraction of each microbial term in a model</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>microbe_reaction_map</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>This dictionary must determine the association between</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>in.</code></td>
          <td>
                <code>In the case of Modified-ADM, this dictionary is the following</code>
          </td>
          <td></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>genome_info</code></td>
          <td>
          </td>
          <td><p>This dictionary is the output of the align_genomes method. It holds</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>relative_abundances</code></td>
          <td>
          </td>
          <td><p>This dictionary holds the relative abundace of each genome in the </p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>NOTE</code></td>
          <td>
          </td>
          <td><p>The relative abundances must be between 0,1</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>For</code></td>
          <td>
                <code>example</code>
          </td>
          <td></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>cod</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>This dictionary includes the fraction of COD that belongs to each microbial species in the</p></td>
        </tr>
        <tr>
<td></td>          <td>
                <code>dict</code>
          </td>
          <td><p>model.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_microbial_portions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">microbe_reaction_map</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span><span class="n">save</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method calculates COD fraction of each microbial term in a model</span>

<span class="sd">    Args:</span>

<span class="sd">        microbe_reaction_map (dict): This dictionary must determine the association between</span>
<span class="sd">        microbial species in the model and the reactions that these species are involved</span>
<span class="sd">        in. In the case of Modified-ADM, this dictionary is the following:</span>

<span class="sd">        microbe_reaction_map={</span>
<span class="sd">                        &quot;Hydrolysis carbohydrates&quot;:&quot;X_ch&quot;,</span>
<span class="sd">                        &quot;Hydrolysis proteins&quot;:&quot;X_pr&quot;,</span>
<span class="sd">                        &quot;Hydrolysis lipids&quot;:&quot;X_li&quot;,</span>
<span class="sd">                        &quot;Uptake of sugars&quot;:&quot;X_su&quot;,</span>
<span class="sd">                        &quot;Uptake of amino acids&quot;:&quot;X_aa&quot;,</span>
<span class="sd">                        &quot;Uptake of LCFA&quot;:&quot;X_fa&quot;,</span>
<span class="sd">                        &quot;Uptake of acetate_et&quot;:&quot;X_ac_et&quot;,</span>
<span class="sd">                        &quot;Uptake of acetate_lac&quot;:&quot;X_ac_lac&quot;,</span>
<span class="sd">                        &quot;Uptake of propionate_et&quot;:&quot;X_chain_et&quot;,</span>
<span class="sd">                        &quot;Uptake of propionate_lac&quot;:&quot;X_chain_lac&quot;,</span>
<span class="sd">                        &quot;Uptake of butyrate_et&quot;:&quot;X_chain_et&quot;,</span>
<span class="sd">                        &quot;Uptake of butyrate_lac&quot;:&quot;X_chain_lac&quot;,</span>
<span class="sd">                        &quot;Uptake of valerate&quot;:&quot;X_VFA_deg&quot;,</span>
<span class="sd">                        &quot;Uptake of caproate&quot;:&quot;X_VFA_deg&quot;,</span>
<span class="sd">                        &quot;Methanogenessis from acetate and h2&quot;:&quot;X_Me_ac&quot;,</span>
<span class="sd">                        &quot;Methanogenessis from CO2 and h2&quot;:&quot;X_Me_CO2&quot;,</span>
<span class="sd">                        &quot;Uptake of ethanol&quot;:&quot;X_et&quot;,</span>
<span class="sd">                        &quot;Uptake of lactate&quot;:&quot;X_lac&quot;,} </span>

<span class="sd">        genome_info: This dictionary is the output of the align_genomes method. It holds</span>
<span class="sd">        the information about the directory holding the result of aligning the genomes of</span>
<span class="sd">        interest and other useful information</span>

<span class="sd">        relative_abundances: This dictionary holds the relative abundace of each genome in the </span>
<span class="sd">        community. The keys of this dictionary are genome_id similar to the output of align_genomes.</span>
<span class="sd">        NOTE: The relative abundances must be between 0,1</span>
<span class="sd">        For example: </span>
<span class="sd">        relative_abundances={</span>
<span class="sd">            &quot;Genome_1&quot;:0.56,</span>
<span class="sd">            &quot;Genome_2&quot;:0.11,</span>
<span class="sd">            &quot;Genome_3&quot;:0.22,</span>
<span class="sd">            &quot;Genome_4&quot;:0.11</span>
<span class="sd">        }</span>


<span class="sd">    Returns:</span>
<span class="sd">        cod (dict): This dictionary includes the fraction of COD that belongs to each microbial species in the</span>
<span class="sd">        model. </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">cod</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">reaction_db</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">csv_reaction_db</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
    <span class="n">reaction_db</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;EC_Numbers&#39;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">reaction_db</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;EC_Numbers&quot;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">model_species</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">microbe_reaction_map</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genome_relative_abundances</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">relative_abundances</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genome_alignment_output_json</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>    
        <span class="n">genome_info</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">relative_abundances</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

        <span class="n">cod_portion</span><span class="o">=</span><span class="n">Additive_Dict</span><span class="p">([(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">model_species</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">genome_id</span> <span class="ow">in</span> <span class="n">relative_abundances</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">temp_tsv</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span>
                        <span class="n">genome_info</span><span class="p">[</span><span class="n">genome_id</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="nb">filter</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp_tsv</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">bit_score</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
                        <span class="n">temp_tsv</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">e_value</span><span class="p">)</span>
            <span class="n">temp_tsv</span> <span class="o">=</span> <span class="n">temp_tsv</span><span class="p">[</span><span class="nb">filter</span><span class="p">]</span>
            <span class="n">unique_ecs</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">temp_tsv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]))</span>
            <span class="n">cleaned_reaction_list</span><span class="o">=</span><span class="p">[]</span>
            <span class="p">[</span><span class="n">cleaned_reaction_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span><span class="n">reaction_db</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ec</span><span class="p">,</span><span class="s2">&quot;Modified_ADM_Reactions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)))</span> <span class="k">for</span> <span class="n">ec</span> <span class="ow">in</span> <span class="n">unique_ecs</span> <span class="k">if</span> <span class="n">ec</span> <span class="ow">in</span> <span class="n">reaction_db</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
            <span class="n">pathway_counts</span><span class="o">=</span><span class="n">Counter</span><span class="p">(</span><span class="n">cleaned_reaction_list</span><span class="p">)</span>
            <span class="n">pathway_counts</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">SUM</span><span class="o">=</span><span class="nb">sum</span><span class="p">([</span><span class="n">pathway_counts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">pathway_counts</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pathway_counts</span><span class="p">:</span>
                <span class="n">pathway_counts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">pathway_counts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">SUM</span>
            <span class="n">microbial_species</span><span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">microbe_reaction_map</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">pathway_counts</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">pathway_counts</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">])</span>
            <span class="n">cod_portion</span><span class="o">=</span><span class="n">cod_portion</span><span class="o">+</span><span class="n">Additive_Dict</span><span class="p">(</span><span class="n">microbial_species</span><span class="p">)</span><span class="o">*</span><span class="n">relative_abundances</span><span class="p">[</span><span class="n">sample</span><span class="p">][</span><span class="n">genome_id</span><span class="p">]</span>
            <span class="n">SUM</span><span class="o">=</span><span class="nb">sum</span><span class="p">([</span><span class="n">cod_portion</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cod_portion</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">SUM</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cod_portion</span><span class="p">:</span>

                    <span class="n">cod_portion</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cod_portion</span><span class="p">:</span>
                    <span class="n">cod_portion</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">cod_portion</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">SUM</span>


        <span class="n">cod</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span><span class="o">=</span><span class="n">cod_portion</span>
    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">cod_output_json</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">cod</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">cod</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Metagenomics.download_genomes" class="doc doc-heading">
<code class="highlight language-python"><span class="n">download_genomes</span><span class="p">(</span><span class="n">identifiers</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">run</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function downloads the genomes from NCBI using the refseq/genbank identifiers.
If you want to save the json file that is holding the information for each genome, set save to True.
Note that this function uses rsync to download the genomes. Also this function does not come with a run option.</p>
<p>Requires:</p>
<p>Satisfies:</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>identifier</code></td>
          <td>
                <code>list[str]</code>
          </td>
          <td><p>The list of identifiers for the genomes. It can be either refseq or genbank.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>save</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to save the genome information as a json file. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>container</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The container to use. Defaults to "None". You may select from "None", "docker", "singularity".</p></td>
          <td>
                <code>&#39;None&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>dict</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>A dictionary containing the address of the genomes that are downloaded or to be downloaded.</p></td>
        </tr>
        <tr>
<td><code>str</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>The bash script that is used to download the genomes or to be used to download the genomes.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_genomes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">identifiers</span><span class="p">:</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span><span class="n">save</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">run</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">container</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This function downloads the genomes from NCBI using the refseq/genbank identifiers.</span>
<span class="sd">    If you want to save the json file that is holding the information for each genome, set save to True.</span>
<span class="sd">    Note that this function uses rsync to download the genomes. Also this function does not come with a run option.</span>


<span class="sd">    Requires:</span>

<span class="sd">    Satisfies:</span>

<span class="sd">    Args:</span>
<span class="sd">        identifier list[str]: The list of identifiers for the genomes. It can be either refseq or genbank.</span>
<span class="sd">        save (bool, optional): Whether to save the genome information as a json file. Defaults to True.</span>
<span class="sd">        container (str, optional): The container to use. Defaults to &quot;None&quot;. You may select from &quot;None&quot;, &quot;docker&quot;, &quot;singularity&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary containing the address of the genomes that are downloaded or to be downloaded.</span>
<span class="sd">        str: The bash script that is used to download the genomes or to be used to download the genomes.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">genome_info</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">base_ncbi_dir</span> <span class="o">=</span> <span class="s1">&#39;rsync://ftp.ncbi.nlm.nih.gov/genomes/all/&#39;</span>
    <span class="n">bash_script</span><span class="o">=</span><span class="s2">&quot;#!/bin/bash</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">for</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="n">identifiers</span><span class="p">:</span>
        <span class="n">specific_ncbi_dir</span> <span class="o">=</span> <span class="n">identifier</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span>\
                            <span class="n">identifier</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span>\
                            <span class="n">identifier</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span>\
                            <span class="n">identifier</span><span class="p">[</span><span class="mi">9</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">genome_dir</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genome_save_dir</span><span class="p">(</span><span class="n">identifier</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;None&quot;</span><span class="p">:</span>
            <span class="n">bash_script</span><span class="o">+=</span><span class="p">(</span><span class="s1">&#39;rsync -avz --progress &#39;</span><span class="o">+</span><span class="n">base_ncbi_dir</span><span class="o">+</span><span class="n">specific_ncbi_dir</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genome_save_dir</span><span class="p">(</span><span class="n">identifier</span><span class="p">))</span>


        <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;docker&quot;</span><span class="p">:</span>
            <span class="n">bash_script</span><span class="o">+=</span><span class="p">(</span><span class="s1">&#39;docker run -it -v &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">genome_dir</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">genome_dir</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">+</span> <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_docker</span><span class="si">}</span><span class="s1"> rsync -avz --progress &#39;</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">base_ncbi_dir</span><span class="o">+</span><span class="n">specific_ncbi_dir</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">genome_dir</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;singularity&quot;</span><span class="p">:</span>
            <span class="n">bash_script</span><span class="o">+=</span><span class="p">(</span><span class="s1">&#39;singularity run -B &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">genome_dir</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">genome_dir</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">+</span> <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_singularity</span><span class="si">}</span><span class="s1"> rsync -avz --progress &#39;</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">base_ncbi_dir</span><span class="o">+</span><span class="n">specific_ncbi_dir</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">genome_dir</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genome_save_dir</span><span class="p">(</span><span class="n">identifier</span><span class="p">))</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;**/*fna.gz&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;rna&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="k">if</span> <span class="s1">&#39;cds&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="k">if</span> <span class="s1">&#39;genomic&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                        <span class="n">genomics_file</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="n">genome_info</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">genomics_file</span>

    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genomes_json_info</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">genome_info</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">genome_info</span><span class="p">,</span> <span class="n">bash_script</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Metagenomics.extract_relative_abundances" class="doc doc-heading">
<code class="highlight language-python"><span class="n">extract_relative_abundances</span><span class="p">(</span><span class="n">sample_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function will extract relative abundances for top k taxa from top k taxa table
and feature table. It will return a dictionary with the top k taxa genomes as keys and the relative abundances as values</p>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_relative_abundances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sample_names</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span><span class="kc">None</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">save</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function will extract relative abundances for top k taxa from top k taxa table</span>
<span class="sd">    and feature table. It will return a dictionary with the top k taxa genomes as keys and the relative abundances as values</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">feature_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feature_table_dir</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sample_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sample_names</span> <span class="o">=</span> <span class="n">feature_table</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">relative_abundances</span><span class="o">=</span><span class="p">{</span><span class="n">sample</span><span class="p">:[]</span> <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">sample_names</span><span class="p">}</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feature_to_taxa</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">feature_genome_map</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">features</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">feature_genome_map</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">genomes</span><span class="o">=</span><span class="p">[</span><span class="n">feature_genome_map</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">sample_names</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
            <span class="n">relative_abundances</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">feature_table</span><span class="p">[</span><span class="s1">&#39;#OTU ID&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">feature</span><span class="p">,</span><span class="n">sample</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>

    <span class="n">abundances</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">relative_abundances</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">genomes</span><span class="p">)</span>
    <span class="n">rel_abunds</span><span class="o">=</span><span class="n">abundances</span><span class="o">/</span><span class="n">abundances</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">rel_abunds</span><span class="o">=</span><span class="n">rel_abunds</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">genome_relative_abundances</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">rel_abunds</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rel_abunds</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Metagenomics.find_top_k_repseqs" class="doc doc-heading">
<code class="highlight language-python"><span class="n">find_top_k_repseqs</span><span class="p">(</span><span class="n">sample_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function takes three inputs from qiime:
1. feature table: This is the abundance of each feature in each sample (TSV).
2. taxonomy table: This is the taxonomy of each feature (TSV). 
3. rep seqs: This is the representative sequence of each feature (fasta).
It then finds the top k features for each sample and then finds the genomes for each feature (if there is one).
It then returns a dictionary of the genomes for the sample(s) along with the NCBI name and the
address where they are stored.</p>
<p>Requires:</p>
<p>Satisfies:</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>sample_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The name of the sample. Defaults to None.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>save</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to save the top k repseqs. Defaults to True. If true it saves three files:</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>1.</code></td>
          <td>
                <code>top_k_repseqs.<span title="top_k_repseqs.fasta">fasta</span></code>
          </td>
          <td><p>this is the fasta file of the top k repseqs. The header is the feature id and the sequence is the </p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>2.</code></td>
          <td>
                <code>top_featureids</code>
          </td>
          <td><p>This is a table that has the feature ids for the top k features for each sample.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>3.</code></td>
          <td>
                <code>top_k_taxa</code>
          </td>
          <td><p>This is a table that has the taxonomy identifier for the top k features for each sample.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>dict</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>A dictionary has all top_repseqs, top_featureids, and top_k_taxa. You can access them with the corresponding keys.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_top_k_repseqs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">sample_names</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span><span class="kc">None</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span>
                        <span class="p">,</span><span class="n">save</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;This function takes three inputs from qiime:</span>
<span class="sd">    1. feature table: This is the abundance of each feature in each sample (TSV).</span>
<span class="sd">    2. taxonomy table: This is the taxonomy of each feature (TSV). </span>
<span class="sd">    3. rep seqs: This is the representative sequence of each feature (fasta).</span>
<span class="sd">    It then finds the top k features for each sample and then finds the genomes for each feature (if there is one).</span>
<span class="sd">    It then returns a dictionary of the genomes for the sample(s) along with the NCBI name and the</span>
<span class="sd">    address where they are stored.</span>

<span class="sd">    Requires:</span>

<span class="sd">    Satisfies:</span>

<span class="sd">    Args:</span>
<span class="sd">        sample_name (str, optional): The name of the sample. Defaults to None.</span>
<span class="sd">        if None, it will find top k genomes for all samples.</span>
<span class="sd">        save (bool, optional): Whether to save the top k repseqs. Defaults to True. If true it saves three files:</span>
<span class="sd">        1. top_k_repseqs.fasta: this is the fasta file of the top k repseqs. The header is the feature id and the sequence is the </span>
<span class="sd">        representative sequence.</span>
<span class="sd">        2. top_featureids: This is a table that has the feature ids for the top k features for each sample.</span>
<span class="sd">        3. top_k_taxa: This is a table that has the taxonomy identifier for the top k features for each sample.</span>


<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary has all top_repseqs, top_featureids, and top_k_taxa. You can access them with the corresponding keys. </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">feature_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feature_table_dir</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">taxonomy_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">taxonomy_table_dir</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">repseqs</span><span class="o">=</span><span class="n">fasta_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">rep_seq_fasta</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sample_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="n">feature_table</span> <span class="o">=</span> <span class="n">feature_table</span><span class="p">[</span><span class="n">sample_names</span><span class="p">]</span>

    <span class="n">top_featureids</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">top_repseqs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">top_k_taxa</span> <span class="o">=</span> <span class="p">{}</span>


    <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">feature_table</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">top_featureids</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">feature_table</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
            <span class="n">sample</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;#OTU ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">k</span><span class="p">))</span>
        <span class="n">top_k_taxa</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">taxonomy_table</span><span class="p">[</span><span class="n">taxonomy_table</span><span class="p">[</span><span class="s2">&quot;Feature ID&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">feature</span><span class="p">][</span><span class="s2">&quot;Taxon&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">top_featureids</span><span class="p">[</span><span class="n">sample</span><span class="p">]]</span>
        <span class="n">top_repseqs</span> <span class="o">|=</span> <span class="p">{</span><span class="n">feature</span><span class="p">:</span><span class="n">repseqs</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">top_featureids</span><span class="p">[</span><span class="n">sample</span><span class="p">]}</span>

    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">top_featureids</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_outputs_dir</span><span class="p">,</span><span class="s1">&#39;Top_k_FeatureIDs.csv&#39;</span><span class="p">))</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">top_k_taxa</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_outputs_dir</span><span class="p">,</span><span class="s1">&#39;Top_k_Taxa.csv&#39;</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_top_repseq_dir</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">top_repseqs</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="o">+</span><span class="n">feature</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">top_repseqs</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>                

    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;top_featureids&#39;</span><span class="p">:</span><span class="n">top_featureids</span><span class="p">,</span><span class="s1">&#39;top_k_taxa&#39;</span><span class="p">:</span><span class="n">top_k_taxa</span><span class="p">,</span><span class="s1">&#39;top_repseqs&#39;</span><span class="p">:</span><span class="n">top_repseqs</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Metagenomics.get_genomes_from_gtdb_alignment" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_genomes_from_gtdb_alignment</span><span class="p">(</span><span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function takes the alignment file generated from the align_to_gtdb function and generates the the genome information
using the GTDB-Tk. if you want to save the information as a json file set save to True.</p>
<p>Requires:</p>
<p>Satisfies:</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>save</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to save the feature:genome_id mapping as a json file. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>dict</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>A dictionary containing</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_genomes_from_gtdb_alignment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">save</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This function takes the alignment file generated from the align_to_gtdb function and generates the the genome information</span>
<span class="sd">    using the GTDB-Tk. if you want to save the information as a json file set save to True.</span>

<span class="sd">    Requires:</span>

<span class="sd">    Satisfies:</span>

<span class="sd">    Args:</span>
<span class="sd">        save (bool, optional): Whether to save the feature:genome_id mapping as a json file. Defaults to True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary containing</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_outputs_dir</span><span class="p">,</span><span class="s1">&#39;matches.blast&#39;</span><span class="p">)</span>
    <span class="n">aligned</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">matches</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">aligned</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">aligned</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">aligned</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]))</span>
    <span class="n">alignment_dict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">aligned</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">aligned</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feature_to_taxa</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">alignment_dict</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">alignment_dict</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Metagenomics.get_requirements_a2g" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_requirements_a2g</span><span class="p">(</span><span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function will automatically download the required files for Amplicon to Genome functionality.</p>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span>
<span class="normal">987</span>
<span class="normal">988</span>
<span class="normal">989</span>
<span class="normal">990</span>
<span class="normal">991</span>
<span class="normal">992</span>
<span class="normal">993</span>
<span class="normal">994</span>
<span class="normal">995</span>
<span class="normal">996</span>
<span class="normal">997</span>
<span class="normal">998</span>
<span class="normal">999</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_requirements_a2g</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function will automatically download the required files for Amplicon to Genome functionality.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_db</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_db</span><span class="p">)</span>

    <span class="n">url</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Version&#39;</span><span class="p">:</span> <span class="s1">&#39;https://data.ace.uq.edu.au/public/gtdb/data/releases/latest/VERSION&#39;</span><span class="p">,</span>
           <span class="s1">&#39;MD5SUM&#39;</span><span class="p">:</span> <span class="s1">&#39;https://data.ace.uq.edu.au/public/gtdb/data/releases/latest/MD5SUM&#39;</span><span class="p">,</span>
           <span class="s1">&#39;FILE_DESCRIPTIONS&#39;</span><span class="p">:</span> <span class="s1">&#39;https://data.ace.uq.edu.au/public/gtdb/data/releases/latest/FILE_DESCRIPTIONS&#39;</span><span class="p">,</span>
           <span class="s1">&#39;metadata_field_desc&#39;</span><span class="p">:</span> <span class="s1">&#39;https://data.ace.uq.edu.au/public/gtdb/data/releases/latest/auxillary_files/metadata_field_desc.tsv&#39;</span><span class="p">,</span>
           <span class="s1">&#39;bac120_metadata&#39;</span><span class="p">:</span> <span class="s1">&#39;https://data.ace.uq.edu.au/public/gtdb/data/releases/latest/bac120_metadata.tar.gz&#39;</span><span class="p">,</span>
           <span class="s1">&#39;bac120_ssu&#39;</span><span class="p">:</span> <span class="s1">&#39;https://data.ace.uq.edu.au/public/gtdb/data/releases/latest/genomic_files_reps/bac120_ssu_reps.tar.gz&#39;</span>
           <span class="p">}</span>
    <span class="k">if</span> <span class="n">progress</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Version&#39;</span><span class="p">,</span> <span class="s1">&#39;MD5SUM&#39;</span><span class="p">,</span> <span class="s1">&#39;FILE_DESCRIPTIONS&#39;</span><span class="p">]:</span>
            <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="n">keys</span><span class="p">],</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">progress</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
                <span class="n">total_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content-length&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                <span class="n">block_size</span> <span class="o">=</span> <span class="mi">1024</span>
                <span class="k">with</span> <span class="n">Progress</span><span class="p">()</span> <span class="k">as</span> <span class="n">progress</span><span class="p">:</span>
                    <span class="n">task1</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="s2">&quot;Downloading &quot;</span> <span class="o">+</span> <span class="n">keys</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="n">total_size</span><span class="p">)</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_db</span><span class="p">,</span> <span class="n">keys</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">block_size</span><span class="p">):</span>
                            <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">task1</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="s1">&#39;metadata_field_desc&#39;</span><span class="p">],</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">progress</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
            <span class="n">total_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content-length&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">block_size</span> <span class="o">=</span> <span class="mi">1024</span>
            <span class="k">with</span> <span class="n">Progress</span><span class="p">()</span> <span class="k">as</span> <span class="n">progress</span><span class="p">:</span>
                <span class="n">task1</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="s2">&quot;Downloading metadata_field_desc.tsv&quot;</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="n">total_size</span><span class="p">)</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_db</span><span class="p">,</span> <span class="s1">&#39;metadata_field_desc.tsv&#39;</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">block_size</span><span class="p">):</span>
                        <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">task1</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;bac120_metadata&#39;</span><span class="p">,</span> <span class="s1">&#39;bac120_ssu&#39;</span><span class="p">]:</span>
            <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="n">keys</span><span class="p">],</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">progress</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
                <span class="n">total_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content-length&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                <span class="n">block_size</span> <span class="o">=</span> <span class="mi">1024</span>
                <span class="k">with</span> <span class="n">Progress</span><span class="p">()</span> <span class="k">as</span> <span class="n">progress</span><span class="p">:</span>
                    <span class="n">task1</span> <span class="o">=</span> <span class="n">progress</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="s2">&quot;Downloading &quot;</span> <span class="o">+</span> <span class="n">keys</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="n">total_size</span><span class="p">)</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_db</span><span class="p">,</span> <span class="n">keys</span><span class="o">+</span><span class="s1">&#39;.tar.gz&#39;</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">block_size</span><span class="p">):</span>
                            <span class="n">progress</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">task1</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Version&#39;</span><span class="p">,</span> <span class="s1">&#39;MD5SUM&#39;</span><span class="p">,</span> <span class="s1">&#39;FILE_DESCRIPTIONS&#39;</span><span class="p">]:</span>
            <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="n">keys</span><span class="p">],</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">progress</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_db</span><span class="p">,</span> <span class="n">keys</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="s1">&#39;metadata_field_desc&#39;</span><span class="p">],</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">progress</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_db</span><span class="p">,</span> <span class="s1">&#39;metadata_field_desc.tsv&#39;</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;bac120_metadata&#39;</span><span class="p">,</span> <span class="s1">&#39;bac120_ssu&#39;</span><span class="p">]:</span>
            <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="n">keys</span><span class="p">],</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">progress</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">amplicon2genome_db</span><span class="p">,</span> <span class="n">keys</span><span class="o">+</span><span class="s1">&#39;.tar.gz&#39;</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Metagenomics.make_json_from_genomes" class="doc doc-heading">
<code class="highlight language-python"><span class="n">make_json_from_genomes</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function takes a csv file directory. The CSV file must include three columns:
1- genome_id: Identifier for the genome, preferrably; NCBI ID
2- NCBI_Name: NCBI taxonomy name for the genome: Does not need to be in a specific format
3- Genome_Dir: Absolute path to the fasta files: NOT .gz</p>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">make_json_from_genomes</span><span class="p">(</span><span class="n">input_dir</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">output_dir</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function takes a csv file directory. The CSV file must include three columns:</span>
<span class="sd">    1- genome_id: Identifier for the genome, preferrably; NCBI ID</span>
<span class="sd">    2- NCBI_Name: NCBI taxonomy name for the genome: Does not need to be in a specific format</span>
<span class="sd">    3- Genome_Dir: Absolute path to the fasta files: NOT .gz</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">genomes_json</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">genomes_table</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
    <span class="n">genomes_table</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;genome_id&quot;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span><span class="p">[</span><span class="n">gi</span><span class="p">]</span> <span class="ow">in</span> <span class="n">genomes_table</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="n">genomes_json</span><span class="p">[</span><span class="n">gi</span><span class="p">]</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">genomes_json</span><span class="p">[</span><span class="n">gi</span><span class="p">][</span><span class="s2">&quot;NCBI_Name&quot;</span><span class="p">]</span><span class="o">=</span> <span class="n">genomes_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gi</span><span class="p">,</span><span class="s2">&quot;NCBI_Name&quot;</span><span class="p">]</span>
        <span class="n">genomes_json</span><span class="p">[</span><span class="n">gi</span><span class="p">][</span><span class="s2">&quot;Genome_Dir&quot;</span><span class="p">]</span><span class="o">=</span> <span class="n">genomes_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gi</span><span class="p">,</span><span class="s2">&quot;Genome_Dir&quot;</span><span class="p">]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">genomes_json</span><span class="p">,</span><span class="n">fp</span><span class="p">)</span>
    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Metagenomics.run_qiime2_from_sra" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run_qiime2_from_sra</span><span class="p">(</span><span class="n">accession</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">run</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  

<details class="requires">
  <summary>Requires</summary>
  <p><R>project_accession</R>
<R>Configs.Metagenomics</R>
<R>sra_project_dir</R>
<R>.fastq_files</R></p>
</details>
<details class="satisfies">
  <summary>Satisfies</summary>
  <p><S>qiime2_work_dir</S>
<S>qiime2_bash_str</S>
<S>manifest.csv</S>
<if>save=True</if><S>qiime2_bash_file</S>
<if>run=True</if><S>qiime2_outputs</S></p>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>accession</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The accession number of the SRA project or run</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>save</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If True, the  bash scripts will be saved in the SRA work directory. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>run</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If True, the bash scripts will be executed. Defaults to True. You must have the SRA toolkit installed in your system.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>container</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>If you want to run the qiime2 commands in a container, specify the container name here. Defaults to 'None'.</p></td>
          <td>
                <code>&#39;None&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>qiime2_bash_str</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>The bash script that will be used to run qiime2 in python string format</p></td>
        </tr>
        <tr>
<td><code>manifest</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>The manifest file that will be used to run qiime2 in python dictionary format</p></td>
        </tr>
    </tbody>
  </table>

<details class="todo">
  <summary>TODO</summary>
  <p>add the ability to submit slurm jobs to cluster
add singularity support</p>
</details>
      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_qiime2_from_sra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">accession</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">save</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">run</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">container</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Requires:</span>
<span class="sd">        &lt;R&gt;project_accession&lt;/R&gt;</span>
<span class="sd">        &lt;R&gt;Configs.Metagenomics&lt;/R&gt;</span>
<span class="sd">        &lt;R&gt;sra_project_dir&lt;/R&gt;</span>
<span class="sd">        &lt;R&gt;.fastq_files&lt;/R&gt;</span>
<span class="sd">    Satisfies:</span>
<span class="sd">        &lt;S&gt;qiime2_work_dir&lt;/S&gt;</span>
<span class="sd">        &lt;S&gt;qiime2_bash_str&lt;/S&gt;</span>
<span class="sd">        &lt;S&gt;manifest.csv&lt;/S&gt;</span>
<span class="sd">        &lt;if&gt;save=True&lt;/if&gt;&lt;S&gt;qiime2_bash_file&lt;/S&gt;</span>
<span class="sd">        &lt;if&gt;run=True&lt;/if&gt;&lt;S&gt;qiime2_outputs&lt;/S&gt;</span>
<span class="sd">    Args:</span>
<span class="sd">        accession (str): The accession number of the SRA project or run</span>
<span class="sd">        save (bool, optional): If True, the  bash scripts will be saved in the SRA work directory. Defaults to True.</span>
<span class="sd">        run (bool, optional): If True, the bash scripts will be executed. Defaults to True. You must have the SRA toolkit installed in your system.</span>
<span class="sd">        container (str, optional): If you want to run the qiime2 commands in a container, specify the container name here. Defaults to &#39;None&#39;.</span>
<span class="sd">    Returns:</span>
<span class="sd">        qiime2_bash_str (str): The bash script that will be used to run qiime2 in python string format</span>
<span class="sd">        manifest (dict): The manifest file that will be used to run qiime2 in python dictionary format</span>

<span class="sd">    TODO:</span>
<span class="sd">        add the ability to submit slurm jobs to cluster</span>
<span class="sd">        add singularity support</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">qiime2_work_dir</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime2_work_dir</span><span class="p">(</span><span class="n">accession</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">qiime2_work_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">qiime2_work_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">sra_project_dir</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sra_work_dir</span><span class="p">(</span><span class="n">accession</span><span class="p">))</span>
    <span class="n">seqs</span><span class="o">=</span><span class="n">sra_project_dir</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;seqs&quot;</span><span class="p">)</span>
    <span class="n">manifest_single</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sample-id&#39;</span><span class="p">:[],</span><span class="s1">&#39;absolute-filepath&#39;</span><span class="p">:[]}</span>
    <span class="n">manifest_paired</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sample-id&#39;</span><span class="p">:[],</span><span class="s1">&#39;forward-absolute-filepath&#39;</span><span class="p">:[],</span><span class="s1">&#39;reverse-absolute-filepath&#39;</span><span class="p">:[]}</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">seqs</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.fastq&quot;</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">r1</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*_1.fastq&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">r2</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*_2.fastq&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">manifest_paired</span><span class="p">[</span><span class="s1">&#39;sample-id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">manifest_paired</span><span class="p">[</span><span class="s1">&#39;forward-absolute-filepath&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">r1</span><span class="p">))</span>
                <span class="n">manifest_paired</span><span class="p">[</span><span class="s1">&#39;reverse-absolute-filepath&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">r2</span><span class="p">))</span>
                <span class="n">paired_end</span><span class="o">=</span><span class="kc">True</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.fastq&quot;</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">r1</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.fastq&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">manifest_single</span><span class="p">[</span><span class="s1">&#39;sample-id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">manifest_single</span><span class="p">[</span><span class="s1">&#39;absolute-filepath&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">r1</span><span class="p">))</span>
                <span class="n">paired_end</span><span class="o">=</span><span class="kc">False</span>

    <span class="n">manifest</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">manifest_single</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">paired_end</span> <span class="k">else</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">manifest_paired</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">paired_end</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime2_paired_end_bash_str</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime2_single_end_bash_str</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="n">manifest_dir</span><span class="o">=</span><span class="n">sra_project_dir</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;manifest.tsv&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;None&quot;</span><span class="p">:</span>
        <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;manifest&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">manifest_dir</span><span class="p">))</span>
        <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;qiime2_work_dir&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">qiime2_work_dir</span><span class="p">))</span>
        <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;classifier&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">))</span>

    <span class="k">elif</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;docker&quot;</span><span class="p">:</span>
        <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">qiime2_bash_str</span><span class="p">):</span>
            <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;qiime&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;biom&quot;</span><span class="p">):</span>
                <span class="n">qiime2_bash_str</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;docker run --env TMPDIR=/data/tmp -v </span><span class="si">{</span><span class="n">sra_project_dir</span><span class="si">}</span><span class="s2">:/data/ -v </span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="si">}</span><span class="s2">:/data/</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> -w /data  </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime2_docker_image</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="n">line</span>
        <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">qiime2_bash_str</span><span class="p">)</span>
        <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;manifest&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">manifest_dir</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;qiime2_work_dir&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">qiime2_work_dir</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;classifier&gt;&quot;</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">)))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">paired_end</span><span class="p">:</span>
            <span class="n">manifest</span><span class="p">[</span><span class="s1">&#39;absolute-filepath&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/data&quot;</span><span class="p">)</span><span class="o">/</span><span class="n">seqs</span><span class="o">.</span><span class="n">name</span><span class="o">/</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="o">/</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">manifest</span><span class="p">[</span><span class="s1">&#39;absolute-filepath&#39;</span><span class="p">]]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">manifest</span><span class="p">[</span><span class="s1">&#39;forward-absolute-filepath&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/data&quot;</span><span class="p">)</span><span class="o">/</span><span class="n">seqs</span><span class="o">.</span><span class="n">name</span><span class="o">/</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="o">/</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">manifest</span><span class="p">[</span><span class="s1">&#39;forward-absolute-filepath&#39;</span><span class="p">]]</span>
            <span class="n">manifest</span><span class="p">[</span><span class="s1">&#39;reverse-absolute-filepath&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/data&quot;</span><span class="p">)</span><span class="o">/</span><span class="n">seqs</span><span class="o">.</span><span class="n">name</span><span class="o">/</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="o">/</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">manifest</span><span class="p">[</span><span class="s1">&#39;reverse-absolute-filepath&#39;</span><span class="p">]]</span>

    <span class="k">elif</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;singularity&quot;</span><span class="p">:</span>
        <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">qiime2_bash_str</span><span class="p">):</span>
            <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;qiime&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;biom&quot;</span><span class="p">):</span>
                <span class="n">qiime2_bash_str</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;singularity exec --bind  $PWD:$PWD,</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">))</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">))</span><span class="si">}</span><span class="s2">,$SINGULARITY_TMPDIR:/tmp  </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime2_singularity_image</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="o">+</span><span class="n">line</span>
        <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">qiime2_bash_str</span><span class="p">)</span>
        <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;manifest&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">manifest_dir</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;qiime2_work_dir&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">qiime2_work_dir</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="n">qiime2_bash_str</span><span class="o">=</span><span class="n">qiime2_bash_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;classifier&gt;&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">qiime_classifier_db</span><span class="p">)))</span>

        <span class="c1"># if not paired_end:</span>
        <span class="c1">#     manifest[&#39;absolute-filepath&#39;]=[&quot;/&quot;+str(Path(seqs.name)/pathlib.Path(x).parent.name/pathlib.Path(x).name) for x in manifest[&#39;absolute-filepath&#39;]]</span>
        <span class="c1"># else:</span>
        <span class="c1">#     manifest[&#39;forward-absolute-filepath&#39;]=[&quot;/&quot;+str(Path(seqs.name)/pathlib.Path(x).parent.name/pathlib.Path(x).name) for x in manifest[&#39;forward-absolute-filepath&#39;]]</span>
        <span class="c1">#     manifest[&#39;reverse-absolute-filepath&#39;]=[&quot;/&quot;+str(Path(seqs.name)/pathlib.Path(x).parent.name/pathlib.Path(x).name) for x in manifest[&#39;reverse-absolute-filepath&#39;]]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Container must be None, singularity or docker&quot;</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">manifest</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">sra_project_dir</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;manifest.tsv&quot;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">qiime2_work_dir</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;qiime2.sh&quot;</span><span class="p">),</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">qiime2_bash_str</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">run</span><span class="p">:</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">qiime2_work_dir</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;qiime2.sh&quot;</span><span class="p">))],</span><span class="n">cwd</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">qiime2_work_dir</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">qiime2_bash_str</span><span class="p">,</span><span class="n">manifest</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.core.Metagenomics.seqs_from_sra" class="doc doc-heading">
<code class="highlight language-python"><span class="n">seqs_from_sra</span><span class="p">(</span><span class="n">accession</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">run</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method downloads the fastq files from the SRA database using the accession number of the project or run.
The method uses the fasterq-dump tool to download the fastq files. The method also creates two bash scripts
that can be used to download the fastq files. The first bash script is used to download the SRA files using the
prefetch tool. The second bash script is used to convert the SRA files to fastq files using the fasterq-dump tool.
depending on the prefered containerization tool, the bash scripts can be converted to singularity or docker containers commands.
In the case of docker or singularity you do not need to install the SRA tools on your machine. However, you need to have the
containerization tool installed on your machine.</p>

<details class="requires">
  <summary>Requires</summary>
  <p><R>project_accession</R>
<R>Configs.Metagenomics</R></p>
</details>
<details class="satisfies">
  <summary>Satisfies</summary>
  <p><S>sra_project_dir</S>
<S>sra_seq_prefetch_bash_str</S>
<S>sra_seq_fasterq_dump_bash_str</S>
<S>manifest_dict</S>
<if> save=True</if><S>sra_seq_prefetch_bash_file</S>
<if> save=True</if><S>sra_seq_fasterq_dump_bash_file</S>
<if> run=True</if><S>.fastq_files</S></p>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>accession</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The accession number of the SRA project or run</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>save</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If True, the  bash scripts will be saved in the SRA work directory. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>run</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If True, the bash scripts will be executed. Defaults to True. You must have the SRA toolkit installed in your system.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>prefetch_script</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>The bash script that will be used to download the SRA files in python string format</p></td>
        </tr>
        <tr>
<td><code>fasterq_dump_script</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>The bash script that will be used to convert the SRA files to fastq files in python string format</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/core.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">seqs_from_sra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">accession</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">save</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">run</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">container</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    This method downloads the fastq files from the SRA database using the accession number of the project or run.</span>
<span class="sd">    The method uses the fasterq-dump tool to download the fastq files. The method also creates two bash scripts</span>
<span class="sd">    that can be used to download the fastq files. The first bash script is used to download the SRA files using the</span>
<span class="sd">    prefetch tool. The second bash script is used to convert the SRA files to fastq files using the fasterq-dump tool.</span>
<span class="sd">    depending on the prefered containerization tool, the bash scripts can be converted to singularity or docker containers commands.</span>
<span class="sd">    In the case of docker or singularity you do not need to install the SRA tools on your machine. However, you need to have the</span>
<span class="sd">    containerization tool installed on your machine.</span>

<span class="sd">    Requires:</span>
<span class="sd">        &lt;R&gt;project_accession&lt;/R&gt;</span>
<span class="sd">        &lt;R&gt;Configs.Metagenomics&lt;/R&gt;</span>
<span class="sd">    Satisfies:</span>
<span class="sd">        &lt;S&gt;sra_project_dir&lt;/S&gt;</span>
<span class="sd">        &lt;S&gt;sra_seq_prefetch_bash_str&lt;/S&gt;</span>
<span class="sd">        &lt;S&gt;sra_seq_fasterq_dump_bash_str&lt;/S&gt;</span>
<span class="sd">        &lt;S&gt;manifest_dict&lt;/S&gt;</span>
<span class="sd">        &lt;if&gt; save=True&lt;/if&gt;&lt;S&gt;sra_seq_prefetch_bash_file&lt;/S&gt;</span>
<span class="sd">        &lt;if&gt; save=True&lt;/if&gt;&lt;S&gt;sra_seq_fasterq_dump_bash_file&lt;/S&gt;</span>
<span class="sd">        &lt;if&gt; run=True&lt;/if&gt;&lt;S&gt;.fastq_files&lt;/S&gt;</span>

<span class="sd">    Args:</span>
<span class="sd">        accession (str): The accession number of the SRA project or run</span>
<span class="sd">        save (bool, optional): If True, the  bash scripts will be saved in the SRA work directory. Defaults to True.</span>
<span class="sd">        run (bool, optional): If True, the bash scripts will be executed. Defaults to True. You must have the SRA toolkit installed in your system.</span>

<span class="sd">    Returns:</span>
<span class="sd">        prefetch_script (str): The bash script that will be used to download the SRA files in python string format</span>
<span class="sd">        fasterq_dump_script (str): The bash script that will be used to convert the SRA files to fastq files in python string format</span>

<span class="sd">    &quot;&quot;&quot;</span>   
    <span class="k">if</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;None&quot;</span><span class="p">:</span>
        <span class="n">prefetch_script</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;#!/bin/bash</span>
<span class="s2">        prefetch </span><span class="si">{</span><span class="n">accession</span><span class="si">}</span><span class="s2"> -O </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sra_work_dir</span><span class="p">(</span><span class="n">accession</span><span class="p">),</span><span class="s2">&quot;seqs&quot;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>

        <span class="n">fasterq_dump_script</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;#!/bin/bash</span>
<span class="s2">        for i in $(ls ./seqs/) ; do</span>
<span class="s2">        fasterq-dump --split-files seqs/$i/*.sra -O seqs/$i/</span>
<span class="s2">        rm seqs/$i/*.sra</span>
<span class="s2">        done</span>
<span class="s2">        &quot;&quot;&quot;</span>

    <span class="k">elif</span> <span class="n">container</span><span class="o">==</span><span class="s2">&quot;docker&quot;</span><span class="p">:</span>
        <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Docker is not supported yet&quot;</span><span class="p">)</span>

    <span class="n">project_path</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sra_work_dir</span><span class="p">(</span><span class="n">accession</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">project_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">project_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">project_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;prefetch.sh&quot;</span><span class="p">),</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">prefetch_script</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">project_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;fasterq_dump.sh&quot;</span><span class="p">),</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fasterq_dump_script</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">run</span><span class="p">:</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">project_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;prefetch.sh&quot;</span><span class="p">))],</span><span class="n">cwd</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">project_path</span><span class="p">))</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;bash&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">project_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;fasterq_dump.sh&quot;</span><span class="p">))],</span><span class="n">cwd</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">project_path</span><span class="p">))</span>



    <span class="k">return</span> <span class="n">prefetch_script</span><span class="p">,</span><span class="n">fasterq_dump_script</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="adm">adm</h2>
<p>Here is a schematic view of adm API:</p>
<p><img alt="adm" src="../ADM.svg" /></p>
<p>You can access this module by:</p>
<pre><code>from adtoolbox import adm 

</code></pre>
<p>This module includes the following classes:</p>


<div class="doc doc-object doc-module">


<a id="adtoolbox.adm"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="adtoolbox.adm.Model" class="doc doc-heading">
        <code>Model</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>General Class For a Model</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>Model</code></td>
          <td>
                <code>Parameters (dict</code>
          </td>
          <td><p>a dictionary which contains model parameters</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>base_parameters</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>a dictionary which contains base paramters</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Initial</code></td>
          <td>
                <code>Conditions (dict</code>
          </td>
          <td><p>a dictionary containing inlet conditions for all species</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Inlet</code></td>
          <td>
                <code>Conditions (dict</code>
          </td>
          <td><p>a dictionary containing inlet conditions for all species</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>reactions</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>a list containing all types of reactions</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>species</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>a list containing all species</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>ODE_System</code></td>
          <td>
                <code>function</code>
          </td>
          <td><p>a function which solves inital value ODEs</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Build</code></td>
          <td>
                <code>Stoiciometric Matrix (function</code>
          </td>
          <td><p>a function which outputs a matrix for of all reactions</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td><p>adtoolbox.ADM.Model: returns a model instance for downstream purposes.</p></td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>adtoolbox/adm.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Model</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;General Class For a Model</span>
<span class="sd">    Args:</span>
<span class="sd">        Model Parameters (dict): a dictionary which contains model parameters</span>
<span class="sd">        base_parameters (dict): a dictionary which contains base paramters</span>
<span class="sd">        Initial Conditions (dict): a dictionary containing inlet conditions for all species</span>
<span class="sd">        Inlet Conditions (dict): a dictionary containing inlet conditions for all species</span>
<span class="sd">        reactions (list): a list containing all types of reactions</span>
<span class="sd">        species (list): a list containing all species</span>
<span class="sd">        ODE_System (function): a function which solves inital value ODEs</span>
<span class="sd">        Build Stoiciometric Matrix (function): a function which outputs a matrix for of all reactions</span>

<span class="sd">    Returns:</span>
<span class="sd">        adtoolbox.ADM.Model: returns a model instance for downstream purposes.</span>
<span class="sd">    &quot;&quot;&quot;</span>



    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_parameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">base_parameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">initial_conditions</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">inlet_conditions</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">reactions</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">species</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">ode_system</span><span class="p">:</span><span class="n">Callable</span><span class="p">,</span> <span class="n">build_stoichiometric_matrix</span><span class="p">:</span><span class="n">Callable</span><span class="p">,</span><span class="n">control_state</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="p">{},</span><span class="n">metagenome_report</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;ADM1&quot;</span><span class="p">,</span> <span class="n">switch</span><span class="o">=</span><span class="s2">&quot;DAE&quot;</span><span class="p">,</span><span class="n">simulation_time</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span> <span class="o">=</span> <span class="n">model_parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_parameters</span> <span class="o">=</span> <span class="n">base_parameters</span>


        <span class="k">for</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">control_state</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">initial_conditions</span><span class="p">[</span><span class="n">items</span><span class="p">]</span>
            <span class="n">initial_conditions</span><span class="p">[</span><span class="n">items</span><span class="p">]</span><span class="o">=</span><span class="n">control_state</span><span class="p">[</span><span class="n">items</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_state</span><span class="o">=</span><span class="n">control_state</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">inlet_conditions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="n">inlet_conditions</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="s2">&quot;_in&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">species</span><span class="p">])[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="o">=</span> <span class="n">reactions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">species</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_conditions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="n">initial_conditions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">species</span><span class="p">])[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ic</span><span class="o">=</span><span class="n">initial_conditions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inc</span><span class="o">=</span><span class="n">inlet_conditions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">switch</span> <span class="o">=</span> <span class="n">switch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metagenome_report</span> <span class="o">=</span> <span class="n">metagenome_report</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="n">build_stoichiometric_matrix</span><span class="p">(</span>
            <span class="n">base_parameters</span><span class="p">,</span> <span class="n">model_parameters</span><span class="p">,</span> <span class="n">reactions</span><span class="p">,</span> <span class="n">species</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ode_system</span> <span class="o">=</span> <span class="n">ode_system</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="o">=</span><span class="n">simulation_time</span>

    <span class="c1"># def Build_COBRA_Model(self, save_model=True):</span>
    <span class="c1">#     model = cobra.Model(self.Name)</span>

    <span class="c1">#     for i in range(len(self.reactions)):</span>
    <span class="c1">#         Temp_Rxn = cobra.Reaction(</span>
    <span class="c1">#             self.reactions[i].replace(&quot; &quot;, &quot;_&quot;), name=self.reactions[i].replace(&quot; &quot;, &quot;_&quot;))</span>
    <span class="c1">#         Temp_Mets = np.where(self.S[:, i] != 0)</span>
    <span class="c1">#         Met_Dict = {}</span>
    <span class="c1">#         for met in Temp_Mets[0]:</span>
    <span class="c1">#             Metabolite = cobra.Metabolite(self.species[met].replace(&quot; &quot;, &quot;_&quot;),</span>
    <span class="c1">#                                           name=self.species[met].replace(&quot; &quot;, &quot;_&quot;), compartment=&quot;Model&quot;)</span>
    <span class="c1">#             Met_Dict[Metabolite] = self.S[met, i]</span>
    <span class="c1">#         Temp_Rxn.add_metabolites(Met_Dict)</span>
    <span class="c1">#         # print(Temp_Rxn.reaction)</span>
    <span class="c1">#         model.add_reaction(Temp_Rxn)</span>

        <span class="c1"># if save_model:</span>
        <span class="c1">#     cobra.io.save_json_model(model, self.Name+&#39;.json&#39;)</span>

    <span class="k">def</span> <span class="nf">solve_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y0</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">t_eval</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;LSODA&quot;</span><span class="p">,</span> <span class="n">switch</span><span class="o">=</span><span class="s2">&quot;DAF&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">_ivp</span><span class="o">.</span><span class="n">ivp</span><span class="o">.</span><span class="n">OdeResult</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to solve the model. </span>
<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; from ADM import Model</span>
<span class="sd">            &gt;&gt;&gt; import numpy as np</span>
<span class="sd">            &gt;&gt;&gt; reactions=[&#39;rxn1&#39;,&#39;rxn2&#39;]</span>
<span class="sd">            &gt;&gt;&gt; species=[&#39;a&#39;,&#39;b&#39;,&#39;c&#39;]</span>
<span class="sd">            &gt;&gt;&gt; Initial_Conditions={&#39;a&#39;:.001,&#39;b&#39;:.002,&#39;c&#39;:.003}</span>
<span class="sd">            &gt;&gt;&gt; inlet_conditions={&#39;a_in&#39;:.001,&#39;b_in&#39;:.002,&#39;c_in&#39;:.003}</span>
<span class="sd">            &gt;&gt;&gt; model_parameters={&#39;k1&#39;:0.001,&#39;k2&#39;:0.002}</span>
<span class="sd">            &gt;&gt;&gt; base_parameters={&#39;T&#39;:0.1}</span>
<span class="sd">            &gt;&gt;&gt; def Build_Stoiciometric_Matrix(base_parameters,model_parameters,reactions,species):</span>
<span class="sd">            ...    S = np.zeros((len(species), len(reactions)))</span>
<span class="sd">            ...    S[[0,1],0]=[-1,0.001]</span>
<span class="sd">            ...    S[[1,2],1]=[-5,1]</span>
<span class="sd">            ...    return S</span>
<span class="sd">            &gt;&gt;&gt; def ODE_System(t,c,Model1):</span>
<span class="sd">            ...    v = np.zeros((len(Model1.reactions), 1))</span>
<span class="sd">            ...    v[0]=Model1.model_parameters[&#39;k1&#39;]*c[0]*Model1.base_parameters[&#39;T&#39;]/1000</span>
<span class="sd">            ...    v[1]=Model1.model_parameters[&#39;k2&#39;]*c[1]/1000</span>
<span class="sd">            ...    dCdt=np.matmul(Model1.S,v)</span>
<span class="sd">            ...    return dCdt[:, 0]</span>
<span class="sd">            &gt;&gt;&gt; m= Model(model_parameters,base_parameters,Initial_Conditions,inlet_conditions,reactions,species,ODE_System,Build_Stoiciometric_Matrix)</span>
<span class="sd">            &gt;&gt;&gt; m.Solve_Model((0,.1),m.Initial_Conditions[:, 0],np.linspace(0,0.1,10),method=&#39;RK45&#39;)[&#39;status&#39;]==0</span>
<span class="sd">            True</span>

<span class="sd">        Args:</span>
<span class="sd">            t_span (tuple): The range the time will include</span>
<span class="sd">            y0 (np.ndarray): The initial value at time = 0</span>
<span class="sd">            T_eval (np.ndarray): The time steps that will be evaluated</span>

<span class="sd">        Returns:</span>
<span class="sd">            scipy.integrate._ivp.ivp.OdeResult: Returns the results of the simulation being run and gives optimized paramters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Fluxes&quot;</span><span class="p">:[]}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">solve_ivp</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ode_system</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="p">),</span> <span class="n">y0</span><span class="p">,</span> <span class="n">t_eval</span><span class="o">=</span><span class="n">t_eval</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="p">])</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not solve model, setting C to a very large value&quot;</span><span class="p">)</span>
            <span class="n">c</span><span class="o">=</span><span class="n">_Fake_Sol</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">y0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">t_eval</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()))</span><span class="o">*</span><span class="mf">1e10</span><span class="p">,</span><span class="n">t_eval</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">c</span>


       <span class="c1">#C = scipy.integrate.solve_ivp(</span>
       <span class="c1">#        self.ODE_System, t_span, y0, t_eval=T_eval, method=method, args=[self])</span>
       <span class="c1">#</span>
       <span class="c1">#return C</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Sol</span><span class="p">:</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">_ivp</span><span class="o">.</span><span class="n">ivp</span><span class="o">.</span><span class="n">OdeResult</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Line&quot;</span><span class="p">)</span><span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; A function which returns a plot of the solution from the ODE</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">solution</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="n">Sol</span><span class="o">.</span><span class="n">t</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)):</span>
            <span class="n">solution</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Sol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">sol_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;Line&quot;</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">sol_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">sol_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
                          <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Concentration of species&quot;</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">sol_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">textposition</span><span class="o">=</span><span class="s2">&quot;bottom center&quot;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="p">{</span>
                    <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
                    <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>

                    <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
                    <span class="s1">&#39;xanchor&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;yanchor&#39;</span><span class="p">:</span> <span class="s1">&#39;top&#39;</span><span class="p">}</span>

            <span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Time (Days)&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Concentrations (kg COD/m^3)&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;Sankey&quot;</span><span class="p">:</span>
            <span class="c1">### Maybe add a sankey plot here later</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">dash_app</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sol</span><span class="p">:</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">_ivp</span><span class="o">.</span><span class="n">ivp</span><span class="o">.</span><span class="n">OdeResult</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Line&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A method that creates the dash web app&quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PKG_DATA</span><span class="p">,</span><span class="s2">&quot;Modified_ADM_Map.json&quot;</span><span class="p">),</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">escher_map</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PKG_DATA</span><span class="p">,</span><span class="s2">&quot;Modified_ADM_Model.json&quot;</span><span class="p">),</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">cobra_model</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>


        <span class="n">app</span> <span class="o">=</span> <span class="n">Dash</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;background&#39;</span><span class="p">:</span> <span class="s1">&#39;#659dbd&#39;</span><span class="p">,</span>
            <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="s1">&#39;#3e4444&#39;</span>
        <span class="p">}</span>


        <span class="n">solution</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="n">sol</span><span class="o">.</span><span class="n">t</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)):</span>
            <span class="n">solution</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">sol_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;Line&quot;</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">sol_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">sol_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
                          <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Concentration of species&quot;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
            <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
            <span class="s1">&#39;xanchor&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span>
            <span class="s1">&#39;yanchor&#39;</span><span class="p">:</span> <span class="s1">&#39;top&#39;</span><span class="p">},</span>
            <span class="n">legend</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span> <span class="mi">20</span><span class="p">))</span>

                <span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Time (Days)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
                <span class="p">},</span>
                 <span class="n">tickfont_size</span><span class="o">=</span><span class="mi">20</span>
                <span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Concentrations (kg COD/m^3)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
             <span class="p">},</span>
             <span class="n">tickfont_size</span><span class="o">=</span><span class="mi">20</span>

                <span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span><span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>

        <span class="n">with_report</span><span class="o">=</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;rgb(200, 200, 200)&#39;</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">:</span><span class="s1">&#39;300px&#39;</span><span class="p">,</span> <span class="s2">&quot;margin-top&quot;</span><span class="p">:</span><span class="s1">&#39;-50px&#39;</span><span class="p">},</span> <span class="n">children</span><span class="o">=</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">H1</span><span class="p">(</span>
            <span class="n">children</span><span class="o">=</span><span class="s1">&#39;ADToolbox&#39;</span><span class="p">,</span>
            <span class="n">style</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span>
                <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
                <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;60px&#39;</span><span class="p">,</span>
                <span class="c1"># &#39;font-family&#39;: &#39;sans-serif&#39;,</span>
                <span class="s1">&#39;padding-top&#39;</span><span class="p">:</span> <span class="s1">&#39;30px&#39;</span><span class="p">,</span>
                <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s2">&quot;rgb(30, 30, 30)&quot;</span><span class="p">,</span>

            <span class="p">}),</span><span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="n">children</span><span class="o">=</span><span class="s2">&quot;A toolbox for modeleing and optimization of anaerobic digestion process&quot;</span><span class="p">,</span>
            <span class="n">style</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span>
                <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s2">&quot;rgb(30, 30, 30)&quot;</span><span class="p">,</span>
                <span class="s1">&#39;font-family&#39;</span><span class="p">:</span> <span class="s1">&#39;sans-serif&#39;</span>

            <span class="p">})</span>
            <span class="p">]),</span>

            <span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> Concentration Plot&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span>
                    <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;BackgroundColor&quot;</span><span class="p">:</span> <span class="s2">&quot;#fbeec1&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;font-family&quot;</span><span class="p">:</span> <span class="s2">&quot;Trebuchet MS&quot;</span><span class="p">,</span>
                    <span class="p">}),</span>


            <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;Concentrations_Line_Plot&#39;</span><span class="p">,</span>
            <span class="n">style</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;backgroundColor&quot;</span><span class="p">:</span> <span class="s2">&quot;#171010&quot;</span><span class="p">,</span>
                <span class="s2">&quot;height&quot;</span><span class="p">:</span><span class="s2">&quot;600px&quot;</span>
            <span class="p">}</span>
            <span class="p">),</span>



            <span class="n">html</span><span class="o">.</span><span class="n">Br</span><span class="p">(),</span>

            <span class="n">html</span><span class="o">.</span><span class="n">H3</span><span class="p">(</span><span class="s2">&quot;base_parameters&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span>
                    <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;BackgroundColor&quot;</span><span class="p">:</span> <span class="s2">&quot;#fbeec1&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;font-family&quot;</span><span class="p">:</span> <span class="s2">&quot;Trebuchet MS&quot;</span><span class="p">,</span>
                    <span class="p">}),</span>

            <span class="n">dash_table</span><span class="o">.</span><span class="n">DataTable</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;base_parameters&#39;</span><span class="p">,</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;numeric&quot;</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())],</span>
            <span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;records&#39;</span><span class="p">),</span>
            <span class="n">editable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">style_table</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;overflowX&#39;</span><span class="p">:</span> <span class="s1">&#39;scroll&#39;</span><span class="p">},</span>
            <span class="n">style_header</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;rgb(200, 200, 200)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="n">style_data</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;rgb(250, 250, 250)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
            <span class="s1">&#39;font-family&#39;</span><span class="p">:</span> <span class="s1">&#39;Trebuchet MS&#39;</span><span class="p">,</span>
            <span class="p">}),</span>


            <span class="n">html</span><span class="o">.</span><span class="n">Br</span><span class="p">(),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">H3</span><span class="p">(</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span>
                    <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;BackgroundColor&quot;</span><span class="p">:</span> <span class="s2">&quot;#fbeec1&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;font-family&quot;</span><span class="p">:</span> <span class="s2">&quot;Trebuchet MS&quot;</span><span class="p">,</span>
                    <span class="p">}),</span>



            <span class="n">dash_table</span><span class="o">.</span><span class="n">DataTable</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;model_parameters&#39;</span><span class="p">,</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;numeric&quot;</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())],</span>
            <span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;records&#39;</span><span class="p">),</span>
            <span class="n">editable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">style_table</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;overflowX&#39;</span><span class="p">:</span> <span class="s1">&#39;scroll&#39;</span><span class="p">},</span>
            <span class="n">style_header</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;rgb(200, 200, 200)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="n">style_data</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;rgb(250, 250, 250)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
            <span class="s1">&#39;font-family&#39;</span><span class="p">:</span> <span class="s1">&#39;Trebuchet MS&#39;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="p">,</span>


                <span class="p">),</span>            

            <span class="n">html</span><span class="o">.</span><span class="n">Br</span><span class="p">(),</span>

            <span class="n">html</span><span class="o">.</span><span class="n">H3</span><span class="p">(</span><span class="s2">&quot;Initial_Conditions&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span>
                    <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;BackgroundColor&quot;</span><span class="p">:</span> <span class="s2">&quot;#fbeec1&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;font-family&quot;</span><span class="p">:</span> <span class="s2">&quot;Trebuchet MS&quot;</span><span class="p">,</span>
                    <span class="p">}),</span>

            <span class="n">dash_table</span><span class="o">.</span><span class="n">DataTable</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;Initial_Conditions&#39;</span><span class="p">,</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;numeric&quot;</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ic</span><span class="o">.</span><span class="n">keys</span><span class="p">())],</span>
            <span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ic</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;records&#39;</span><span class="p">),</span>
            <span class="n">editable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">style_table</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;overflowX&#39;</span><span class="p">:</span> <span class="s1">&#39;scroll&#39;</span><span class="p">},</span>
            <span class="n">style_header</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;rgb(200, 200, 200)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="n">style_data</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;rgb(250, 250, 250)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
            <span class="s1">&#39;font-family&#39;</span><span class="p">:</span> <span class="s1">&#39;Trebuchet MS&#39;</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="p">),</span>

            <span class="n">html</span><span class="o">.</span><span class="n">Br</span><span class="p">(),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">H3</span><span class="p">(</span><span class="s2">&quot;inlet_conditions&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span>
                    <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;BackgroundColor&quot;</span><span class="p">:</span> <span class="s2">&quot;#fbeec1&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;font-family&quot;</span><span class="p">:</span> <span class="s2">&quot;Trebuchet MS&quot;</span><span class="p">,</span>
                    <span class="p">}),</span>
            <span class="n">dash_table</span><span class="o">.</span><span class="n">DataTable</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;inlet_conditions&#39;</span><span class="p">,</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;numeric&quot;</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inc</span><span class="o">.</span><span class="n">keys</span><span class="p">())],</span>
            <span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inc</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;records&#39;</span><span class="p">),</span>
            <span class="n">editable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">style_table</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;overflowX&#39;</span><span class="p">:</span> <span class="s1">&#39;scroll&#39;</span><span class="p">},</span>
            <span class="n">style_header</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;rgb(200, 200, 200)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="n">style_data</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;rgb(250, 250, 250)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
            <span class="s1">&#39;font-family&#39;</span><span class="p">:</span> <span class="s1">&#39;Trebuchet MS&#39;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">export_format</span><span class="o">=</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span>
            <span class="n">export_headers</span><span class="o">=</span><span class="s1">&#39;display&#39;</span><span class="p">,</span>
            <span class="n">merge_duplicate_headers</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>

            <span class="n">html</span><span class="o">.</span><span class="n">Br</span><span class="p">(),</span>

                        <span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="s2">&quot;Escher Map&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span>
                    <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;BackgroundColor&quot;</span><span class="p">:</span> <span class="s2">&quot;#fbeec1&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;font-family&quot;</span><span class="p">:</span> <span class="s2">&quot;Trebuchet MS&quot;</span><span class="p">,</span>
                    <span class="p">})</span> <span class="p">,</span>

            <span class="n">dcc</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">([</span><span class="s2">&quot;Show Map&quot;</span><span class="p">,</span><span class="s2">&quot;Hide Map&quot;</span><span class="p">],</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="s2">&quot;300px&quot;</span><span class="p">,</span><span class="s2">&quot;font-size&quot;</span><span class="p">:</span><span class="mi">25</span><span class="p">},</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;Drop_Down_Escher&quot;</span><span class="p">),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">Br</span><span class="p">(),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="n">children</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;Escher_&quot;</span><span class="p">),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="n">children</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;Escher&quot;</span><span class="p">),</span>

            <span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="s2">&quot;Microbial Association&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span>
                    <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;BackgroundColor&quot;</span><span class="p">:</span> <span class="s2">&quot;#fbeec1&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;font-family&quot;</span><span class="p">:</span> <span class="s2">&quot;Trebuchet MS&quot;</span><span class="p">,</span>
                    <span class="p">})</span> <span class="p">,</span>


            <span class="n">dcc</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="s2">&quot;300px&quot;</span><span class="p">,</span><span class="s2">&quot;font-size&quot;</span><span class="p">:</span><span class="mi">25</span><span class="p">},</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;Drop_Down&quot;</span><span class="p">)</span> <span class="p">,</span>

            <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;Annotation_Graph&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="s2">&quot;650px&quot;</span><span class="p">}),</span>



         <span class="p">]</span>
        <span class="n">without_report</span><span class="o">=</span><span class="n">with_report</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>



        <span class="n">app</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="n">with_report</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metagenome_report</span> <span class="k">else</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="n">without_report</span><span class="p">)</span>





        <span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s2">&quot;Escher_&quot;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;children&#39;</span><span class="p">),</span> <span class="n">Input</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s2">&quot;Drop_Down_Escher&quot;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="k">def</span> <span class="nf">escher_wrapper</span><span class="p">(</span><span class="n">drop_down_escher</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">drop_down_escher</span><span class="o">==</span><span class="s2">&quot;Show Map&quot;</span><span class="p">:</span>
                <span class="n">Labels</span><span class="o">=</span><span class="p">{}</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="o">/</span><span class="mi">20</span><span class="p">)):</span>
                    <span class="n">Labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="s1">&#39;style&#39;</span><span class="p">:{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#77b0b1&#39;</span><span class="p">}}</span>
                <span class="n">Labels</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Br</span><span class="p">(),</span><span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="s2">&quot;Time (Day)&quot;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">}),</span><span class="n">dcc</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="o">/</span><span class="mi">20</span><span class="p">),</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;Escher_Slider&quot;</span><span class="p">,</span><span class="n">marks</span><span class="o">=</span><span class="n">Labels</span><span class="p">),</span><span class="n">html</span><span class="o">.</span><span class="n">Br</span><span class="p">()]</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s2">&quot;Escher&quot;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;children&#39;</span><span class="p">),</span> <span class="n">Input</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s2">&quot;Drop_Down_Escher&quot;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">),</span>
        <span class="n">Input</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s2">&quot;Escher_Slider&quot;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">))</span>        
        <span class="k">def</span> <span class="nf">draw_escher</span><span class="p">(</span><span class="n">drop_down_escher</span><span class="p">,</span><span class="n">escher_slider</span><span class="p">):</span>
            <span class="n">rxn_data</span><span class="o">=</span><span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ode_system</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span><span class="nb">int</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">30</span><span class="o">*</span><span class="n">escher_slider</span><span class="p">)],</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">fluxes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;Fluxes&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">):</span>
                <span class="n">rxn_data</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;_&quot;</span><span class="p">)]</span><span class="o">=</span> <span class="n">fluxes</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">drop_down_escher</span><span class="o">==</span><span class="s2">&quot;Show Map&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">dash_escher</span><span class="o">.</span><span class="n">DashEscher</span><span class="p">(</span><span class="n">mapData</span><span class="o">=</span><span class="n">escher_map</span><span class="p">,</span><span class="n">modelData</span><span class="o">=</span><span class="n">cobra_model</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="p">{</span>
             <span class="s1">&#39;reaction_data&#39;</span><span class="p">:</span><span class="n">rxn_data</span>
            <span class="p">}</span>
            <span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="s1">&#39;1000px&#39;</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="s1">&#39;100%&#39;</span><span class="p">)</span>
             <span class="p">]</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s2">&quot;Annotation_Graph&quot;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;figure&#39;</span><span class="p">),</span> <span class="n">Input</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s1">&#39;Drop_Down&#39;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">))</span>
        <span class="k">def</span> <span class="nf">update_graph_fig</span><span class="p">(</span><span class="n">input_value</span><span class="p">):</span>
            <span class="n">reactions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span>
            <span class="n">id_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">label_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">parents_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">label_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input_value</span><span class="p">)</span>
            <span class="n">id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">parents_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">id_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">genome_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metagenome_report</span><span class="p">[</span><span class="n">input_value</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">genome_list</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">label_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">parents_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input_value</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">genome_list</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">C</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metagenome_report</span><span class="p">[</span><span class="n">input_value</span><span class="p">][</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">ecs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metagenome_report</span><span class="p">[</span><span class="n">input_value</span><span class="p">][</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">label_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ecs</span><span class="p">)</span>
                        <span class="n">id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">+</span><span class="s2">&quot; : &quot;</span><span class="o">+</span><span class="n">ecs</span><span class="p">)</span>
                        <span class="n">parents_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                        <span class="n">label_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&lt;br&gt;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">metagenome_report</span><span class="p">[</span><span class="n">input_value</span><span class="p">][</span><span class="n">item</span><span class="p">][</span><span class="n">ecs</span><span class="p">]))</span>
                        <span class="n">id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">+</span><span class="s2">&quot; : &quot;</span><span class="o">+</span><span class="n">ecs</span><span class="o">+</span><span class="s2">&quot; : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">C</span><span class="p">))</span>
                        <span class="n">parents_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">+</span><span class="s2">&quot; : &quot;</span><span class="o">+</span><span class="n">ecs</span><span class="p">)</span>
                        <span class="n">C</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">label_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;No Relevant EC Numbers were found for </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> !&quot;</span><span class="p">)</span>
                    <span class="n">parents_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Treemap</span><span class="p">(</span>
                <span class="n">ids</span><span class="o">=</span><span class="n">id_list</span><span class="p">,</span>
                <span class="n">labels</span><span class="o">=</span><span class="n">label_list</span><span class="p">,</span>
                <span class="n">parents</span><span class="o">=</span><span class="n">parents_list</span><span class="p">,</span>
                <span class="n">values</span><span class="o">=</span><span class="nb">list</span><span class="p">([</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">id_list</span><span class="o">.</span><span class="fm">__len__</span><span class="p">())]),</span>
                <span class="n">root_color</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span>
                <span class="n">maxdepth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">marker_colorscale</span> <span class="o">=</span> <span class="s1">&#39;RdBu&#39;</span>


            <span class="p">))</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
            <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>


            <span class="p">)</span>
            <span class="k">return</span> <span class="n">fig</span>

        <span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s1">&#39;Concentrations_Line_Plot&#39;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;figure&#39;</span><span class="p">),</span>
                    <span class="n">Input</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s1">&#39;base_parameters&#39;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">),</span>
                    <span class="n">Input</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s1">&#39;model_parameters&#39;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">),</span>
                    <span class="n">Input</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s1">&#39;Initial_Conditions&#39;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">),</span>
                    <span class="n">Input</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s1">&#39;inlet_conditions&#39;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">))</span>
        <span class="k">def</span> <span class="nf">update_graph_fig</span><span class="p">(</span><span class="n">base_parameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">model_parameters</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">initial_conditions</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">inlet_conditions</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span><span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">plotly</span><span class="o">.</span><span class="n">graph_objects</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;A functions that imports base_parameters, model_parameters, Initial_Conditions, inlet_conditions into the plot.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_state</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">control_state</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">control_state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">initial_conditions</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">base_parameters</span> <span class="o">=</span> <span class="n">base_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initial_conditions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="n">initial_conditions</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">])[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inlet_conditions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="n">inlet_conditions</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="o">+</span><span class="s2">&quot;_in&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">])[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
            <span class="n">update_sol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solve_model</span><span class="p">(</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">initial_conditions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="p">,</span> <span class="mi">10000</span><span class="p">))</span>

            <span class="n">sol</span><span class="o">=</span><span class="n">update_sol</span>
            <span class="n">solution</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="n">update_sol</span><span class="o">.</span><span class="n">t</span><span class="p">,</span>
                        <span class="p">}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)):</span>
                <span class="n">solution</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">update_sol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">sol_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">sol_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">sol_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
                  <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Concentration of species&quot;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
            <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
            <span class="s1">&#39;xanchor&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span>
            <span class="s1">&#39;yanchor&#39;</span><span class="p">:</span> <span class="s1">&#39;top&#39;</span><span class="p">},</span>
            <span class="n">legend</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span> <span class="mi">20</span><span class="p">))</span>

                <span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Time (Days)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
                <span class="p">},</span>
                 <span class="n">tickfont_size</span><span class="o">=</span><span class="mi">20</span>
                <span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Concentrations (kg COD/m^3)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
             <span class="p">},</span>
             <span class="n">tickfont_size</span><span class="o">=</span><span class="mi">20</span>

                <span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span><span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">fig</span>



        <span class="n">app</span><span class="o">.</span><span class="n">run_server</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">8000</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sol_to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Address</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts the matrix to a pandas data frame then to a csv&quot;&quot;&quot;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">Address</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">csv_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sol</span><span class="p">:</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">_ivp</span><span class="o">.</span><span class="n">ivp</span><span class="o">.</span><span class="n">OdeResult</span> <span class="p">,</span><span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts the results to a pandas data frame then to a csv&quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">sol</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">address</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;_Report.csv&quot;</span><span class="p">),</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="adtoolbox.adm.Model.csv_report" class="doc doc-heading">
<code class="highlight language-python"><span class="n">csv_report</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Converts the results to a pandas data frame then to a csv</p>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/adm.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">csv_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sol</span><span class="p">:</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">_ivp</span><span class="o">.</span><span class="n">ivp</span><span class="o">.</span><span class="n">OdeResult</span> <span class="p">,</span><span class="n">address</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts the results to a pandas data frame then to a csv&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">sol</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">address</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;_Report.csv&quot;</span><span class="p">),</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
              <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="adtoolbox.adm.Model.dash_app" class="doc doc-heading">
<code class="highlight language-python"><span class="n">dash_app</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;Line&#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>A method that creates the dash web app</p>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/adm.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">dash_app</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sol</span><span class="p">:</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">_ivp</span><span class="o">.</span><span class="n">ivp</span><span class="o">.</span><span class="n">OdeResult</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Line&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A method that creates the dash web app&quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PKG_DATA</span><span class="p">,</span><span class="s2">&quot;Modified_ADM_Map.json&quot;</span><span class="p">),</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">escher_map</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PKG_DATA</span><span class="p">,</span><span class="s2">&quot;Modified_ADM_Model.json&quot;</span><span class="p">),</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">cobra_model</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>


    <span class="n">app</span> <span class="o">=</span> <span class="n">Dash</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;background&#39;</span><span class="p">:</span> <span class="s1">&#39;#659dbd&#39;</span><span class="p">,</span>
        <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="s1">&#39;#3e4444&#39;</span>
    <span class="p">}</span>


    <span class="n">solution</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="n">sol</span><span class="o">.</span><span class="n">t</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)):</span>
        <span class="n">solution</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">sol_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;Line&quot;</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">sol_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">sol_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
                      <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Concentration of species&quot;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
        <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
        <span class="s1">&#39;xanchor&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span>
        <span class="s1">&#39;yanchor&#39;</span><span class="p">:</span> <span class="s1">&#39;top&#39;</span><span class="p">},</span>
        <span class="n">legend</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span> <span class="mi">20</span><span class="p">))</span>

            <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Time (Days)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
            <span class="p">},</span>
             <span class="n">tickfont_size</span><span class="o">=</span><span class="mi">20</span>
            <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Concentrations (kg COD/m^3)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
         <span class="p">},</span>
         <span class="n">tickfont_size</span><span class="o">=</span><span class="mi">20</span>

            <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span><span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>

    <span class="n">with_report</span><span class="o">=</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;rgb(200, 200, 200)&#39;</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">:</span><span class="s1">&#39;300px&#39;</span><span class="p">,</span> <span class="s2">&quot;margin-top&quot;</span><span class="p">:</span><span class="s1">&#39;-50px&#39;</span><span class="p">},</span> <span class="n">children</span><span class="o">=</span><span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">H1</span><span class="p">(</span>
        <span class="n">children</span><span class="o">=</span><span class="s1">&#39;ADToolbox&#39;</span><span class="p">,</span>
        <span class="n">style</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span>
            <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
            <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;60px&#39;</span><span class="p">,</span>
            <span class="c1"># &#39;font-family&#39;: &#39;sans-serif&#39;,</span>
            <span class="s1">&#39;padding-top&#39;</span><span class="p">:</span> <span class="s1">&#39;30px&#39;</span><span class="p">,</span>
            <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s2">&quot;rgb(30, 30, 30)&quot;</span><span class="p">,</span>

        <span class="p">}),</span><span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="n">children</span><span class="o">=</span><span class="s2">&quot;A toolbox for modeleing and optimization of anaerobic digestion process&quot;</span><span class="p">,</span>
        <span class="n">style</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span>
            <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s2">&quot;rgb(30, 30, 30)&quot;</span><span class="p">,</span>
            <span class="s1">&#39;font-family&#39;</span><span class="p">:</span> <span class="s1">&#39;sans-serif&#39;</span>

        <span class="p">})</span>
        <span class="p">]),</span>

        <span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> Concentration Plot&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
                <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                <span class="s2">&quot;BackgroundColor&quot;</span><span class="p">:</span> <span class="s2">&quot;#fbeec1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;font-family&quot;</span><span class="p">:</span> <span class="s2">&quot;Trebuchet MS&quot;</span><span class="p">,</span>
                <span class="p">}),</span>


        <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;Concentrations_Line_Plot&#39;</span><span class="p">,</span>
        <span class="n">style</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;backgroundColor&quot;</span><span class="p">:</span> <span class="s2">&quot;#171010&quot;</span><span class="p">,</span>
            <span class="s2">&quot;height&quot;</span><span class="p">:</span><span class="s2">&quot;600px&quot;</span>
        <span class="p">}</span>
        <span class="p">),</span>



        <span class="n">html</span><span class="o">.</span><span class="n">Br</span><span class="p">(),</span>

        <span class="n">html</span><span class="o">.</span><span class="n">H3</span><span class="p">(</span><span class="s2">&quot;base_parameters&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
                <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                <span class="s2">&quot;BackgroundColor&quot;</span><span class="p">:</span> <span class="s2">&quot;#fbeec1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;font-family&quot;</span><span class="p">:</span> <span class="s2">&quot;Trebuchet MS&quot;</span><span class="p">,</span>
                <span class="p">}),</span>

        <span class="n">dash_table</span><span class="o">.</span><span class="n">DataTable</span><span class="p">(</span>
        <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;base_parameters&#39;</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;numeric&quot;</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())],</span>
        <span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;records&#39;</span><span class="p">),</span>
        <span class="n">editable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">style_table</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;overflowX&#39;</span><span class="p">:</span> <span class="s1">&#39;scroll&#39;</span><span class="p">},</span>
        <span class="n">style_header</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;rgb(200, 200, 200)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
        <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="n">style_data</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;rgb(250, 250, 250)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
        <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
        <span class="s1">&#39;font-family&#39;</span><span class="p">:</span> <span class="s1">&#39;Trebuchet MS&#39;</span><span class="p">,</span>
        <span class="p">}),</span>


        <span class="n">html</span><span class="o">.</span><span class="n">Br</span><span class="p">(),</span>
        <span class="n">html</span><span class="o">.</span><span class="n">H3</span><span class="p">(</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
                <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                <span class="s2">&quot;BackgroundColor&quot;</span><span class="p">:</span> <span class="s2">&quot;#fbeec1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;font-family&quot;</span><span class="p">:</span> <span class="s2">&quot;Trebuchet MS&quot;</span><span class="p">,</span>
                <span class="p">}),</span>



        <span class="n">dash_table</span><span class="o">.</span><span class="n">DataTable</span><span class="p">(</span>
        <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;model_parameters&#39;</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;numeric&quot;</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())],</span>
        <span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;records&#39;</span><span class="p">),</span>
        <span class="n">editable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">style_table</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;overflowX&#39;</span><span class="p">:</span> <span class="s1">&#39;scroll&#39;</span><span class="p">},</span>
        <span class="n">style_header</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;rgb(200, 200, 200)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
        <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="n">style_data</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;rgb(250, 250, 250)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
        <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
        <span class="s1">&#39;font-family&#39;</span><span class="p">:</span> <span class="s1">&#39;Trebuchet MS&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="p">,</span>


            <span class="p">),</span>            

        <span class="n">html</span><span class="o">.</span><span class="n">Br</span><span class="p">(),</span>

        <span class="n">html</span><span class="o">.</span><span class="n">H3</span><span class="p">(</span><span class="s2">&quot;Initial_Conditions&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
                <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                <span class="s2">&quot;BackgroundColor&quot;</span><span class="p">:</span> <span class="s2">&quot;#fbeec1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;font-family&quot;</span><span class="p">:</span> <span class="s2">&quot;Trebuchet MS&quot;</span><span class="p">,</span>
                <span class="p">}),</span>

        <span class="n">dash_table</span><span class="o">.</span><span class="n">DataTable</span><span class="p">(</span>
        <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;Initial_Conditions&#39;</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;numeric&quot;</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ic</span><span class="o">.</span><span class="n">keys</span><span class="p">())],</span>
        <span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ic</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;records&#39;</span><span class="p">),</span>
        <span class="n">editable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">style_table</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;overflowX&#39;</span><span class="p">:</span> <span class="s1">&#39;scroll&#39;</span><span class="p">},</span>
        <span class="n">style_header</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;rgb(200, 200, 200)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
        <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="n">style_data</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;rgb(250, 250, 250)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
        <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
        <span class="s1">&#39;font-family&#39;</span><span class="p">:</span> <span class="s1">&#39;Trebuchet MS&#39;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="p">),</span>

        <span class="n">html</span><span class="o">.</span><span class="n">Br</span><span class="p">(),</span>
        <span class="n">html</span><span class="o">.</span><span class="n">H3</span><span class="p">(</span><span class="s2">&quot;inlet_conditions&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
                <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                <span class="s2">&quot;BackgroundColor&quot;</span><span class="p">:</span> <span class="s2">&quot;#fbeec1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;font-family&quot;</span><span class="p">:</span> <span class="s2">&quot;Trebuchet MS&quot;</span><span class="p">,</span>
                <span class="p">}),</span>
        <span class="n">dash_table</span><span class="o">.</span><span class="n">DataTable</span><span class="p">(</span>
        <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;inlet_conditions&#39;</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;numeric&quot;</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inc</span><span class="o">.</span><span class="n">keys</span><span class="p">())],</span>
        <span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inc</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;records&#39;</span><span class="p">),</span>
        <span class="n">editable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">style_table</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;overflowX&#39;</span><span class="p">:</span> <span class="s1">&#39;scroll&#39;</span><span class="p">},</span>
        <span class="n">style_header</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;rgb(200, 200, 200)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
        <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="n">style_data</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;rgb(250, 250, 250)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
        <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
        <span class="s1">&#39;font-family&#39;</span><span class="p">:</span> <span class="s1">&#39;Trebuchet MS&#39;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">export_format</span><span class="o">=</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span>
        <span class="n">export_headers</span><span class="o">=</span><span class="s1">&#39;display&#39;</span><span class="p">,</span>
        <span class="n">merge_duplicate_headers</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>

        <span class="n">html</span><span class="o">.</span><span class="n">Br</span><span class="p">(),</span>

                    <span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="s2">&quot;Escher Map&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
                <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                <span class="s2">&quot;BackgroundColor&quot;</span><span class="p">:</span> <span class="s2">&quot;#fbeec1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;font-family&quot;</span><span class="p">:</span> <span class="s2">&quot;Trebuchet MS&quot;</span><span class="p">,</span>
                <span class="p">})</span> <span class="p">,</span>

        <span class="n">dcc</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">([</span><span class="s2">&quot;Show Map&quot;</span><span class="p">,</span><span class="s2">&quot;Hide Map&quot;</span><span class="p">],</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="s2">&quot;300px&quot;</span><span class="p">,</span><span class="s2">&quot;font-size&quot;</span><span class="p">:</span><span class="mi">25</span><span class="p">},</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;Drop_Down_Escher&quot;</span><span class="p">),</span>
        <span class="n">html</span><span class="o">.</span><span class="n">Br</span><span class="p">(),</span>
        <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="n">children</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;Escher_&quot;</span><span class="p">),</span>
        <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="n">children</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;Escher&quot;</span><span class="p">),</span>

        <span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="s2">&quot;Microbial Association&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span>
                <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
                <span class="s2">&quot;BackgroundColor&quot;</span><span class="p">:</span> <span class="s2">&quot;#fbeec1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;font-family&quot;</span><span class="p">:</span> <span class="s2">&quot;Trebuchet MS&quot;</span><span class="p">,</span>
                <span class="p">})</span> <span class="p">,</span>


        <span class="n">dcc</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">,</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="s2">&quot;300px&quot;</span><span class="p">,</span><span class="s2">&quot;font-size&quot;</span><span class="p">:</span><span class="mi">25</span><span class="p">},</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;Drop_Down&quot;</span><span class="p">)</span> <span class="p">,</span>

        <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;Annotation_Graph&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="s2">&quot;650px&quot;</span><span class="p">}),</span>



     <span class="p">]</span>
    <span class="n">without_report</span><span class="o">=</span><span class="n">with_report</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>



    <span class="n">app</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="n">with_report</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metagenome_report</span> <span class="k">else</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="n">without_report</span><span class="p">)</span>





    <span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s2">&quot;Escher_&quot;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;children&#39;</span><span class="p">),</span> <span class="n">Input</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s2">&quot;Drop_Down_Escher&quot;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">escher_wrapper</span><span class="p">(</span><span class="n">drop_down_escher</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">drop_down_escher</span><span class="o">==</span><span class="s2">&quot;Show Map&quot;</span><span class="p">:</span>
            <span class="n">Labels</span><span class="o">=</span><span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="o">/</span><span class="mi">20</span><span class="p">)):</span>
                <span class="n">Labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="s1">&#39;style&#39;</span><span class="p">:{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#77b0b1&#39;</span><span class="p">}}</span>
            <span class="n">Labels</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">html</span><span class="o">.</span><span class="n">Br</span><span class="p">(),</span><span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="s2">&quot;Time (Day)&quot;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;textAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">}),</span><span class="n">dcc</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="o">/</span><span class="mi">20</span><span class="p">),</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;Escher_Slider&quot;</span><span class="p">,</span><span class="n">marks</span><span class="o">=</span><span class="n">Labels</span><span class="p">),</span><span class="n">html</span><span class="o">.</span><span class="n">Br</span><span class="p">()]</span>

    <span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s2">&quot;Escher&quot;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;children&#39;</span><span class="p">),</span> <span class="n">Input</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s2">&quot;Drop_Down_Escher&quot;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s2">&quot;Escher_Slider&quot;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">))</span>        
    <span class="k">def</span> <span class="nf">draw_escher</span><span class="p">(</span><span class="n">drop_down_escher</span><span class="p">,</span><span class="n">escher_slider</span><span class="p">):</span>
        <span class="n">rxn_data</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ode_system</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span><span class="nb">int</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">30</span><span class="o">*</span><span class="n">escher_slider</span><span class="p">)],</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">fluxes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;Fluxes&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">):</span>
            <span class="n">rxn_data</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;_&quot;</span><span class="p">)]</span><span class="o">=</span> <span class="n">fluxes</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">drop_down_escher</span><span class="o">==</span><span class="s2">&quot;Show Map&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">dash_escher</span><span class="o">.</span><span class="n">DashEscher</span><span class="p">(</span><span class="n">mapData</span><span class="o">=</span><span class="n">escher_map</span><span class="p">,</span><span class="n">modelData</span><span class="o">=</span><span class="n">cobra_model</span><span class="p">,</span>
        <span class="n">options</span><span class="o">=</span><span class="p">{</span>
         <span class="s1">&#39;reaction_data&#39;</span><span class="p">:</span><span class="n">rxn_data</span>
        <span class="p">}</span>
        <span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="s1">&#39;1000px&#39;</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="s1">&#39;100%&#39;</span><span class="p">)</span>
         <span class="p">]</span>

    <span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s2">&quot;Annotation_Graph&quot;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;figure&#39;</span><span class="p">),</span> <span class="n">Input</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s1">&#39;Drop_Down&#39;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">update_graph_fig</span><span class="p">(</span><span class="n">input_value</span><span class="p">):</span>
        <span class="n">reactions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span>
        <span class="n">id_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">label_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">parents_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">label_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input_value</span><span class="p">)</span>
        <span class="n">id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">parents_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">id_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">genome_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metagenome_report</span><span class="p">[</span><span class="n">input_value</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">genome_list</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">label_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">parents_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input_value</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">genome_list</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">C</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metagenome_report</span><span class="p">[</span><span class="n">input_value</span><span class="p">][</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ecs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metagenome_report</span><span class="p">[</span><span class="n">input_value</span><span class="p">][</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">label_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ecs</span><span class="p">)</span>
                    <span class="n">id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">+</span><span class="s2">&quot; : &quot;</span><span class="o">+</span><span class="n">ecs</span><span class="p">)</span>
                    <span class="n">parents_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                    <span class="n">label_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&lt;br&gt;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">metagenome_report</span><span class="p">[</span><span class="n">input_value</span><span class="p">][</span><span class="n">item</span><span class="p">][</span><span class="n">ecs</span><span class="p">]))</span>
                    <span class="n">id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">+</span><span class="s2">&quot; : &quot;</span><span class="o">+</span><span class="n">ecs</span><span class="o">+</span><span class="s2">&quot; : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">C</span><span class="p">))</span>
                    <span class="n">parents_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">+</span><span class="s2">&quot; : &quot;</span><span class="o">+</span><span class="n">ecs</span><span class="p">)</span>
                    <span class="n">C</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">label_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;No Relevant EC Numbers were found for </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> !&quot;</span><span class="p">)</span>
                <span class="n">parents_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Treemap</span><span class="p">(</span>
            <span class="n">ids</span><span class="o">=</span><span class="n">id_list</span><span class="p">,</span>
            <span class="n">labels</span><span class="o">=</span><span class="n">label_list</span><span class="p">,</span>
            <span class="n">parents</span><span class="o">=</span><span class="n">parents_list</span><span class="p">,</span>
            <span class="n">values</span><span class="o">=</span><span class="nb">list</span><span class="p">([</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">id_list</span><span class="o">.</span><span class="fm">__len__</span><span class="p">())]),</span>
            <span class="n">root_color</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span>
            <span class="n">maxdepth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">marker_colorscale</span> <span class="o">=</span> <span class="s1">&#39;RdBu&#39;</span>


        <span class="p">))</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>


        <span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span>

    <span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s1">&#39;Concentrations_Line_Plot&#39;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;figure&#39;</span><span class="p">),</span>
                <span class="n">Input</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s1">&#39;base_parameters&#39;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">),</span>
                <span class="n">Input</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s1">&#39;model_parameters&#39;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">),</span>
                <span class="n">Input</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s1">&#39;Initial_Conditions&#39;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">),</span>
                <span class="n">Input</span><span class="p">(</span><span class="n">component_id</span><span class="o">=</span><span class="s1">&#39;inlet_conditions&#39;</span><span class="p">,</span> <span class="n">component_property</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">update_graph_fig</span><span class="p">(</span><span class="n">base_parameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">model_parameters</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">initial_conditions</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">inlet_conditions</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span><span class="n">prevent_initial_call</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">plotly</span><span class="o">.</span><span class="n">graph_objects</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A functions that imports base_parameters, model_parameters, Initial_Conditions, inlet_conditions into the plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control_state</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">control_state</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">control_state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">initial_conditions</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">base_parameters</span> <span class="o">=</span> <span class="n">base_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_parameters</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_conditions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span><span class="n">initial_conditions</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">])[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inlet_conditions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span><span class="n">inlet_conditions</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="o">+</span><span class="s2">&quot;_in&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">])[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="n">update_sol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solve_model</span><span class="p">(</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">initial_conditions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="p">,</span> <span class="mi">10000</span><span class="p">))</span>

        <span class="n">sol</span><span class="o">=</span><span class="n">update_sol</span>
        <span class="n">solution</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="n">update_sol</span><span class="o">.</span><span class="n">t</span><span class="p">,</span>
                    <span class="p">}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)):</span>
            <span class="n">solution</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">update_sol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">sol_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">sol_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">sol_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
              <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Concentration of species&quot;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
        <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
        <span class="s1">&#39;xanchor&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span>
        <span class="s1">&#39;yanchor&#39;</span><span class="p">:</span> <span class="s1">&#39;top&#39;</span><span class="p">},</span>
        <span class="n">legend</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span> <span class="mi">20</span><span class="p">))</span>

            <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Time (Days)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
            <span class="p">},</span>
             <span class="n">tickfont_size</span><span class="o">=</span><span class="mi">20</span>
            <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Concentrations (kg COD/m^3)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
         <span class="p">},</span>
         <span class="n">tickfont_size</span><span class="o">=</span><span class="mi">20</span>

            <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span><span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">fig</span>



    <span class="n">app</span><span class="o">.</span><span class="n">run_server</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">8000</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="adtoolbox.adm.Model.plot" class="doc doc-heading">
<code class="highlight language-python"><span class="n">plot</span><span class="p">(</span><span class="n">Sol</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;Line&#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>A function which returns a plot of the solution from the ODE</p>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/adm.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Sol</span><span class="p">:</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">_ivp</span><span class="o">.</span><span class="n">ivp</span><span class="o">.</span><span class="n">OdeResult</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Line&quot;</span><span class="p">)</span><span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; A function which returns a plot of the solution from the ODE</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">solution</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="n">Sol</span><span class="o">.</span><span class="n">t</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)):</span>
        <span class="n">solution</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Sol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">sol_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;Line&quot;</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">sol_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">sol_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
                      <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Concentration of species&quot;</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">sol_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">textposition</span><span class="o">=</span><span class="s2">&quot;bottom center&quot;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
                <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>

                <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
                <span class="s1">&#39;xanchor&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span>
                <span class="s1">&#39;yanchor&#39;</span><span class="p">:</span> <span class="s1">&#39;top&#39;</span><span class="p">}</span>

        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Time (Days)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Concentrations (kg COD/m^3)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;Sankey&quot;</span><span class="p">:</span>
        <span class="c1">### Maybe add a sankey plot here later</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="adtoolbox.adm.Model.sol_to_df" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sol_to_df</span><span class="p">(</span><span class="n">Address</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Converts the matrix to a pandas data frame then to a csv</p>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/adm.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sol_to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Address</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts the matrix to a pandas data frame then to a csv&quot;&quot;&quot;</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">Address</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
              <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="adtoolbox.adm.Model.solve_model" class="doc doc-heading">
<code class="highlight language-python"><span class="n">solve_model</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">t_eval</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;LSODA&#39;</span><span class="p">,</span> <span class="n">switch</span><span class="o">=</span><span class="s1">&#39;DAF&#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Function to solve the model. </p>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ADM</span> <span class="kn">import</span> <span class="n">Model</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reactions</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;rxn1&#39;</span><span class="p">,</span><span class="s1">&#39;rxn2&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">species</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Initial_Conditions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="mf">.001</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="mf">.002</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mf">.003</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inlet_conditions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a_in&#39;</span><span class="p">:</span><span class="mf">.001</span><span class="p">,</span><span class="s1">&#39;b_in&#39;</span><span class="p">:</span><span class="mf">.002</span><span class="p">,</span><span class="s1">&#39;c_in&#39;</span><span class="p">:</span><span class="mf">.003</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model_parameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;k1&#39;</span><span class="p">:</span><span class="mf">0.001</span><span class="p">,</span><span class="s1">&#39;k2&#39;</span><span class="p">:</span><span class="mf">0.002</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">base_parameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;T&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">Build_Stoiciometric_Matrix</span><span class="p">(</span><span class="n">base_parameters</span><span class="p">,</span><span class="n">model_parameters</span><span class="p">,</span><span class="n">reactions</span><span class="p">,</span><span class="n">species</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">species</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">reactions</span><span class="p">)))</span>
<span class="gp">... </span>   <span class="n">S</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.001</span><span class="p">]</span>
<span class="gp">... </span>   <span class="n">S</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">... </span>   <span class="k">return</span> <span class="n">S</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">ODE_System</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">Model1</span><span class="p">):</span>
<span class="gp">... </span>   <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">Model1</span><span class="o">.</span><span class="n">reactions</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
<span class="gp">... </span>   <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">Model1</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k1&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">Model1</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span>
<span class="gp">... </span>   <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">Model1</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k2&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span>
<span class="gp">... </span>   <span class="n">dCdt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">Model1</span><span class="o">.</span><span class="n">S</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
<span class="gp">... </span>   <span class="k">return</span> <span class="n">dCdt</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">model_parameters</span><span class="p">,</span><span class="n">base_parameters</span><span class="p">,</span><span class="n">Initial_Conditions</span><span class="p">,</span><span class="n">inlet_conditions</span><span class="p">,</span><span class="n">reactions</span><span class="p">,</span><span class="n">species</span><span class="p">,</span><span class="n">ODE_System</span><span class="p">,</span><span class="n">Build_Stoiciometric_Matrix</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">Solve_Model</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mf">.1</span><span class="p">),</span><span class="n">m</span><span class="o">.</span><span class="n">Initial_Conditions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;RK45&#39;</span><span class="p">)[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span>
<span class="go">True</span>
</code></pre></div>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>t_span</code></td>
          <td>
                <code>tuple</code>
          </td>
          <td><p>The range the time will include</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y0</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>The initial value at time = 0</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>T_eval</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>The time steps that will be evaluated</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="scipy.integrate">scipy</span>.<span title="scipy.integrate.integrate">integrate</span>.<span title="scipy.integrate._ivp">_ivp</span>.<span title="scipy.integrate._ivp.ivp">ivp</span>.<span title="scipy.integrate._ivp.ivp.OdeResult">OdeResult</span></code>
          </td>
          <td><p>scipy.integrate._ivp.ivp.OdeResult: Returns the results of the simulation being run and gives optimized paramters.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/adm.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">solve_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y0</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">t_eval</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;LSODA&quot;</span><span class="p">,</span> <span class="n">switch</span><span class="o">=</span><span class="s2">&quot;DAF&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">_ivp</span><span class="o">.</span><span class="n">ivp</span><span class="o">.</span><span class="n">OdeResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to solve the model. </span>
<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; from ADM import Model</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; reactions=[&#39;rxn1&#39;,&#39;rxn2&#39;]</span>
<span class="sd">        &gt;&gt;&gt; species=[&#39;a&#39;,&#39;b&#39;,&#39;c&#39;]</span>
<span class="sd">        &gt;&gt;&gt; Initial_Conditions={&#39;a&#39;:.001,&#39;b&#39;:.002,&#39;c&#39;:.003}</span>
<span class="sd">        &gt;&gt;&gt; inlet_conditions={&#39;a_in&#39;:.001,&#39;b_in&#39;:.002,&#39;c_in&#39;:.003}</span>
<span class="sd">        &gt;&gt;&gt; model_parameters={&#39;k1&#39;:0.001,&#39;k2&#39;:0.002}</span>
<span class="sd">        &gt;&gt;&gt; base_parameters={&#39;T&#39;:0.1}</span>
<span class="sd">        &gt;&gt;&gt; def Build_Stoiciometric_Matrix(base_parameters,model_parameters,reactions,species):</span>
<span class="sd">        ...    S = np.zeros((len(species), len(reactions)))</span>
<span class="sd">        ...    S[[0,1],0]=[-1,0.001]</span>
<span class="sd">        ...    S[[1,2],1]=[-5,1]</span>
<span class="sd">        ...    return S</span>
<span class="sd">        &gt;&gt;&gt; def ODE_System(t,c,Model1):</span>
<span class="sd">        ...    v = np.zeros((len(Model1.reactions), 1))</span>
<span class="sd">        ...    v[0]=Model1.model_parameters[&#39;k1&#39;]*c[0]*Model1.base_parameters[&#39;T&#39;]/1000</span>
<span class="sd">        ...    v[1]=Model1.model_parameters[&#39;k2&#39;]*c[1]/1000</span>
<span class="sd">        ...    dCdt=np.matmul(Model1.S,v)</span>
<span class="sd">        ...    return dCdt[:, 0]</span>
<span class="sd">        &gt;&gt;&gt; m= Model(model_parameters,base_parameters,Initial_Conditions,inlet_conditions,reactions,species,ODE_System,Build_Stoiciometric_Matrix)</span>
<span class="sd">        &gt;&gt;&gt; m.Solve_Model((0,.1),m.Initial_Conditions[:, 0],np.linspace(0,0.1,10),method=&#39;RK45&#39;)[&#39;status&#39;]==0</span>
<span class="sd">        True</span>

<span class="sd">    Args:</span>
<span class="sd">        t_span (tuple): The range the time will include</span>
<span class="sd">        y0 (np.ndarray): The initial value at time = 0</span>
<span class="sd">        T_eval (np.ndarray): The time steps that will be evaluated</span>

<span class="sd">    Returns:</span>
<span class="sd">        scipy.integrate._ivp.ivp.OdeResult: Returns the results of the simulation being run and gives optimized paramters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Fluxes&quot;</span><span class="p">:[]}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">solve_ivp</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ode_system</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_time</span><span class="p">),</span> <span class="n">y0</span><span class="p">,</span> <span class="n">t_eval</span><span class="o">=</span><span class="n">t_eval</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="p">])</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not solve model, setting C to a very large value&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">=</span><span class="n">_Fake_Sol</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">y0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">t_eval</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()))</span><span class="o">*</span><span class="mf">1e10</span><span class="p">,</span><span class="n">t_eval</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">c</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="adtoolbox.adm.adm1_ode_sys" class="doc doc-heading">
<code class="highlight language-python"><span class="n">adm1_ode_sys</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">adm1_instance</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>The ODE system for the original ADM.
No testing is done.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>t</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>a matrix of zeros to be filled</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>c</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>an array of concentrations to be filled</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Model</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="adtoolbox.adm.Model" href="#adtoolbox.adm.Model">Model</a></code>
          </td>
          <td><p>The model to calculate ODE with</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>np.ndarray: The output is dCdt, the change of concentration with respect to time.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/adm.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">adm1_ode_sys</span><span class="p">(</span><span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">adm1_instance</span><span class="p">:</span><span class="n">Model</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; The ODE system for the original ADM.</span>
<span class="sd">        No testing is done.</span>

<span class="sd">        Args:</span>
<span class="sd">            t (float):a matrix of zeros to be filled</span>
<span class="sd">            c (np.ndarray): an array of concentrations to be filled</span>
<span class="sd">            Model (Model): The model to calculate ODE with</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.ndarray: The output is dCdt, the change of concentration with respect to time.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">c</span><span class="p">[</span><span class="mi">34</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">-</span> <span class="n">c</span><span class="p">[</span><span class="mi">33</span><span class="p">]</span>
    <span class="n">c</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">-</span> <span class="n">c</span><span class="p">[</span><span class="mi">31</span><span class="p">]</span>
    <span class="n">I_pH_aa</span> <span class="o">=</span> <span class="p">(</span><span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;K_pH_aa&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;nn_aa&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span>
        <span class="n">c</span><span class="p">[</span><span class="mi">26</span><span class="p">],</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;nn_aa&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;K_pH_aa&quot;</span><span class="p">],</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;nn_aa&#39;</span><span class="p">]))</span>
    <span class="n">I_pH_ac</span> <span class="o">=</span> <span class="p">(</span><span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_ac&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;n_ac&quot;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span>
        <span class="n">c</span><span class="p">[</span><span class="mi">26</span><span class="p">]</span> <span class="o">**</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_ac&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_ac&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_ac&#39;</span><span class="p">])</span>
    <span class="n">I_pH_h2</span> <span class="o">=</span> <span class="p">(</span><span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_h2&#39;</span><span class="p">]</span><span class="o">**</span><span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_h2&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span>
        <span class="n">c</span><span class="p">[</span><span class="mi">26</span><span class="p">]</span> <span class="o">**</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_h2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_h2&#39;</span><span class="p">]</span><span class="o">**</span><span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_h2&#39;</span><span class="p">])</span>
    <span class="n">I_IN_lim</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_IN&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">c</span><span class="p">[</span><span class="mi">10</span><span class="p">]))</span>
    <span class="n">I_h2_fa</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">/</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_I_h2_fa&#39;</span><span class="p">]))</span>
    <span class="n">I_h2_c4</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">/</span><span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_I_h2_c4&#39;</span><span class="p">]))</span>
    <span class="n">I_h2_pro</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">/</span><span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_I_h2_pro&#39;</span><span class="p">])))</span>
    <span class="n">I_nh3</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">33</span><span class="p">]</span><span class="o">/</span><span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_I_nh3&#39;</span><span class="p">]))</span>
    <span class="n">I5</span> <span class="o">=</span> <span class="p">(</span><span class="n">I_pH_aa</span> <span class="o">*</span> <span class="n">I_IN_lim</span><span class="p">)</span>
    <span class="n">I6</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">I5</span><span class="p">)</span>
    <span class="n">I7</span> <span class="o">=</span> <span class="p">(</span><span class="n">I_pH_aa</span> <span class="o">*</span> <span class="n">I_IN_lim</span> <span class="o">*</span> <span class="n">I_h2_fa</span><span class="p">)</span>
    <span class="n">I8</span> <span class="o">=</span> <span class="p">(</span><span class="n">I_pH_aa</span> <span class="o">*</span> <span class="n">I_IN_lim</span> <span class="o">*</span> <span class="n">I_h2_c4</span><span class="p">)</span>
    <span class="n">I9</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">I8</span><span class="p">)</span>
    <span class="n">I10</span> <span class="o">=</span> <span class="p">(</span><span class="n">I_pH_aa</span> <span class="o">*</span> <span class="n">I_IN_lim</span> <span class="o">*</span> <span class="n">I_h2_pro</span><span class="p">)</span>
    <span class="n">I11</span> <span class="o">=</span> <span class="p">(</span><span class="n">I_pH_ac</span> <span class="o">*</span> <span class="n">I_IN_lim</span> <span class="o">*</span> <span class="n">I_nh3</span><span class="p">)</span>
    <span class="n">I12</span> <span class="o">=</span> <span class="p">(</span><span class="n">I_pH_h2</span> <span class="o">*</span> <span class="n">I_IN_lim</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">adm1_instance</span><span class="o">.</span><span class="n">reactions</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;k_dis&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_hyd_ch&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_hyd_pr&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_hyd_li&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_su&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_su&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span><span class="o">*</span><span class="n">I5</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_aa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_aa&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span><span class="o">*</span><span class="n">I6</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_fa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_fa&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span><span class="o">*</span><span class="n">I7</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_c4&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_c4&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> \
        <span class="n">c</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">))</span><span class="o">*</span><span class="n">I8</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_c4&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_c4&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="o">*</span> \
        <span class="n">c</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">))</span><span class="o">*</span><span class="n">I9</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_pr&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_pro&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span><span class="o">*</span><span class="n">I10</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_ac&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">21</span><span class="p">]</span><span class="o">*</span><span class="n">I11</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_h2&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_h2&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">22</span><span class="p">]</span><span class="o">*</span><span class="n">I12</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_su&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_aa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_fa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_c4&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_pro&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span> <span class="o">=</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">21</span><span class="p">]</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span> <span class="o">=</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_h2&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="mi">22</span><span class="p">]</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span> <span class="o">=</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_va&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">27</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_va&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="mi">26</span><span class="p">])</span> <span class="o">-</span>
         <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_va&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="o">=</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_bu&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">28</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_bu&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="mi">26</span><span class="p">])</span> <span class="o">-</span>
         <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_bu&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">21</span><span class="p">]</span> <span class="o">=</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_pro&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_pro&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="mi">26</span><span class="p">])</span> <span class="o">-</span>
         <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_pro&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">22</span><span class="p">]</span> <span class="o">=</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_ac&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">30</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_ac&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="mi">26</span><span class="p">])</span> <span class="o">-</span>
         <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_ac&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">23</span><span class="p">]</span> <span class="o">=</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_co2&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">31</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_co2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="mi">26</span><span class="p">])</span> <span class="o">-</span>
         <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_co2&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">24</span><span class="p">]</span> <span class="o">=</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_IN&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">33</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_IN&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="mi">26</span><span class="p">])</span> <span class="o">-</span>
         <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_IN&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span>
    <span class="n">p_gas_h2</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">35</span><span class="p">]</span> <span class="o">*</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;R&quot;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="n">adm1_instance</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;T_op&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">16</span>
    <span class="n">p_gas_ch4</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">36</span><span class="p">]</span> <span class="o">*</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;R&quot;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="n">adm1_instance</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;T_op&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">64</span>
    <span class="n">p_gas_co2</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">37</span><span class="p">]</span> <span class="o">*</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;R&quot;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="n">adm1_instance</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;T_op&quot;</span><span class="p">]</span>
    <span class="n">p_gas_h2o</span> <span class="o">=</span> <span class="mf">0.0313</span> <span class="o">*</span> \
        <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">5290</span> <span class="o">*</span>
               <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;T_base&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;T_op&quot;</span><span class="p">]))</span>
    <span class="n">P_gas</span> <span class="o">=</span> <span class="n">p_gas_h2</span> <span class="o">+</span> <span class="n">p_gas_ch4</span> <span class="o">+</span> <span class="n">p_gas_co2</span> <span class="o">+</span> <span class="n">p_gas_h2o</span>
    <span class="n">q_gas</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
        <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_p&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">P_gas</span> <span class="o">-</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;P_atm&#39;</span><span class="p">])))</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">25</span><span class="p">]</span> <span class="o">=</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_L_a&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">-</span> <span class="mi">16</span> <span class="o">*</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_H_h2&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">p_gas_h2</span><span class="p">)</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">26</span><span class="p">]</span> <span class="o">=</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_L_a&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">-</span> <span class="mi">64</span> <span class="o">*</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_H_ch4&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">p_gas_ch4</span><span class="p">)</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">27</span><span class="p">]</span> <span class="o">=</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_L_a&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="o">-</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_H_co2&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">p_gas_co2</span><span class="p">)</span>
    <span class="n">dCdt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">adm1_instance</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">24</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="mi">34</span><span class="p">]</span><span class="o">-</span><span class="n">c</span><span class="p">[</span><span class="mi">31</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">30</span><span class="p">]</span> <span class="o">/</span> <span class="mi">64</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="o">/</span>
                                              <span class="mi">112</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">28</span><span class="p">]</span> <span class="o">/</span> <span class="mi">160</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">27</span><span class="p">]</span> <span class="o">/</span> <span class="mi">208</span><span class="p">)</span> <span class="o">-</span> <span class="n">c</span><span class="p">[</span><span class="mi">25</span><span class="p">]</span>
    <span class="n">c</span><span class="p">[</span><span class="mi">26</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">phi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
        <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">phi</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_w&#39;</span><span class="p">]))</span>
    <span class="n">dCdt</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="mi">35</span><span class="p">]</span> <span class="o">=</span> <span class="n">dCdt</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="mi">35</span><span class="p">]</span><span class="o">+</span><span class="n">adm1_instance</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;q_in&#39;</span><span class="p">]</span> <span class="o">/</span> \
        <span class="n">adm1_instance</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;V_liq&quot;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">adm1_instance</span><span class="o">.</span><span class="n">inlet_conditions</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="mi">35</span><span class="p">]</span><span class="o">-</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">35</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">dCdt</span><span class="p">[</span><span class="mi">35</span><span class="p">:]</span> <span class="o">=</span> <span class="n">dCdt</span><span class="p">[</span><span class="mi">35</span><span class="p">:]</span><span class="o">+</span><span class="n">q_gas</span><span class="o">/</span><span class="n">adm1_instance</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;V_gas&quot;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">adm1_instance</span><span class="o">.</span><span class="n">inlet_conditions</span><span class="p">[</span><span class="mi">35</span><span class="p">:]</span><span class="o">-</span><span class="n">c</span><span class="p">[</span><span class="mi">35</span><span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">dCdt</span><span class="p">[[</span><span class="mi">26</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">34</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">adm1_instance</span><span class="o">.</span><span class="n">switch</span> <span class="o">==</span> <span class="s2">&quot;DAE&quot;</span><span class="p">:</span>
        <span class="n">dCdt</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">dCdt</span><span class="p">[</span><span class="mi">27</span><span class="p">:</span> <span class="mi">32</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">dCdt</span><span class="p">[</span><span class="mi">33</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">dCdt</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.adm.build_adm1_stoiciometric_matrix" class="doc doc-heading">
<code class="highlight language-python"><span class="n">build_adm1_stoiciometric_matrix</span><span class="p">(</span><span class="n">base_parameters</span><span class="p">,</span> <span class="n">model_parameters</span><span class="p">,</span> <span class="n">reactons</span><span class="p">,</span> <span class="n">species</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function builds the stoichiometric matrix for the original ADM Model.
No testing is done.</p>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/adm.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">build_adm1_stoiciometric_matrix</span><span class="p">(</span><span class="n">base_parameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">model_parameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">reactons</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">species</span><span class="p">:</span><span class="nb">list</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This function builds the stoichiometric matrix for the original ADM Model.</span>
<span class="sd">    No testing is done.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">base_parameters</span><span class="p">)</span><span class="o">!=</span> <span class="nb">dict</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_parameters</span><span class="p">)</span><span class="o">!=</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;base_parameters and model_parameters need to be dictionary&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">reactons</span><span class="p">)</span><span class="o">!=</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">species</span><span class="p">)</span><span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;reactions and species must be list&quot;</span><span class="p">)</span>


    <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">species</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">reactons</span><span class="p">)))</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;f_fa_li&quot;</span><span class="p">]),</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;f_fa_li&quot;</span><span class="p">]),</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa&#39;</span><span class="p">])</span> <span class="o">*</span>
                    <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_va_aa&#39;</span><span class="p">],</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_bu_su&#39;</span><span class="p">],</span>
                       <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;f_bu_aa&quot;</span><span class="p">],</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;Y_su&quot;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_pro_su&#39;</span><span class="p">],</span>
                          <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;f_pro_aa&quot;</span><span class="p">],</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_c4&#39;</span><span class="p">])</span><span class="o">*</span><span class="mf">0.54</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_ac_su&#39;</span><span class="p">],</span>
                                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa&#39;</span><span class="p">])</span> <span class="o">*</span>
                                    <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_ac_aa&#39;</span><span class="p">],</span>
                                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_fa&#39;</span><span class="p">])</span><span class="o">*</span><span class="mf">0.7</span><span class="p">,</span>
                                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_c4&#39;</span><span class="p">])</span><span class="o">*</span><span class="mf">0.31</span><span class="p">,</span>
                                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_c4&#39;</span><span class="p">])</span><span class="o">*</span><span class="mf">0.8</span><span class="p">,</span>
                                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro&#39;</span><span class="p">])</span><span class="o">*</span><span class="mf">0.57</span><span class="p">,</span>
                                    <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">25</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_h2_su&#39;</span><span class="p">],</span>
                                        <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa&#39;</span><span class="p">])</span> <span class="o">*</span>
                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_h2_aa&#39;</span><span class="p">],</span>
                                        <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_fa&#39;</span><span class="p">])</span><span class="o">*</span><span class="mf">0.3</span><span class="p">,</span>
                                        <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_c4&#39;</span><span class="p">])</span><span class="o">*</span><span class="mf">0.15</span><span class="p">,</span>
                                        <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_c4&#39;</span><span class="p">])</span><span class="o">*</span><span class="mf">0.2</span><span class="p">,</span>
                                        <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro&#39;</span><span class="p">])</span><span class="o">*</span><span class="mf">0.43</span><span class="p">,</span>
                                        <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                        <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">26</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac&#39;</span><span class="p">]),</span>
                          <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_h2&#39;</span><span class="p">]),</span>
                          <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">s_1</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_xc&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_sI_xc&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_sI&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_ch_xc&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ch&#39;</span><span class="p">]</span> <span class="o">+</span>
           <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_pr_xc&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_pr&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_li_xc&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_li&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_xI_xc&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_xI&#39;</span><span class="p">])</span>
    <span class="n">s_2</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ch&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_su&#39;</span><span class="p">])</span>
    <span class="n">s_3</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_pr&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_aa&#39;</span><span class="p">])</span>
    <span class="n">s_4</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_li&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_fa_li&#39;</span><span class="p">])</span> <span class="o">*</span>
           <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_su&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_fa_li&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_fa&#39;</span><span class="p">])</span>
    <span class="n">s_5</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_su&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_bu_su&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bu&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_pro_su&#39;</span><span class="p">]</span>
                                                                             <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_pro&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_ac_su&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>
    <span class="n">s_6</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_aa&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_va_aa&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_va&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_bu_aa&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bu&#39;</span><span class="p">]</span> <span class="o">+</span>
                                                                             <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_pro_aa&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_pro&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_ac_aa&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>
    <span class="n">s_7</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_fa&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_fa&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.7</span> <span class="o">*</span>
           <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_fa&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>
    <span class="n">s_8</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_va&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_c4&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.54</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_pro&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span>
        <span class="mi">1</span> <span class="o">-</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_c4&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.31</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_c4&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>
    <span class="n">s_9</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bu&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_c4&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.8</span> <span class="o">*</span>
           <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_c4&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>
    <span class="n">s_10</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_pro&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.57</span> <span class="o">*</span>
            <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>
    <span class="n">s_11</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac&#39;</span><span class="p">])</span> <span class="o">*</span>
            <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ch4&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>
    <span class="n">s_12</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_h2&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ch4&#39;</span><span class="p">]</span> <span class="o">+</span>
            <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_h2&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>
    <span class="n">s_13</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_xc&#39;</span><span class="p">])</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">27</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">s_1</span><span class="p">,</span> <span class="o">-</span><span class="n">s_2</span><span class="p">,</span> <span class="o">-</span><span class="n">s_3</span><span class="p">,</span> <span class="o">-</span><span class="n">s_4</span><span class="p">,</span> <span class="o">-</span>
                                                                                    <span class="n">s_5</span><span class="p">,</span> <span class="o">-</span><span class="n">s_6</span><span class="p">,</span> <span class="o">-</span><span class="n">s_7</span><span class="p">,</span> <span class="o">-</span><span class="n">s_8</span><span class="p">,</span> <span class="o">-</span><span class="n">s_9</span><span class="p">,</span> <span class="o">-</span><span class="n">s_10</span><span class="p">,</span> <span class="o">-</span><span class="n">s_11</span><span class="p">,</span> <span class="o">-</span><span class="n">s_12</span><span class="p">,</span> <span class="o">-</span><span class="n">s_13</span><span class="p">,</span> <span class="o">-</span><span class="n">s_13</span><span class="p">,</span> <span class="o">-</span><span class="n">s_13</span><span class="p">,</span> <span class="o">-</span><span class="n">s_13</span><span class="p">,</span> <span class="o">-</span><span class="n">s_13</span><span class="p">,</span> <span class="o">-</span><span class="n">s_13</span><span class="p">,</span> <span class="o">-</span><span class="n">s_13</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_xc&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_xI_xc&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_I&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_sI_xc&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_I&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_pr_xc&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_aa&#39;</span><span class="p">],</span>
                                                                        <span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_aa&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa&#39;</span><span class="p">]</span> <span class="o">*</span>
                                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                                        <span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_fa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                                        <span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_c4&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                                        <span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_c4&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                                        <span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                                        <span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                                        <span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_h2&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">]</span> <span class="o">-</span>
                                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_xc&#39;</span><span class="p">],</span>
                                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">]</span> <span class="o">-</span>
                                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_xc&#39;</span><span class="p">],</span>
                                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">]</span> <span class="o">-</span>
                                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_xc&#39;</span><span class="p">],</span>
                                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">]</span> <span class="o">-</span>
                                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_xc&#39;</span><span class="p">],</span>
                                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">]</span> <span class="o">-</span>
                                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_xc&#39;</span><span class="p">],</span>
                                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">]</span> <span class="o">-</span>
                                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_xc&#39;</span><span class="p">],</span>
                                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_xc&#39;</span><span class="p">]]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_sI_xc&#39;</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">13</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_ch_xc&#39;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_pr_xc&#39;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_li_xc&#39;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">12</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su&#39;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">17</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">13</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa&#39;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">18</span><span class="p">,</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">14</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_fa&#39;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">19</span><span class="p">,</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">15</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_c4&#39;</span><span class="p">],</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_c4&#39;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">16</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro&#39;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">21</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">17</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac&#39;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">22</span><span class="p">,</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">18</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_h2&#39;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">23</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_xI_xc&#39;</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">24</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">26</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">27</span><span class="p">,</span> <span class="mi">19</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">28</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">29</span><span class="p">,</span> <span class="mi">21</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">22</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">31</span><span class="p">,</span> <span class="mi">23</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">32</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">33</span><span class="p">,</span> <span class="mi">24</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">34</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">35</span><span class="p">,</span> <span class="mi">25</span><span class="p">]</span> <span class="o">=</span> <span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;V_liq&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;V_gas&#39;</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">36</span><span class="p">,</span> <span class="mi">26</span><span class="p">]</span> <span class="o">=</span> <span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;V_liq&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;V_gas&#39;</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">37</span><span class="p">,</span> <span class="mi">27</span><span class="p">]</span> <span class="o">=</span> <span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;V_liq&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;V_gas&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">S</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.adm.build_modified_adm_stoichiometric_matrix" class="doc doc-heading">
<code class="highlight language-python"><span class="n">build_modified_adm_stoichiometric_matrix</span><span class="p">(</span><span class="n">base_parameters</span><span class="p">,</span> <span class="n">model_parameters</span><span class="p">,</span> <span class="n">reactions</span><span class="p">,</span> <span class="n">species</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function builds the stoichiometric matrix for the modified ADM Model.</p>
<pre><code>Model Parameters (dict): a dictionary which contains model parameters
base_parameters (dict): a dictionary which contains base paramters
Initial Conditions (dict): a dictionary containing inlet conditions for all species
Inlet Conditions (dict): a dictionary containing inlet conditions for all species
reactions (list): a list containing all of the reaction names
species (list): a list containing all species
</code></pre>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>np.ndarray: Returns an matrix of stochiometic values.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/adm.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">build_modified_adm_stoichiometric_matrix</span><span class="p">(</span><span class="n">base_parameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">model_parameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">reactions</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">species</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    This function builds the stoichiometric matrix for the modified ADM Model.</span>

<span class="sd">        Model Parameters (dict): a dictionary which contains model parameters</span>
<span class="sd">        base_parameters (dict): a dictionary which contains base paramters</span>
<span class="sd">        Initial Conditions (dict): a dictionary containing inlet conditions for all species</span>
<span class="sd">        Inlet Conditions (dict): a dictionary containing inlet conditions for all species</span>
<span class="sd">        reactions (list): a list containing all of the reaction names</span>
<span class="sd">        species (list): a list containing all species</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Returns an matrix of stochiometic values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">species</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">reactions</span><span class="p">)))</span>
    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;TSS&quot;</span><span class="p">,</span> <span class="s2">&quot;X_ch&quot;</span><span class="p">,</span> <span class="s2">&quot;X_pr&quot;</span><span class="p">,</span> <span class="s2">&quot;X_li&quot;</span><span class="p">,</span> <span class="s2">&quot;X_I&quot;</span><span class="p">])),</span>
      <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;TSS_Disintegration&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_ch_TSS&#39;</span><span class="p">],</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_pr_TSS&#39;</span><span class="p">],</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_li_TSS&#39;</span><span class="p">],</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_xI_TSS&#39;</span><span class="p">]]</span>
    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;TDS&quot;</span><span class="p">,</span> <span class="s2">&quot;X_ch&quot;</span><span class="p">,</span> <span class="s2">&quot;X_pr&quot;</span><span class="p">,</span> <span class="s2">&quot;X_li&quot;</span><span class="p">,</span> <span class="s2">&quot;S_I&quot;</span><span class="p">])),</span> <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;TDS_Disintegration&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                                                                                  <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_ch_TDS&#39;</span><span class="p">],</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_pr_TDS&#39;</span><span class="p">],</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_li_TDS&#39;</span><span class="p">],</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_sI_TDS&#39;</span><span class="p">]]</span>
    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_ch&quot;</span><span class="p">,</span> <span class="s2">&quot;S_su&quot;</span><span class="p">])),</span>
      <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Hydrolysis carbohydrates&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_pr&quot;</span><span class="p">,</span> <span class="s2">&quot;S_aa&quot;</span><span class="p">])),</span>
      <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Hydrolysis proteins&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_li&quot;</span><span class="p">,</span> <span class="s2">&quot;S_fa&quot;</span><span class="p">])),</span>
      <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Hydrolysis lipids&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">f_IC_su</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_su&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_pro_su&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_pro&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_su&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_et&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_su&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_lac&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_ac_su&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_su&quot;</span><span class="p">,</span> <span class="s2">&quot;S_pro&quot;</span><span class="p">,</span> <span class="s2">&quot;S_et&quot;</span><span class="p">,</span> <span class="s2">&quot;S_lac&quot;</span><span class="p">,</span> <span class="s2">&quot;S_ac&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IN&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IC&quot;</span><span class="p">,</span> <span class="s2">&quot;X_su&quot;</span><span class="p">])),</span>
      <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of sugars&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                              <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su&#39;</span><span class="p">])</span> <span class="o">*</span>
                                              <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_pro_su&#39;</span><span class="p">],</span>
                                              <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su&#39;</span><span class="p">])</span> <span class="o">*</span>
                                              <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_su&#39;</span><span class="p">],</span>
                                              <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su&#39;</span><span class="p">])</span> <span class="o">*</span>
                                              <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_su&#39;</span><span class="p">],</span>
                                              <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su&#39;</span><span class="p">])</span> <span class="o">*</span>
                                              <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_ac_su&#39;</span><span class="p">],</span>
                                              <span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su&#39;</span><span class="p">],</span>
                                              <span class="n">f_IC_su</span><span class="p">,</span>
                                              <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_su&#39;</span><span class="p">]]</span>

    <span class="n">f_IC_aa</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_aa&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_pro_aa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_pro&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_aa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_et&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_aa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_lac&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_ac_aa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_aa&quot;</span><span class="p">,</span> <span class="s2">&quot;S_pro&quot;</span><span class="p">,</span> <span class="s2">&quot;S_et&quot;</span><span class="p">,</span> <span class="s2">&quot;S_lac&quot;</span><span class="p">,</span> <span class="s2">&quot;S_ac&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IN&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IC&quot;</span><span class="p">,</span> <span class="s2">&quot;X_aa&quot;</span><span class="p">])),</span>
      <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of amino acids&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                   <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa&#39;</span><span class="p">])</span> <span class="o">*</span>
                                                   <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_pro_aa&#39;</span><span class="p">],</span>
                                                   <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa&#39;</span><span class="p">])</span> <span class="o">*</span>
                                                   <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_aa&#39;</span><span class="p">],</span>
                                                   <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa&#39;</span><span class="p">])</span> <span class="o">*</span>
                                                   <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_aa&#39;</span><span class="p">],</span>
                                                   <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa&#39;</span><span class="p">])</span> <span class="o">*</span>
                                                   <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_ac_aa&#39;</span><span class="p">],</span>
                                                   <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_aa&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa&#39;</span><span class="p">]</span> <span class="o">*</span>
                                                   <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                   <span class="n">f_IC_aa</span><span class="p">,</span>
                                                   <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_aa&#39;</span><span class="p">]]</span>
    <span class="n">f_IC_fa</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_fa&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_fa&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_pro_fa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_pro&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_fa&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_fa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_et&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_fa&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_fa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_lac&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_fa&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_ac_fa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_fa&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_fa&quot;</span><span class="p">,</span> <span class="s2">&quot;S_pro&quot;</span><span class="p">,</span> <span class="s2">&quot;S_et&quot;</span><span class="p">,</span> <span class="s2">&quot;S_lac&quot;</span><span class="p">,</span> <span class="s2">&quot;S_ac&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IN&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IC&quot;</span><span class="p">,</span> <span class="s2">&quot;X_fa&quot;</span><span class="p">])),</span>
      <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of LCFA&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                            <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_fa&#39;</span><span class="p">])</span> <span class="o">*</span>
                                            <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_pro_fa&#39;</span><span class="p">],</span>
                                            <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_fa&#39;</span><span class="p">])</span> <span class="o">*</span>
                                            <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_fa&#39;</span><span class="p">],</span>
                                            <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_fa&#39;</span><span class="p">])</span> <span class="o">*</span>
                                            <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_fa&#39;</span><span class="p">],</span>
                                            <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_fa&#39;</span><span class="p">])</span> <span class="o">*</span>
                                            <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_ac_fa&#39;</span><span class="p">],</span>
                                            <span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_fa&#39;</span><span class="p">]</span> <span class="o">*</span>
                                            <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                            <span class="n">f_IC_fa</span><span class="p">,</span>
                                            <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_fa&#39;</span><span class="p">]]</span>

    <span class="n">f_IC_ac_et</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">]</span> <span class="o">+</span>
                   <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac_et&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_et&#39;</span><span class="p">]</span> <span class="o">+</span>
                   <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac_et&#39;</span><span class="p">])</span> <span class="o">*</span>
                   <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_bu_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bu&#39;</span><span class="p">]</span> <span class="o">+</span>
                   <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac_et&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>

    <span class="n">f_IC_ac_lac</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac_lac&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_lac&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac_lac&#39;</span><span class="p">])</span> <span class="o">*</span>
                    <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_bu_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bu&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac_lac&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_ac&quot;</span><span class="p">,</span> <span class="s2">&quot;S_et&quot;</span><span class="p">,</span> <span class="s2">&quot;S_bu&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IN&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IC&quot;</span><span class="p">,</span> <span class="s2">&quot;S_h2&quot;</span><span class="p">,</span> <span class="s2">&quot;X_ac_et&quot;</span><span class="p">])),</span>
      <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of acetate_et&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                  <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac_et&#39;</span><span class="p">])</span> <span class="o">*</span>
                                                  <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_ac&#39;</span><span class="p">],</span>
                                                  <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac&#39;</span><span class="p">])</span> <span class="o">*</span>
                                                  <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_bu_ac&#39;</span><span class="p">],</span>
                                                  <span class="n">f_IC_ac_et</span><span class="p">,</span>
                                                  <span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac_et&#39;</span><span class="p">]</span> <span class="o">*</span>
                                                  <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                  <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac_et&#39;</span><span class="p">])</span> <span class="o">*</span>
                                                  <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_h2_ac&#39;</span><span class="p">],</span>
                                                  <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac_et&#39;</span><span class="p">]]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_ac&quot;</span><span class="p">,</span> <span class="s2">&quot;S_lac&quot;</span><span class="p">,</span> <span class="s2">&quot;S_bu&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IN&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IC&quot;</span><span class="p">,</span> <span class="s2">&quot;S_h2&quot;</span><span class="p">,</span> <span class="s2">&quot;X_ac_lac&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of acetate_lac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                     <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac_lac&#39;</span><span class="p">])</span> <span class="o">*</span>
                                                     <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_ac&#39;</span><span class="p">],</span>
                                                     <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac_lac&#39;</span><span class="p">])</span> <span class="o">*</span>
                                                     <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_bu_ac&#39;</span><span class="p">],</span>
                                                     <span class="n">f_IC_ac_lac</span><span class="p">,</span>
                                                     <span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac_lac&#39;</span><span class="p">]</span> <span class="o">*</span>
                                                     <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                     <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac_lac&#39;</span><span class="p">])</span> <span class="o">*</span>
                                                     <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_h2_ac&#39;</span><span class="p">],</span>
                                                     <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac_lac&#39;</span><span class="p">]]</span>

    <span class="n">f_IC_pro_et</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_pro&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro_et&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_pro&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_et&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro_et&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_va_pro&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_va&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro_et&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>

    <span class="n">f_IC_pro_lac</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_pro&#39;</span><span class="p">]</span> <span class="o">+</span>
                     <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro_lac&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_pro&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_lac&#39;</span><span class="p">]</span> <span class="o">+</span>
                     <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro_lac&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_va_pro&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_va&#39;</span><span class="p">]</span> <span class="o">+</span>
                     <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro_lac&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_pro&quot;</span><span class="p">,</span> <span class="s2">&quot;S_et&quot;</span><span class="p">,</span> <span class="s2">&quot;S_va&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IN&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IC&quot;</span><span class="p">,</span> <span class="s2">&quot;S_h2&quot;</span><span class="p">,</span> <span class="s2">&quot;X_chain_et&quot;</span><span class="p">])),</span>
      <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of propionate_et&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                     <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro_et&#39;</span><span class="p">])</span> <span class="o">*</span>
                                                     <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_pro&#39;</span><span class="p">],</span>
                                                     <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro_et&#39;</span><span class="p">])</span> <span class="o">*</span>
                                                     <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_va_pro&#39;</span><span class="p">],</span>
                                                     <span class="n">f_IC_pro_et</span><span class="p">,</span>
                                                     <span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro_et&#39;</span><span class="p">]</span> <span class="o">*</span>
                                                     <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                     <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro_et&#39;</span><span class="p">])</span> <span class="o">*</span>
                                                     <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_h2_pro&#39;</span><span class="p">],</span>
                                                     <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_chain_et_pro&#39;</span><span class="p">]]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_pro&quot;</span><span class="p">,</span> <span class="s2">&quot;S_lac&quot;</span><span class="p">,</span> <span class="s2">&quot;S_va&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IN&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IC&quot;</span><span class="p">,</span> <span class="s2">&quot;S_h2&quot;</span><span class="p">,</span> <span class="s2">&quot;X_chain_lac&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of propionate_lac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                        <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro_lac&#39;</span><span class="p">])</span> <span class="o">*</span>
                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_pro&#39;</span><span class="p">],</span>
                                                        <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro_lac&#39;</span><span class="p">])</span> <span class="o">*</span>
                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_va_pro&#39;</span><span class="p">],</span>
                                                        <span class="n">f_IC_pro_lac</span><span class="p">,</span>
                                                        <span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro_lac&#39;</span><span class="p">]</span> <span class="o">*</span>
                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                        <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro_lac&#39;</span><span class="p">])</span> <span class="o">*</span>
                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_h2_pro&#39;</span><span class="p">],</span>
                                                        <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_chain_lac_pro&#39;</span><span class="p">]]</span>

    <span class="n">f_IC_bu_et</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bu&#39;</span><span class="p">]</span> <span class="o">+</span>
                   <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_bu_et&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_bu&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_et&#39;</span><span class="p">]</span> <span class="o">+</span>
                   <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_bu_et&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_cap_bu&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_cap&#39;</span><span class="p">]</span> <span class="o">+</span>
                   <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_bu_et&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>

    <span class="n">f_IC_bu_lac</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bu&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_bu_lac&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_bu&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_lac&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_bu_lac&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_cap_bu&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_cap&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_bu_lac&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_bu&quot;</span><span class="p">,</span> <span class="s2">&quot;S_et&quot;</span><span class="p">,</span> <span class="s2">&quot;S_cap&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IN&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IC&quot;</span><span class="p">,</span> <span class="s2">&quot;S_h2&quot;</span><span class="p">,</span> <span class="s2">&quot;X_chain_et&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of butyrate_et&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                     <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_bu_et&#39;</span><span class="p">]</span>
                                                      <span class="p">)</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_et_bu&#39;</span><span class="p">],</span>
                                                     <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_bu_et&#39;</span><span class="p">])</span> <span class="o">*</span>
                                                     <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_cap_bu&#39;</span><span class="p">],</span>
                                                     <span class="n">f_IC_bu_et</span><span class="p">,</span>
                                                     <span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_bu_et&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                     <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_bu_et&#39;</span><span class="p">]</span>
                                                      <span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_h2_bu&#39;</span><span class="p">],</span>
                                                     <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_bu_et&#39;</span><span class="p">]]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_bu&quot;</span><span class="p">,</span> <span class="s2">&quot;S_lac&quot;</span><span class="p">,</span> <span class="s2">&quot;S_cap&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IN&quot;</span><span class="p">,</span> <span class="s2">&quot;S_IC&quot;</span><span class="p">,</span> <span class="s2">&quot;S_h2&quot;</span><span class="p">,</span> <span class="s2">&quot;X_chain_lac&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of butyrate_lac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                      <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_bu_lac&#39;</span><span class="p">])</span> <span class="o">*</span>
                                                      <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_lac_bu&#39;</span><span class="p">],</span>
                                                      <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_bu_lac&#39;</span><span class="p">])</span> <span class="o">*</span>
                                                      <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_cap_bu&#39;</span><span class="p">],</span>
                                                      <span class="n">f_IC_bu_lac</span><span class="p">,</span>
                                                      <span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_bu_lac&#39;</span><span class="p">]</span> <span class="o">*</span>
                                                      <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;N_bac&#39;</span><span class="p">],</span>
                                                      <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_bu_lac&#39;</span><span class="p">]</span>
                                                       <span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_h2_bu&#39;</span><span class="p">],</span>
                                                      <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_bu_lac&#39;</span><span class="p">]]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_va&quot;</span><span class="p">,</span> <span class="s2">&quot;S_ac&quot;</span><span class="p">,</span> <span class="s2">&quot;X_VFA_deg&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of valerate&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                  <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_va&#39;</span><span class="p">]),</span>
                                                  <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_va&#39;</span><span class="p">]]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_cap&quot;</span><span class="p">,</span> <span class="s2">&quot;S_ac&quot;</span><span class="p">,</span> <span class="s2">&quot;X_VFA_deg&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of caproate&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                  <span class="p">(</span><span class="mi">1</span> <span class="o">-</span>
                                                   <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_cap&#39;</span><span class="p">]),</span>
                                                  <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_cap&#39;</span><span class="p">]]</span>
    <span class="n">f_IC_Me_ach2</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_h2&quot;</span><span class="p">,</span> <span class="s2">&quot;S_ac&quot;</span><span class="p">,</span> <span class="s2">&quot;S_ch4&quot;</span><span class="p">,</span> <span class="s2">&quot;X_Me_ac&quot;</span><span class="p">,</span> <span class="s1">&#39;S_IC&#39;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Methanogenessis from acetate and h2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                                   <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_h2_ac&#39;</span><span class="p">]</span>
                                                                    <span class="p">)</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;f_ac_h2&#39;</span><span class="p">],</span>
                                                                   <span class="p">(</span><span class="mi">1</span> <span class="o">-</span>
                                                                       <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_Me_ac&#39;</span><span class="p">]),</span>
                                                                   <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_Me_ac&#39;</span><span class="p">],</span>
                                                                   <span class="n">f_IC_Me_ach2</span><span class="p">]</span>

    <span class="n">f_IC_Me_CO2h2</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_Me_CO2&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ch4&#39;</span><span class="p">]</span> <span class="o">+</span>
                      <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_Me_h2&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">])</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_h2&quot;</span><span class="p">,</span> <span class="s2">&quot;S_ch4&quot;</span><span class="p">,</span> <span class="s2">&quot;X_Me_CO2&quot;</span><span class="p">,</span> <span class="s1">&#39;S_IC&#39;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Methanogenessis from CO2 and h2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                               <span class="p">(</span><span class="mi">1</span> <span class="o">-</span>
                                                                <span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_h2_CO2&#39;</span><span class="p">]),</span>
                                                               <span class="p">(</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_Me_CO2&#39;</span><span class="p">]),</span>
                                                               <span class="n">f_IC_Me_CO2h2</span><span class="p">]</span>

    <span class="n">f_IC_et_ox</span><span class="o">=-</span><span class="p">(</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_et&#39;</span><span class="p">]</span> <span class="o">+</span>
                    <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac_et_ox&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">]</span>
                    <span class="o">+</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac_et_ox&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_ac&#39;</span><span class="p">])</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_et&quot;</span><span class="p">,</span> <span class="s2">&quot;X_et&quot;</span><span class="p">,</span><span class="s2">&quot;S_ac&quot;</span><span class="p">,</span><span class="s2">&quot;S_IC&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of ethanol&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac_et_ox&#39;</span><span class="p">],</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_ac_et_ox&#39;</span><span class="p">],</span><span class="n">f_IC_et_ox</span><span class="p">]</span>



    <span class="n">f_IC_lac_ox</span><span class="o">=-</span><span class="p">(</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_lac&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro_lac_ox&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_bac&#39;</span><span class="p">]</span>
                <span class="o">+</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro_lac_ox&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;C_pro&#39;</span><span class="p">])</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_lac&quot;</span><span class="p">,</span> <span class="s2">&quot;X_lac&quot;</span><span class="p">,</span><span class="s2">&quot;S_pro&quot;</span><span class="p">,</span><span class="s2">&quot;S_IC&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of lactate&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro_lac_ox&#39;</span><span class="p">],</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;Y_pro_lac_ox&#39;</span><span class="p">],</span><span class="n">f_IC_lac_ox</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_su&quot;</span><span class="p">,</span> <span class="s2">&quot;TSS&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of Xsu&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_aa&quot;</span><span class="p">,</span> <span class="s2">&quot;TSS&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of Xaa&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_fa&quot;</span><span class="p">,</span> <span class="s2">&quot;TSS&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of Xfa&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_ac_et&quot;</span><span class="p">,</span> <span class="s2">&quot;TSS&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of X_ac_et&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_ac_lac&quot;</span><span class="p">,</span> <span class="s2">&quot;TSS&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of X_ac_lac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_chain_et&quot;</span><span class="p">,</span> <span class="s2">&quot;TSS&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of X_chain_et&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_chain_lac&quot;</span><span class="p">,</span> <span class="s2">&quot;TSS&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of X_chain_lac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_VFA_deg&quot;</span><span class="p">,</span> <span class="s2">&quot;TSS&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of X_VFA_deg&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_Me_ac&quot;</span><span class="p">,</span> <span class="s2">&quot;TSS&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of X_Me_ac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;X_Me_CO2&quot;</span><span class="p">,</span> <span class="s2">&quot;TSS&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of X_Me_CO2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_va_ion&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Va)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_bu_ion&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Bu)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_pro_ion&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Pro)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_cap_ion&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Cap)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_lac_ion&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Lac)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_ac_ion&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Ac)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># S[list(map(species.index, [&quot;S_CO2&quot;, &quot;S_hco3_ion&quot;])),  # I don&#39;t think this is right، should look at the reaction in ADM1</span>
    <span class="c1">#     reactions.index(&#39;Acid Base Equilibrium (CO2)&#39;)] = [-1, 1]</span>

    <span class="c1"># S[list(map(species.index, [&quot;S_nh3&quot;, &quot;S_nh4_ion&quot;])),</span>
    <span class="c1">#     reactions.index(&#39;Acid Base Equilibrium (IN)&#39;)] = [-1, 1]  # I don&#39;t think this is right، should look at the reaction in ADM1</span>

    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_h2&quot;</span><span class="p">,</span> <span class="s2">&quot;S_gas_h2&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Gas Transfer H2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;V_liq&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;V_gas&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_ch4&quot;</span><span class="p">,</span> <span class="s2">&quot;S_gas_ch4&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Gas Transfer CH4&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;V_liq&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;V_gas&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">S</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;S_co2&quot;</span><span class="p">,</span> <span class="s2">&quot;S_gas_co2&quot;</span><span class="p">])),</span>
        <span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Gas Transfer CO2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;V_liq&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;V_gas&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">S</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="adtoolbox.adm.modified_adm_ode_sys" class="doc doc-heading">
<code class="highlight language-python"><span class="n">modified_adm_ode_sys</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This function is used to build the ODEs of the modified ADM1 model.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>t</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>a matrix of zeros to be filled</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>c</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>an array of concentrations to be filled</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Model</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="adtoolbox.adm.Model" href="#adtoolbox.adm.Model">Model</a></code>
          </td>
          <td><p>The model to calculate ODE with</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>np.ndarray: The output is dCdt, the change of concentration with respect to time.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>adtoolbox/adm.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">modified_adm_ode_sys</span><span class="p">(</span><span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function is used to build the ODEs of the modified ADM1 model.</span>

<span class="sd">    Args:</span>
<span class="sd">        t (float):a matrix of zeros to be filled</span>
<span class="sd">        c (np.ndarray): an array of concentrations to be filled</span>
<span class="sd">        Model (Model): The model to calculate ODE with</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: The output is dCdt, the change of concentration with respect to time. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">c</span><span class="p">[</span><span class="n">c</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_nh4_ion&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="s1">&#39;S_IN&#39;</span><span class="p">)]</span> <span class="o">-</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_nh3&#39;</span><span class="p">)]</span>
    <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_co2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="s1">&#39;S_IC&#39;</span><span class="p">)]</span> <span class="o">-</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_hco3_ion&#39;</span><span class="p">)]</span>
    <span class="n">I_pH_aa</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;K_pH_aa&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;nn_aa&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)],</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;nn_aa&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;K_pH_aa&quot;</span><span class="p">],</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;nn_aa&#39;</span><span class="p">]))</span>

    <span class="n">I_pH_ac</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_ac&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;n_ac&quot;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_ac&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_ac&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_ac&#39;</span><span class="p">])</span>

    <span class="n">I_pH_pro</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_pro&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;n_pro&quot;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_pro&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_pro&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_pro&#39;</span><span class="p">])</span>

    <span class="n">I_pH_bu</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_bu&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;n_bu&quot;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_bu&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_bu&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_bu&#39;</span><span class="p">])</span>

    <span class="n">I_pH_va</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_va&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;n_va&quot;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_va&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_va&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_va&#39;</span><span class="p">])</span>

    <span class="n">I_pH_cap</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_cap&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;n_cap&quot;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_cap&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_cap&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_cap&#39;</span><span class="p">])</span>

    <span class="n">I_pH_h2</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_h2&#39;</span><span class="p">]</span><span class="o">**</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_h2&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)]</span> <span class="o">**</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_h2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_pH_h2&#39;</span><span class="p">]</span><span class="o">**</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;n_h2&#39;</span><span class="p">])</span>

    <span class="n">I_IN_lim</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> \
        <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_IN&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_IN&#39;</span><span class="p">)]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span><span class="p">)))</span>

    <span class="n">I_h2_fa</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_h2&#39;</span><span class="p">)]</span> <span class="o">/</span>
                   <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_I_h2_fa&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span><span class="p">)))</span>

    <span class="n">I_h2_c4</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_h2&#39;</span><span class="p">)]</span> <span class="o">/</span>
                   <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_I_h2_c4&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span><span class="p">)))</span>

    <span class="n">I_h2_pro</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_h2&#39;</span><span class="p">)]</span> <span class="o">/</span>
                <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_I_h2_pro&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span><span class="p">))))</span>

    <span class="n">I_nh3</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_nh3&#39;</span><span class="p">)]</span> <span class="o">/</span>
               <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_I_nh3&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span><span class="p">)))</span>

    <span class="n">I_h2_oxidation</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_h2&#39;</span><span class="p">)]</span> <span class="o">/</span>
                <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_I_h2_ox&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span><span class="p">))))</span>

    <span class="n">I5</span> <span class="o">=</span> <span class="p">(</span><span class="n">I_pH_aa</span> <span class="o">*</span> <span class="n">I_IN_lim</span><span class="p">)</span>
    <span class="n">I6</span> <span class="o">=</span> <span class="n">I5</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">I7</span> <span class="o">=</span> <span class="p">(</span><span class="n">I_pH_aa</span> <span class="o">*</span> <span class="n">I_IN_lim</span> <span class="o">*</span> <span class="n">I_h2_fa</span><span class="p">)</span>
    <span class="n">I8</span> <span class="o">=</span> <span class="p">(</span><span class="n">I_pH_aa</span> <span class="o">*</span> <span class="n">I_IN_lim</span> <span class="o">*</span> <span class="n">I_h2_c4</span><span class="p">)</span>
    <span class="n">I9</span> <span class="o">=</span> <span class="n">I8</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">I10</span> <span class="o">=</span> <span class="p">(</span><span class="n">I_pH_pro</span> <span class="o">*</span> <span class="n">I_IN_lim</span> <span class="o">*</span> <span class="n">I_h2_pro</span><span class="p">)</span>
    <span class="n">I11</span> <span class="o">=</span> <span class="p">(</span><span class="n">I_pH_ac</span> <span class="o">*</span> <span class="n">I_IN_lim</span> <span class="o">*</span> <span class="n">I_nh3</span><span class="p">)</span>
    <span class="n">I12</span> <span class="o">=</span> <span class="p">(</span><span class="n">I_pH_h2</span> <span class="o">*</span> <span class="n">I_IN_lim</span><span class="p">)</span>
    <span class="n">I13</span> <span class="o">=</span> <span class="p">(</span><span class="n">I_pH_cap</span> <span class="o">*</span> <span class="n">I_IN_lim</span> <span class="o">*</span> <span class="n">I_h2_c4</span><span class="p">)</span>
    <span class="n">I14</span> <span class="o">=</span> <span class="p">(</span><span class="n">I_pH_bu</span> <span class="o">*</span> <span class="n">I_IN_lim</span> <span class="o">*</span> <span class="n">I_h2_c4</span><span class="p">)</span>
    <span class="n">I15</span> <span class="o">=</span> <span class="p">(</span><span class="n">I_pH_va</span> <span class="o">*</span> <span class="n">I_IN_lim</span> <span class="o">*</span> <span class="n">I_h2_c4</span><span class="p">)</span>
    <span class="n">I16</span> <span class="o">=</span> <span class="n">I_IN_lim</span> <span class="o">*</span> <span class="n">I_nh3</span><span class="o">*</span><span class="n">I_pH_aa</span><span class="o">*</span><span class="n">I_h2_oxidation</span>

    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="s1">&#39;TSS_Disintegration&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;k_dis_TSS&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;TSS&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="s1">&#39;TDS_Disintegration&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s2">&quot;k_dis_TDS&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;TDS&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Hydrolysis carbohydrates&#39;</span><span class="p">)</span>
      <span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_hyd_ch&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_ch&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Hydrolysis proteins&#39;</span><span class="p">)</span>
      <span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_hyd_pr&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_pr&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Hydrolysis lipids&#39;</span><span class="p">)</span>
      <span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_hyd_li&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_li&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of sugars&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_su&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_su&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_su&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_su&#39;</span><span class="p">)]</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_su&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I5</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of amino acids&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_aa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_aa&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_aa&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_aa&#39;</span><span class="p">)]</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_aa&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I6</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of LCFA&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_fa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_fa&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_fa&#39;</span><span class="p">]</span> <span class="o">+</span>
         <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_fa&#39;</span><span class="p">)])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_fa&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I7</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of acetate_et&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_ac_et&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_ac_et&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I11</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of acetate_lac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_ac_lac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_ac_lac&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I11</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of propionate_et&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_pro&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_pro&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_pro_et&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_chain_et&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I10</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of propionate_lac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_pro&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_pro&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_pro_lac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_chain_lac&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I10</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of butyrate_et&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_bu&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_bu&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_bu_et&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_chain_et&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I14</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of butyrate_lac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_bu&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_bu&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_bu_lac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_chain_lac&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I14</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of valerate&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_va&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_va&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_va&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_va&#39;</span><span class="p">)]</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_VFA_deg&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I15</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of caproate&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_cap&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_cap&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_cap&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_cap&#39;</span><span class="p">)]</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_VFA_deg&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I13</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Methanogenessis from acetate and h2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_h2_Me_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_h2&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_h2_Me_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_h2&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_ac_Me&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
            <span class="s1">&#39;S_ac&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_h2&#39;</span><span class="p">)]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span><span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_Me_ac&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I12</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Methanogenessis from CO2 and h2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_h2_Me_CO2&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_h2&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_co2&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_h2_Me_CO2&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_h2&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_CO2_Me&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
            <span class="s1">&#39;S_co2&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_co2&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_h2&#39;</span><span class="p">)]</span><span class="o">+</span><span class="mi">10</span><span class="o">**-</span><span class="mi">9</span><span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_Me_CO2&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I12</span>


    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of ethanol&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_et&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_et&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_et&#39;</span><span class="p">)]</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;X_et&quot;</span><span class="p">)]</span><span class="o">*</span><span class="n">I16</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Uptake of lactate&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_m_lac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span> <span class="o">/</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_S_lac&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span>
         <span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_lac&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">I16</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="s1">&#39;Decay of Xsu&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_su&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_su&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="s1">&#39;Decay of Xaa&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_aa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_aa&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="s1">&#39;Decay of Xfa&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_fa&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_fa&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="s1">&#39;Decay of X_ac_et&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_ac_et&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="s1">&#39;Decay of X_ac_lac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_ac_lac&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="s1">&#39;Decay of X_chain_et&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_chain_et&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_chain_et&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Decay of X_chain_lac&#39;</span><span class="p">)</span>
      <span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_chain_lac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_chain_lac&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="s1">&#39;Decay of X_VFA_deg&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_VFA_deg&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_VFA_deg&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="s1">&#39;Decay of X_Me_ac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_Me_ac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_Me_ac&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="s1">&#39;Decay of X_Me_CO2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_Me_CO2&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_Me_CO2&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="s1">&#39;Decay of Xet&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_et&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_et&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="s1">&#39;Decay of Xlac&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_dec_X_lac&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;X_lac&#39;</span><span class="p">)]</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Va)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_va&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_va_ion&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_va&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span> <span class="o">-</span>
         <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_va&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_va&#39;</span><span class="p">)])</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Bu)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_bu&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu_ion&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_bu&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span> <span class="o">-</span>
         <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_bu&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu&#39;</span><span class="p">)])</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Pro)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_pro&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro_ion&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_pro&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span> <span class="o">-</span>
         <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_pro&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro&#39;</span><span class="p">)])</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Cap)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_cap&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_cap_ion&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_cap&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span> <span class="o">-</span>
         <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_cap&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_cap&#39;</span><span class="p">)])</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Lac)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_lac&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac_ion&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_lac&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span> <span class="o">-</span>
         <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_lac&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)])</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (Ac)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_ac&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac_ion&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_ac&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span> <span class="o">-</span>
         <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_ac&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac&#39;</span><span class="p">)])</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (CO2)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_co2&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_hco3_ion&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_co2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span> <span class="o">-</span>
         <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_co2&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_IC&#39;</span><span class="p">)])</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Acid Base Equilibrium (In)&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_A_B_IN&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_nh3&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_IN&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span> <span class="o">-</span>
         <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_IN&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_IC&#39;</span><span class="p">)])</span>

    <span class="n">p_gas_h2</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_gas_h2&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;R&quot;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;T_op&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">16</span>
    <span class="n">p_gas_ch4</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_gas_ch4&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;R&quot;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;T_op&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">64</span>
    <span class="n">p_gas_co2</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_gas_co2&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;R&quot;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;T_op&quot;</span><span class="p">]</span>
    <span class="n">p_gas_h2o</span> <span class="o">=</span> <span class="mf">0.0313</span> <span class="o">*</span> \
        <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">5290</span> <span class="o">*</span>
               <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;T_base&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;T_op&quot;</span><span class="p">]))</span>
    <span class="n">P_gas</span> <span class="o">=</span> <span class="n">p_gas_h2</span> <span class="o">+</span> <span class="n">p_gas_ch4</span> <span class="o">+</span> <span class="n">p_gas_co2</span> <span class="o">+</span> <span class="n">p_gas_h2o</span>
    <span class="n">q_gas</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
        <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_p&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">P_gas</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;P_atm&#39;</span><span class="p">])))</span>
    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Gas Transfer H2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_L_a&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_h2&#39;</span><span class="p">)]</span> <span class="o">-</span> <span class="mi">16</span> <span class="o">*</span>
         <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_H_h2&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">p_gas_h2</span><span class="p">)</span>

    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Gas Transfer CH4&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_L_a&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ch4&#39;</span><span class="p">)]</span> <span class="o">-</span> <span class="mi">64</span> <span class="o">*</span>
         <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_H_ch4&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">p_gas_ch4</span><span class="p">))</span>
    <span class="n">v</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Gas Transfer CO2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;k_L_a&#39;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_co2&#39;</span><span class="p">)]</span> <span class="o">-</span>
         <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_H_co2&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">p_gas_co2</span><span class="p">))</span>

    <span class="n">dCdt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

    <span class="n">phi</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_cation&#39;</span><span class="p">)]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_nh4_ion&#39;</span><span class="p">)]</span><span class="o">-</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_hco3_ion&#39;</span><span class="p">)]</span><span class="o">-</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac_ion&#39;</span><span class="p">)]</span> <span class="o">/</span> <span class="mi">88</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac_ion&#39;</span><span class="p">)]</span> <span class="o">/</span> <span class="mi">64</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro_ion&#39;</span><span class="p">)]</span> <span class="o">/</span>
                                                                                                                                                                     <span class="mi">112</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu_ion&#39;</span><span class="p">)]</span> <span class="o">/</span> <span class="mi">160</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_cap_ion&#39;</span><span class="p">)]</span> <span class="o">/</span> <span class="mi">230</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_va_ion&#39;</span><span class="p">)]</span> <span class="o">/</span> <span class="mi">208</span><span class="p">)</span> <span class="o">-</span> <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_anion&#39;</span><span class="p">)]</span>
    <span class="k">if</span> <span class="s1">&#39;S_H_ion&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">control_state</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">control_state</span><span class="p">[</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">phi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
        <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">phi</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_w&#39;</span><span class="p">]))</span>

    <span class="n">dCdt</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">dCdt</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s1">&#39;q_in&#39;</span><span class="p">]</span> <span class="o">/</span> \
        <span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;V_liq&quot;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">inlet_conditions</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="fm">__len__</span><span class="p">(</span>
        <span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="n">dCdt</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">=</span> <span class="n">dCdt</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span><span class="o">+</span><span class="n">q_gas</span><span class="o">/</span><span class="n">model</span><span class="o">.</span><span class="n">base_parameters</span><span class="p">[</span><span class="s2">&quot;V_gas&quot;</span><span class="p">]</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">inlet_conditions</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span> <span class="o">-</span>
         <span class="mi">3</span><span class="p">:]</span><span class="o">-</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="n">dCdt</span><span class="p">[[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">),</span> <span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
        <span class="s1">&#39;S_co2&#39;</span><span class="p">),</span> <span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_nh4_ion&#39;</span><span class="p">)],</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">switch</span> <span class="o">==</span> <span class="s2">&quot;DAE&quot;</span><span class="p">:</span>
        <span class="n">dCdt</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_h2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">dCdt</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_va_ion&#39;</span><span class="p">):</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_co2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">dCdt</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_nh3&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_va_ion&#39;</span><span class="p">)]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_va&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_va&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_va&#39;</span><span class="p">)]</span>

        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu_ion&#39;</span><span class="p">)]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_bu&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_bu&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_bu&#39;</span><span class="p">)]</span>

        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro_ion&#39;</span><span class="p">)]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_pro&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_pro&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_pro&#39;</span><span class="p">)]</span>

        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_cap_ion&#39;</span><span class="p">)]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_cap&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_cap&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_cap&#39;</span><span class="p">)]</span>

        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac_ion&#39;</span><span class="p">)]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_ac&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_ac&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_ac&#39;</span><span class="p">)]</span>

        <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac_ion&#39;</span><span class="p">)]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_lac&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model_parameters</span><span class="p">[</span><span class="s1">&#39;K_a_lac&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_H_ion&#39;</span><span class="p">)])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;S_lac&#39;</span><span class="p">)]</span>    

    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">control_state</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">control_state</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">c</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">state</span><span class="p">)]</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">control_state</span><span class="p">[</span><span class="n">state</span><span class="p">]</span>
            <span class="n">dCdt</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">state</span><span class="p">)]</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">model</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;Fluxes&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">v</span>
    <span class="k">return</span> <span class="n">dCdt</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="configs">configs</h2>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.a00a7c5e.min.js"></script>
      
    
  </body>
</html>